###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.20.2.41139 for 8051             02/Apr/2014  09:56:16 #
# Copyright 2004-2013 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#                                                                             #
#    Source file        =  E:\wise-house\Projects\zstack\Samples\MyGenericApp #
#                          \Source\GenericApp.c                               #
#    Command line       =  -f E:\wise-house\Projects\zstack\Samples\MyGeneric #
#                          App\CC2530DB\..\..\..\Tools\CC2530DB\f8wCoord.cfg  #
#                          (-DCPU32MHZ -DROOT=__near_func                     #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8         #
#                          -DMAC_CFG_RX_MAX=5 -DZDO_COORDINATOR -DRTR_NWK)    #
#                          -f E:\wise-house\Projects\zstack\Samples\MyGeneric #
#                          App\CC2530DB\..\..\..\Tools\CC2530DB\f8wConfig.cfg #
#                           (-DZIGBEEPRO -DSECURE=0 -DZG_SECURE_DYNAMIC=0     #
#                          -DREFLECTOR -DDEFAULT_CHANLIST=0x00000800          #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=TRUE -DPOLL_RATE=1000         #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 E:\wise-house\Projects\zsta #
#                          ck\Samples\MyGenericApp\Source\GenericApp.c -D     #
#                          ZTOOL_P1 -D MT_TASK -D MT_SYS_FUNC -D MT_ZDO_FUNC  #
#                          -D LCD_SUPPORTED=DEBUG -D NV_RESTORE=1 -lC         #
#                          E:\wise-house\Projects\zstack\Samples\MyGenericApp #
#                          \CC2530DB\CoordinatorEB\List\ -lA                  #
#                          E:\wise-house\Projects\zstack\Samples\MyGenericApp #
#                          \CC2530DB\CoordinatorEB\List\ --diag_suppress      #
#                          Pe001,Pa010 -o E:\wise-house\Projects\zstack\Sampl #
#                          es\MyGenericApp\CC2530DB\CoordinatorEB\Obj\ -e     #
#                          --debug --core=plain --dptr=16,1                   #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I E:\wise-house\Projects\zstack\Samples\MyGeneric #
#                          App\CC2530DB\ -I E:\wise-house\Projects\zstack\Sam #
#                          ples\MyGenericApp\CC2530DB\..\Source\ -I           #
#                          E:\wise-house\Projects\zstack\Samples\MyGenericApp #
#                          \CC2530DB\..\..\..\ZMain\TI2530DB\ -I              #
#                          E:\wise-house\Projects\zstack\Samples\MyGenericApp #
#                          \CC2530DB\..\..\..\..\..\Components\hal\include\   #
#                          -I E:\wise-house\Projects\zstack\Samples\MyGeneric #
#                          App\CC2530DB\..\..\..\..\..\Components\hal\target\ #
#                          CC2530EB\ -I E:\wise-house\Projects\zstack\Samples #
#                          \MyGenericApp\CC2530DB\..\..\..\..\..\Components\m #
#                          ac\include\ -I E:\wise-house\Projects\zstack\Sampl #
#                          es\MyGenericApp\CC2530DB\..\..\..\..\..\Components #
#                          \mac\high_level\ -I E:\wise-house\Projects\zstack\ #
#                          Samples\MyGenericApp\CC2530DB\..\..\..\..\..\Compo #
#                          nents\mac\low_level\srf04\ -I                      #
#                          E:\wise-house\Projects\zstack\Samples\MyGenericApp #
#                          \CC2530DB\..\..\..\..\..\Components\mac\low_level\ #
#                          srf04\single_chip\ -I E:\wise-house\Projects\zstac #
#                          k\Samples\MyGenericApp\CC2530DB\..\..\..\..\..\Com #
#                          ponents\mt\ -I E:\wise-house\Projects\zstack\Sampl #
#                          es\MyGenericApp\CC2530DB\..\..\..\..\..\Components #
#                          \osal\include\ -I E:\wise-house\Projects\zstack\Sa #
#                          mples\MyGenericApp\CC2530DB\..\..\..\..\..\Compone #
#                          nts\services\saddr\ -I E:\wise-house\Projects\zsta #
#                          ck\Samples\MyGenericApp\CC2530DB\..\..\..\..\..\Co #
#                          mponents\services\sdata\ -I                        #
#                          E:\wise-house\Projects\zstack\Samples\MyGenericApp #
#                          \CC2530DB\..\..\..\..\..\Components\stack\af\ -I   #
#                          E:\wise-house\Projects\zstack\Samples\MyGenericApp #
#                          \CC2530DB\..\..\..\..\..\Components\stack\nwk\ -I  #
#                          E:\wise-house\Projects\zstack\Samples\MyGenericApp #
#                          \CC2530DB\..\..\..\..\..\Components\stack\sapi\    #
#                          -I E:\wise-house\Projects\zstack\Samples\MyGeneric #
#                          App\CC2530DB\..\..\..\..\..\Components\stack\sec\  #
#                          -I E:\wise-house\Projects\zstack\Samples\MyGeneric #
#                          App\CC2530DB\..\..\..\..\..\Components\stack\sys\  #
#                          -I E:\wise-house\Projects\zstack\Samples\MyGeneric #
#                          App\CC2530DB\..\..\..\..\..\Components\stack\zdo\  #
#                          -I E:\wise-house\Projects\zstack\Samples\MyGeneric #
#                          App\CC2530DB\..\..\..\..\..\Components\zmac\ -I    #
#                          E:\wise-house\Projects\zstack\Samples\MyGenericApp #
#                          \CC2530DB\..\..\..\..\..\Components\zmac\f8w\ -Ohz #
#    List file          =  E:\wise-house\Projects\zstack\Samples\MyGenericApp #
#                          \CC2530DB\CoordinatorEB\List\GenericApp.lst        #
#    Object file        =  E:\wise-house\Projects\zstack\Samples\MyGenericApp #
#                          \CC2530DB\CoordinatorEB\Obj\GenericApp.r51         #
#                                                                             #
#                                                                             #
###############################################################################

E:\wise-house\Projects\zstack\Samples\MyGenericApp\Source\GenericApp.c
      1          /******************************************************************************
      2          	Filename:       GenericApp.c
      3          	Revised:        $Date: 2012-03-07 01:04:58 -0800 (Wed, 07 Mar 2012) $
      4          	Revision:       $Revision: 29656 $
      5          
      6          	Description:    Generic Application (no Profile).
      7          
      8          
      9          	Copyright 2004-2012 Texas Instruments Incorporated. All rights reserved.
     10          
     11          	IMPORTANT: Your use of this Software is limited to those specific rights
     12          	granted under the terms of a software license agreement between the user
     13          	who downloaded the software, his/her employer (which must be your employer)
     14          	and Texas Instruments Incorporated (the "License"). You may not use this
     15          	Software unless you agree to abide by the terms of the License. The License
     16          	limits your use, and you acknowledge, that the Software may not be modified,
     17          	copied or distributed unless embedded on a Texas Instruments microcontroller
     18          	or used solely and exclusively in conjunction with a Texas Instruments radio
     19          	frequency transceiver, which is integrated into your product. Other than for
     20          	the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21          	works of, modify, distribute, perform, display or sell this Software and/or
     22          	its documentation for any purpose.
     23          
     24          	YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25          	PROVIDED AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26          	INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27          	NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28          	TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29          	NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30          	LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31          	INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32          	OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33          	OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34          	(INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36          	Should you have any questions regarding your right to use this Software,
     37          	contact Texas Instruments Incorporated at www.TI.com.
     38          ******************************************************************************/
     39          
     40          /*********************************************************************
     41          	This application isn't intended to do anything useful, it is
     42          	intended to be a simple example of an application's structure.
     43          
     44          	This application sends "Hello World" to another "Generic"
     45          	application every 5 seconds.  The application will also
     46          	receives "Hello World" packets.
     47          
     48          	The "Hello World" messages are sent/received as MSG type message.
     49          
     50          	This applications doesn't have a profile, so it handles everything
     51          	directly - itself.
     52          
     53          	Key control:
     54          		SW1:
     55          		SW2:  initiates end device binding
     56          		SW3:
     57          		SW4:  initiates a match description request
     58          *********************************************************************/
     59          
     60          /*********************************************************************
     61           * INCLUDES
     62           */
     63          #include "OSAL.h"
     64          #include "AF.h"
     65          #include "ZDApp.h"
     66          #include "ZDObject.h"
     67          #include "ZDProfile.h"
     68          #include "osal_nv.h"
     69          
     70          #include "GenericApp.h"
     71          #include "DebugTrace.h"
     72          
     73          #if !defined( WIN32 )
     74          	#include "OnBoard.h"
     75          #endif
     76          
     77          /* HAL */
     78          #include "hal_lcd.h"
     79          #include "hal_led.h"
     80          #include "hal_key.h"
     81          #include "hal_uart.h"
     82          
     83          #include <stdlib.h>
     84          #include <stdio.h>
     85          #include <string.h>
     86          #include <math.h>
     87          
     88          /* RTOS */
     89          #if defined( IAR_ARMCM3_LM )
     90          #include "RTOS_App.h"
     91          #endif  
     92          #include "chdebug.h"
     93          
     94          /*********************************************************************
     95           * MACROS
     96           */
     97          
     98          /*********************************************************************
     99           * CONSTANTS
    100           */
    101          
    102          /*********************************************************************
    103           * TYPEDEFS
    104           */
    105          
    106          /*********************************************************************
    107           * GLOBAL VARIABLES
    108           */
    109          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
    110          const cId_t GenericApp_ClusterList[GENERICAPP_MAX_CLUSTERS] =
   \                     GenericApp_ClusterList:
   \   000000   0100         DW 1
    111          {
    112          	GENERICAPP_CLUSTERID
    113          };
    114          

   \                                 In  segment XDATA_ROM_C, align 1
    115          const SimpleDescriptionFormat_t GenericApp_SimpleDesc =
   \                     GenericApp_SimpleDesc:
   \   000000   0A           DB 10
   \   000001   040F         DW 3844
   \   000003   0100         DW 1
   \   000005   00           DB 0
   \   000006   01           DB 1
   \   000007   ....         DW GenericApp_ClusterList
   \   000009   01           DB 1
   \   00000A   ....         DW GenericApp_ClusterList
    116          {
    117          	GENERICAPP_ENDPOINT,              //  int Endpoint;
    118          	GENERICAPP_PROFID,                //  uint16 AppProfId[2];
    119          	GENERICAPP_DEVICEID,              //  uint16 AppDeviceId[2];
    120          	GENERICAPP_DEVICE_VERSION,        //  int   AppDevVer:4;
    121          	GENERICAPP_FLAGS,                 //  int   AppFlags:4;
    122          	GENERICAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    123          	(cId_t *)GenericApp_ClusterList,  //  byte *pAppInClusterList;
    124          	GENERICAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    125          	(cId_t *)GenericApp_ClusterList   //  byte *pAppInClusterList;
    126          };
    127          
    128          // This is the Endpoint/Interface description.  It is defined here, but
    129          // filled-in in GenericApp_Init().  Another way to go would be to fill
    130          // in the structure here and make it a "const" (in code space).  The
    131          // way it's defined in this sample app it is define in RAM.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    132          endPointDesc_t GenericApp_epDesc;
   \                     GenericApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE __INIT_XDATA_Z
    133          
    134          
    135          void UartControlSend(uint8*buf,uint8 len);
    136          /*********************************************************************
    137           * EXTERNAL VARIABLES
    138           */
    139          
    140          /*********************************************************************
    141           * EXTERNAL FUNCTIONS
    142           */
    143          /*********************************************************************
    144           * TYPEDEFS
    145           */
    146          #if !defined( SERIAL_APP_PORT )
    147          #define SERIAL_APP_PORT  0
    148          #endif
    149          
    150          #if !defined( SERIAL_APP_BAUD )
    151          //#define SERIAL_APP_BAUD  HAL_UART_BR_38400
    152          #define SERIAL_APP_BAUD  HAL_UART_BR_115200
    153          #endif
    154          
    155          // When the Rx buf space is less than this threshold, invoke the Rx callback.
    156          #if !defined( SERIAL_APP_THRESH )
    157          #define SERIAL_APP_THRESH  64
    158          #endif
    159          
    160          #if !defined( SERIAL_APP_RX_SZ )
    161          #define SERIAL_APP_RX_SZ  128
    162          #endif
    163          
    164          #if !defined( SERIAL_APP_TX_SZ )
    165          #define SERIAL_APP_TX_SZ  128
    166          #endif
    167          
    168          // Millisecs of idle time after a byte is received before invoking Rx callback.
    169          #if !defined( SERIAL_APP_IDLE )
    170          #define SERIAL_APP_IDLE  6
    171          #endif
    172          
    173          // Loopback Rx bytes to Tx for throughput testing.
    174          #if !defined( SERIAL_APP_LOOPBACK )
    175          #define SERIAL_APP_LOOPBACK  FALSE
    176          #endif
    177          
    178          // This is the max byte count per OTA message.
    179          #if !defined( SERIAL_APP_TX_MAX )
    180          #define SERIAL_APP_TX_MAX  256
    181          #endif
    182          
    183          
    184          /*********************************************************************
    185           * GLOBAL VARIABLES
    186           */
    187          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    188          XDATA static uint8 SerialApp_Buf[SERIAL_APP_TX_MAX];
   \                     SerialApp_Buf:
   \   000000                DS 256
   \   000100                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    189          XDATA static uint8 SerialApp_Len = 0;
   \                     SerialApp_Len:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    190          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    191          XDATA static uint8 bufBig_gen[256] = {0};//大的缓存，用于读写flash等
   \                     bufBig_gen:
   \   000000                DS 256
   \   000100                REQUIRE __INIT_XDATA_Z
    192          #if defined(ZDO_COORDINATOR)
    193          
    194          
    195          
    196          
    197          #endif
    198          #if ! defined(RTR_NWK)
    199          static uint16 GroupId_gen = 0;
    200          static uint8 ledBrightness_gen = 0xff;
    201          static uint8 ledYellow_gen = 0xff;
    202          static uint8 ledColorR_gen = 0xff;
    203          static uint8 ledColorG_gen = 0xff;
    204          static uint8 ledColorB_gen = 0xff;
    205          #endif
    206          
    207          
    208          #define GENERICAPP_CMDID_REPORT_SHORTADDR			0x0001
    209          #define GENERICAPP_CMDID_ZD0_RESTART					0x0002
    210          #define GENERICAPP_CMDID_SYNC_STATUS					0x0007
    211          #define GENERICAPP_CMDID_LIGHT			0x0011
    212          #define GENERICAPP_CMDID_SET_DEVICE_NAME	0x0021
    213          #define GENERICAPP_CMDID_READ_DEVICE_NAME	0x0022
    214          #define GENERICAPP_CMDID_REPORT_DEVICE_NAME	0x0023
    215          #define GENERICAPP_CMDID_ADD_TO_GROUP		0x0031
    216          #define GENERICAPP_CMDID_REMOVE_FROM_GROUP	0x0032
    217          #define GENERICAPP_CMDID_READ_GROUP_ID		0x0033
    218          #define GENERICAPP_CMDID_REPORT_GROUP_ID		0x0034
    219          ////因为zigbee自带的组播消息在快速反复操作时，会有消息丢失的现象，故改用广播消息中判断
    220          #define GENERICAPP_CMDID_BROADCAST_GROUP_CTRL		0x0041		
    221          /*********************************************************************
    222           * LOCAL VARIABLES
    223           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    224          byte GenericApp_TaskID;   // Task ID for internal task/event processing
   \                     GenericApp_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    225          													// This variable will be received when
    226          													// GenericApp_Init() is called.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    227          devStates_t GenericApp_NwkState;
   \                     GenericApp_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    228          
    229          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    230          byte GenericApp_TransID;  // This is the unique message ID (counter)
   \                     GenericApp_TransID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    231          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    232          afAddrType_t GenericApp_DstAddr;
   \                     GenericApp_DstAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z
    233          
    234          #define ZIGBEE_PROTOCOL_DATA_START			2
    235          
    236          #define UART_PROTOCOL_SEQ_START			2
    237          #define UART_PROTOCOL_ACK_START			6
    238          #define UART_PROTOCOL_CMDID_START			7
    239          #define UART_PROTOCOL_DATA_START				9
    240          
    241          extern XDATA uint32 ramdomSeed;

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    242          XDATA uint8 syncStatusCnt = 0;
   \                     syncStatusCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    243          XDATA uint8 syncStatusOk = 0;
   \                     syncStatusOk:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    244          /*********************************************************************
    245           * LOCAL FUNCTIONS
    246           */
    247          static void GenericApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg );
    248          static void GenericApp_HandleKeys( byte shift, byte keys );
    249          static void GenericApp_MessageMSGCB( afIncomingMSGPacket_t *pckt );
    250          static void GenericApp_SendMessage(afAddrMode_t addrMode,uint16 addr ,uint8* buf,uint16 buflen );
    251          static void GenericApp_SendMessageCmd(afAddrMode_t addrMode,uint16 addr ,uint16 cmd,uint8* buf,uint16 buflen );
    252          
    253          #if defined( IAR_ARMCM3_LM )
    254          static void GenericApp_ProcessRtosMessage( void );
    255          #endif
    256          static void SerialApp_CallBack(uint8 port, uint8 event);
    257          void PrintDeviceList_gen(void);
    258          void initTimer4();
    259          #if ! defined(RTR_NWK)
    260          void ProcessMsgLight(uint8* data);
    261          
    262          #endif
    263          void ReportStatus();
    264          void UartControlSendCmd(uint16 retCmdId,uint8*buf,uint8 dataLen);
    265          uint8 CalcChecksum(uint8*buf,uint8 len);
    266          void UartControlSend(uint8*buf,uint8 dataLen);
    267          void UartControlSendAck(uint8*buf);
    268          
    269          /*********************************************************************
    270           * NETWORK LAYER CALLBACKS
    271           */
    272          
    273          
    274          
    275          /*********************************************************************
    276           * @fn      GenericApp_Init
    277           *
    278           * @brief   Initialization function for the Generic App Task.
    279           *          This is called during initialization and should contain
    280           *          any application specific initialization (ie. hardware
    281           *          initialization/setup, table initialization, power up
    282           *          notificaiton ... ).
    283           *
    284           * @param   task_id - the ID assigned by OSAL.  This ID should be
    285           *                    used to send messages and set timers.
    286           *
    287           * @return  none
    288           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    289          void GenericApp_Init( uint8 task_id )
   \                     GenericApp_Init:
    290          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 29
   \   000005   74E3         MOV     A,#-0x1d
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
    291          	#if ! defined(ZDO_COORDINATOR)
    292          	//P0_2=uart0_RX,P0_3=uart0_TX,串口冲突
    293          	P0SEL = 0;
    294          	P0DIR = 0x7C;//port:p0_2~p0_6
    295          	P0INP = 0;
    296          
    297          	P0_3 = 1;
    298          	P0_4 = 1;
    299          	P0_5 = 1;
    300          	P0_6 = 1;
    301          	P0_2 = 0;
    302          	#endif
    303          	halUARTCfg_t uartConfig;
    304          
    305          #if 0
    306          	uartConfig.configured = TRUE;
    307          	uartConfig.baudRate = HAL_UART_BR_115200;
    308          	uartConfig.flowControl          = FALSE;
    309          	uartConfig.flowControlThreshold = SERIAL_APP_THRESH;
    310          	uartConfig.rx.maxBufSize        = SERIAL_APP_RX_SZ;
    311          	uartConfig.tx.maxBufSize        = SERIAL_APP_TX_SZ;
    312          	uartConfig.idleTimeout          = SERIAL_APP_IDLE;
    313          	uartConfig.intEnable            = TRUE;
    314          	uartConfig.callBackFunc         = SerialApp_CallBack;
    315          	HalUARTOpen(DEBUG_PORT,&uartConfig);
    316          
    317          	dbgtag(("hello world\r\n"));
    318          
    319          #endif
    320          #if 1
    321          	uartConfig.configured = TRUE;
   \   00000C   85..82       MOV     DPL,?XSP + 0
   \   00000F   85..83       MOV     DPH,?XSP + 1
   \   000012   7401         MOV     A,#0x1
   \   000014   F0           MOVX    @DPTR,A
    322          	uartConfig.baudRate = HAL_UART_BR_115200;
   \   000015   12....       LCALL   ?XSTACK_DISP0_8
   \   000018   7404         MOV     A,#0x4
   \   00001A   F0           MOVX    @DPTR,A
    323          	uartConfig.flowControl          = FALSE;
   \   00001B   7402         MOV     A,#0x2
   \   00001D   12....       LCALL   ?XSTACK_DISP0_8
   \   000020   E4           CLR     A
   \   000021   F0           MOVX    @DPTR,A
    324          	uartConfig.flowControlThreshold = SERIAL_APP_THRESH;
   \   000022   7403         MOV     A,#0x3
   \   000024   12....       LCALL   ?XSTACK_DISP0_8
   \   000027   7440         MOV     A,#0x40
   \   000029   F0           MOVX    @DPTR,A
   \   00002A   A3           INC     DPTR
   \   00002B   E4           CLR     A
   \   00002C   F0           MOVX    @DPTR,A
    325          	uartConfig.rx.maxBufSize        = SERIAL_APP_RX_SZ;
   \   00002D   740A         MOV     A,#0xa
   \   00002F   12....       LCALL   ?XSTACK_DISP0_8
   \   000032   7480         MOV     A,#-0x80
   \   000034   F0           MOVX    @DPTR,A
   \   000035   A3           INC     DPTR
   \   000036   E4           CLR     A
   \   000037   F0           MOVX    @DPTR,A
    326          	uartConfig.tx.maxBufSize        = SERIAL_APP_TX_SZ;
   \   000038   7412         MOV     A,#0x12
   \   00003A   12....       LCALL   ?XSTACK_DISP0_8
   \   00003D   7480         MOV     A,#-0x80
   \   00003F   F0           MOVX    @DPTR,A
   \   000040   A3           INC     DPTR
   \   000041   E4           CLR     A
   \   000042   F0           MOVX    @DPTR,A
    327          	uartConfig.idleTimeout          = SERIAL_APP_IDLE;
   \   000043   7405         MOV     A,#0x5
   \   000045   12....       LCALL   ?XSTACK_DISP0_8
   \   000048   7406         MOV     A,#0x6
   \   00004A   F0           MOVX    @DPTR,A
    328          	uartConfig.intEnable            = TRUE;
   \   00004B   7416         MOV     A,#0x16
   \   00004D   12....       LCALL   ?XSTACK_DISP0_8
   \   000050   7401         MOV     A,#0x1
   \   000052   F0           MOVX    @DPTR,A
    329          	uartConfig.callBackFunc         = NULL;//SerialApp_CallBack;
   \   000053   741B         MOV     A,#0x1b
   \   000055   12....       LCALL   ?XSTACK_DISP0_8
   \   000058   E4           CLR     A
   \   000059   F0           MOVX    @DPTR,A
   \   00005A   A3           INC     DPTR
   \   00005B   F0           MOVX    @DPTR,A
    330          	dbgopen(&uartConfig);
    331          
    332          	dbgtag(("hello world\r\n"));
    333          	//dbgint(("short=%d\r\n",sizeof(short)));
    334          	//dbgint(("int=%d\r\n",sizeof(int)));
    335          	//dbgint(("long=%d\r\n",sizeof(long)));
    336          
    337          	uartConfig.configured = TRUE;
    338          	uartConfig.baudRate = HAL_UART_BR_115200;
    339          	uartConfig.flowControl          = FALSE;
    340          	uartConfig.flowControlThreshold = SERIAL_APP_THRESH;
    341          	uartConfig.rx.maxBufSize        = SERIAL_APP_RX_SZ;
    342          	uartConfig.tx.maxBufSize        = SERIAL_APP_TX_SZ;
    343          	uartConfig.idleTimeout          = SERIAL_APP_IDLE;
    344          	uartConfig.intEnable            = TRUE;
    345          	uartConfig.callBackFunc         = SerialApp_CallBack;
   \   00005C   741B         MOV     A,#0x1b
   \   00005E   12....       LCALL   ?XSTACK_DISP0_8
   \   000061   74..         MOV     A,#??SerialApp_CallBack?relay & 0xff
   \   000063   F0           MOVX    @DPTR,A
   \   000064   A3           INC     DPTR
   \   000065   74..         MOV     A,#(??SerialApp_CallBack?relay >> 8) & 0xff
   \   000067   12....       LCALL   ?Subroutine3 & 0xFFFF
    346          	HalUARTOpen(CTRL_PORT,&uartConfig);
   \                     ??CrossCallReturnLabel_3:
   \   00006A   AA82         MOV     R2,DPL
   \   00006C   AB83         MOV     R3,DPH
   \   00006E   7900         MOV     R1,#0x0
   \   000070   12....       LCALL   ??HalUARTOpen?relay
    347          #endif
    348          	#if defined(ZDO_COORDINATOR)
    349          	
    350          	#endif
    351          
    352          	GenericApp_TaskID = task_id;
   \   000073   EE           MOV     A,R6
   \   000074   90....       MOV     DPTR,#GenericApp_TaskID
   \   000077   F0           MOVX    @DPTR,A
    353          	GenericApp_NwkState = DEV_INIT;
   \   000078   90....       MOV     DPTR,#GenericApp_NwkState
   \   00007B   7401         MOV     A,#0x1
   \   00007D   F0           MOVX    @DPTR,A
    354          	GenericApp_TransID = 0;
   \   00007E   90....       MOV     DPTR,#GenericApp_TransID
   \   000081   E4           CLR     A
   \   000082   F0           MOVX    @DPTR,A
    355          
    356          	// Device hardware initialization can be added here or in main() (Zmain.c).
    357          	// If the hardware is application specific - add it here.
    358          	// If the hardware is other parts of the device add it in main().
    359          
    360          #if defined(ZDO_COORDINATOR)
    361          	GenericApp_DstAddr.addrMode = (afAddrMode_t)AddrNotPresent;
   \   000083   90....       MOV     DPTR,#GenericApp_DstAddr + 8
   \   000086   F0           MOVX    @DPTR,A
    362          	GenericApp_DstAddr.endPoint = 0;
   \   000087   A3           INC     DPTR
   \   000088   F0           MOVX    @DPTR,A
    363          	GenericApp_DstAddr.addr.shortAddr = 0;
   \   000089   90....       MOV     DPTR,#GenericApp_DstAddr
   \   00008C   F0           MOVX    @DPTR,A
   \   00008D   A3           INC     DPTR
   \   00008E   F0           MOVX    @DPTR,A
    364          #else
    365          	GenericApp_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;
    366          	GenericApp_DstAddr.addr.shortAddr = 0;
    367          	// Take the first endpoint, Can be changed to search through endpoints
    368          	GenericApp_DstAddr.endPoint = GENERICAPP_ENDPOINT;
    369          
    370          
    371          #endif
    372          
    373          	// Fill out the endpoint description.
    374          	GenericApp_epDesc.endPoint = GENERICAPP_ENDPOINT;
   \   00008F   90....       MOV     DPTR,#GenericApp_epDesc
   \   000092   740A         MOV     A,#0xa
   \   000094   F0           MOVX    @DPTR,A
    375          	GenericApp_epDesc.task_id = &GenericApp_TaskID;
   \   000095   A3           INC     DPTR
   \   000096   74..         MOV     A,#GenericApp_TaskID & 0xff
   \   000098   F0           MOVX    @DPTR,A
   \   000099   A3           INC     DPTR
   \   00009A   74..         MOV     A,#(GenericApp_TaskID >> 8) & 0xff
   \   00009C   F0           MOVX    @DPTR,A
    376          	GenericApp_epDesc.simpleDesc
    377          						= (SimpleDescriptionFormat_t *)&GenericApp_SimpleDesc;
   \   00009D   A3           INC     DPTR
   \   00009E   74..         MOV     A,#GenericApp_SimpleDesc & 0xff
   \   0000A0   F0           MOVX    @DPTR,A
   \   0000A1   A3           INC     DPTR
   \   0000A2   74..         MOV     A,#(GenericApp_SimpleDesc >> 8) & 0xff
   \   0000A4   F0           MOVX    @DPTR,A
    378          	GenericApp_epDesc.latencyReq = noLatencyReqs;
   \   0000A5   A3           INC     DPTR
   \   0000A6   E4           CLR     A
   \   0000A7   F0           MOVX    @DPTR,A
    379          
    380          
    381          	#if defined(ZDO_COORDINATOR)
    382          	//若条目不存在，初始化条目的内容为0
    383          	//memset(bufBig_gen,0,sizeof(bufBig_gen));
    384          	UartControlSendCmd(0x9001,bufBig_gen,0);
   \   0000A8                ; Setup parameters for call to function UartControlSendCmd
   \   0000A8   F9           MOV     R1,A
   \   0000A9   7C..         MOV     R4,#bufBig_gen & 0xff
   \   0000AB   7D..         MOV     R5,#(bufBig_gen >> 8) & 0xff
   \   0000AD   7A01         MOV     R2,#0x1
   \   0000AF   7B90         MOV     R3,#-0x70
   \   0000B1   12....       LCALL   ??UartControlSendCmd?relay
    385          
    386          	#elif ! defined(RTR_NWK)
    387          	initTimer4();
    388          	//若条目存在，则读出
    389          	#endif
    390          	// Register the endpoint description with the AF
    391          	afRegister( &GenericApp_epDesc );
   \   0000B4                ; Setup parameters for call to function afRegister
   \   0000B4   7A..         MOV     R2,#GenericApp_epDesc & 0xff
   \   0000B6   7B..         MOV     R3,#(GenericApp_epDesc >> 8) & 0xff
   \   0000B8   12....       LCALL   ??afRegister?relay
    392          
    393          	// Register for all key events - This app will handle all key events
    394          	RegisterForKeys( GenericApp_TaskID );
   \   0000BB                ; Setup parameters for call to function RegisterForKeys
   \   0000BB   90....       MOV     DPTR,#GenericApp_TaskID
   \   0000BE   E0           MOVX    A,@DPTR
   \   0000BF   F9           MOV     R1,A
   \   0000C0   12....       LCALL   ??RegisterForKeys?relay
    395          
    396          	// Update the display
    397          #if defined ( LCD_SUPPORTED )
    398          	//HalLcdWriteString( "GenericApp", HAL_LCD_LINE_1 );
    399          #endif
    400          
    401          	//ZDO_RegisterForZDOMsg( GenericApp_TaskID, End_Device_Bind_rsp );
    402          	//ZDO_RegisterForZDOMsg( GenericApp_TaskID, Match_Desc_rsp );
    403          
    404          #if defined( IAR_ARMCM3_LM )
    405          	// Register this task with RTOS task initiator
    406          	RTOS_RegisterApp( task_id, GENERICAPP_RTOS_MSG_EVT );
    407          #endif
    408          
    409          }
   \   0000C3   741D         MOV     A,#0x1d
   \   0000C5   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000C8   02....       LJMP    ?Subroutine0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   F0           MOVX    @DPTR,A
   \   000001                ; Setup parameters for call to function HalUARTOpen
   \   000001   85..82       MOV     DPL,?XSP + 0
   \   000004   85..83       MOV     DPH,?XSP + 1
   \   000007   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    410          
    411          /*********************************************************************
    412           * @fn      GenericApp_ProcessEvent
    413           *
    414           * @brief   Generic Application Task event processor.  This function
    415           *          is called to process all events for the task.  Events
    416           *          include timers, messages and any other user defined events.
    417           *
    418           * @param   task_id  - The OSAL assigned task ID.
    419           * @param   events - events to process.  This is a bit map and can
    420           *                   contain more than one event.
    421           *
    422           * @return  none
    423           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    424          uint16 GenericApp_ProcessEvent( uint8 task_id, uint16 events )
   \                     GenericApp_ProcessEvent:
    425          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 9
   \   000005   74F7         MOV     A,#-0x9
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    426          	afIncomingMSGPacket_t *MSGpkt;
    427          	afDataConfirm_t *afDataConfirm;
    428          
    429          	// Data Confirmation message fields
    430          	byte sentEP;
    431          	ZStatus_t sentStatus;
    432          	byte sentTransID;       // This should match the value sent
    433          	(void)task_id;  // Intentionally unreferenced parameter
    434          
    435          	if ( events & SYS_EVENT_MSG )
   \   00000E   5480         ANL     A,#0x80
   \   000010   7003         JNZ     $+5
   \   000012   02....       LJMP    ??GenericApp_ProcessEvent_0 & 0xFFFF
    436          	{
    437          		MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( GenericApp_TaskID );
   \   000015                ; Setup parameters for call to function osal_msg_receive
   \   000015   90....       MOV     DPTR,#GenericApp_TaskID
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F9           MOV     R1,A
   \   00001A   12....       LCALL   ??osal_msg_receive?relay
   \   00001D   8A..         MOV     ?V0 + 0,R2
   \   00001F   8B..         MOV     ?V0 + 1,R3
   \   000021   75....       MOV     ?V0 + 4,#GenericApp_ClusterList & 0xff
   \   000024   75....       MOV     ?V0 + 5,#(GenericApp_ClusterList >> 8) & 0xff
   \   000027   8044         SJMP    ??GenericApp_ProcessEvent_1
    438          		while ( MSGpkt )
    439          		{
    440          			dbghex(("event=%x,",MSGpkt->hdr.event));
    441          			dbghex(("addr=%x\r\n",NLME_GetShortAddr()));
    442          		 	switch ( MSGpkt->hdr.event )
    443          			{
    444          				case ZDO_CB_MSG:
    445          					GenericApp_ProcessZDOMsgs( (zdoIncomingMsg_t *)MSGpkt );
    446          					break;
    447          
    448          				case KEY_CHANGE:
    449          					GenericApp_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    450          					break;
    451          
    452          				case AF_DATA_CONFIRM_CMD:
    453          					// This message is received as a confirmation of a data packet sent.
    454          					// The status is of ZStatus_t type [defined in ZComDef.h]
    455          					// The message fields are defined in AF.h
    456          					afDataConfirm = (afDataConfirm_t *)MSGpkt;
    457          					sentEP = afDataConfirm->endpoint;
    458          					sentStatus = afDataConfirm->hdr.status;
    459          					sentTransID = afDataConfirm->transID;
    460          					(void)sentEP;
    461          					(void)sentTransID;
    462          
    463          					// Action taken when confirmation is received.
    464          					if ( sentStatus != ZSuccess )
    465          					{
    466          						// The data wasn't delivered -- Do something
    467          					}
    468          					break;
    469          
    470          				case AF_INCOMING_MSG_CMD:
    471          					GenericApp_MessageMSGCB( MSGpkt );
    472          					break;
    473          
    474          				case ZDO_STATE_CHANGE:
    475          					GenericApp_NwkState = (devStates_t)(MSGpkt->hdr.status);
   \                     ??GenericApp_ProcessEvent_2:
   \   000029   A3           INC     DPTR
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   90....       MOV     DPTR,#GenericApp_NwkState
   \   00002E   F0           MOVX    @DPTR,A
    476          					dbghex(("ZDO_STATE_CHANGE=%x,",GenericApp_NwkState));
    477          					dbghex(("addr=%x\r\n",NLME_GetShortAddr()));
    478          					#if defined(ZDO_COORDINATOR)
    479          						if ( (GenericApp_NwkState == DEV_ZB_COORD))
   \   00002F   6409         XRL     A,#0x9
   \   000031   7027         JNZ     ??GenericApp_ProcessEvent_3
    480          						{
    481          							GenericApp_SendMessageCmd(afAddrBroadcast, 0xffff,GENERICAPP_CMDID_ZD0_RESTART, bufBig_gen, 0);							
   \   000033                ; Setup parameters for call to function GenericApp_SendMessageCmd
   \   000033   E4           CLR     A
   \   000034   F5..         MOV     ?V0 + 2,A
   \   000036   F5..         MOV     ?V0 + 3,A
   \   000038   78..         MOV     R0,#?V0 + 2
   \   00003A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003D   75....       MOV     ?V0 + 2,#bufBig_gen & 0xff
   \   000040   75....       MOV     ?V0 + 3,#(bufBig_gen >> 8) & 0xff
   \   000043   78..         MOV     R0,#?V0 + 2
   \   000045   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000048   7C02         MOV     R4,#0x2
   \   00004A   7D00         MOV     R5,#0x0
   \   00004C   7AFF         MOV     R2,#-0x1
   \   00004E   7BFF         MOV     R3,#-0x1
   \   000050   790F         MOV     R1,#0xf
   \   000052   12....       LCALL   ??GenericApp_SendMessageCmd?relay
   \   000055   7404         MOV     A,#0x4
   \   000057   12....       LCALL   ?DEALLOC_XSTACK8
    482          						}
    483          					#elif ! defined(RTR_NWK)
    484          						if ( GenericApp_NwkState == DEV_END_DEVICE )
    485          						{
    486          							syncStatusCnt = 0;
    487          							srand(ramdomSeed);
    488          							osal_start_timerEx( GenericApp_TaskID,EVT_SyncStatus_Generic,rand()%300 );
    489          						}
    490          					#endif
    491          
    492          					break;
    493          
    494          				default:
    495          					break;
    496          			}
    497          
    498          			// Release the memory
    499          			osal_msg_deallocate( (uint8 *)MSGpkt );
   \                     ??GenericApp_ProcessEvent_3:
   \   00005A                ; Setup parameters for call to function osal_msg_deallocate
   \   00005A   AA..         MOV     R2,?V0 + 0
   \   00005C   AB..         MOV     R3,?V0 + 1
   \   00005E   12....       LCALL   ??osal_msg_deallocate?relay
    500          
    501          			// Next
    502          			MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( GenericApp_TaskID );
   \   000061                ; Setup parameters for call to function osal_msg_receive
   \   000061   90....       MOV     DPTR,#GenericApp_TaskID
   \   000064   E0           MOVX    A,@DPTR
   \   000065   F9           MOV     R1,A
   \   000066   12....       LCALL   ??osal_msg_receive?relay
   \   000069   8A..         MOV     ?V0 + 0,R2
   \   00006B   8B..         MOV     ?V0 + 1,R3
   \                     ??GenericApp_ProcessEvent_1:
   \   00006D   E5..         MOV     A,?V0 + 0
   \   00006F   45..         ORL     A,?V0 + 1
   \   000071   7003         JNZ     $+5
   \   000073   02....       LJMP    ??GenericApp_ProcessEvent_4 & 0xFFFF
   \   000076   85..82       MOV     DPL,?V0 + 0
   \   000079   85..83       MOV     DPH,?V0 + 1
   \   00007C   E0           MOVX    A,@DPTR
   \   00007D   24E6         ADD     A,#-0x1a
   \   00007F   7003         JNZ     $+5
   \   000081   02....       LJMP    ??GenericApp_ProcessEvent_5 & 0xFFFF
   \   000084   245A         ADD     A,#0x5a
   \   000086   7003         JNZ     $+5
   \   000088   02....       LJMP    ??GenericApp_ProcessEvent_6 & 0xFFFF
   \   00008B   24EF         ADD     A,#-0x11
   \   00008D   609A         JZ      ??GenericApp_ProcessEvent_2
   \   00008F   24FE         ADD     A,#-0x2
   \   000091   70C7         JNZ     ??GenericApp_ProcessEvent_3
   \   000093   E5..         MOV     A,?V0 + 0
   \   000095   240C         ADD     A,#0xc
   \   000097   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_16:
   \   00009A   F5..         MOV     ?V0 + 2,A
   \   00009C   A3           INC     DPTR
   \   00009D   E0           MOVX    A,@DPTR
   \   00009E   F5..         MOV     ?V0 + 3,A
   \   0000A0   78..         MOV     R0,#?V0 + 2
   \   0000A2   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for GenericApp_ProcessEvent>_0`:
   \   0000A5   0000         DW        0
   \   0000A7   0200         DW        2
   \   0000A9   0680         DW        32774
   \   0000AB   ....         DW        ??GenericApp_ProcessEvent_7
   \   0000AD   2080         DW        32800
   \   0000AF   ....         DW        ??GenericApp_ProcessEvent_8
   \   0000B1   ....         DW        ??GenericApp_ProcessEvent_3
   \                     ??GenericApp_ProcessEvent_7:
   \   0000B3                ; Setup parameters for call to function ZDO_ParseEPListRsp
   \   0000B3   AA..         MOV     R2,?V0 + 0
   \   0000B5   AB..         MOV     R3,?V0 + 1
   \   0000B7   12....       LCALL   ??ZDO_ParseEPListRsp?relay
   \   0000BA   8A..         MOV     ?V0 + 2,R2
   \   0000BC   8B..         MOV     ?V0 + 3,R3
   \   0000BE   EA           MOV     A,R2
   \   0000BF   45..         ORL     A,?V0 + 3
   \   0000C1   6097         JZ      ??GenericApp_ProcessEvent_3
   \   0000C3   8A82         MOV     DPL,R2
   \   0000C5   8B83         MOV     DPH,R3
   \   0000C7   E0           MOVX    A,@DPTR
   \   0000C8   7032         JNZ     ??GenericApp_ProcessEvent_9
   \   0000CA   A3           INC     DPTR
   \   0000CB   A3           INC     DPTR
   \   0000CC   A3           INC     DPTR
   \   0000CD   E0           MOVX    A,@DPTR
   \   0000CE   602C         JZ      ??GenericApp_ProcessEvent_9
   \   0000D0   90....       MOV     DPTR,#GenericApp_DstAddr + 8
   \   0000D3   7402         MOV     A,#0x2
   \   0000D5   F0           MOVX    @DPTR,A
   \   0000D6   8A82         MOV     DPL,R2
   \   0000D8   8B83         MOV     DPH,R3
   \   0000DA   A3           INC     DPTR
   \   0000DB   E0           MOVX    A,@DPTR
   \   0000DC   F8           MOV     R0,A
   \   0000DD   A3           INC     DPTR
   \   0000DE   E0           MOVX    A,@DPTR
   \   0000DF   F9           MOV     R1,A
   \   0000E0   90....       MOV     DPTR,#GenericApp_DstAddr
   \   0000E3   E8           MOV     A,R0
   \   0000E4   F0           MOVX    @DPTR,A
   \   0000E5   A3           INC     DPTR
   \   0000E6   E9           MOV     A,R1
   \   0000E7   F0           MOVX    @DPTR,A
   \   0000E8   8A82         MOV     DPL,R2
   \   0000EA   8B83         MOV     DPH,R3
   \   0000EC   A3           INC     DPTR
   \   0000ED   A3           INC     DPTR
   \   0000EE   A3           INC     DPTR
   \   0000EF   A3           INC     DPTR
   \   0000F0   E0           MOVX    A,@DPTR
   \   0000F1   90....       MOV     DPTR,#GenericApp_DstAddr + 9
   \   0000F4   F0           MOVX    @DPTR,A
   \   0000F5                ; Setup parameters for call to function HalLedSet
   \   0000F5   7A01         MOV     R2,#0x1
   \   0000F7   7908         MOV     R1,#0x8
   \   0000F9   12....       LCALL   ??HalLedSet?relay
   \                     ??GenericApp_ProcessEvent_9:
   \   0000FC                ; Setup parameters for call to function osal_mem_free
   \   0000FC   AA..         MOV     R2,?V0 + 2
   \   0000FE   AB..         MOV     R3,?V0 + 3
   \   000100   12....       LCALL   ??osal_mem_free?relay
   \   000103   02....       LJMP    ??GenericApp_ProcessEvent_3 & 0xFFFF
   \                     ??GenericApp_ProcessEvent_8:
   \   000106   E5..         MOV     A,?V0 + 0
   \   000108   2413         ADD     A,#0x13
   \   00010A   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_17:
   \   00010D   F8           MOV     R0,A
   \   00010E   A3           INC     DPTR
   \   00010F   E0           MOVX    A,@DPTR
   \   000110   F583         MOV     DPH,A
   \   000112   8882         MOV     DPL,R0
   \   000114   E0           MOVX    A,@DPTR
   \   000115   700A         JNZ     ??GenericApp_ProcessEvent_10
   \   000117                ; Setup parameters for call to function HalLedSet
   \   000117   7A01         MOV     R2,#0x1
   \                     ??GenericApp_ProcessEvent_11:
   \   000119   7908         MOV     R1,#0x8
   \   00011B   12....       LCALL   ??HalLedSet?relay
   \   00011E   02....       LJMP    ??GenericApp_ProcessEvent_3 & 0xFFFF
   \                     ??GenericApp_ProcessEvent_10:
   \   000121                ; Setup parameters for call to function HalLedSet
   \   000121   7A04         MOV     R2,#0x4
   \   000123   80F4         SJMP    ??GenericApp_ProcessEvent_11
   \                     ??GenericApp_ProcessEvent_6:
   \   000125   A3           INC     DPTR
   \   000126   A3           INC     DPTR
   \   000127   A3           INC     DPTR
   \   000128   E0           MOVX    A,@DPTR
   \   000129   F5..         MOV     ?V0 + 2,A
   \   00012B   A2E1         MOV     C,0xE0 /* A   */.1
   \   00012D   5060         JNC     ??GenericApp_ProcessEvent_12
   \   00012F                ; Setup parameters for call to function HalLedSet
   \   00012F   7A00         MOV     R2,#0x0
   \   000131   7908         MOV     R1,#0x8
   \   000133   12....       LCALL   ??HalLedSet?relay
   \   000136   7408         MOV     A,#0x8
   \   000138   12....       LCALL   ?XSTACK_DISP0_8
   \   00013B   7402         MOV     A,#0x2
   \   00013D   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   000140   E4           CLR     A
   \   000141   F0           MOVX    @DPTR,A
   \   000142   A3           INC     DPTR
   \   000143   F0           MOVX    @DPTR,A
   \   000144                ; Setup parameters for call to function NLME_GetShortAddr
   \   000144   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000147   8A..         MOV     ?V0 + 6,R2
   \   000149   8B..         MOV     ?V0 + 7,R3
   \   00014B   AC..         MOV     R4,?V0 + 6
   \   00014D   AD..         MOV     R5,?V0 + 7
   \   00014F                ; Setup parameters for call to function ZDP_EndDeviceBindReq
   \   00014F   75..00       MOV     ?V0 + 3,#0x0
   \   000152   78..         MOV     R0,#?V0 + 3
   \   000154   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000157   78..         MOV     R0,#?V0 + 4
   \   000159   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00015C   75..01       MOV     ?V0 + 3,#0x1
   \   00015F   78..         MOV     R0,#?V0 + 3
   \   000161   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000164   78..         MOV     R0,#?V0 + 4
   \   000166   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000169   78..         MOV     R0,#?V0 + 3
   \   00016B   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00016E   75..04       MOV     ?V0 + 6,#0x4
   \   000171   75..0F       MOV     ?V0 + 7,#0xf
   \   000174   78..         MOV     R0,#?V0 + 6
   \   000176   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000179   90....       MOV     DPTR,#GenericApp_epDesc
   \   00017C   E0           MOVX    A,@DPTR
   \   00017D   F9           MOV     R1,A
   \   00017E   7409         MOV     A,#0x9
   \   000180   12....       LCALL   ?XSTACK_DISP0_8
   \   000183   AA82         MOV     R2,DPL
   \   000185   AB83         MOV     R3,DPH
   \   000187   12....       LCALL   ??ZDP_EndDeviceBindReq?relay
   \   00018A   7409         MOV     A,#0x9
   \   00018C   12....       LCALL   ?DEALLOC_XSTACK8
   \                     ??GenericApp_ProcessEvent_12:
   \   00018F   E5..         MOV     A,?V0 + 2
   \   000191   A2E3         MOV     C,0xE0 /* A   */.3
   \   000193   4003         JC      $+5
   \   000195   02....       LJMP    ??GenericApp_ProcessEvent_3 & 0xFFFF
   \   000198                ; Setup parameters for call to function HalLedSet
   \   000198   7A00         MOV     R2,#0x0
   \   00019A   7908         MOV     R1,#0x8
   \   00019C   12....       LCALL   ??HalLedSet?relay
   \   00019F   7408         MOV     A,#0x8
   \   0001A1   12....       LCALL   ?XSTACK_DISP0_8
   \   0001A4   740F         MOV     A,#0xf
   \   0001A6   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   0001A9   74FF         MOV     A,#-0x1
   \   0001AB   F0           MOVX    @DPTR,A
   \   0001AC   A3           INC     DPTR
   \   0001AD   F0           MOVX    @DPTR,A
   \   0001AE                ; Setup parameters for call to function ZDP_MatchDescReq
   \   0001AE   75..00       MOV     ?V0 + 2,#0x0
   \   0001B1   78..         MOV     R0,#?V0 + 2
   \   0001B3   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0001B6   78..         MOV     R0,#?V0 + 4
   \   0001B8   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001BB   75..01       MOV     ?V0 + 2,#0x1
   \   0001BE   78..         MOV     R0,#?V0 + 2
   \   0001C0   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0001C3   78..         MOV     R0,#?V0 + 4
   \   0001C5   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001C8   75..04       MOV     ?V0 + 2,#0x4
   \   0001CB   75..0F       MOV     ?V0 + 3,#0xf
   \   0001CE   78..         MOV     R0,#?V0 + 2
   \   0001D0   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001D3   7901         MOV     R1,#0x1
   \   0001D5   7CFF         MOV     R4,#-0x1
   \   0001D7   7DFF         MOV     R5,#-0x1
   \   0001D9   7408         MOV     A,#0x8
   \   0001DB   12....       LCALL   ?XSTACK_DISP0_8
   \   0001DE   AA82         MOV     R2,DPL
   \   0001E0   AB83         MOV     R3,DPH
   \   0001E2   12....       LCALL   ??ZDP_MatchDescReq?relay
   \   0001E5   7408         MOV     A,#0x8
   \   0001E7   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001EA   02....       LJMP    ??GenericApp_ProcessEvent_3 & 0xFFFF
   \                     ??GenericApp_ProcessEvent_5:
   \   0001ED                ; Setup parameters for call to function GenericApp_MessageMSGCB
   \   0001ED   AA..         MOV     R2,?V0 + 0
   \   0001EF   AB..         MOV     R3,?V0 + 1
   \   0001F1   12....       LCALL   ??GenericApp_MessageMSGCB?relay
   \   0001F4   02....       LJMP    ??GenericApp_ProcessEvent_3 & 0xFFFF
    503          		}
    504          
    505          		// return unprocessed events
    506          		return (events ^ SYS_EVENT_MSG);
   \                     ??GenericApp_ProcessEvent_4:
   \   0001F7   EE           MOV     A,R6
   \   0001F8   FA           MOV     R2,A
   \   0001F9   EF           MOV     A,R7
   \   0001FA   6480         XRL     A,#0x80
   \   0001FC   FB           MOV     R3,A
   \   0001FD   800E         SJMP    ??GenericApp_ProcessEvent_13
    507          	}
    508          
    509          	// Send a message out - This event is generated by a timer
    510          	//  (setup in GenericApp_Init()).
    511          	if ( events & EVT_SyncStatus_Generic )
   \                     ??GenericApp_ProcessEvent_0:
   \   0001FF   EE           MOV     A,R6
   \   000200   A2E0         MOV     C,0xE0 /* A   */.0
   \   000202   5005         JNC     ??GenericApp_ProcessEvent_14
    512          	{
    513          		// Send "the" message
    514          		//GenericApp_SendTheMessage();
    515          
    516          		// Setup to send message again
    517          
    518          		// if coordinator restart
    519          		#if ! defined(RTR_NWK)
    520          		if( ! syncStatusOk)
    521          		{
    522          			ReportStatus();
    523          			syncStatusCnt++;
    524          			//这个可归纳为没应答则超时重发
    525          			
    526          			if(syncStatusCnt < 5)
    527          			{
    528          				uint16 delay;
    529          				srand(ramdomSeed);
    530          				delay = rand()%500 + 500;
    531          				osal_start_timerEx( GenericApp_TaskID,EVT_SyncStatus_Generic,delay );
    532          				dbgint(("clock=%d\r\n",osal_getClock()));
    533          			}
    534          			
    535          		}
    536          		#endif
    537          		// return unprocessed events
    538          		return (events ^ EVT_SyncStatus_Generic);
   \   000204   6401         XRL     A,#0x1
   \   000206   FA           MOV     R2,A
   \   000207   8004         SJMP    ??GenericApp_ProcessEvent_13
    539          	}
    540          
    541          	
    542          #if defined( IAR_ARMCM3_LM )
    543          	// Receive a message from the RTOS queue
    544          	if ( events & GENERICAPP_RTOS_MSG_EVT )
    545          	{
    546          		// Process message from RTOS queue
    547          		GenericApp_ProcessRtosMessage();
    548          
    549          		// return unprocessed events
    550          		return (events ^ GENERICAPP_RTOS_MSG_EVT);
    551          	}
    552          #endif
    553          
    554          	// Discard unknown events
    555          	return 0;
   \                     ??GenericApp_ProcessEvent_14:
   \   000209   7A00         MOV     R2,#0x0
   \   00020B   7B00         MOV     R3,#0x0
   \                     ??GenericApp_ProcessEvent_13:
   \   00020D                REQUIRE ?Subroutine1
   \   00020D                ; // Fall through to label ?Subroutine1
    556          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7409         MOV     A,#0x9
   \   000002   12....       LCALL   ?DEALLOC_XSTACK8
   \   000005   7F08         MOV     R7,#0x8
   \   000007   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   F582         MOV     DPL,A
   \   000002   E5..         MOV     A,?V0 + 1
   \   000004                REQUIRE ??Subroutine9_0
   \   000004                ; // Fall through to label ??Subroutine9_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine9_0:
   \   000000   3400         ADDC    A,#0x0
   \   000002   F583         MOV     DPH,A
   \   000004   E0           MOVX    A,@DPTR
   \   000005   22           RET
    557          
    558          /*********************************************************************
    559           * Event Generation Functions
    560           */
    561          
    562          /*********************************************************************
    563           * @fn      GenericApp_ProcessZDOMsgs()
    564           *
    565           * @brief   Process response messages
    566           *
    567           * @param   none
    568           *
    569           * @return  none
    570           */
    571          static void GenericApp_ProcessZDOMsgs( zdoIncomingMsg_t *inMsg )
    572          {
    573          	switch ( inMsg->clusterID )
    574          	{
    575          		case End_Device_Bind_rsp:
    576          			if ( ZDO_ParseBindRsp( inMsg ) == ZSuccess )
    577          			{
    578          				// Light LED
    579          				HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
    580          			}
    581          #if defined( BLINK_LEDS )
    582          			else
    583          			{
    584          				// Flash LED to show failure
    585          				HalLedSet ( HAL_LED_4, HAL_LED_MODE_FLASH );
    586          			}
    587          #endif
    588          			break;
    589          
    590          		case Match_Desc_rsp:
    591          			{
    592          				ZDO_ActiveEndpointRsp_t *pRsp = ZDO_ParseEPListRsp( inMsg );
    593          				if ( pRsp )
    594          				{
    595          					if ( pRsp->status == ZSuccess && pRsp->cnt )
    596          					{
    597          						GenericApp_DstAddr.addrMode = (afAddrMode_t)Addr16Bit;
    598          						GenericApp_DstAddr.addr.shortAddr = pRsp->nwkAddr;
    599          						// Take the first endpoint, Can be changed to search through endpoints
    600          						GenericApp_DstAddr.endPoint = pRsp->epList[0];
    601          
    602          						dbgint(("endPoint=%d\r\n",GenericApp_DstAddr.endPoint));
    603          
    604          						// Light LED
    605          						HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
    606          					}
    607          					osal_mem_free( pRsp );
    608          				}
    609          			}
    610          			break;
    611          	}
    612          }
    613          
    614          /*********************************************************************
    615           * @fn      GenericApp_HandleKeys
    616           *
    617           * @brief   Handles all key events for this device.
    618           *
    619           * @param   shift - true if in shift/alt.
    620           * @param   keys - bit field for key events. Valid entries:
    621           *                 HAL_KEY_SW_4
    622           *                 HAL_KEY_SW_3
    623           *                 HAL_KEY_SW_2
    624           *                 HAL_KEY_SW_1
    625           *
    626           * @return  none
    627           */
    628          static void GenericApp_HandleKeys( uint8 shift, uint8 keys )
    629          {
    630          	zAddrType_t dstAddr;
    631          
    632          	// Shift is used to make each button/switch dual purpose.
    633          	if ( 0 )
    634          	{
    635          		if ( keys & HAL_KEY_SW_1 )
    636          		{
    637          		}
    638          		if ( keys & HAL_KEY_SW_2 )
    639          		{
    640          		}
    641          		if ( keys & HAL_KEY_SW_3 )
    642          		{
    643          		}
    644          		if ( keys & HAL_KEY_SW_4 )
    645          		{
    646          		}
    647          	}
    648          	else
    649          	{
    650          		if ( keys & HAL_KEY_SW_1 )
    651          		{
    652          			// Since SW1 isn't used for anything else in this application...
    653          #if defined( SWITCH1_BIND )
    654          			// we can use SW1 to simulate SW2 for devices that only have one switch,
    655          			keys |= HAL_KEY_SW_2;
    656          #elif defined( SWITCH1_MATCH )
    657          			// or use SW1 to simulate SW4 for devices that only have one switch
    658          			keys |= HAL_KEY_SW_4;
    659          #endif
    660          		}
    661          
    662          		if ( keys & HAL_KEY_SW_2 )
    663          		{
    664          			HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
    665          
    666          			// Initiate an End Device Bind Request for the mandatory endpoint
    667          			dstAddr.addrMode = Addr16Bit;
    668          			dstAddr.addr.shortAddr = 0x0000; // Coordinator
    669          			ZDP_EndDeviceBindReq( &dstAddr, NLME_GetShortAddr(),
    670          														GenericApp_epDesc.endPoint,
    671          														GENERICAPP_PROFID,
    672          														GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    673          														GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    674          														FALSE );
    675          		}
    676          
    677          		if ( keys & HAL_KEY_SW_3 )
    678          		{
    679          		}
    680          
    681          		if ( keys & HAL_KEY_SW_4 )
    682          		{
    683          			HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF );
    684          			// Initiate a Match Description Request (Service Discovery)
    685          			dstAddr.addrMode = AddrBroadcast;
    686          			dstAddr.addr.shortAddr = NWK_BROADCAST_SHORTADDR;
    687          			ZDP_MatchDescReq( &dstAddr, NWK_BROADCAST_SHORTADDR,
    688          												GENERICAPP_PROFID,
    689          												GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    690          												GENERICAPP_MAX_CLUSTERS, (cId_t *)GenericApp_ClusterList,
    691          												FALSE );
    692          		}
    693          	}
    694          }
    695          
    696          /*********************************************************************
    697           * LOCAL FUNCTIONS
    698           */
    699          
    700          /*********************************************************************
    701           * @fn      GenericApp_MessageMSGCB
    702           *
    703           * @brief   Data message processor callback.  This function processes
    704           *          any incoming data - probably from other devices.  So, based
    705           *          on cluster ID, perform the intended action.
    706           *
    707           * @param   none
    708           *
    709           * @return  none
    710           */
    711          #if 1

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    712          static void GenericApp_MessageMSGCB( afIncomingMSGPacket_t *pkt )
   \                     GenericApp_MessageMSGCB:
    713          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    714          	int16 i;
    715          	uint16 cmdId;
    716          #if 1
    717          	dbgint(("Message Length=%d\r\n",pkt->cmd.DataLength));
    718                  
    719          	for(i = 0;i<pkt->cmd.DataLength;i++)
   \   000005   7800         MOV     R0,#0x0
   \   000007   7900         MOV     R1,#0x0
   \   000009   EA           MOV     A,R2
   \   00000A   2420         ADD     A,#0x20
   \   00000C   FC           MOV     R4,A
   \   00000D   EB           MOV     A,R3
   \   00000E   3400         ADDC    A,#0x0
   \   000010   FD           MOV     R5,A
   \   000011   8003         SJMP    ??CrossCallReturnLabel_6
    720          	{
    721          		dbghex((" %02x",pkt->cmd.Data[i]));
    722          		if(i%8 == 7)
   \                     ??GenericApp_MessageMSGCB_0:
   \   000013   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   000016   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   000019   40F8         JC      ??GenericApp_MessageMSGCB_0
    723          		{
    724          			dbgtag(("\r\n"));
    725          		}
    726          	}
    727          	dbgtag(("\r\n"));
    728          #endif
    729          	switch ( pkt->clusterId )
   \   00001B   8A82         MOV     DPL,R2
   \   00001D   8B83         MOV     DPH,R3
   \   00001F   A3           INC     DPTR
   \   000020   A3           INC     DPTR
   \   000021   A3           INC     DPTR
   \   000022   A3           INC     DPTR
   \   000023   E0           MOVX    A,@DPTR
   \   000024   6401         XRL     A,#0x1
   \   000026   7002         JNZ     ??GenericApp_MessageMSGCB_1
   \   000028   A3           INC     DPTR
   \   000029   E0           MOVX    A,@DPTR
   \                     ??GenericApp_MessageMSGCB_1:
   \   00002A   7070         JNZ     ??GenericApp_MessageMSGCB_2
    730          	{
    731          		case GENERICAPP_CLUSTERID:
    732          			cmdId = (pkt->cmd.Data[0])|(pkt->cmd.Data[1]<<8);
    733          			switch(cmdId)
   \   00002C   EA           MOV     A,R2
   \   00002D   2422         ADD     A,#0x22
   \   00002F   F8           MOV     R0,A
   \   000030   EB           MOV     A,R3
   \   000031   3400         ADDC    A,#0x0
   \   000033   F9           MOV     R1,A
   \   000034   E8           MOV     A,R0
   \   000035   FA           MOV     R2,A
   \   000036   E9           MOV     A,R1
   \   000037   FB           MOV     R3,A
   \   000038   8A82         MOV     DPL,R2
   \   00003A   8B83         MOV     DPH,R3
   \   00003C   E0           MOVX    A,@DPTR
   \   00003D   F8           MOV     R0,A
   \   00003E   A3           INC     DPTR
   \   00003F   E0           MOVX    A,@DPTR
   \   000040   F9           MOV     R1,A
   \   000041   8882         MOV     DPL,R0
   \   000043   8983         MOV     DPH,R1
   \   000045   E0           MOVX    A,@DPTR
   \   000046   FE           MOV     R6,A
   \   000047   A3           INC     DPTR
   \   000048   E0           MOVX    A,@DPTR
   \   000049   F9           MOV     R1,A
   \   00004A   EE           MOV     A,R6
   \   00004B   F8           MOV     R0,A
   \   00004C   7401         MOV     A,#0x1
   \   00004E   68           XRL     A,R0
   \   00004F   7001         JNZ     ??GenericApp_MessageMSGCB_3
   \   000051   E9           MOV     A,R1
   \                     ??GenericApp_MessageMSGCB_3:
   \   000052   7048         JNZ     ??GenericApp_MessageMSGCB_2
    734          			{
    735          			
    736          			case GENERICAPP_CMDID_REPORT_SHORTADDR:
    737          				#if defined(ZDO_COORDINATOR)
    738          				{
    739          					for(i = 2;i<pkt->cmd.DataLength;i++)
   \   000054   7802         MOV     R0,#0x2
   \   000056   7900         MOV     R1,#0x0
   \   000058   8021         SJMP    ??CrossCallReturnLabel_7
    740          						bufBig_gen[UART_PROTOCOL_DATA_START + i - 2] = pkt->cmd.Data[i];
   \                     ??GenericApp_MessageMSGCB_4:
   \   00005A   8A82         MOV     DPL,R2
   \   00005C   8B83         MOV     DPH,R3
   \   00005E   E0           MOVX    A,@DPTR
   \   00005F   28           ADD     A,R0
   \   000060   FE           MOV     R6,A
   \   000061   A3           INC     DPTR
   \   000062   E0           MOVX    A,@DPTR
   \   000063   39           ADDC    A,R1
   \   000064   8E82         MOV     DPL,R6
   \   000066   F583         MOV     DPH,A
   \   000068   E0           MOVX    A,@DPTR
   \   000069   C0E0         PUSH    A
   \   00006B   74..         MOV     A,#(bufBig_gen + 7) & 0xff
   \   00006D   28           ADD     A,R0
   \   00006E   F582         MOV     DPL,A
   \   000070   74..         MOV     A,#((bufBig_gen + 7) >> 8) & 0xff
   \   000072   39           ADDC    A,R1
   \   000073   F583         MOV     DPH,A
   \   000075   D0E0         POP     A
   \   000077   F0           MOVX    @DPTR,A
   \   000078   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   00007B   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   00007E   40DA         JC      ??GenericApp_MessageMSGCB_4
    741          
    742          					#if 0
    743          					dbgint(("Message Length=%d\r\n",pkt->cmd.DataLength));
    744          					for(i = 0;i<pkt->cmd.DataLength;i++)
    745          					{
    746          						dbghex((" %02x",bufBig_gen[i]));
    747          						if(i%8 == 7)
    748          						{
    749          							dbgtag(("\r\n"));
    750          						}
    751          					}
    752          					dbgtag(("\r\n"));
    753          					#endif
    754          
    755          					UartControlSendCmd(0x9010, bufBig_gen,pkt->cmd.DataLength -2);
   \   000080                ; Setup parameters for call to function UartControlSendCmd
   \   000080   EE           MOV     A,R6
   \   000081   24FE         ADD     A,#-0x2
   \   000083   F9           MOV     R1,A
   \   000084   7C..         MOV     R4,#bufBig_gen & 0xff
   \   000086   7D..         MOV     R5,#(bufBig_gen >> 8) & 0xff
   \   000088   7A10         MOV     R2,#0x10
   \   00008A   7B90         MOV     R3,#-0x70
   \   00008C   12....       LCALL   ??UartControlSendCmd?relay
    756          
    757          					HalLedBlink(HAL_LED_1, 2,50,300);
   \   00008F                ; Setup parameters for call to function HalLedBlink
   \   00008F   7C2C         MOV     R4,#0x2c
   \   000091   7D01         MOV     R5,#0x1
   \   000093   7B32         MOV     R3,#0x32
   \   000095   7A02         MOV     R2,#0x2
   \   000097   7901         MOV     R1,#0x1
   \   000099   12....       LCALL   ??HalLedBlink?relay
    758          				}
    759          				#endif
    760          				break;
    761          			case GENERICAPP_CMDID_ZD0_RESTART:
    762          				#if ! defined(RTR_NWK)
    763          				{
    764          					syncStatusCnt = 0;
    765          					srand(ramdomSeed);
    766          					osal_start_timerEx( GenericApp_TaskID,EVT_SyncStatus_Generic,rand()%3000 );
    767          				}
    768          				#endif
    769          				break;
    770          			case GENERICAPP_CMDID_SYNC_STATUS:
    771          				#if ! defined(RTR_NWK)
    772          				{
    773          					////in:		groupId[2],sync[1],cmds[...]
    774          					GroupId_gen = *((uint16*)(pkt->cmd.Data+2));
    775          					if(pkt->cmd.Data[4] != 0)
    776          					{
    777          						ledBrightness_gen = pkt->cmd.Data[5];
    778          						ledYellow_gen = pkt->cmd.Data[6];
    779          						ledColorR_gen = pkt->cmd.Data[7];
    780          						ledColorG_gen = pkt->cmd.Data[8];
    781          						ledColorB_gen = pkt->cmd.Data[9];
    782          					}
    783          					syncStatusOk = 1;
    784          				}
    785          				#endif
    786          				break;
    787          			case GENERICAPP_CMDID_LIGHT:
    788          				#if ! defined(RTR_NWK)
    789          				{
    790          					ProcessMsgLight(&pkt->cmd.Data[2]);
    791          				}
    792          				#endif
    793          				break;
    794          
    795          			case GENERICAPP_CMDID_ADD_TO_GROUP:
    796          				#if ! defined(RTR_NWK)
    797          				{
    798          					GroupId_gen = *((uint16*)(pkt->cmd.Data+2));
    799          				}
    800          				#endif
    801          				break;
    802          			case GENERICAPP_CMDID_REMOVE_FROM_GROUP:
    803          				#if ! defined(RTR_NWK)
    804          				{
    805          					GroupId_gen = 0;
    806          				}
    807          				#endif
    808          				break;
    809          			case GENERICAPP_CMDID_BROADCAST_GROUP_CTRL:
    810          				#if ! defined(RTR_NWK)
    811          				{
    812          					uint16 groupId = *((uint16*)(pkt->cmd.Data+2));
    813          					if(groupId == GroupId_gen)
    814          					{
    815          						uint16 cmdId2 = (pkt->cmd.Data[4])|(pkt->cmd.Data[5]<<8);
    816          						switch(cmdId2)
    817          						{
    818          						case GENERICAPP_CMDID_LIGHT:
    819          							ProcessMsgLight(&pkt->cmd.Data[6]);
    820          							break;
    821          						case GENERICAPP_CMDID_REMOVE_FROM_GROUP:
    822          							#if ! defined(RTR_NWK)
    823          							{
    824          								GroupId_gen = 0;
    825          							}
    826          							#endif
    827          							break;
    828          						}
    829          					}
    830          				}
    831          				#endif
    832          				break;
    833          			}
    834          			break;
    835          	}
    836          }
   \                     ??GenericApp_MessageMSGCB_2:
   \   00009C   02....       LJMP    ?Subroutine0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   8C82         MOV     DPL,R4
   \   000002   8D83         MOV     DPH,R5
   \   000004   E0           MOVX    A,@DPTR
   \   000005   FE           MOV     R6,A
   \   000006   A3           INC     DPTR
   \   000007   E0           MOVX    A,@DPTR
   \   000008   FF           MOV     R7,A
   \   000009   C3           CLR     C
   \   00000A   E8           MOV     A,R0
   \   00000B   9E           SUBB    A,R6
   \   00000C   E9           MOV     A,R1
   \   00000D   9F           SUBB    A,R7
   \   00000E   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   E8           MOV     A,R0
   \   000001   2401         ADD     A,#0x1
   \   000003   08           INC     R0
   \   000004   E9           MOV     A,R1
   \   000005   3400         ADDC    A,#0x0
   \   000007   F9           MOV     R1,A
   \   000008   22           RET
    837          #endif
    838          
    839          /*********************************************************************
    840           * @fn      GenericApp_SendTheMessage
    841           *
    842           * @brief   Send "the" message.
    843           *
    844           * @param   none
    845           *
    846           * @return  none
    847           */
    848          static void GenericApp_SendMessage(afAddrMode_t addrMode,uint16 addr ,uint8* buf,uint16 buflen )
    849          {
    850          	
    851          	GenericApp_DstAddr.addrMode = addrMode;
    852          	GenericApp_DstAddr.endPoint = GENERICAPP_ENDPOINT;
    853          	GenericApp_DstAddr.addr.shortAddr = addr;
    854          	
    855          	
    856          	if ( AF_DataRequest( &GenericApp_DstAddr, &GenericApp_epDesc,
    857          											 GENERICAPP_CLUSTERID,
    858          											 buflen,
    859          											 (byte *)buf,
    860          											 &GenericApp_TransID,
    861          											 AF_DISCV_ROUTE, AF_DEFAULT_RADIUS ) == afStatus_SUCCESS )
    862          	{
    863          	}
    864          	else
    865          	{} 
    866          }
    867          
    868          /*********************************************************************
    869           * @fn      GenericApp_SendTheMessage
    870           *
    871           * @brief   Send "the" message.
    872           *
    873           * @param   none
    874           *
    875           * @return  none
    876           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    877          static void GenericApp_SendMessageCmd(afAddrMode_t addrMode,uint16 addr ,uint16 cmd,uint8* buf,uint16 buflen )
   \                     GenericApp_SendMessageCmd:
    878          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
   \   000009   EB           MOV     A,R3
   \   00000A   FF           MOV     R7,A
   \   00000B   7412         MOV     A,#0x12
   \   00000D   12....       LCALL   ?XSTACK_DISP0_8
   \   000010   E0           MOVX    A,@DPTR
   \   000011   F5..         MOV     ?V0 + 2,A
   \   000013   A3           INC     DPTR
   \   000014   E0           MOVX    A,@DPTR
   \   000015   F5..         MOV     ?V0 + 3,A
    879          	int16 i;
    880          	for(i=buflen+1;i>1;i--)
   \   000017   E5..         MOV     A,?V0 + 2
   \   000019   2401         ADD     A,#0x1
   \   00001B   F8           MOV     R0,A
   \   00001C   E5..         MOV     A,?V0 + 3
   \   00001E   3400         ADDC    A,#0x0
   \   000020   F9           MOV     R1,A
   \   000021   7410         MOV     A,#0x10
   \   000023   12....       LCALL   ?XSTACK_DISP0_8
   \   000026   E0           MOVX    A,@DPTR
   \   000027   F5..         MOV     ?V0 + 4,A
   \   000029   A3           INC     DPTR
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   F5..         MOV     ?V0 + 5,A
   \   00002D   8020         SJMP    ??GenericApp_SendMessageCmd_0
    881          		buf[i] = buf[i-2];
   \                     ??GenericApp_SendMessageCmd_1:
   \   00002F   E5..         MOV     A,?V0 + 4
   \   000031   28           ADD     A,R0
   \   000032   FA           MOV     R2,A
   \   000033   E5..         MOV     A,?V0 + 5
   \   000035   39           ADDC    A,R1
   \   000036   FB           MOV     R3,A
   \   000037   EA           MOV     A,R2
   \   000038   24FE         ADD     A,#-0x2
   \   00003A   F582         MOV     DPL,A
   \   00003C   EB           MOV     A,R3
   \   00003D   34FF         ADDC    A,#-0x1
   \   00003F   F583         MOV     DPH,A
   \   000041   E0           MOVX    A,@DPTR
   \   000042   8A82         MOV     DPL,R2
   \   000044   8B83         MOV     DPH,R3
   \   000046   F0           MOVX    @DPTR,A
   \   000047   E8           MOV     A,R0
   \   000048   24FF         ADD     A,#-0x1
   \   00004A   18           DEC     R0
   \   00004B   E9           MOV     A,R1
   \   00004C   34FF         ADDC    A,#-0x1
   \   00004E   F9           MOV     R1,A
   \                     ??GenericApp_SendMessageCmd_0:
   \   00004F   C3           CLR     C
   \   000050   E8           MOV     A,R0
   \   000051   9402         SUBB    A,#0x2
   \   000053   E9           MOV     A,R1
   \   000054   9400         SUBB    A,#0x0
   \   000056   A2D2         MOV     C,0xD0 /* PSW */.2
   \   000058   65D0         XRL     A,PSW
   \   00005A   33           RLC     A
   \   00005B   50D2         JNC     ??GenericApp_SendMessageCmd_1
    882          	buf[0] = cmd&0xff;
   \   00005D   EC           MOV     A,R4
   \   00005E   85..82       MOV     DPL,?V0 + 4
   \   000061   85..83       MOV     DPH,?V0 + 5
   \   000064   F0           MOVX    @DPTR,A
    883          	buf[1] = cmd>>8;
   \   000065   ED           MOV     A,R5
   \   000066   A3           INC     DPTR
   \   000067   F0           MOVX    @DPTR,A
    884          	
    885          	GenericApp_SendMessage(addrMode,addr,buf,buflen + 2);
   \   000068   E5..         MOV     A,?V0 + 0
   \   00006A   90....       MOV     DPTR,#GenericApp_DstAddr + 8
   \   00006D   F0           MOVX    @DPTR,A
   \   00006E   A3           INC     DPTR
   \   00006F   740A         MOV     A,#0xa
   \   000071   F0           MOVX    @DPTR,A
   \   000072   90....       MOV     DPTR,#GenericApp_DstAddr
   \   000075   EE           MOV     A,R6
   \   000076   F0           MOVX    @DPTR,A
   \   000077   A3           INC     DPTR
   \   000078   EF           MOV     A,R7
   \   000079   F0           MOVX    @DPTR,A
   \   00007A                ; Setup parameters for call to function AF_DataRequest
   \   00007A   75..1E       MOV     ?V0 + 1,#0x1e
   \   00007D   78..         MOV     R0,#?V0 + 1
   \   00007F   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000082   75....       MOV     ?V0 + 6,#GenericApp_TransID & 0xff
   \   000085   75....       MOV     ?V0 + 7,#(GenericApp_TransID >> 8) & 0xff
   \   000088   78..         MOV     R0,#?V0 + 6
   \   00008A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00008D   78..         MOV     R0,#?V0 + 4
   \   00008F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000092   E5..         MOV     A,?V0 + 2
   \   000094   2402         ADD     A,#0x2
   \   000096   F5..         MOV     ?V0 + 2,A
   \   000098   E5..         MOV     A,?V0 + 3
   \   00009A   3400         ADDC    A,#0x0
   \   00009C   F5..         MOV     ?V0 + 3,A
   \   00009E   78..         MOV     R0,#?V0 + 2
   \   0000A0   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000A3   75..01       MOV     ?V0 + 2,#0x1
   \   0000A6   75..00       MOV     ?V0 + 3,#0x0
   \   0000A9   78..         MOV     R0,#?V0 + 2
   \   0000AB   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000AE   7920         MOV     R1,#0x20
   \   0000B0   7C..         MOV     R4,#GenericApp_epDesc & 0xff
   \   0000B2   7D..         MOV     R5,#(GenericApp_epDesc >> 8) & 0xff
   \   0000B4   7A..         MOV     R2,#GenericApp_DstAddr & 0xff
   \   0000B6   7B..         MOV     R3,#(GenericApp_DstAddr >> 8) & 0xff
   \   0000B8   12....       LCALL   ??AF_DataRequest?relay
   \   0000BB   02....       LJMP    ?Subroutine1 & 0xFFFF
    886          }
    887          
    888          #if defined( IAR_ARMCM3_LM )
    889          /*********************************************************************
    890           * @fn      GenericApp_ProcessRtosMessage
    891           *
    892           * @brief   Receive message from RTOS queue, send response back.
    893           *
    894           * @param   none
    895           *
    896           * @return  none
    897           */
    898          static void GenericApp_ProcessRtosMessage( void )
    899          {
    900          	osalQueue_t inMsg;
    901          
    902          	if ( osal_queue_receive( OsalQueue, &inMsg, 0 ) == pdPASS )
    903          	{
    904          		uint8 cmndId = inMsg.cmnd;
    905          		uint32 counter = osal_build_uint32( inMsg.cbuf, 4 );
    906          
    907          		switch ( cmndId )
    908          		{
    909          			case CMD_INCR:
    910          				counter += 1;  /* Increment the incoming counter */
    911          											 /* Intentionally fall through next case */
    912          
    913          			case CMD_ECHO:
    914          			{
    915          				userQueue_t outMsg;
    916          
    917          				outMsg.resp = RSP_CODE | cmndId;  /* Response ID */
    918          				osal_buffer_uint32( outMsg.rbuf, counter );    /* Increment counter */
    919          				osal_queue_send( UserQueue1, &outMsg, 0 );  /* Send back to UserTask */
    920          				break;
    921          			}
    922          			
    923          			default:
    924          				break;  /* Ignore unknown command */    
    925          		}
    926          	}
    927          }
    928          #endif
    929          #if ! defined(RTR_NWK)
    930          void ReportStatus()
    931          {
    932          	{
    933          		//report short addr ...info... to the coordinator
    934          		uint16 shortAddr = NLME_GetShortAddr();
    935          		//uint8 group;
    936          		dbghex(("Addr=%x\r\n",shortAddr));
    937          		bufBig_gen[0] = shortAddr&0xff;
    938          		bufBig_gen[1] = shortAddr>>8;
    939          		
    940          		
    941          		GenericApp_SendMessageCmd(afAddr16Bit,0,GENERICAPP_CMDID_REPORT_SHORTADDR,bufBig_gen,2);
    942          	}
    943          }
    944          #endif
    945          /*********************************************************************
    946           * @fn      SerialApp_CallBack回调函数
    947           *
    948           * @brief   Send data OTA.
    949           *
    950           * @param   port - UART port.
    951           * @param   event - the UART port event flag.
    952           *
    953           * @return  none
    954           */
    955           /////串口协议(简单，帧最长为256字节)
    956           /////len[1],data[n],crc[1]
    957           /////中括号内表示字节数，len:data长度，不包含len字节和crc字节。data:	cmdID(low),cmdID(high),......
    958           /////收到每条命令，都要有相应的回复，获取命令回复数据内容，操作命令回复ok，
    959           /////		不支持的命令回复not supported,校验出错回复crc err

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    960          static void SerialApp_CallBack(uint8 port, uint8 event)
   \                     SerialApp_CallBack:
    961          {
   \   000000   74EE         MOV     A,#-0x12
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 18
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 4,R2
    962          #if 1
    963          	(void)port;
    964          
    965          	//int16 i=0;
    966          	
    967          	if ((event & (HAL_UART_RX_FULL | HAL_UART_RX_ABOUT_FULL | HAL_UART_RX_TIMEOUT)) &&
    968          #if SERIAL_APP_LOOPBACK
    969          			(SerialApp_Len < SERIAL_APP_TX_MAX))
    970          #else
    971          			!SerialApp_Len)
   \   000007   7407         MOV     A,#0x7
   \   000009   55..         ANL     A,?V0 + 4
   \   00000B   7003         JNZ     $+5
   \   00000D   02....       LJMP    ??SerialApp_CallBack_0 & 0xFFFF
   \   000010   90....       MOV     DPTR,#SerialApp_Len
   \   000013   E0           MOVX    A,@DPTR
   \   000014   6003         JZ      $+5
   \   000016   02....       LJMP    ??SerialApp_CallBack_0 & 0xFFFF
    972          #endif
    973          	{
    974          		if (!SerialApp_Len && 
    975          			//(SerialApp_Len = HalUARTRead(SERIAL_APP_PORT, SerialApp_Buf, SERIAL_APP_TX_MAX)))
    976          			(SerialApp_Len = HalUARTRead(CTRL_PORT, SerialApp_Buf, SERIAL_APP_TX_MAX)))
   \   000019                ; Setup parameters for call to function HalUARTRead
   \   000019   7C00         MOV     R4,#0x0
   \   00001B   7D01         MOV     R5,#0x1
   \   00001D   7A..         MOV     R2,#SerialApp_Buf & 0xff
   \   00001F   7B..         MOV     R3,#(SerialApp_Buf >> 8) & 0xff
   \   000021   7900         MOV     R1,#0x0
   \   000023   12....       LCALL   ??HalUARTRead?relay
   \   000026   EA           MOV     A,R2
   \   000027   90....       MOV     DPTR,#SerialApp_Len
   \   00002A   F0           MOVX    @DPTR,A
   \   00002B   7003         JNZ     $+5
   \   00002D   02....       LJMP    ??SerialApp_CallBack_0 & 0xFFFF
    977          		{
    978          			dbgint(("serial receive Len=%d,",SerialApp_Len));
    979          			dbghex(("data=%02x,",SerialApp_Buf[0]));
    980          			dbghex(("%02x,",SerialApp_Buf[1]));
    981          			dbghex(("%02x,",SerialApp_Buf[2]));
    982          			dbghex(("%02x,",SerialApp_Buf[3]));
    983          			dbghex(("%02x,",SerialApp_Buf[4]));
    984          			dbghex(("%02x\r\n",SerialApp_Buf[5]));
    985                                  
    986          			// Pre-pend sequence number to the Tx message.
    987          			uint8 dataLen = SerialApp_Buf[1];
   \   000030   90....       MOV     DPTR,#SerialApp_Buf + 1
   \   000033   E0           MOVX    A,@DPTR
   \   000034   FE           MOV     R6,A
    988          			uint16 cmdid ;
    989          
    990          			#if 1
    991          			/*
    992          			if(dataLen > (256-2) || dataLen + 2 != SerialApp_Len)
    993          			{
    994          				//len error
    995          				UartControlSendSimple(SerialApp_Buf,0,0x0004);
    996          				goto exit;
    997          			}
    998          			*/
    999          			if(CalcChecksum(&SerialApp_Buf[UART_PROTOCOL_SEQ_START],dataLen) != SerialApp_Buf[dataLen+2])
   \   000035                ; Setup parameters for call to function CalcChecksum
   \   000035   F9           MOV     R1,A
   \   000036   7A..         MOV     R2,#(SerialApp_Buf + 2) & 0xff
   \   000038   7B..         MOV     R3,#((SerialApp_Buf + 2) >> 8) & 0xff
   \   00003A   12....       LCALL   ??CalcChecksum?relay
   \   00003D   E9           MOV     A,R1
   \   00003E   F8           MOV     R0,A
   \   00003F   8E82         MOV     DPL,R6
   \   000041   8582..       MOV     ?V0 + 0,DPL
   \   000044   74..         MOV     A,#(SerialApp_Buf + 2) & 0xff
   \   000046   25..         ADD     A,?V0 + 0
   \   000048   F582         MOV     DPL,A
   \   00004A   74..         MOV     A,#((SerialApp_Buf + 2) >> 8) & 0xff
   \   00004C   12....       LCALL   ??Subroutine9_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_14:
   \   00004F   68           XRL     A,R0
   \   000050   6003         JZ      $+5
   \   000052   02....       LJMP    ??SerialApp_CallBack_0 & 0xFFFF
   1000          			{
   1001          				//crc error,do not send ack
   1002          				//UartControlSendSimple(SerialApp_Buf,0,0x0005);
   1003          				goto exit;
   1004          			}
   1005          			if(SerialApp_Buf[UART_PROTOCOL_ACK_START] == 1)
   \   000055   90....       MOV     DPTR,#SerialApp_Buf + 6
   \   000058   E0           MOVX    A,@DPTR
   \   000059   6401         XRL     A,#0x1
   \   00005B   7003         JNZ     $+5
   \   00005D   02....       LJMP    ??SerialApp_CallBack_0 & 0xFFFF
   1006          			{
   1007          				// is the ack frame,do nothing
   1008          				goto exit;
   1009          			}
   1010          			#endif
   1011          
   1012          
   1013          			cmdid = (SerialApp_Buf[UART_PROTOCOL_CMDID_START+0])|(SerialApp_Buf[UART_PROTOCOL_CMDID_START+1]<<8);
   \   000060   A3           INC     DPTR
   \   000061   E0           MOVX    A,@DPTR
   \   000062   FA           MOV     R2,A
   \   000063   A3           INC     DPTR
   \   000064   E0           MOVX    A,@DPTR
   \   000065   F8           MOV     R0,A
   \   000066   E4           CLR     A
   \   000067   C8           XCH     A,R0
   \   000068   F9           MOV     R1,A
   \   000069   EA           MOV     A,R2
   \   00006A   F5..         MOV     ?V0 + 6,A
   \   00006C   E9           MOV     A,R1
   \   00006D   F5..         MOV     ?V0 + 7,A
   1014          
   1015          			memcpy(bufBig_gen,SerialApp_Buf,SerialApp_Len);
   \   00006F                ; Setup parameters for call to function memcpy
   \   00006F   90....       MOV     DPTR,#SerialApp_Len
   \   000072   E0           MOVX    A,@DPTR
   \   000073   F5..         MOV     ?V0 + 2,A
   \   000075   88..         MOV     ?V0 + 3,R0
   \   000077   78..         MOV     R0,#?V0 + 2
   \   000079   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00007C   7C..         MOV     R4,#SerialApp_Buf & 0xff
   \   00007E   7D..         MOV     R5,#(SerialApp_Buf >> 8) & 0xff
   \   000080   7A..         MOV     R2,#bufBig_gen & 0xff
   \   000082   7B..         MOV     R3,#(bufBig_gen >> 8) & 0xff
   \   000084   12....       LCALL   ??memcpy?relay
   \   000087   7402         MOV     A,#0x2
   \   000089   12....       LCALL   ?DEALLOC_XSTACK8
   1016          			UartControlSendAck(bufBig_gen);	
   \   00008C                ; Setup parameters for call to function UartControlSendAck
   \   00008C   7A..         MOV     R2,#bufBig_gen & 0xff
   \   00008E   7B..         MOV     R3,#(bufBig_gen >> 8) & 0xff
   \   000090   12....       LCALL   ??UartControlSendAck?relay
   1017          			////len,cmdID(low),cmdID(high),...,crc
   1018          			switch(cmdid) //解析命令字
   \   000093   90....       MOV     DPTR,#SerialApp_Buf + 10
   \   000096   E0           MOVX    A,@DPTR
   \   000097   F5..         MOV     ?V0 + 8,A
   \   000099   90....       MOV     DPTR,#SerialApp_Buf + 9
   \   00009C   E0           MOVX    A,@DPTR
   \   00009D   F5..         MOV     ?V0 + 5,A
   \   00009F   FA           MOV     R2,A
   \   0000A0   AB..         MOV     R3,?V0 + 8
   \   0000A2   90....       MOV     DPTR,#SerialApp_Buf + 12
   \   0000A5   E0           MOVX    A,@DPTR
   \   0000A6   F5..         MOV     ?V0 + 2,A
   \   0000A8   90....       MOV     DPTR,#SerialApp_Buf + 11
   \   0000AB   E0           MOVX    A,@DPTR
   \   0000AC   FE           MOV     R6,A
   \   0000AD   E5..         MOV     A,?V0 + 0
   \   0000AF   24F7         ADD     A,#-0x9
   \   0000B1   FC           MOV     R4,A
   \   0000B2   E4           CLR     A
   \   0000B3   34FF         ADDC    A,#-0x1
   \   0000B5   FD           MOV     R5,A
   \   0000B6   E5..         MOV     A,?V0 + 7
   \   0000B8   6003         JZ      $+5
   \   0000BA   02....       LJMP    ??SerialApp_CallBack_0 & 0xFFFF
   \   0000BD   E5..         MOV     A,?V0 + 6
   \   0000BF   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for SerialApp_CallBack>_0`:
   \   0000C2   00           DB        0
   \   0000C3   08           DB        8
   \   0000C4   01           DB        1
   \   0000C5   ....         DW        ??SerialApp_CallBack_1
   \   0000C7   03           DB        3
   \   0000C8   ....         DW        ??SerialApp_CallBack_2
   \   0000CA   07           DB        7
   \   0000CB   ....         DW        ??SerialApp_CallBack_3
   \   0000CD   21           DB        33
   \   0000CE   ....         DW        ??SerialApp_CallBack_4
   \   0000D0   22           DB        34
   \   0000D1   ....         DW        ??SerialApp_CallBack_5
   \   0000D3   30           DB        48
   \   0000D4   ....         DW        ??SerialApp_CallBack_6
   \   0000D6   40           DB        64
   \   0000D7   ....         DW        ??SerialApp_CallBack_7
   \   0000D9   50           DB        80
   \   0000DA   ....         DW        ??SerialApp_CallBack_8
   \   0000DC   ....         DW        ??SerialApp_CallBack_0
   1019          			{
   1020          
   1021          			#if defined(ZDO_COORDINATOR)
   1022          			case 0x0001://read nv items
   1023          				{
   1024          					uint16 id = (SerialApp_Buf[UART_PROTOCOL_DATA_START+0])|(SerialApp_Buf[UART_PROTOCOL_DATA_START+1]<<8);
   \                     ??SerialApp_CallBack_1:
   \   0000DE   EA           MOV     A,R2
   \   0000DF   FE           MOV     R6,A
   \   0000E0   EB           MOV     A,R3
   \   0000E1   FF           MOV     R7,A
   1025          					/* Length of item in NV memory */
   1026          					uint16 len = osal_nv_item_len(id);
   \   0000E2                ; Setup parameters for call to function osal_nv_item_len
   \   0000E2   12....       LCALL   ??osal_nv_item_len?relay
   \   0000E5   8A..         MOV     ?V0 + 0,R2
   \   0000E7   8B..         MOV     ?V0 + 1,R3
   1027          					uint8 *pRetBuf;
   1028          
   1029          					dbgint(("id[%x] ",id));
   1030          					dbgint(("len=%d\r\n",len));
   1031          					pRetBuf = osal_mem_alloc(len);
   \   0000E9                ; Setup parameters for call to function osal_mem_alloc
   \   0000E9   12....       LCALL   ??osal_mem_alloc?relay
   \   0000EC   8A..         MOV     ?V0 + 2,R2
   \   0000EE   8B..         MOV     ?V0 + 3,R3
   1032          					if (pRetBuf != NULL)
   \   0000F0   EA           MOV     A,R2
   \   0000F1   45..         ORL     A,?V0 + 3
   \   0000F3   602F         JZ      ??SerialApp_CallBack_9
   1033          					{
   1034          						if ((osal_nv_read(id,0, len, pRetBuf)) == ZSUCCESS)
   \   0000F5                ; Setup parameters for call to function osal_nv_read
   \   0000F5   78..         MOV     R0,#?V0 + 2
   \   0000F7   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000FA   78..         MOV     R0,#?V0 + 0
   \   0000FC   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000FF   7C00         MOV     R4,#0x0
   \   000101   7D00         MOV     R5,#0x0
   \   000103   EE           MOV     A,R6
   \   000104   FA           MOV     R2,A
   \   000105   EF           MOV     A,R7
   \   000106   FB           MOV     R3,A
   \   000107   12....       LCALL   ??osal_nv_read?relay
   \   00010A   7404         MOV     A,#0x4
   \   00010C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00010F   E9           MOV     A,R1
   \   000110   7012         JNZ     ??SerialApp_CallBack_9
   1035          						{
   1036          							int16 i;
   1037          							for(i = 0;i<len;i++)
   \   000112   7800         MOV     R0,#0x0
   \   000114   7900         MOV     R1,#0x0
   \   000116   8003         SJMP    ??CrossCallReturnLabel_8
   1038          							{
   1039          								dbghex(("%02x ",pRetBuf[i]));
   1040          								if(i%8 == 7)
   \                     ??SerialApp_CallBack_10:
   \   000118   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   00011B   C3           CLR     C
   \   00011C   E8           MOV     A,R0
   \   00011D   95..         SUBB    A,?V0 + 0
   \   00011F   E9           MOV     A,R1
   \   000120   95..         SUBB    A,?V0 + 1
   \   000122   40F4         JC      ??SerialApp_CallBack_10
   1041          								{
   1042          									dbgtag(("\r\n"));
   1043          
   1044          								}
   1045          							}
   1046          							dbgtag(("\r\n"));
   1047          						}
   1048          					}
   1049          					osal_mem_free(pRetBuf);
   \                     ??SerialApp_CallBack_9:
   \   000124                ; Setup parameters for call to function osal_mem_free
   \   000124   AA..         MOV     R2,?V0 + 2
   \   000126   AB..         MOV     R3,?V0 + 3
   \   000128   12....       LCALL   ??osal_mem_free?relay
   1050          				}
   1051          				break;
   \   00012B   02....       LJMP    ??SerialApp_CallBack_0 & 0xFFFF
   1052          			case 0x0003://send control cmds to any Devices
   1053          				{
   1054          					////in:		addrmode[1],addr[2],cmds[...]
   1055          					////inSub:	cmds[...]
   1056          					uint16 addr = (SerialApp_Buf[UART_PROTOCOL_DATA_START+1])|(SerialApp_Buf[UART_PROTOCOL_DATA_START+2]<<8);
   1057          					uint16 cmd = (SerialApp_Buf[UART_PROTOCOL_DATA_START+3])|(SerialApp_Buf[UART_PROTOCOL_DATA_START+4]<<8);
   1058          
   1059          					GenericApp_SendMessageCmd((afAddrMode_t)SerialApp_Buf[UART_PROTOCOL_DATA_START+0], addr,cmd,&SerialApp_Buf[UART_PROTOCOL_DATA_START+3] , dataLen-UART_PROTOCOL_CMDID_START-3);
   \                     ??SerialApp_CallBack_2:
   \   00012E                ; Setup parameters for call to function GenericApp_SendMessageCmd
   \   00012E   E5..         MOV     A,?V0 + 0
   \   000130   24F6         ADD     A,#-0xa
   \   000132   12....       LCALL   ?Subroutine8 & 0xFFFF
   1060          				}
   \                     ??CrossCallReturnLabel_11:
   \   000135   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000138   75....       MOV     ?V0 + 0,#(SerialApp_Buf + 12) & 0xff
   \   00013B   75....       MOV     ?V0 + 1,#((SerialApp_Buf + 12) >> 8) & 0xff
   \   00013E   78..         MOV     R0,#?V0 + 0
   \   000140   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000143   90....       MOV     DPTR,#SerialApp_Buf + 13
   \   000146   E0           MOVX    A,@DPTR
   \   000147   AC..         MOV     R4,?V0 + 2
   \   000149   FD           MOV     R5,A
   \   00014A   EE           MOV     A,R6
   \   00014B   FF           MOV     R7,A
   \   00014C   EB           MOV     A,R3
   \   00014D   FA           MOV     R2,A
   \   00014E   EF           MOV     A,R7
   \   00014F   FB           MOV     R3,A
   \   000150   A9..         MOV     R1,?V0 + 5
   \   000152   02....       LJMP    ??SerialApp_CallBack_11 & 0xFFFF
   1061          				break;
   1062          
   1063          			case 0x0007://sync device status
   1064          				{
   1065          					////in:		addr[2],groupId[2],sync[1],cmds[...]
   1066          					////inSub:	groupId[2],sync[1],cmds[...]
   1067          					uint16 addr = (SerialApp_Buf[UART_PROTOCOL_DATA_START+0])|(SerialApp_Buf[UART_PROTOCOL_DATA_START+1]<<8);
   1068          
   1069          					GenericApp_SendMessageCmd(afAddr16Bit, addr,GENERICAPP_CMDID_SYNC_STATUS,&SerialApp_Buf[UART_PROTOCOL_DATA_START+2] , dataLen-UART_PROTOCOL_CMDID_START-2);
   \                     ??SerialApp_CallBack_3:
   \   000155                ; Setup parameters for call to function GenericApp_SendMessageCmd
   \   000155   8C..         MOV     ?V0 + 0,R4
   \   000157   8D..         MOV     ?V0 + 1,R5
   \   000159   78..         MOV     R0,#?V0 + 0
   \   00015B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00015E   75....       MOV     ?V0 + 0,#(SerialApp_Buf + 11) & 0xff
   \   000161   75....       MOV     ?V0 + 1,#((SerialApp_Buf + 11) >> 8) & 0xff
   \   000164   78..         MOV     R0,#?V0 + 0
   \   000166   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000169   7C07         MOV     R4,#0x7
   \   00016B   802E         SJMP    ??SerialApp_CallBack_12
   1070          				}
   1071          				break;
   1072          
   1073          			case 0x00021://add to a group
   1074          				{
   1075          					////in:		addr[2],group ID[2]
   1076          					////inSub:	group ID[2]
   1077          					uint16 addr = (SerialApp_Buf[UART_PROTOCOL_DATA_START+0])|(SerialApp_Buf[UART_PROTOCOL_DATA_START+1]<<8);
   1078          					
   1079          
   1080          					GenericApp_SendMessageCmd(afAddr16Bit, addr,GENERICAPP_CMDID_ADD_TO_GROUP, &SerialApp_Buf[UART_PROTOCOL_DATA_START+2], dataLen-UART_PROTOCOL_CMDID_START-2);
   \                     ??SerialApp_CallBack_4:
   \   00016D                ; Setup parameters for call to function GenericApp_SendMessageCmd
   \   00016D   8C..         MOV     ?V0 + 0,R4
   \   00016F   8D..         MOV     ?V0 + 1,R5
   \   000171   78..         MOV     R0,#?V0 + 0
   \   000173   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000176   75....       MOV     ?V0 + 0,#(SerialApp_Buf + 11) & 0xff
   \   000179   75....       MOV     ?V0 + 1,#((SerialApp_Buf + 11) >> 8) & 0xff
   \   00017C   78..         MOV     R0,#?V0 + 0
   \   00017E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000181   7C31         MOV     R4,#0x31
   \   000183   8016         SJMP    ??SerialApp_CallBack_12
   1081          				}
   1082          				break;
   1083          			case 0x00022://remove from a group
   1084          				{
   1085          					////in:		addr[2],group ID[2]
   1086          					////inSub:	group ID[2]
   1087          					uint16 addr = (SerialApp_Buf[UART_PROTOCOL_DATA_START+0])|(SerialApp_Buf[UART_PROTOCOL_DATA_START+1]<<8);
   1088          					
   1089          
   1090          					GenericApp_SendMessageCmd(afAddr16Bit, addr,GENERICAPP_CMDID_REMOVE_FROM_GROUP, &SerialApp_Buf[UART_PROTOCOL_DATA_START+2], dataLen-UART_PROTOCOL_CMDID_START-2);
   \                     ??SerialApp_CallBack_5:
   \   000185                ; Setup parameters for call to function GenericApp_SendMessageCmd
   \   000185   8C..         MOV     ?V0 + 0,R4
   \   000187   8D..         MOV     ?V0 + 1,R5
   \   000189   78..         MOV     R0,#?V0 + 0
   \   00018B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00018E   75....       MOV     ?V0 + 0,#(SerialApp_Buf + 11) & 0xff
   \   000191   75....       MOV     ?V0 + 1,#((SerialApp_Buf + 11) >> 8) & 0xff
   \   000194   78..         MOV     R0,#?V0 + 0
   \   000196   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000199   7C32         MOV     R4,#0x32
   \                     ??SerialApp_CallBack_12:
   \   00019B   7D00         MOV     R5,#0x0
   \   00019D   801D         SJMP    ??SerialApp_CallBack_13
   1091          				}
   1092          				break;
   1093          
   1094          			case 0x0030://endDevice control
   1095          				{
   1096          					////in:		addr[2],cmds[2],data[...]
   1097          					////inSub:	data[...]
   1098          					uint16 addr = (SerialApp_Buf[UART_PROTOCOL_DATA_START+0])|(SerialApp_Buf[UART_PROTOCOL_DATA_START+1]<<8);
   1099          					uint16 cmd = (SerialApp_Buf[UART_PROTOCOL_DATA_START+2])|(SerialApp_Buf[UART_PROTOCOL_DATA_START+3]<<8);
   1100          
   1101          					dbghex(("0x0030 data=%02x,",SerialApp_Buf[UART_PROTOCOL_DATA_START+0]));
   1102          					dbghex(("%02x,",SerialApp_Buf[UART_PROTOCOL_DATA_START+1]));
   1103          					dbghex(("%02x,",SerialApp_Buf[UART_PROTOCOL_DATA_START+2]));
   1104          					dbghex(("%02x,",SerialApp_Buf[UART_PROTOCOL_DATA_START+3]));
   1105          					dbghex(("%02x,",SerialApp_Buf[UART_PROTOCOL_DATA_START+4]));
   1106          					dbghex(("%02x\r\n",SerialApp_Buf[UART_PROTOCOL_DATA_START+5]));
   1107          					GenericApp_SendMessageCmd(afAddr16Bit, addr,cmd, &SerialApp_Buf[UART_PROTOCOL_DATA_START+4], dataLen-UART_PROTOCOL_CMDID_START-4);
   \                     ??SerialApp_CallBack_6:
   \   00019F                ; Setup parameters for call to function GenericApp_SendMessageCmd
   \   00019F   E5..         MOV     A,?V0 + 0
   \   0001A1   24F5         ADD     A,#-0xb
   \   0001A3   12....       LCALL   ?Subroutine8 & 0xFFFF
   1108          
   1109          				}
   \                     ??CrossCallReturnLabel_12:
   \   0001A6   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001A9   75....       MOV     ?V0 + 0,#(SerialApp_Buf + 13) & 0xff
   \   0001AC   75....       MOV     ?V0 + 1,#((SerialApp_Buf + 13) >> 8) & 0xff
   \   0001AF   78..         MOV     R0,#?V0 + 0
   \   0001B1   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001B4   E5..         MOV     A,?V0 + 2
   \   0001B6   F5..         MOV     ?V0 + 3,A
   \   0001B8   EE           MOV     A,R6
   \   0001B9   FC           MOV     R4,A
   \   0001BA   AD..         MOV     R5,?V0 + 3
   \                     ??SerialApp_CallBack_13:
   \   0001BC   7902         MOV     R1,#0x2
   \   0001BE   8039         SJMP    ??SerialApp_CallBack_11
   1110          				break;
   1111          			case 0x0040://group control
   1112          				{
   1113          					////in:		group id[2],cmds[2],data[...]
   1114          					////inSub:	group id[2],cmds[2],data[...]
   1115          
   1116          					GenericApp_SendMessageCmd(afAddrBroadcast, 0xffff,GENERICAPP_CMDID_BROADCAST_GROUP_CTRL, &SerialApp_Buf[UART_PROTOCOL_DATA_START], dataLen-UART_PROTOCOL_CMDID_START);
   \                     ??SerialApp_CallBack_7:
   \   0001C0                ; Setup parameters for call to function GenericApp_SendMessageCmd
   \   0001C0   E5..         MOV     A,?V0 + 0
   \   0001C2   24F9         ADD     A,#-0x7
   \   0001C4   12....       LCALL   ?Subroutine8 & 0xFFFF
   1117          
   1118          				}
   \                     ??CrossCallReturnLabel_13:
   \   0001C7   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001CA   75....       MOV     ?V0 + 0,#(SerialApp_Buf + 9) & 0xff
   \   0001CD   75....       MOV     ?V0 + 1,#((SerialApp_Buf + 9) >> 8) & 0xff
   \   0001D0   78..         MOV     R0,#?V0 + 0
   \   0001D2   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001D5   7C41         MOV     R4,#0x41
   \   0001D7   7D00         MOV     R5,#0x0
   \   0001D9   8018         SJMP    ??SerialApp_CallBack_14
   1119          				break;
   1120          			case 0x0050://broadcast control
   1121          				{
   1122          					////in:		cmds[2],data[...]
   1123          					////inSub:	data[...]
   1124          					uint16 cmd = (SerialApp_Buf[UART_PROTOCOL_DATA_START+0])|(SerialApp_Buf[UART_PROTOCOL_DATA_START+1]<<8);
   1125          
   1126          					GenericApp_SendMessageCmd(afAddrBroadcast, 0xffff,cmd, &SerialApp_Buf[UART_PROTOCOL_DATA_START+2], dataLen-UART_PROTOCOL_CMDID_START-2);
   \                     ??SerialApp_CallBack_8:
   \   0001DB                ; Setup parameters for call to function GenericApp_SendMessageCmd
   \   0001DB   8C..         MOV     ?V0 + 0,R4
   \   0001DD   8D..         MOV     ?V0 + 1,R5
   \   0001DF   78..         MOV     R0,#?V0 + 0
   \   0001E1   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001E4   75....       MOV     ?V0 + 0,#(SerialApp_Buf + 11) & 0xff
   \   0001E7   75....       MOV     ?V0 + 1,#((SerialApp_Buf + 11) >> 8) & 0xff
   \   0001EA   78..         MOV     R0,#?V0 + 0
   \   0001EC   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001EF   EA           MOV     A,R2
   \   0001F0   FC           MOV     R4,A
   \   0001F1   EB           MOV     A,R3
   \   0001F2   FD           MOV     R5,A
   \                     ??SerialApp_CallBack_14:
   \   0001F3   7AFF         MOV     R2,#-0x1
   \   0001F5   7BFF         MOV     R3,#-0x1
   \   0001F7   790F         MOV     R1,#0xf
   \                     ??SerialApp_CallBack_11:
   \   0001F9   12....       LCALL   ??GenericApp_SendMessageCmd?relay
   \   0001FC   7404         MOV     A,#0x4
   \   0001FE   12....       LCALL   ?DEALLOC_XSTACK8
   1127          
   1128          				}
   1129          				break;
   1130          
   1131          			#endif
   1132          			default:
   1133          				{
   1134          					//not supported
   1135          					//UartControlSendSimple(SerialApp_Buf,0,0x0006);
   1136          				}
   1137          				break;
   1138          			}
   1139          				
   1140          		}
   1141          	}
   1142          exit:
   1143          	SerialApp_Len = 0;
   \                     ??SerialApp_CallBack_0:
   \   000201   90....       MOV     DPTR,#SerialApp_Len
   \   000204   E4           CLR     A
   \   000205   F0           MOVX    @DPTR,A
   1144          #endif
   1145          }
   \   000206   7F0A         MOV     R7,#0xa
   \   000208   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   F5..         MOV     ?V0 + 0,A
   \   000002   E4           CLR     A
   \   000003   34FF         ADDC    A,#-0x1
   \   000005   F5..         MOV     ?V0 + 1,A
   \   000007   78..         MOV     R0,#?V0 + 0
   \   000009   22           RET
   1146          //#define TIMER_FREE
   1147          #if ! defined(RTR_NWK)
   1148          static volatile uint8 T4Count = 0;
   1149          void initTimer4()
   1150          {
   1151          	#if  ! defined(TIMER_FREE)
   1152              T4CTL |= 0x08 ;          //开溢出中断     
   1153              T4IE = 1;                //开总中断和T3中断
   1154              //T4CTL |= 0x40;           // 4分频
   1155              T4CTL |= 0x00;           // 1分频
   1156              T4CTL &= ~0x03;          //自动重装 00－>0xff  
   1157              T4CTL |= 0x10;           //启动
   1158              //EA = 1;                  //开总中断
   1159              #else
   1160              T4CTL |= 0x08 ;          //开溢出中断     
   1161              T4CTL |= 0x40;           // 4分频
   1162              T4CTL &= ~0x03;          //
   1163              T4CTL |= 0x01;          //重复向上计数//自动重装 00－>0xff  
   1164              T4CCTL0 = 0X6c;			//比较模式
   1165              T4OVFIF = 1;
   1166              T4CC0 = 30;
   1167              T4IF = 1;                //
   1168              T4IE = 1;                //开总中断和T3中断
   1169              T4CTL |= 0x10;           //启动
   1170              //EA = 1;                  //开总中断
   1171          	#endif
   1172          }
   1173          /*********************************************************************
   1174           */
   1175           //定时器T3中断处理函数
   1176          #pragma vector = T4_VECTOR 
   1177          __interrupt void T4_ISR(void) 
   1178          { 
   1179          	//IRCON = 0x00;            //清中断标志, 也可由硬件自动完成 
   1180              //T4OVFIF = 0;
   1181          	T4IF = 0;
   1182          	//T4CTL |= 0x04;
   1183          	if(T4Count++==255)
   1184          		T4Count = 0;
   1185          #if ! defined(RTR_NWK)
   1186          	#if 0//for test
   1187          	P0_3 = 0;
   1188          	P0_4 = 0;
   1189          	P0_5 = 0;
   1190          	P0_6 = 0;
   1191          	if(T4Count<76)
   1192          		P0_2 = 1;
   1193          	else
   1194          		P0_2 = 0;
   1195          	#else
   1196          	if(T4Count<63)
   1197          		P0_2 = 1;
   1198          	else
   1199          		P0_2 = 0;
   1200          	if(T4Count<ledBrightness_gen)
   1201          		P0_3 = 0;
   1202          	else
   1203          		P0_3 = 1;
   1204          	//if(T4Count<ledBrightness_gen)
   1205          	//	P1_0 = 1;
   1206          	//else
   1207          	//	P1_0 = 0;
   1208          	//if(T4Count<ledYellow_gen)
   1209          	//	P1_1 = 0;
   1210          	//else
   1211          	//	P1_1 = 1;
   1212          	if(T4Count<ledColorR_gen)
   1213          		P0_4 = 0;
   1214          	else
   1215          		P0_4 = 1;
   1216          	if(T4Count<ledColorG_gen)
   1217          		P0_5 = 0;
   1218          	else
   1219          		P0_5 = 1;
   1220          	if(T4Count<ledColorB_gen)
   1221          		P0_6 = 0;
   1222          	else
   1223          		P0_6 = 1;
   1224          	#endif
   1225          #endif
   1226          	#if  defined(TIMER_FREE)
   1227          	T4CC0 = 0x10;
   1228          	T4CTL |= 0x10;
   1229          	#endif
   1230          }
   1231          void ProcessMsgLight(uint8* data)
   1232          {
   1233          	ledBrightness_gen = data[0];
   1234          	ledYellow_gen = data[1];
   1235          	ledColorR_gen = data[2];
   1236          	ledColorG_gen = data[3];
   1237          	ledColorB_gen = data[4];
   1238          }
   1239          #endif

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1240          uint8 CalcChecksum(uint8*buf,uint8 len)
   \                     CalcChecksum:
   1241          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FD           MOV     R5,A
   1242          	uint16 checksum = 0;
   \   000007   7800         MOV     R0,#0x0
   1243          	uint8 i;
   1244          	for(i=0;i<len;i++)
   \   000009   7C00         MOV     R4,#0x0
   \   00000B   8010         SJMP    ??CalcChecksum_0
   1245          		checksum += buf[i];
   \                     ??CalcChecksum_1:
   \   00000D   8C..         MOV     ?V0 + 0,R4
   \   00000F   EA           MOV     A,R2
   \   000010   25..         ADD     A,?V0 + 0
   \   000012   F582         MOV     DPL,A
   \   000014   EB           MOV     A,R3
   \   000015   12....       LCALL   ??Subroutine9_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_15:
   \   000018   FE           MOV     R6,A
   \   000019   E8           MOV     A,R0
   \   00001A   2E           ADD     A,R6
   \   00001B   F8           MOV     R0,A
   \   00001C   0C           INC     R4
   \                     ??CalcChecksum_0:
   \   00001D   EC           MOV     A,R4
   \   00001E   C3           CLR     C
   \   00001F   9D           SUBB    A,R5
   \   000020   40EB         JC      ??CalcChecksum_1
   1246          	return checksum & 0xff;
   \   000022   E8           MOV     A,R0
   \   000023   F9           MOV     R1,A
   \   000024   7F02         MOV     R7,#0x2
   \   000026   02....       LJMP    ?BANKED_LEAVE_XDATA
   1247          }
   1248          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   1249          XDATA uint32 uartSendSeq = 0;
   \                     uartSendSeq:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z
   1250          
   1251          
   1252          ////buf复用,len为你的数据长度，不考虑头(len)、尾(crc)

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1253          void UartControlSend(uint8*buf,uint8 dataLen)
   \                     UartControlSend:
   1254          {
   \   000000   74F3         MOV     A,#-0xd
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 13
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   \   000009   89..         MOV     ?V0 + 4,R1
   1255          	//int16 i;
   1256          	//if(len + 2 >SERIAL_APP_TX_MAX)
   1257          	//	;//error
   1258          	buf[0] = 0xAA;
   \   00000B   8E82         MOV     DPL,R6
   \   00000D   8F83         MOV     DPH,R7
   \   00000F   74AA         MOV     A,#-0x56
   \   000011   F0           MOVX    @DPTR,A
   1259          	buf[1] = dataLen+5;
   \   000012   7405         MOV     A,#0x5
   \   000014   25..         ADD     A,?V0 + 4
   \   000016   F9           MOV     R1,A
   \   000017   A3           INC     DPTR
   \   000018   F0           MOVX    @DPTR,A
   1260          	buf[2] = uartSendSeq;
   \   000019   EE           MOV     A,R6
   \   00001A   2402         ADD     A,#0x2
   \   00001C   FA           MOV     R2,A
   \   00001D   EF           MOV     A,R7
   \   00001E   3400         ADDC    A,#0x0
   \   000020   FB           MOV     R3,A
   \   000021   90....       MOV     DPTR,#uartSendSeq
   \   000024   78..         MOV     R0,#?V0 + 0
   \   000026   12....       LCALL   ?L_MOV_X
   \   000029   8A82         MOV     DPL,R2
   \   00002B   8B83         MOV     DPH,R3
   \   00002D   12....       LCALL   ?Subroutine4 & 0xFFFF
   1261          	buf[3] = uartSendSeq>>8;
   \                     ??CrossCallReturnLabel_18:
   \   000030   12....       LCALL   ?L_MOV_X
   \   000033   E5..         MOV     A,?V0 + 1
   \   000035   8E82         MOV     DPL,R6
   \   000037   8F83         MOV     DPH,R7
   \   000039   A3           INC     DPTR
   \   00003A   A3           INC     DPTR
   \   00003B   A3           INC     DPTR
   \   00003C   12....       LCALL   ??Subroutine10_0 & 0xFFFF
   1262          	buf[4] = uartSendSeq>>16;
   \                     ??CrossCallReturnLabel_20:
   \   00003F   12....       LCALL   ?L_MOV_X
   \   000042   7410         MOV     A,#0x10
   \   000044   78..         MOV     R0,#?V0 + 0
   \   000046   12....       LCALL   ?UL_SHR
   \   000049   8E82         MOV     DPL,R6
   \   00004B   8F83         MOV     DPH,R7
   \   00004D   A3           INC     DPTR
   \   00004E   A3           INC     DPTR
   \   00004F   A3           INC     DPTR
   \   000050   A3           INC     DPTR
   \   000051   12....       LCALL   ?Subroutine4 & 0xFFFF
   1263          	buf[5] = uartSendSeq>>24;
   \                     ??CrossCallReturnLabel_19:
   \   000054   12....       LCALL   ?L_MOV_X
   \   000057   7418         MOV     A,#0x18
   \   000059   78..         MOV     R0,#?V0 + 0
   \   00005B   12....       LCALL   ?UL_SHR
   \   00005E   8E82         MOV     DPL,R6
   \   000060   8F83         MOV     DPH,R7
   \   000062   A3           INC     DPTR
   \   000063   A3           INC     DPTR
   \   000064   A3           INC     DPTR
   \   000065   A3           INC     DPTR
   \   000066   A3           INC     DPTR
   \   000067   E5..         MOV     A,?V0 + 0
   \   000069   12....       LCALL   ?Subroutine2 & 0xFFFF
   1264          	buf[6] = 0;// not ack
   \                     ??CrossCallReturnLabel_0:
   \   00006C   E4           CLR     A
   \   00006D   F0           MOVX    @DPTR,A
   1265          	buf[7 + dataLen] = CalcChecksum(&buf[UART_PROTOCOL_SEQ_START],dataLen+5);
   \   00006E   85..82       MOV     DPL,?V0 + 4
   \   000071   8582..       MOV     ?V0 + 2,DPL
   \   000074   EE           MOV     A,R6
   \   000075   25..         ADD     A,?V0 + 2
   \   000077   F5..         MOV     ?V0 + 0,A
   \   000079   EF           MOV     A,R7
   \   00007A   3400         ADDC    A,#0x0
   \   00007C   F5..         MOV     ?V0 + 1,A
   \   00007E                ; Setup parameters for call to function CalcChecksum
   \   00007E   12....       LCALL   ??CalcChecksum?relay
   \   000081   E9           MOV     A,R1
   \   000082   85..82       MOV     DPL,?V0 + 0
   \   000085   85..83       MOV     DPH,?V0 + 1
   \   000088   A3           INC     DPTR
   \   000089   A3           INC     DPTR
   \   00008A   A3           INC     DPTR
   \   00008B   A3           INC     DPTR
   \   00008C   A3           INC     DPTR
   \   00008D   A3           INC     DPTR
   \   00008E   A3           INC     DPTR
   \   00008F   F0           MOVX    @DPTR,A
   1266          	buf[8 + dataLen] = 0x55;
   \   000090   85..82       MOV     DPL,?V0 + 0
   \   000093   85..83       MOV     DPH,?V0 + 1
   \   000096   A3           INC     DPTR
   \   000097   A3           INC     DPTR
   \   000098   A3           INC     DPTR
   \   000099   A3           INC     DPTR
   \   00009A   A3           INC     DPTR
   \   00009B   A3           INC     DPTR
   \   00009C   A3           INC     DPTR
   \   00009D   A3           INC     DPTR
   \   00009E   7455         MOV     A,#0x55
   \   0000A0   F0           MOVX    @DPTR,A
   1267          	HalUARTWrite(CTRL_PORT,buf,dataLen+9);
   \   0000A1                ; Setup parameters for call to function HalUARTWrite
   \   0000A1   E5..         MOV     A,?V0 + 2
   \   0000A3   2409         ADD     A,#0x9
   \   0000A5   FC           MOV     R4,A
   \   0000A6   E4           CLR     A
   \   0000A7   3400         ADDC    A,#0x0
   \   0000A9   FD           MOV     R5,A
   \   0000AA   EE           MOV     A,R6
   \   0000AB   FA           MOV     R2,A
   \   0000AC   EF           MOV     A,R7
   \   0000AD   FB           MOV     R3,A
   \   0000AE   7900         MOV     R1,#0x0
   \   0000B0   12....       LCALL   ??HalUARTWrite?relay
   1268          
   1269          	uartSendSeq++;
   \   0000B3   90....       MOV     DPTR,#__Constant_1
   \   0000B6   78..         MOV     R0,#?V0 + 0
   \   0000B8   12....       LCALL   ?L_MOV_X
   \   0000BB   90....       MOV     DPTR,#uartSendSeq
   \   0000BE   78..         MOV     R0,#?V0 + 0
   \   0000C0   12....       LCALL   ?L_ADD_TO_X
   1270          #if 0
   1271          	dbgint(("uart send=%d\r\n",dataLen));
   1272                  
   1273          	for(i = 0;i<dataLen;i++)
   1274          	{
   1275          		dbghex((" %02x",buf[i]));
   1276          		if(i%8 == 7)
   1277          		{
   1278          			dbgtag(("\r\n"));
   1279          		}
   1280          	}
   1281          	dbgtag(("\r\n"));
   1282          #endif
   1283          }
   \   0000C3   7F05         MOV     R7,#0x5
   \   0000C5   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   E5..         MOV     A,?V0 + 0
   \   000002                REQUIRE ??Subroutine10_0
   \   000002                ; // Fall through to label ??Subroutine10_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine10_0:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   90....       MOV     DPTR,#uartSendSeq
   \   000004   78..         MOV     R0,#?V0 + 0
   \   000006   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   8E82         MOV     DPL,R6
   \   000003   8F83         MOV     DPH,R7
   \   000005   A3           INC     DPTR
   \   000006   A3           INC     DPTR
   \   000007   A3           INC     DPTR
   \   000008   A3           INC     DPTR
   \   000009   A3           INC     DPTR
   \   00000A   A3           INC     DPTR
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1284          void UartControlSendAck(uint8*buf)
   \                     UartControlSendAck:
   1285          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   1286          	//if(len + 2 >SERIAL_APP_TX_MAX)
   1287          	//	;//error
   1288          	buf[0] = 0xAA;
   \   000009   8E82         MOV     DPL,R6
   \   00000B   8F83         MOV     DPH,R7
   \   00000D   74AA         MOV     A,#-0x56
   \   00000F   F0           MOVX    @DPTR,A
   1289          	buf[1] = 5;
   \   000010   A3           INC     DPTR
   \   000011   7405         MOV     A,#0x5
   \   000013   12....       LCALL   ?Subroutine2 & 0xFFFF
   1290          	//buf[2] = uartSendSeq;	//use same seq received
   1291          	//buf[3] = uartSendSeq>>8;
   1292          	//buf[4] = uartSendSeq>>16;
   1293          	//buf[5] = uartSendSeq>>24;
   1294          	buf[6] = 1;// ack
   \                     ??CrossCallReturnLabel_1:
   \   000016   7401         MOV     A,#0x1
   \   000018   F0           MOVX    @DPTR,A
   1295          	buf[7 ] = CalcChecksum(&buf[UART_PROTOCOL_SEQ_START],5);
   \   000019                ; Setup parameters for call to function CalcChecksum
   \   000019   7905         MOV     R1,#0x5
   \   00001B   EE           MOV     A,R6
   \   00001C   2402         ADD     A,#0x2
   \   00001E   FA           MOV     R2,A
   \   00001F   EF           MOV     A,R7
   \   000020   3400         ADDC    A,#0x0
   \   000022   FB           MOV     R3,A
   \   000023   12....       LCALL   ??CalcChecksum?relay
   \   000026   E9           MOV     A,R1
   \   000027   8E82         MOV     DPL,R6
   \   000029   8F83         MOV     DPH,R7
   \   00002B   A3           INC     DPTR
   \   00002C   A3           INC     DPTR
   \   00002D   A3           INC     DPTR
   \   00002E   A3           INC     DPTR
   \   00002F   A3           INC     DPTR
   \   000030   A3           INC     DPTR
   \   000031   A3           INC     DPTR
   \   000032   12....       LCALL   ?Subroutine2 & 0xFFFF
   1296          	buf[8 ] = 0x55;
   \                     ??CrossCallReturnLabel_2:
   \   000035   A3           INC     DPTR
   \   000036   A3           INC     DPTR
   \   000037   7455         MOV     A,#0x55
   \   000039   F0           MOVX    @DPTR,A
   1297          	HalUARTWrite(CTRL_PORT,buf,9);
   \   00003A                ; Setup parameters for call to function HalUARTWrite
   \   00003A   7C09         MOV     R4,#0x9
   \   00003C   7D00         MOV     R5,#0x0
   \   00003E   EE           MOV     A,R6
   \   00003F   FA           MOV     R2,A
   \   000040   EF           MOV     A,R7
   \   000041   FB           MOV     R3,A
   \   000042   7900         MOV     R1,#0x0
   \   000044   12....       LCALL   ??HalUARTWrite?relay
   1298          
   1299          }
   \   000047                REQUIRE ?Subroutine0
   \   000047                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1300          void UartControlSendCmd(uint16 retCmdId,uint8*buf,uint8 dataLen)
   \                     UartControlSendCmd:
   1301          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   1302          	buf[UART_PROTOCOL_CMDID_START+0] = retCmdId;
   \   000005   EA           MOV     A,R2
   \   000006   8C82         MOV     DPL,R4
   \   000008   8D83         MOV     DPH,R5
   \   00000A   A3           INC     DPTR
   \   00000B   A3           INC     DPTR
   \   00000C   A3           INC     DPTR
   \   00000D   A3           INC     DPTR
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   A3           INC     DPTR
   \   000011   F0           MOVX    @DPTR,A
   1303          	buf[UART_PROTOCOL_CMDID_START+1] = retCmdId>>8;
   \   000012   EB           MOV     A,R3
   \   000013   8C82         MOV     DPL,R4
   \   000015   8D83         MOV     DPH,R5
   \   000017   A3           INC     DPTR
   \   000018   A3           INC     DPTR
   \   000019   A3           INC     DPTR
   \   00001A   A3           INC     DPTR
   \   00001B   A3           INC     DPTR
   \   00001C   A3           INC     DPTR
   \   00001D   A3           INC     DPTR
   \   00001E   A3           INC     DPTR
   \   00001F   F0           MOVX    @DPTR,A
   1304          	UartControlSend(buf,dataLen+2);
   \   000020                ; Setup parameters for call to function UartControlSend
   \   000020   09           INC     R1
   \   000021   09           INC     R1
   \   000022   EC           MOV     A,R4
   \   000023   FA           MOV     R2,A
   \   000024   ED           MOV     A,R5
   \   000025   FB           MOV     R3,A
   \   000026   12....       LCALL   ??UartControlSend?relay
   1305          }
   \   000029   80..         SJMP    ?Subroutine0

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_1:
   \   000000   01000000     DD 1

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_MessageMSGCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_MessageMSGCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??GenericApp_SendMessageCmd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    GenericApp_SendMessageCmd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_CallBack?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_CallBack

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??CalcChecksum?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    CalcChecksum

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??UartControlSend?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    UartControlSend

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??UartControlSendAck?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    UartControlSendAck

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??UartControlSendCmd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    UartControlSendCmd
   1306          

   Maximum stack usage in bytes:

   ISTACK PSTACK XSTACK Function
   ------ ------ ------ --------
       0      0     28  CalcChecksum
       0      0     38  GenericApp_Init
                          0 0 38 -> HalUARTOpen
                          0 0 38 -> RegisterForKeys
                          0 0 38 -> UartControlSendCmd
                          0 0 38 -> afRegister
       1      0     34  GenericApp_MessageMSGCB
                          0 0  9 -> HalLedBlink
                          0 0  9 -> UartControlSendCmd
       0      0     34  GenericApp_ProcessEvent
                          0 0 25 -> GenericApp_MessageMSGCB
                          0 0 29 -> GenericApp_SendMessageCmd
                          0 0 25 -> HalLedSet
                          0 0 25 -> NLME_GetShortAddr
                          0 0 25 -> ZDO_ParseEPListRsp
                          0 0 34 -> ZDP_EndDeviceBindReq
                          0 0 33 -> ZDP_MatchDescReq
                          0 0 25 -> osal_mem_free
                          0 0 25 -> osal_msg_deallocate
                          0 0 25 -> osal_msg_receive
       1      0     54  GenericApp_SendMessageCmd
                          0 0 25 -> AF_DataRequest
       0      0     22  SerialApp_CallBack
                          0 0 18 -> CalcChecksum
                          0 0 22 -> GenericApp_SendMessageCmd
                          0 0 18 -> HalUARTRead
                          0 0 18 -> UartControlSendAck
                          0 0 20 -> memcpy
                          0 0 18 -> osal_mem_alloc
                          0 0 18 -> osal_mem_free
                          0 0 18 -> osal_nv_item_len
                          0 0 22 -> osal_nv_read
       1      0     22  UartControlSend
                          0 0 13 -> CalcChecksum
                          0 0 13 -> HalUARTWrite
       1      0     27  UartControlSendAck
                          0 0  9 -> CalcChecksum
                          0 0  9 -> HalUARTWrite
       1      0     47  UartControlSendCmd
                          0 0  9 -> UartControlSend


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
       6  ??CalcChecksum?relay
       6  ??GenericApp_Init?relay
       6  ??GenericApp_MessageMSGCB?relay
       6  ??GenericApp_ProcessEvent?relay
       6  ??GenericApp_SendMessageCmd?relay
       6  ??SerialApp_CallBack?relay
       7  ??Subroutine10_0
       6  ??Subroutine9_0
       6  ??UartControlSend?relay
       6  ??UartControlSendAck?relay
       6  ??UartControlSendCmd?relay
       5  ?Subroutine0
      10  ?Subroutine1
      12  ?Subroutine2
       8  ?Subroutine3
       2  ?Subroutine4
       9  ?Subroutine5
      15  ?Subroutine6
       4  ?Subroutine7
      10  ?Subroutine8
      41  CalcChecksum
       2  GenericApp_ClusterList
      12  GenericApp_DstAddr
     203  GenericApp_Init
     159  GenericApp_MessageMSGCB
       1  GenericApp_NwkState
     525  GenericApp_ProcessEvent
     190  GenericApp_SendMessageCmd
      12  GenericApp_SimpleDesc
       1  GenericApp_TaskID
       1  GenericApp_TransID
       6  GenericApp_epDesc
     256  SerialApp_Buf
     523  SerialApp_CallBack
       1  SerialApp_Len
     200  UartControlSend
      71  UartControlSendAck
      43  UartControlSendCmd
       4  __Constant_1
     256  bufBig_gen
       1  syncStatusCnt
       1  syncStatusOk
       4  uartSendSeq

 
 2 043 bytes in segment BANKED_CODE
    54 bytes in segment BANK_RELAYS
    18 bytes in segment XDATA_ROM_C
   540 bytes in segment XDATA_Z
 
 2 097 bytes of CODE  memory
    14 bytes of CONST memory (+ 4 bytes shared)
   540 bytes of XDATA memory

Errors: none
Warnings: none
