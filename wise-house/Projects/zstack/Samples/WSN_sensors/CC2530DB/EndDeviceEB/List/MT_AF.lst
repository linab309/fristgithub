###############################################################################
#                                                                             #
# IAR C/C++ Compiler V7.51A/W32 for 8051                29/Sep/2011  15:47:02 #
# Copyright 2004-2009 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Com #
#                          ponents\mt\MT_AF.c                                 #
#    Command line       =  -f "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0 #
#                          \Projects\zstack\Samples\LightCtlPrj\CC2530DB\..\. #
#                          .\..\Tools\CC2530DB\f8wEndev.cfg" (-DCPU32MHZ      #
#                          -DROOT=__near_func -DBLINK_LEDS) -f "C:\Texas      #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\LightCtlPrj\CC2530DB\..\..\..\Tools\CC #
#                          2530DB\f8wConfig.cfg" (-DSECURE=0                  #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00001000                      #
#                          -DZDAPP_CONFIG_PAN_ID=0x1212                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Co #
#                          mponents\mt\MT_AF.c" -D NWK_AUTO_POLL -D ZTOOL_P1  #
#                          -D MT_TASK -D MT_SYS_FUNC -D MT_ZDO_FUNC -D        #
#                          LCD_SUPPORTED=DEBUG -D HAL_UART=TRUE -D            #
#                          xPOWER_SAVING -lC "C:\Texas                        #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\LightCtlPrj\CC2530DB\EndDeviceEB\List\ #
#                          " -lA "C:\Texas Instruments\ZStack-CC2530-2.2.2-1. #
#                          3.0\Projects\zstack\Samples\LightCtlPrj\CC2530DB\E #
#                          ndDeviceEB\List\" --diag_suppress Pe001,Pa010 -o   #
#                          "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Pr #
#                          ojects\zstack\Samples\LightCtlPrj\CC2530DB\EndDevi #
#                          ceEB\Obj\" -e --require_prototypes --debug         #
#                          --core=plain --dptr=16,1 --data_model=large        #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 8 -I "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\LightCtlPrj\CC2530DB\" -I "C:\Texas    #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\LightCtlPrj\CC2530DB\..\SOURCE\" -I    #
#                          "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Pr #
#                          ojects\zstack\Samples\LightCtlPrj\CC2530DB\..\..\. #
#                          .\ZMAIN\TI2530DB\" -I "C:\Texas                    #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\LightCtlPrj\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MT\" -I "C:\Texas                         #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\LightCtlPrj\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\HAL\INCLUDE\" -I "C:\Texas                #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\LightCtlPrj\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\HAL\TARGET\CC2530EB\" -I "C:\Texas        #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\LightCtlPrj\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\OSAL\MCU\CCSOC\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\LightCtlPrj\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\OSAL\INCLUDE\" -I "C:\Texas               #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\LightCtlPrj\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\AF\" -I "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\LightCtlPrj\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\NWK\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\LightCtlPrj\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\SEC\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\LightCtlPrj\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\SAPI\" -I "C:\Texas                 #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\LightCtlPrj\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\SYS\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\LightCtlPrj\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\ZDO\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\LightCtlPrj\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\ZMAC\F8W\" -I "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\LightCtlPrj\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\ZMAC\" -I "C:\Texas                       #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\LightCtlPrj\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\SERVICES\SADDR\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\LightCtlPrj\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\SERVICES\SDATA\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\LightCtlPrj\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\INCLUDE\" -I "C:\Texas                #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\LightCtlPrj\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\HIGH_LEVEL\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\LightCtlPrj\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\LOW_LEVEL\srf04\" -I "C:\Texas        #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\LightCtlPrj\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\LOW_LEVEL\srf04\SINGLE_CHIP\" -I      #
#                          "C:\Program Files\IAR Systems\Embedded Workbench   #
#                          5.3\8051\INC\" -I "C:\Program Files\IAR            #
#                          Systems\Embedded Workbench 5.3\8051\INC\CLIB\"     #
#                          -Ohz                                               #
#    List file          =  C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Pro #
#                          jects\zstack\Samples\LightCtlPrj\CC2530DB\EndDevic #
#                          eEB\List\MT_AF.lst                                 #
#    Object file        =  C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Pro #
#                          jects\zstack\Samples\LightCtlPrj\CC2530DB\EndDevic #
#                          eEB\Obj\MT_AF.r51                                  #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Components\mt\MT_AF.c
      1          /**************************************************************************************************
      2            Filename:       MT_AF.c
      3            Revised:        $Date: 2008-10-10 09:56:24 -0700 (Fri, 10 Oct 2008) $
      4            Revision:       $Revision: 18257 $
      5          
      6          
      7            Description:    MonitorTest functions for the AF layer.
      8          
      9          
     10            Copyright 2007 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com.
     39          
     40          **************************************************************************************************/
     41          
     42          /***************************************************************************************************
     43           * INCLUDES
     44           ***************************************************************************************************/
     45          #include "ZComDef.h"
     46          #include "OSAL.h"
     47          #include "MT.h"
     48          #include "MT_AF.h"
     49          #include "nwk.h"
     50          #include "OnBoard.h"
     51          #include "MT_UART.h"
     52          
     53          
     54          /***************************************************************************************************
     55           * GLOBAL VARIABLES
     56           ***************************************************************************************************/
     57          
     58          #if defined ( MT_AF_CB_FUNC )
     59          uint16 _afCallbackSub;
     60          #endif
     61          
     62          /***************************************************************************************************
     63           * LOCAL FUNCTIONS
     64           ***************************************************************************************************/
     65          void MT_AfRegister(uint8 *pBuf);
     66          void MT_AfDataRequest(uint8 *pBuf);
     67          
     68          /***************************************************************************************************
     69           * @fn      MT_afCommandProcessing
     70           *
     71           * @brief   Process all the AF commands that are issued by test tool
     72           *
     73           * @param   pBuf - pointer to the received buffer
     74           *
     75           * @return  status
     76           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     77          uint8 MT_AfCommandProcessing(uint8 *pBuf)
   \                     MT_AfCommandProcessing:
     78          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
     79            uint8 status = MT_RPC_SUCCESS;
   \   000005   7E00         MOV     R6,#0x0
     80          
     81            switch (pBuf[MT_RPC_POS_CMD1])
   \   000007   8A82         MOV     DPL,R2
   \   000009   8B83         MOV     DPH,R3
   \   00000B   A3           INC     DPTR
   \   00000C   A3           INC     DPTR
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   12....       LCALL   ?UC_SWITCH_DENSE
   \                     `?<Jumptable for MT_AfCommandProcessing>_0`:
   \   000011   00           DB        0
   \   000012   01           DB        1
   \   000013   ....         DW        ??MT_AfCommandProcessing_0
   \   000015   ....         DW        ??MT_AfCommandProcessing_1
   \   000017   ....         DW        ??MT_AfCommandProcessing_2
     82            {
     83              case MT_AF_REGISTER:
     84                MT_AfRegister(pBuf);
   \                     ??MT_AfCommandProcessing_1:
   \   000019                ; Setup parameters for call to function MT_AfRegister
   \   000019   12....       LCALL   ??MT_AfRegister?relay
   \   00001C   8007         SJMP    ??MT_AfCommandProcessing_3
     85                break;
     86          
     87              case MT_AF_DATA_REQUEST:
     88                MT_AfDataRequest(pBuf);
   \                     ??MT_AfCommandProcessing_2:
   \   00001E                ; Setup parameters for call to function MT_AfDataRequest
   \   00001E   12....       LCALL   ??MT_AfDataRequest?relay
   \   000021   8002         SJMP    ??MT_AfCommandProcessing_3
     89                break;
     90          
     91              default:
     92                status = MT_RPC_ERR_COMMAND_ID;
   \                     ??MT_AfCommandProcessing_0:
   \   000023   0E           INC     R6
   \   000024   0E           INC     R6
     93                break;
     94            }
     95          
     96            return status;
   \                     ??MT_AfCommandProcessing_3:
   \   000025   EE           MOV     A,R6
   \   000026   F9           MOV     R1,A
   \   000027   7F01         MOV     R7,#0x1
   \   000029   02....       LJMP    ?BANKED_LEAVE_XDATA
     97          }
     98          
     99          /***************************************************************************************************
    100           * @fn      MT_AfRegister
    101           *
    102           * @brief   Process AF Register command
    103           *
    104           * @param   pBuf - pointer to the received buffer
    105           *
    106           * @return  none
    107           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    108          void MT_AfRegister(uint8 *pBuf)
   \                     MT_AfRegister:
    109          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
    110            uint8 cmdId;
    111            uint8 retValue = ZMemError;
   \   00000E   7410         MOV     A,#0x10
   \   000010   12....       LCALL   ?Subroutine3 & 0xFFFF
    112            endPointDesc_t *epDesc;
    113          
    114            /* parse header */
    115            cmdId = pBuf[MT_RPC_POS_CMD1];
   \                     ??CrossCallReturnLabel_2:
   \   000013   F5..         MOV     ?V0 + 2,A
    116            pBuf += MT_RPC_FRAME_HDR_SZ;
    117          
    118            epDesc = (endPointDesc_t *)osal_mem_alloc(sizeof(endPointDesc_t));
   \   000015                ; Setup parameters for call to function osal_mem_alloc
   \   000015   7A06         MOV     R2,#0x6
   \   000017   7B00         MOV     R3,#0x0
   \   000019   12....       LCALL   ??osal_mem_alloc?relay
   \   00001C   8A..         MOV     ?V0 + 4,R2
   \   00001E   8B..         MOV     ?V0 + 5,R3
   \   000020   AE..         MOV     R6,?V0 + 4
   \   000022   AF..         MOV     R7,?V0 + 5
    119            if ( epDesc )
   \   000024   EE           MOV     A,R6
   \   000025   7001         JNZ     ??MT_AfRegister_0
   \   000027   EF           MOV     A,R7
   \                     ??MT_AfRegister_0:
   \   000028   6040         JZ      ??MT_AfRegister_1
    120            {
    121              epDesc->task_id = &MT_TaskID;
   \   00002A   8E82         MOV     DPL,R6
   \   00002C   8F83         MOV     DPH,R7
   \   00002E   A3           INC     DPTR
   \   00002F   74..         MOV     A,#(MT_TaskID & 0xff)
   \   000031   F0           MOVX    @DPTR,A
   \   000032   A3           INC     DPTR
   \   000033   74..         MOV     A,#((MT_TaskID >> 8) & 0xff)
   \   000035   F0           MOVX    @DPTR,A
    122              retValue = MT_BuildEndpointDesc( pBuf, epDesc );
   \   000036                ; Setup parameters for call to function MT_BuildEndpointDesc
   \   000036   EE           MOV     A,R6
   \   000037   FC           MOV     R4,A
   \   000038   EF           MOV     A,R7
   \   000039   FD           MOV     R5,A
   \   00003A   E5..         MOV     A,?V0 + 0
   \   00003C   2403         ADD     A,#0x3
   \   00003E   FA           MOV     R2,A
   \   00003F   E5..         MOV     A,?V0 + 1
   \   000041   3400         ADDC    A,#0x0
   \   000043   FB           MOV     R3,A
   \   000044   12....       LCALL   ??MT_BuildEndpointDesc?relay
   \   000047   E9           MOV     A,R1
   \   000048   85..82       MOV     DPL,?XSP + 0
   \   00004B   85..83       MOV     DPH,?XSP + 1
   \   00004E   F0           MOVX    @DPTR,A
    123              if ( retValue == ZSuccess )
   \   00004F   700F         JNZ     ??MT_AfRegister_2
    124              {
    125                retValue = afRegister( epDesc );
   \   000051                ; Setup parameters for call to function afRegister
   \   000051   EE           MOV     A,R6
   \   000052   FA           MOV     R2,A
   \   000053   EF           MOV     A,R7
   \   000054   FB           MOV     R3,A
   \   000055   12....       LCALL   ??afRegister?relay
   \   000058   E9           MOV     A,R1
   \   000059   85..82       MOV     DPL,?XSP + 0
   \   00005C   85..83       MOV     DPH,?XSP + 1
   \   00005F   F0           MOVX    @DPTR,A
    126              }
    127          
    128              if ( retValue != ZSuccess )
   \                     ??MT_AfRegister_2:
   \   000060   E0           MOVX    A,@DPTR
   \   000061   6007         JZ      ??MT_AfRegister_1
    129              {
    130                osal_mem_free( epDesc );
   \   000063                ; Setup parameters for call to function osal_mem_free
   \   000063   EE           MOV     A,R6
   \   000064   FA           MOV     R2,A
   \   000065   EF           MOV     A,R7
   \   000066   FB           MOV     R3,A
   \   000067   12....       LCALL   ??osal_mem_free?relay
    131              }
    132            }
    133          
    134            /* Build and send back the response */
    135            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_AF), cmdId, 1, &retValue);
   \                     ??MT_AfRegister_1:
   \   00006A                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   00006A   85..82       MOV     DPL,?XSP + 0
   \   00006D   85..83       MOV     DPH,?XSP + 1
   \   000070   AC82         MOV     R4,DPL
   \   000072   AD83         MOV     R5,DPH
   \   000074   7B01         MOV     R3,#0x1
   \   000076   AA..         MOV     R2,?V0 + 2
   \   000078   7964         MOV     R1,#0x64
   \   00007A   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    136          }
   \   00007D   7401         MOV     A,#0x1
   \   00007F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000082   7F06         MOV     R7,#0x6
   \   000084   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   85..82       MOV     DPL,?XSP + 0
   \   000003   85..83       MOV     DPH,?XSP + 1
   \   000006   F0           MOVX    @DPTR,A
   \   000007   8A82         MOV     DPL,R2
   \   000009   8B83         MOV     DPH,R3
   \   00000B   A3           INC     DPTR
   \   00000C   A3           INC     DPTR
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   22           RET
    137          
    138          /***************************************************************************************************
    139           * @fn      MT_AfDataRequest
    140           *
    141           * @brief   Process AF Register command
    142           *
    143           * @param   pBuf - pointer to the received buffer
    144           *
    145           * @return  none
    146           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    147          void MT_AfDataRequest(uint8 *pBuf)
   \                     MT_AfDataRequest:
    148          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 14
   \   000005   74F2         MOV     A,#-0xe
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    149            uint8 cmdId, tempLen = 0;
    150            uint8 retValue = ZFailure;
   \   00000A   7401         MOV     A,#0x1
   \   00000C   12....       LCALL   ?Subroutine3 & 0xFFFF
    151            endPointDesc_t *epDesc;
    152            byte transId;
    153            afAddrType_t dstAddr;
    154            cId_t cId;
    155            byte txOpts, radius, srcEP;
    156          
    157              /* parse header */
    158            cmdId = pBuf[MT_RPC_POS_CMD1];
   \                     ??CrossCallReturnLabel_3:
   \   00000F   FE           MOV     R6,A
    159            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000010   EA           MOV     A,R2
   \   000011   2403         ADD     A,#0x3
   \   000013   F5..         MOV     ?V0 + 0,A
   \   000015   EB           MOV     A,R3
   \   000016   3400         ADDC    A,#0x0
   \   000018   F5..         MOV     ?V0 + 1,A
    160          
    161            /* Destination address */
    162            dstAddr.addrMode = afAddr16Bit;
   \   00001A   740A         MOV     A,#0xa
   \   00001C   12....       LCALL   ?XSTACK_DISP0_8
   \   00001F   7402         MOV     A,#0x2
   \   000021   F0           MOVX    @DPTR,A
    163            dstAddr.addr.shortAddr = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   000022   85..82       MOV     DPL,?V0 + 0
   \   000025   85..83       MOV     DPH,?V0 + 1
   \   000028   E0           MOVX    A,@DPTR
   \   000029   FA           MOV     R2,A
   \   00002A   A3           INC     DPTR
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   F9           MOV     R1,A
   \   00002D   EA           MOV     A,R2
   \   00002E   F8           MOV     R0,A
   \   00002F   7402         MOV     A,#0x2
   \   000031   12....       LCALL   ?XSTACK_DISP0_8
   \   000034   E8           MOV     A,R0
   \   000035   F0           MOVX    @DPTR,A
   \   000036   A3           INC     DPTR
   \   000037   E9           MOV     A,R1
   \   000038   F0           MOVX    @DPTR,A
    164            pBuf += 2;
   \   000039   12....       LCALL   ?Subroutine2 & 0xFFFF
    165          
    166            /* Destination endpoint */
    167            dstAddr.endPoint = *pBuf++;
   \                     ??CrossCallReturnLabel_0:
   \   00003C   C0E0         PUSH    A
   \   00003E   740B         MOV     A,#0xb
   \   000040   12....       LCALL   ?XSTACK_DISP0_8
   \   000043   D0E0         POP     A
   \   000045   12....       LCALL   ?Subroutine4 & 0xFFFF
    168          
    169            /* Source endpoint */
    170            srcEP = *pBuf++;
   \                     ??CrossCallReturnLabel_5:
   \   000048   8582..       MOV     ?V0 + 0,DPL
   \   00004B   8583..       MOV     ?V0 + 1,DPH
    171            epDesc = afFindEndPointDesc( srcEP );
   \   00004E                ; Setup parameters for call to function afFindEndPointDesc
   \   00004E   12....       LCALL   ??afFindEndPointDesc?relay
   \   000051   8A..         MOV     ?V0 + 2,R2
   \   000053   8B..         MOV     ?V0 + 3,R3
   \   000055   AC..         MOV     R4,?V0 + 2
   \   000057   AD..         MOV     R5,?V0 + 3
    172          
    173            /* ClusterId */
    174            cId = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   000059   85..82       MOV     DPL,?V0 + 0
   \   00005C   85..83       MOV     DPH,?V0 + 1
   \   00005F   E0           MOVX    A,@DPTR
   \   000060   FA           MOV     R2,A
   \   000061   A3           INC     DPTR
   \   000062   E0           MOVX    A,@DPTR
   \   000063   FB           MOV     R3,A
    175            pBuf +=2;
   \   000064   12....       LCALL   ?Subroutine2 & 0xFFFF
    176          
    177            /* TransId */
    178            transId = *pBuf++;
   \                     ??CrossCallReturnLabel_1:
   \   000067   C0E0         PUSH    A
   \   000069   7401         MOV     A,#0x1
   \   00006B   12....       LCALL   ?XSTACK_DISP0_8
   \   00006E   D0E0         POP     A
   \   000070   12....       LCALL   ?Subroutine4 & 0xFFFF
    179          
    180            /* TxOption */
    181            txOpts = *pBuf++;
    182          
    183            /* Radius */
    184            radius = *pBuf++;
   \                     ??CrossCallReturnLabel_6:
   \   000073   E0           MOVX    A,@DPTR
   \   000074   F5..         MOV     ?V0 + 2,A
   \   000076   A3           INC     DPTR
    185          
    186            /* Length */
    187            tempLen = *pBuf++;
   \   000077   E0           MOVX    A,@DPTR
   \   000078   FF           MOV     R7,A
   \   000079   A3           INC     DPTR
   \   00007A   8582..       MOV     ?V0 + 0,DPL
   \   00007D   8583..       MOV     ?V0 + 1,DPH
    188          
    189            if ( epDesc == NULL )
   \   000080   EC           MOV     A,R4
   \   000081   7001         JNZ     ??MT_AfDataRequest_0
   \   000083   ED           MOV     A,R5
   \                     ??MT_AfDataRequest_0:
   \   000084   7004         JNZ     ??MT_AfDataRequest_1
    190            {
    191              retValue = afStatus_INVALID_PARAMETER;
   \   000086   7402         MOV     A,#0x2
   \   000088   803F         SJMP    ??MT_AfDataRequest_2
    192            }
    193            else
    194            {
    195              retValue = AF_DataRequest( &dstAddr, epDesc, cId, tempLen, pBuf, &transId, txOpts, radius );
   \                     ??MT_AfDataRequest_1:
   \   00008A                ; Setup parameters for call to function AF_DataRequest
   \   00008A   78..         MOV     R0,#?V0 + 2
   \   00008C   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00008F   7402         MOV     A,#0x2
   \   000091   12....       LCALL   ?XSTACK_DISP0_8
   \   000094   8582..       MOV     ?V0 + 2,DPL
   \   000097   8583..       MOV     ?V0 + 3,DPH
   \   00009A   78..         MOV     R0,#?V0 + 2
   \   00009C   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00009F   78..         MOV     R0,#?V0 + 0
   \   0000A1   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000A4   8F..         MOV     ?V0 + 0,R7
   \   0000A6   75..00       MOV     ?V0 + 1,#0x0
   \   0000A9   78..         MOV     R0,#?V0 + 0
   \   0000AB   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000AE   8A..         MOV     ?V0 + 0,R2
   \   0000B0   8B..         MOV     ?V0 + 1,R3
   \   0000B2   78..         MOV     R0,#?V0 + 0
   \   0000B4   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000B7   740B         MOV     A,#0xb
   \   0000B9   12....       LCALL   ?XSTACK_DISP0_8
   \   0000BC   AA82         MOV     R2,DPL
   \   0000BE   AB83         MOV     R3,DPH
   \   0000C0   12....       LCALL   ??AF_DataRequest?relay
   \   0000C3   7409         MOV     A,#0x9
   \   0000C5   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000C8   E9           MOV     A,R1
   \                     ??MT_AfDataRequest_2:
   \   0000C9   85..82       MOV     DPL,?XSP + 0
   \   0000CC   85..83       MOV     DPH,?XSP + 1
   \   0000CF   F0           MOVX    @DPTR,A
    196            }
    197          
    198            /* Build and send back the response */
    199            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_AF), cmdId, 1, &retValue);
   \   0000D0                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   0000D0   AC82         MOV     R4,DPL
   \   0000D2   AD83         MOV     R5,DPH
   \   0000D4   7B01         MOV     R3,#0x1
   \   0000D6   EE           MOV     A,R6
   \   0000D7   FA           MOV     R2,A
   \   0000D8   7964         MOV     R1,#0x64
   \   0000DA   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    200          }
   \   0000DD   740E         MOV     A,#0xe
   \   0000DF   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000E2   7F04         MOV     R7,#0x4
   \   0000E4   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   85..82       MOV     DPL,?V0 + 0
   \   000004   85..83       MOV     DPH,?V0 + 1
   \   000007   A3           INC     DPTR
   \   000008   E0           MOVX    A,@DPTR
   \   000009   F9           MOV     R1,A
   \   00000A   A3           INC     DPTR
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   E5..         MOV     A,?V0 + 0
   \   000002   2402         ADD     A,#0x2
   \   000004   F5..         MOV     ?V0 + 0,A
   \   000006   E5..         MOV     A,?V0 + 1
   \   000008   3400         ADDC    A,#0x0
   \   00000A   F5..         MOV     ?V0 + 1,A
   \   00000C   85..82       MOV     DPL,?V0 + 0
   \   00000F   F583         MOV     DPH,A
   \   000011   E0           MOVX    A,@DPTR
   \   000012   22           RET
    201          
    202          /***************************************************************************************************
    203           * @fn      MT_AfDataConfirm
    204           *
    205           * @brief   Process
    206           *
    207           * @param   pBuf - pointer to the received buffer
    208           *
    209           * @return  none
    210           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    211          void MT_AfDataConfirm(afDataConfirm_t *pMsg)
   \                     MT_AfDataConfirm:
    212          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 3
   \   000004   74FD         MOV     A,#-0x3
   \   000006   12....       LCALL   ?ALLOC_XSTACK8
    213            uint8 retArray[3];
    214          
    215            retArray[0] = pMsg->hdr.status;
   \   000009   8A82         MOV     DPL,R2
   \   00000B   8B83         MOV     DPH,R3
   \   00000D   A3           INC     DPTR
   \   00000E   E0           MOVX    A,@DPTR
   \   00000F   12....       LCALL   ?Subroutine3 & 0xFFFF
    216            retArray[1] = pMsg->endpoint;
   \                     ??CrossCallReturnLabel_4:
   \   000012   C0E0         PUSH    A
   \   000014   7401         MOV     A,#0x1
   \   000016   12....       LCALL   ?XSTACK_DISP0_8
   \   000019   D0E0         POP     A
   \   00001B   F0           MOVX    @DPTR,A
    217            retArray[2] = pMsg->transID;
   \   00001C   8A82         MOV     DPL,R2
   \   00001E   8B83         MOV     DPH,R3
   \   000020   A3           INC     DPTR
   \   000021   A3           INC     DPTR
   \   000022   A3           INC     DPTR
   \   000023   E0           MOVX    A,@DPTR
   \   000024   C0E0         PUSH    A
   \   000026   7402         MOV     A,#0x2
   \   000028   12....       LCALL   ?XSTACK_DISP0_8
   \   00002B   D0E0         POP     A
   \   00002D   F0           MOVX    @DPTR,A
    218          
    219            /* Build and send back the response */
    220            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_AF), MT_AF_DATA_CONFIRM, 3, retArray);
   \   00002E                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   00002E   85..82       MOV     DPL,?XSP + 0
   \   000031   85..83       MOV     DPH,?XSP + 1
   \   000034   AC82         MOV     R4,DPL
   \   000036   AD83         MOV     R5,DPH
   \   000038   7B03         MOV     R3,#0x3
   \   00003A   7A80         MOV     R2,#-0x80
   \   00003C   7944         MOV     R1,#0x44
   \   00003E   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    221          }
   \   000041   7403         MOV     A,#0x3
   \   000043   12....       LCALL   ?DEALLOC_XSTACK8
   \   000046   D083         POP     DPH
   \   000048   D082         POP     DPL
   \   00004A   02....       LJMP    ?BRET
    222          
    223          /***************************************************************************************************
    224           * @fn          MT_AfIncomingMsg
    225           *
    226           * @brief       Process the callback subscription for AF Incoming data.
    227           *
    228           * @param       pkt - Incoming AF data.
    229           *
    230           * @return      none
    231           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    232          void MT_AfIncomingMsg(afIncomingMSGPacket_t *pMsg)
   \                     MT_AfIncomingMsg:
    233          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    234            uint8 respLen;            /* Length of the whole response packet */
    235            uint8 dataLen;            /* Length of the data section in the response packet */
    236            uint8 *respPtr, *tempPtr;
    237          
    238            /* dataLen */
    239            dataLen = pMsg->cmd.DataLength;
   \   000009   EE           MOV     A,R6
   \   00000A   241F         ADD     A,#0x1f
   \   00000C   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   F5..         MOV     ?V0 + 4,A
    240            /* respLen */
    241            respLen = 17 + dataLen;
   \   000012   7411         MOV     A,#0x11
   \   000014   25..         ADD     A,?V0 + 4
   \   000016   F5..         MOV     ?V0 + 5,A
    242          
    243            /* Allocate memory for the response packet */
    244            respPtr = osal_mem_alloc(respLen);
   \   000018                ; Setup parameters for call to function osal_mem_alloc
   \   000018   FA           MOV     R2,A
   \   000019   7B00         MOV     R3,#0x0
   \   00001B   12....       LCALL   ??osal_mem_alloc?relay
   \   00001E   8A..         MOV     ?V0 + 6,R2
   \   000020   8B..         MOV     ?V0 + 7,R3
    245            if (!respPtr)
   \   000022   EA           MOV     A,R2
   \   000023   7001         JNZ     ??MT_AfIncomingMsg_0
   \   000025   EB           MOV     A,R3
   \                     ??MT_AfIncomingMsg_0:
   \   000026   7003         JNZ     $+5
   \   000028   02....       LJMP    ??MT_AfIncomingMsg_1 & 0xFFFF
    246            {
    247              return;
    248            }
    249            tempPtr = respPtr;
    250          
    251            /* Fill in the data */
    252          
    253            /* Group ID */
    254            *tempPtr++ = LO_UINT16(pMsg->groupId);
   \   00002B   EE           MOV     A,R6
   \   00002C   2402         ADD     A,#0x2
   \   00002E   F8           MOV     R0,A
   \   00002F   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_15:
   \   000032   AA82         MOV     R2,DPL
   \   000034   12....       LCALL   ??Subroutine9_0 & 0xFFFF
    255            *tempPtr++ = HI_UINT16(pMsg->groupId);
    256          
    257            /* Cluster ID */
    258            *tempPtr++ = LO_UINT16(pMsg->clusterId);
   \                     ??CrossCallReturnLabel_22:
   \   000037   2404         ADD     A,#0x4
   \   000039   12....       LCALL   ?Subroutine0 & 0xFFFF
    259            *tempPtr++ = HI_UINT16(pMsg->clusterId);
    260          
    261            /* Source Address */
    262            *tempPtr++ = LO_UINT16(pMsg->srcAddr.addr.shortAddr);
   \                     ??CrossCallReturnLabel_20:
   \   00003C   2406         ADD     A,#0x6
   \   00003E   12....       LCALL   ?Subroutine0 & 0xFFFF
    263            *tempPtr++ = HI_UINT16(pMsg->srcAddr.addr.shortAddr);
    264          
    265            /* Source EP */
    266            *tempPtr++ = pMsg->srcAddr.endPoint;
   \                     ??CrossCallReturnLabel_21:
   \   000041   240F         ADD     A,#0xf
   \   000043   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   000046   12....       LCALL   ??Subroutine10_0 & 0xFFFF
    267          
    268            /* Destination EP */
    269            *tempPtr++ = pMsg->endPoint;
   \                     ??CrossCallReturnLabel_23:
   \   000049   2414         ADD     A,#0x14
   \   00004B   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   00004E   12....       LCALL   ??Subroutine10_0 & 0xFFFF
    270          
    271            /* WasBroadCast */
    272            *tempPtr++ = pMsg->wasBroadcast;
   \                     ??CrossCallReturnLabel_24:
   \   000051   2415         ADD     A,#0x15
   \   000053   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   000056   12....       LCALL   ??Subroutine10_0 & 0xFFFF
    273          
    274            /* LinkQuality */
    275            *tempPtr++ = pMsg->LinkQuality;
   \                     ??CrossCallReturnLabel_25:
   \   000059   2416         ADD     A,#0x16
   \   00005B   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   00005E   12....       LCALL   ??Subroutine10_0 & 0xFFFF
    276          
    277            /* SecurityUse */
    278            *tempPtr++ = pMsg->SecurityUse;
   \                     ??CrossCallReturnLabel_26:
   \   000061   2419         ADD     A,#0x19
   \   000063   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_12:
   \   000066   12....       LCALL   ??Subroutine10_0 & 0xFFFF
    279          
    280            /* Timestamp */
    281            *tempPtr++ = BREAK_UINT32(pMsg->timestamp, 0);
   \                     ??CrossCallReturnLabel_27:
   \   000069   241A         ADD     A,#0x1a
   \   00006B   FC           MOV     R4,A
   \   00006C   EF           MOV     A,R7
   \   00006D   3400         ADDC    A,#0x0
   \   00006F   FD           MOV     R5,A
   \   000070   8C82         MOV     DPL,R4
   \   000072   8D83         MOV     DPH,R5
   \   000074   78..         MOV     R0,#?V0 + 0
   \   000076   12....       LCALL   ?L_MOV_X
   \   000079   12....       LCALL   ?Subroutine1 & 0xFFFF
    282            *tempPtr++ = BREAK_UINT32(pMsg->timestamp, 1);
   \                     ??CrossCallReturnLabel_17:
   \   00007C   12....       LCALL   ?L_MOV_X
   \   00007F   E5..         MOV     A,?V0 + 1
   \   000081   8A82         MOV     DPL,R2
   \   000083   8B83         MOV     DPH,R3
   \   000085   12....       LCALL   ??Subroutine8_0 & 0xFFFF
    283            *tempPtr++ = BREAK_UINT32(pMsg->timestamp, 2);
   \                     ??CrossCallReturnLabel_19:
   \   000088   12....       LCALL   ?L_MOV_X
   \   00008B   7410         MOV     A,#0x10
   \   00008D   78..         MOV     R0,#?V0 + 0
   \   00008F   12....       LCALL   ?UL_SHR
   \   000092   12....       LCALL   ?Subroutine1 & 0xFFFF
    284            *tempPtr++ = BREAK_UINT32(pMsg->timestamp, 3);
   \                     ??CrossCallReturnLabel_18:
   \   000095   12....       LCALL   ?L_MOV_X
   \   000098   7418         MOV     A,#0x18
   \   00009A   78..         MOV     R0,#?V0 + 0
   \   00009C   12....       LCALL   ?UL_SHR
   \   00009F   8A82         MOV     DPL,R2
   \   0000A1   8B83         MOV     DPH,R3
   \   0000A3   E5..         MOV     A,?V0 + 0
   \   0000A5   F0           MOVX    @DPTR,A
   \   0000A6   A3           INC     DPTR
   \   0000A7   0A           INC     R2
   \   0000A8   AB83         MOV     R3,DPH
    285          
    286            /* Transmit Sequence Number */
    287            *tempPtr++ = pMsg->cmd.TransSeqNumber;
   \   0000AA   EE           MOV     A,R6
   \   0000AB   241E         ADD     A,#0x1e
   \   0000AD   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_13:
   \   0000B0   12....       LCALL   ?Subroutine7 & 0xFFFF
    288          
    289            /* Data Length */
    290            *tempPtr++ = dataLen;
   \                     ??CrossCallReturnLabel_28:
   \   0000B3   E5..         MOV     A,?V0 + 4
   \   0000B5   F0           MOVX    @DPTR,A
   \   0000B6   A3           INC     DPTR
   \   0000B7   0A           INC     R2
   \   0000B8   0A           INC     R2
   \   0000B9   AB83         MOV     R3,DPH
    291          
    292            /* Data */
    293            if (dataLen)
   \   0000BB   601E         JZ      ??MT_AfIncomingMsg_2
    294            {
    295              osal_memcpy(tempPtr, pMsg->cmd.Data, dataLen);
   \   0000BD                ; Setup parameters for call to function osal_memcpy
   \   0000BD   EE           MOV     A,R6
   \   0000BE   2421         ADD     A,#0x21
   \   0000C0   12....       LCALL   ?Subroutine5 & 0xFFFF
    296            }
   \                     ??CrossCallReturnLabel_14:
   \   0000C3   E0           MOVX    A,@DPTR
   \   0000C4   F5..         MOV     ?V0 + 0,A
   \   0000C6   A3           INC     DPTR
   \   0000C7   E0           MOVX    A,@DPTR
   \   0000C8   F5..         MOV     ?V0 + 1,A
   \   0000CA   78..         MOV     R0,#?V0 + 0
   \   0000CC   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0000CF   AC..         MOV     R4,?V0 + 4
   \   0000D1   7D00         MOV     R5,#0x0
   \   0000D3   12....       LCALL   ??osal_memcpy?relay
   \   0000D6   7403         MOV     A,#0x3
   \   0000D8   12....       LCALL   ?DEALLOC_XSTACK8
    297          
    298            /* Build and send back the response */
    299            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_AF), MT_AF_INCOMING_MSG, respLen, respPtr );
   \                     ??MT_AfIncomingMsg_2:
   \   0000DB                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   0000DB   AC..         MOV     R4,?V0 + 6
   \   0000DD   AD..         MOV     R5,?V0 + 7
   \   0000DF   AB..         MOV     R3,?V0 + 5
   \   0000E1   7A81         MOV     R2,#-0x7f
   \   0000E3   7944         MOV     R1,#0x44
   \   0000E5   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    300          
    301            /* Free memory */
    302            osal_mem_free(respPtr);
   \   0000E8                ; Setup parameters for call to function osal_mem_free
   \   0000E8   AA..         MOV     R2,?V0 + 6
   \   0000EA   AB..         MOV     R3,?V0 + 7
   \   0000EC   12....       LCALL   ??osal_mem_free?relay
    303          
    304          }
   \                     ??MT_AfIncomingMsg_1:
   \   0000EF   7F08         MOV     R7,#0x8
   \   0000F1   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   F582         MOV     DPL,A
   \   000002   EF           MOV     A,R7
   \   000003   3400         ADDC    A,#0x0
   \   000005   F583         MOV     DPH,A
   \   000007   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   8A82         MOV     DPL,R2
   \   000002   8B83         MOV     DPH,R3
   \   000004   E5..         MOV     A,?V0 + 0
   \   000006                REQUIRE ??Subroutine8_0
   \   000006                ; // Fall through to label ??Subroutine8_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine8_0:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   A3           INC     DPTR
   \   000002   0A           INC     R2
   \   000003   AB83         MOV     R3,DPH
   \   000005   8C82         MOV     DPL,R4
   \   000007   8D83         MOV     DPH,R5
   \   000009   78..         MOV     R0,#?V0 + 0
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   08           INC     R0
   \   000001   08           INC     R0
   \   000002   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_16:
   \   000005   0A           INC     R2
   \   000006                REQUIRE ??Subroutine9_0
   \   000006                ; // Fall through to label ??Subroutine9_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine9_0:
   \   000000   AB83         MOV     R3,DPH
   \   000002   8882         MOV     DPL,R0
   \   000004   8983         MOV     DPH,R1
   \   000006   A3           INC     DPTR
   \   000007                REQUIRE ??Subroutine10_0
   \   000007                ; // Fall through to label ??Subroutine10_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine10_0:
   \   000000   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_30:
   \   000003   0A           INC     R2
   \   000004   AB83         MOV     R3,DPH
   \   000006   EE           MOV     A,R6
   \   000007   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   EF           MOV     A,R7
   \   000001   3400         ADDC    A,#0x0
   \   000003   F9           MOV     R1,A
   \   000004   8882         MOV     DPL,R0
   \   000006   8983         MOV     DPH,R1
   \   000008   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_29:
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   8A82         MOV     DPL,R2
   \   000003   8B83         MOV     DPH,R3
   \   000005   F0           MOVX    @DPTR,A
   \   000006   A3           INC     DPTR
   \   000007   22           RET

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfCommandProcessing?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfCommandProcessing

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfRegister?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfRegister

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfDataRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfDataRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfDataConfirm?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfDataConfirm

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfIncomingMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfIncomingMsg
    305          
    306          /***************************************************************************************************
    307          ***************************************************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     MT_AfCommandProcessing             0      0      9
       -> MT_AfRegister                 0      0     18
       -> MT_AfDataRequest              0      0     18
     MT_AfDataConfirm                   3      0      3
       -> MT_BuildAndSendZToolResponse
                                        4      0      6
     MT_AfDataRequest                   1      0     44
       -> afFindEndPointDesc            0      0     52
       -> AF_DataRequest                0      0     70
       -> MT_BuildAndSendZToolResponse
                                        0      0     52
     MT_AfIncomingMsg                   1      0     19
       -> osal_mem_alloc                0      0     32
       -> osal_memcpy                   0      0     38
       -> MT_BuildAndSendZToolResponse
                                        0      0     32
       -> osal_mem_free                 0      0     32
     MT_AfRegister                      1      0     24
       -> osal_mem_alloc                0      0     30
       -> MT_BuildEndpointDesc          0      0     30
       -> afRegister                    0      0     30
       -> osal_mem_free                 0      0     30
       -> MT_BuildAndSendZToolResponse
                                        0      0     30


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     MT_AfCommandProcessing           44
     MT_AfRegister                   135
     ?Subroutine3                     15
     MT_AfDataRequest                231
     ?Subroutine4                     12
     ?Subroutine2                     19
     MT_AfDataConfirm                 77
     MT_AfIncomingMsg                244
     ?Subroutine5                      8
     ?Subroutine1                      6
     ??Subroutine8_0                  12
     ?Subroutine0                      6
     ??Subroutine9_0                   7
     ??Subroutine10_0                  8
     ?Subroutine6                     12
     ?Subroutine7                      8
     ??MT_AfCommandProcessing?relay    6
     ??MT_AfRegister?relay             6
     ??MT_AfDataRequest?relay          6
     ??MT_AfDataConfirm?relay          6
     ??MT_AfIncomingMsg?relay          6

 
 844 bytes in segment BANKED_CODE
  30 bytes in segment BANK_RELAYS
 
 874 bytes of CODE memory

Errors: none
Warnings: none
