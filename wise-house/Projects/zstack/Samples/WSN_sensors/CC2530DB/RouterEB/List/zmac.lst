###############################################################################
#                                                                             #
# IAR C/C++ Compiler V7.51A/W32 for 8051                08/Apr/2013  11:22:50 #
# Copyright 2004-2009 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Com #
#                          ponents\zmac\f8w\zmac.c                            #
#    Command line       =  -f "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0 #
#                          \Projects\zstack\Samples\WSN_sensors\CC2530DB\..\. #
#                          .\..\Tools\CC2530DB\f8wRouter.cfg" (-DCPU32MHZ     #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DRTR_NWK -DBLINK_LEDS) -f "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\Tools\CC #
#                          2530DB\f8wConfig.cfg" (-DSECURE=0                  #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Co #
#                          mponents\zmac\f8w\zmac.c" -D ZTOOL_P1 -D MT_TASK   #
#                          -D MT_SYS_FUNC -D MT_ZDO_FUNC -D                   #
#                          LCD_SUPPORTED=DEBUG -lC "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\RouterEB\List\"   #
#                          -lA "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3. #
#                          0\Projects\zstack\Samples\WSN_sensors\CC2530DB\Rou #
#                          terEB\List\" --diag_suppress Pe001,Pa010 -o        #
#                          "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Pr #
#                          ojects\zstack\Samples\WSN_sensors\CC2530DB\RouterE #
#                          B\Obj\" -e --require_prototypes --no_unroll        #
#                          --no_inline --no_tbaa --debug --core=plain         #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 8 -I "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\" -I "C:\Texas    #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\SOURCE\" -I    #
#                          "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Pr #
#                          ojects\zstack\Samples\WSN_sensors\CC2530DB\..\..\. #
#                          .\ZMAIN\TI2530DB\" -I "C:\Texas                    #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MT\" -I "C:\Texas                         #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\HAL\INCLUDE\" -I "C:\Texas                #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\HAL\TARGET\CC2530EB\" -I "C:\Texas        #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\OSAL\MCU\CCSOC\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\OSAL\INCLUDE\" -I "C:\Texas               #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\AF\" -I "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\NWK\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\SEC\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\SAPI\" -I "C:\Texas                 #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\SYS\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\ZDO\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\ZMAC\F8W\" -I "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\ZMAC\" -I "C:\Texas                       #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\SERVICES\SADDR\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\SERVICES\SDATA\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\INCLUDE\" -I "C:\Texas                #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\HIGH_LEVEL\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\LOW_LEVEL\srf04\" -I "C:\Texas        #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\LOW_LEVEL\srf04\SINGLE_CHIP\" -I      #
#                          "D:\Program Files\IAR Systems\Embedded Workbench   #
#                          5.3\8051\INC\" -I "D:\Program Files\IAR            #
#                          Systems\Embedded Workbench 5.3\8051\INC\CLIB\" -Om #
#    List file          =  C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Pro #
#                          jects\zstack\Samples\WSN_sensors\CC2530DB\RouterEB #
#                          \List\zmac.lst                                     #
#    Object file        =  C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Pro #
#                          jects\zstack\Samples\WSN_sensors\CC2530DB\RouterEB #
#                          \Obj\zmac.r51                                      #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Components\zmac\f8w\zmac.c
      1          /**************************************************************************************************
      2            Filename:       zmac.c
      3            Revised:        $Date: 2009-03-31 11:40:58 -0700 (Tue, 31 Mar 2009) $
      4            Revision:       $Revision: 19611 $
      5          
      6          
      7            Description:    This file contains the ZStack MAC Porting Layer
      8          
      9          
     10            Copyright 2005-2007 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com.
     39          **************************************************************************************************/
     40          
     41          /********************************************************************************************************
     42           *                                               INCLUDES
     43           ********************************************************************************************************/
     44          
     45          #include "ZComDef.h"
     46          #include "OSAL.h"
     47          #include "ZMAC.h"
     48          #include "mac_main.h"
     49          
     50          #if !defined NONWK
     51            #include "ZGlobals.h"
     52          #endif
     53          
     54          /********************************************************************************************************
     55           *                                                 MACROS
     56           ********************************************************************************************************/
     57          
     58          /********************************************************************************************************
     59           *                                               CONSTANTS
     60           ********************************************************************************************************/
     61          
     62          /********************************************************************************************************
     63           *                                               GLOBALS
     64           ********************************************************************************************************/

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     65          uint32 _ScanChannels;
   \                     _ScanChannels:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z
     66          
     67          extern uint8 aExtendedAddress[];
     68          
     69          /********************************************************************************************************
     70           *                                               LOCALS
     71           ********************************************************************************************************/
     72          
     73          /* Pointer to scan result buffer */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     74          void *ZMac_ScanBuf = NULL;
   \                     ZMac_ScanBuf:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
     75          
     76          /********************************************************************************************************
     77           * LOCAL FUNCTION PROTOTYPES
     78           ********************************************************************************************************/
     79          
     80          /********************************************************************************************************
     81           *                                                TYPEDEFS
     82           ********************************************************************************************************/
     83          
     84          
     85          /********************************************************************************************************
     86           *                                                FUNCTIONS
     87           ********************************************************************************************************/
     88          
     89          /********************************************************************************************************
     90           * @fn      ZMacInit
     91           *
     92           * @brief   Initialize MAC.
     93           *
     94           * @param   none.
     95           *
     96           * @return  status.
     97           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     98          uint8 ZMacInit( void )
   \                     ZMacInit:
     99          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    100            uint8 stat;
    101          
    102            MAC_Init();
   \   000005                ; Setup parameters for call to function MAC_Init
   \   000005   12....       LCALL   ??MAC_Init?relay
    103            MAC_InitDevice();
   \   000008                ; Setup parameters for call to function MAC_InitDevice
   \   000008   12....       LCALL   ??MAC_InitDevice?relay
    104          
    105          #if !defined NONWK
    106            if ( ZG_BUILD_RTR_TYPE )
    107            {
    108              MAC_InitCoord();
   \   00000B                ; Setup parameters for call to function MAC_InitCoord
   \   00000B   12....       LCALL   ??MAC_InitCoord?relay
    109            }
    110          #endif
    111          
    112            // If OK, initialize the MAC
    113            stat = ZMacReset( TRUE );
   \   00000E                ; Setup parameters for call to function ZMacReset
   \   00000E   7901         MOV     R1,#0x1
   \   000010   12....       LCALL   ??ZMacReset?relay
   \   000013   E9           MOV     A,R1
   \   000014   FE           MOV     R6,A
    114          
    115            // Turn off interrupts
    116            osal_int_disable( INTS_ALL );
   \   000015                ; Setup parameters for call to function osal_int_disable
   \   000015   79FF         MOV     R1,#-0x1
   \   000017   12....       LCALL   ??osal_int_disable?relay
    117          
    118            return ( stat );
   \   00001A   EE           MOV     A,R6
   \   00001B   F9           MOV     R1,A
   \   00001C   7F01         MOV     R7,#0x1
   \   00001E   02....       LJMP    ?BANKED_LEAVE_XDATA
    119          }
    120          
    121          /********************************************************************************************************
    122           * @fn      ZMacReset
    123           *
    124           * @brief   Reset the MAC.
    125           *
    126           * @param   Default to PIB defaults.
    127           *
    128           * @return  status.
    129           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    130          uint8 ZMacReset( bool SetDefaultPIB )
   \                     ZMacReset:
    131          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    132            byte stat;
    133            byte value;
    134          
    135            stat = MAC_MlmeResetReq( SetDefaultPIB );
   \   00000A                ; Setup parameters for call to function MAC_MlmeResetReq
   \   00000A   12....       LCALL   ??MAC_MlmeResetReq?relay
   \   00000D   E9           MOV     A,R1
   \   00000E   FE           MOV     R6,A
    136          
    137            // Don't send PAN ID conflict
    138            value = FALSE;
   \   00000F   E4           CLR     A
   \   000010   85..82       MOV     DPL,?XSP + 0
   \   000013   85..83       MOV     DPH,?XSP + 1
   \   000016   F0           MOVX    @DPTR,A
    139            MAC_MlmeSetReq( MAC_ASSOCIATED_PAN_COORD, &value );
   \   000017                ; Setup parameters for call to function MAC_MlmeSetReq
   \   000017   AA82         MOV     R2,DPL
   \   000019   AB83         MOV     R3,DPH
   \   00001B   7956         MOV     R1,#0x56
   \   00001D   12....       LCALL   ??MAC_MlmeSetReq?relay
    140            MAC_MlmeSetReq( MAC_EXTENDED_ADDRESS, &aExtendedAddress );
   \   000020                ; Setup parameters for call to function MAC_MlmeSetReq
   \   000020   7A..         MOV     R2,#(aExtendedAddress & 0xff)
   \   000022   7B..         MOV     R3,#((aExtendedAddress >> 8) & 0xff)
   \   000024   79E2         MOV     R1,#-0x1e
   \   000026   12....       LCALL   ??MAC_MlmeSetReq?relay
    141          
    142            if (ZMac_ScanBuf)
   \   000029   90....       MOV     DPTR,#ZMac_ScanBuf
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   7002         JNZ     ??ZMacReset_0
   \   00002F   A3           INC     DPTR
   \   000030   E0           MOVX    A,@DPTR
   \                     ??ZMacReset_0:
   \   000031   6012         JZ      ??ZMacReset_1
    143            {
    144              osal_mem_free(ZMac_ScanBuf);
   \   000033                ; Setup parameters for call to function osal_mem_free
   \   000033   90....       MOV     DPTR,#ZMac_ScanBuf
   \   000036   E0           MOVX    A,@DPTR
   \   000037   FA           MOV     R2,A
   \   000038   A3           INC     DPTR
   \   000039   E0           MOVX    A,@DPTR
   \   00003A   FB           MOV     R3,A
   \   00003B   12....       LCALL   ??osal_mem_free?relay
    145              ZMac_ScanBuf = NULL;
   \   00003E   90....       MOV     DPTR,#ZMac_ScanBuf
   \   000041   E4           CLR     A
   \   000042   F0           MOVX    @DPTR,A
   \   000043   A3           INC     DPTR
   \   000044   F0           MOVX    @DPTR,A
    146            }
    147          
    148            return ( stat );
   \                     ??ZMacReset_1:
   \   000045   EE           MOV     A,R6
   \   000046   F9           MOV     R1,A
   \   000047   7401         MOV     A,#0x1
   \   000049   12....       LCALL   ?DEALLOC_XSTACK8
   \   00004C   7F01         MOV     R7,#0x1
   \   00004E   02....       LJMP    ?BANKED_LEAVE_XDATA
    149          }
    150          
    151          
    152          /********************************************************************************************************
    153           * @fn      ZMacGetReq
    154           *
    155           * @brief   Read a MAC PIB attribute.
    156           *
    157           * @param   attr - PIB attribute to get
    158           * @param   value - pointer to the buffer to store the attribute
    159           *
    160           * @return  status
    161           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    162          uint8 ZMacGetReq( uint8 attr, uint8 *value )
   \                     ZMacGetReq:
    163          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    164            if ( attr == ZMacExtAddr )
   \   000004   74E2         MOV     A,#-0x1e
   \   000006   69           XRL     A,R1
   \   000007   700B         JNZ     ??ZMacGetReq_0
    165            {
    166              osal_cpyExtAddr( value, &aExtendedAddress );
   \   000009                ; Setup parameters for call to function sAddrExtCpy
   \   000009   7C..         MOV     R4,#(aExtendedAddress & 0xff)
   \   00000B   7D..         MOV     R5,#((aExtendedAddress >> 8) & 0xff)
   \   00000D   12....       LCALL   ??sAddrExtCpy?relay
    167              return ZMacSuccess;
   \   000010   7900         MOV     R1,#0x0
   \   000012   8003         SJMP    ??ZMacGetReq_1
    168            }
    169          
    170            return (ZMacStatus_t) MAC_MlmeGetReq( attr, value );
   \                     ??ZMacGetReq_0:
   \   000014                ; Setup parameters for call to function MAC_MlmeGetReq
   \   000014   12....       LCALL   ??MAC_MlmeGetReq?relay
   \                     ??ZMacGetReq_1:
   \   000017   D083         POP     DPH
   \   000019   D082         POP     DPL
   \   00001B   02....       LJMP    ?BRET
    171          }
    172          
    173          
    174          /********************************************************************************************************
    175           * @fn      ZMacSetReq
    176           *
    177           * @brief   Write a MAC PIB attribute.
    178           *
    179           * @param   attr - PIB attribute to Set
    180           * @param   value - pointer to the data
    181           *
    182           * @return  status
    183           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    184          uint8 ZMacSetReq( uint8 attr, byte *value )
   \                     ZMacSetReq:
    185          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 0,R1
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
   \   000009   EB           MOV     A,R3
   \   00000A   FF           MOV     R7,A
    186            if ( attr == ZMacExtAddr )
   \   00000B   74E2         MOV     A,#-0x1e
   \   00000D   65..         XRL     A,?V0 + 0
   \   00000F   700B         JNZ     ??ZMacSetReq_0
    187            {
    188              osal_cpyExtAddr( aExtendedAddress, value );
   \   000011                ; Setup parameters for call to function sAddrExtCpy
   \   000011   EE           MOV     A,R6
   \   000012   FC           MOV     R4,A
   \   000013   EF           MOV     A,R7
   \   000014   FD           MOV     R5,A
   \   000015   7A..         MOV     R2,#(aExtendedAddress & 0xff)
   \   000017   7B..         MOV     R3,#((aExtendedAddress >> 8) & 0xff)
   \   000019   12....       LCALL   ??sAddrExtCpy?relay
    189            }
    190          
    191            return (ZMacStatus_t) MAC_MlmeSetReq( attr, value );
   \                     ??ZMacSetReq_0:
   \   00001C                ; Setup parameters for call to function MAC_MlmeSetReq
   \   00001C   EE           MOV     A,R6
   \   00001D   FA           MOV     R2,A
   \   00001E   EF           MOV     A,R7
   \   00001F   FB           MOV     R3,A
   \   000020   A9..         MOV     R1,?V0 + 0
   \   000022   12....       LCALL   ??MAC_MlmeSetReq?relay
   \   000025   7F01         MOV     R7,#0x1
   \   000027   02....       LJMP    ?BANKED_LEAVE_XDATA
    192          }
    193          
    194          /********************************************************************************************************
    195           * @fn      ZMacAssociateReq
    196           *
    197           * @brief   Request an association with a coordinator.
    198           *
    199           * @param   structure with info need to associate.
    200           *
    201           * @return  status
    202           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    203          uint8 ZMacAssociateReq( ZMacAssociateReq_t *pData )
   \                     ZMacAssociateReq:
    204          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    205            /* Right now, set security to zero */
    206            pData->Sec.SecurityLevel = false;
   \   000004   E4           CLR     A
   \   000005   C0E0         PUSH    A
   \   000007   EA           MOV     A,R2
   \   000008   2416         ADD     A,#0x16
   \   00000A   F582         MOV     DPL,A
   \   00000C   EB           MOV     A,R3
   \   00000D   3400         ADDC    A,#0x0
   \   00000F   F583         MOV     DPH,A
   \   000011   D0E0         POP     A
   \   000013   F0           MOVX    @DPTR,A
    207          
    208            MAC_MlmeAssociateReq ( (macMlmeAssociateReq_t *)pData);
   \   000014                ; Setup parameters for call to function MAC_MlmeAssociateReq
   \   000014   12....       LCALL   ??MAC_MlmeAssociateReq?relay
    209            return ( ZMacSuccess );
   \   000017   7900         MOV     R1,#0x0
   \   000019   D083         POP     DPH
   \   00001B   D082         POP     DPL
   \   00001D   02....       LJMP    ?BRET
    210          }
    211          
    212          /********************************************************************************************************
    213           * @fn      ZMacAssociateRsp
    214           *
    215           * @brief   Request to send an association response message.
    216           *
    217           * @param   structure with associate response and info needed to send it.
    218           *
    219           * @return  status
    220           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    221          uint8 ZMacAssociateRsp( ZMacAssociateRsp_t *pData )
   \                     ZMacAssociateRsp:
    222          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    223            /* Right now, set security to zero */
    224            pData->Sec.SecurityLevel = false;
   \   000004   E4           CLR     A
   \   000005   C0E0         PUSH    A
   \   000007   EA           MOV     A,R2
   \   000008   2413         ADD     A,#0x13
   \   00000A   F582         MOV     DPL,A
   \   00000C   EB           MOV     A,R3
   \   00000D   3400         ADDC    A,#0x0
   \   00000F   F583         MOV     DPH,A
   \   000011   D0E0         POP     A
   \   000013   F0           MOVX    @DPTR,A
    225          
    226            MAC_MlmeAssociateRsp( (macMlmeAssociateRsp_t *) pData );
   \   000014                ; Setup parameters for call to function MAC_MlmeAssociateRsp
   \   000014   12....       LCALL   ??MAC_MlmeAssociateRsp?relay
    227            return ( ZMacSuccess );
   \   000017   7900         MOV     R1,#0x0
   \   000019   D083         POP     DPH
   \   00001B   D082         POP     DPL
   \   00001D   02....       LJMP    ?BRET
    228          }
    229          
    230          /********************************************************************************************************
    231           * @fn      ZMacDisassociateReq
    232           *
    233           * @brief   Request to send a disassociate request message.
    234           *
    235           * @param   structure with info need send it.
    236           *
    237           * @return  status
    238           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    239          uint8 ZMacDisassociateReq( ZMacDisassociateReq_t *pData )
   \                     ZMacDisassociateReq:
    240          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    241            /* Right now, set security to zero */
    242            pData->Sec.SecurityLevel = false;
   \   000004   E4           CLR     A
   \   000005   C0E0         PUSH    A
   \   000007   EA           MOV     A,R2
   \   000008   2415         ADD     A,#0x15
   \   00000A   F582         MOV     DPL,A
   \   00000C   EB           MOV     A,R3
   \   00000D   3400         ADDC    A,#0x0
   \   00000F   F583         MOV     DPH,A
   \   000011   D0E0         POP     A
   \   000013   F0           MOVX    @DPTR,A
    243          
    244            MAC_MlmeDisassociateReq( (macMlmeDisassociateReq_t *)pData);
   \   000014                ; Setup parameters for call to function MAC_MlmeDisassociateReq
   \   000014   12....       LCALL   ??MAC_MlmeDisassociateReq?relay
    245            return ( ZMacSuccess );
   \   000017   7900         MOV     R1,#0x0
   \   000019   D083         POP     DPH
   \   00001B   D082         POP     DPL
   \   00001D   02....       LJMP    ?BRET
    246          }
    247          
    248          /********************************************************************************************************
    249           * @fn      ZMacOrphanRsp
    250           *
    251           * @brief   Allows next higher layer to respond to an orphan indication message.
    252           *
    253           * @param   structure with info need send it.
    254           *
    255           * @return  status
    256           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    257          uint8 ZMacOrphanRsp( ZMacOrphanRsp_t *pData )
   \                     ZMacOrphanRsp:
    258          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    259            /* Right now, set security to zero */
    260            pData->Sec.SecurityLevel = false;
   \   000004   E4           CLR     A
   \   000005   C0E0         PUSH    A
   \   000007   EA           MOV     A,R2
   \   000008   2413         ADD     A,#0x13
   \   00000A   F582         MOV     DPL,A
   \   00000C   EB           MOV     A,R3
   \   00000D   3400         ADDC    A,#0x0
   \   00000F   F583         MOV     DPH,A
   \   000011   D0E0         POP     A
   \   000013   F0           MOVX    @DPTR,A
    261          
    262            MAC_MlmeOrphanRsp( (macMlmeOrphanRsp_t *)pData);
   \   000014                ; Setup parameters for call to function MAC_MlmeOrphanRsp
   \   000014   12....       LCALL   ??MAC_MlmeOrphanRsp?relay
    263            return ( ZMacSuccess );
   \   000017   7900         MOV     R1,#0x0
   \   000019   D083         POP     DPH
   \   00001B   D082         POP     DPL
   \   00001D   02....       LJMP    ?BRET
    264          }
    265          
    266          /********************************************************************************************************
    267           * @fn      ZMacScanReq
    268           *
    269           * @brief   This function is called to perform a network scan.
    270           *
    271           * @param   param - structure with info need send it.
    272           *
    273           * @return  status
    274           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    275          uint8 ZMacScanReq( ZMacScanReq_t *pData )
   \                     ZMacScanReq:
    276          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    277            _ScanChannels = pData->ScanChannels;
   \   000009   8E82         MOV     DPL,R6
   \   00000B   8F83         MOV     DPH,R7
   \   00000D   78..         MOV     R0,#?V0 + 0
   \   00000F   12....       LCALL   ?L_MOV_X
   \   000012   90....       MOV     DPTR,#_ScanChannels
   \   000015   78..         MOV     R0,#?V0 + 0
   \   000017   12....       LCALL   ?L_MOV_TO_X
    278          
    279            /* scan in progress */
    280            if (ZMac_ScanBuf != NULL)
   \   00001A   90....       MOV     DPTR,#ZMac_ScanBuf
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   7002         JNZ     ??ZMacScanReq_0
   \   000020   A3           INC     DPTR
   \   000021   E0           MOVX    A,@DPTR
   \                     ??ZMacScanReq_0:
   \   000022   6005         JZ      ??ZMacScanReq_1
    281            {
    282              return MAC_SCAN_IN_PROGRESS;
   \   000024   79FC         MOV     R1,#-0x4
   \   000026   02....       LJMP    ??ZMacScanReq_2 & 0xFFFF
    283            }
    284          
    285            if (pData->ScanType != ZMAC_ORPHAN_SCAN)
   \                     ??ZMacScanReq_1:
   \   000029   EE           MOV     A,R6
   \   00002A   2404         ADD     A,#0x4
   \   00002C   F582         MOV     DPL,A
   \   00002E   EF           MOV     A,R7
   \   00002F   3400         ADDC    A,#0x0
   \   000031   F583         MOV     DPH,A
   \   000033   E0           MOVX    A,@DPTR
   \   000034   6403         XRL     A,#0x3
   \   000036   7003         JNZ     $+5
   \   000038   02....       LJMP    ??ZMacScanReq_3 & 0xFFFF
    286            {
    287              /* Allocate memory depends on the scan type */
    288              if (pData->ScanType == ZMAC_ED_SCAN)
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   7050         JNZ     ??ZMacScanReq_4
    289              {
    290                if ((ZMac_ScanBuf = osal_mem_alloc(ZMAC_ED_SCAN_MAXCHANNELS)) == NULL)
   \   00003E                ; Setup parameters for call to function osal_mem_alloc
   \   00003E   7A1B         MOV     R2,#0x1b
   \   000040   7B00         MOV     R3,#0x0
   \   000042   12....       LCALL   ??osal_mem_alloc?relay
   \   000045   8A..         MOV     ?V0 + 0,R2
   \   000047   8B..         MOV     ?V0 + 1,R3
   \   000049   A8..         MOV     R0,?V0 + 0
   \   00004B   A9..         MOV     R1,?V0 + 1
   \   00004D   90....       MOV     DPTR,#ZMac_ScanBuf
   \   000050   E8           MOV     A,R0
   \   000051   F0           MOVX    @DPTR,A
   \   000052   A3           INC     DPTR
   \   000053   E9           MOV     A,R1
   \   000054   F0           MOVX    @DPTR,A
   \   000055   E8           MOV     A,R0
   \   000056   7001         JNZ     ??ZMacScanReq_5
   \   000058   E9           MOV     A,R1
   \                     ??ZMacScanReq_5:
   \   000059   7005         JNZ     ??ZMacScanReq_6
    291                {
    292                  return MAC_NO_RESOURCES;
   \                     ??ZMacScanReq_7:
   \   00005B   791A         MOV     R1,#0x1a
   \   00005D   02....       LJMP    ??ZMacScanReq_2 & 0xFFFF
    293                }
    294                osal_memset(ZMac_ScanBuf, 0, ZMAC_ED_SCAN_MAXCHANNELS);
   \                     ??ZMacScanReq_6:
   \   000060                ; Setup parameters for call to function osal_memset
   \   000060   7C1B         MOV     R4,#0x1b
   \   000062   7D00         MOV     R5,#0x0
   \   000064   7900         MOV     R1,#0x0
   \   000066   90....       MOV     DPTR,#ZMac_ScanBuf
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   FA           MOV     R2,A
   \   00006B   A3           INC     DPTR
   \   00006C   E0           MOVX    A,@DPTR
   \   00006D   FB           MOV     R3,A
   \   00006E   12....       LCALL   ??osal_memset?relay
    295                pData->Result.pEnergyDetect = ((uint8*)ZMac_ScanBuf) + MAC_CHAN_11;
   \   000071   90....       MOV     DPTR,#ZMac_ScanBuf
   \   000074   E0           MOVX    A,@DPTR
   \   000075   240B         ADD     A,#0xb
   \   000077   F8           MOV     R0,A
   \   000078   A3           INC     DPTR
   \   000079   E0           MOVX    A,@DPTR
   \   00007A   3400         ADDC    A,#0x0
   \   00007C   F9           MOV     R1,A
   \   00007D   EE           MOV     A,R6
   \   00007E   2413         ADD     A,#0x13
   \   000080   F582         MOV     DPL,A
   \   000082   EF           MOV     A,R7
   \   000083   3400         ADDC    A,#0x0
   \   000085   F583         MOV     DPH,A
   \   000087   E8           MOV     A,R0
   \   000088   F0           MOVX    @DPTR,A
   \   000089   A3           INC     DPTR
   \   00008A   E9           MOV     A,R1
   \   00008B   F0           MOVX    @DPTR,A
   \   00008C   804A         SJMP    ??ZMacScanReq_3
    296              }
    297              else if (pData->MaxResults > 0)
   \                     ??ZMacScanReq_4:
   \   00008E   EE           MOV     A,R6
   \   00008F   2407         ADD     A,#0x7
   \   000091   F582         MOV     DPL,A
   \   000093   EF           MOV     A,R7
   \   000094   3400         ADDC    A,#0x0
   \   000096   F583         MOV     DPH,A
   \   000098   E0           MOVX    A,@DPTR
   \   000099   603D         JZ      ??ZMacScanReq_3
    298              {
    299                if ((ZMac_ScanBuf = pData->Result.pPanDescriptor =
    300                     osal_mem_alloc( sizeof( ZMacPanDesc_t ) * pData->MaxResults )) == NULL)
   \   00009B   EE           MOV     A,R6
   \   00009C   2413         ADD     A,#0x13
   \   00009E   F5..         MOV     ?V0 + 0,A
   \   0000A0   EF           MOV     A,R7
   \   0000A1   3400         ADDC    A,#0x0
   \   0000A3   F5..         MOV     ?V0 + 1,A
   \   0000A5                ; Setup parameters for call to function osal_mem_alloc
   \   0000A5   E0           MOVX    A,@DPTR
   \   0000A6   75F021       MOV     B,#0x21
   \   0000A9   A4           MUL     AB
   \   0000AA   FA           MOV     R2,A
   \   0000AB   ABF0         MOV     R3,B
   \   0000AD   12....       LCALL   ??osal_mem_alloc?relay
   \   0000B0   85..82       MOV     DPL,?V0 + 0
   \   0000B3   85..83       MOV     DPH,?V0 + 1
   \   0000B6   EA           MOV     A,R2
   \   0000B7   F0           MOVX    @DPTR,A
   \   0000B8   A3           INC     DPTR
   \   0000B9   EB           MOV     A,R3
   \   0000BA   F0           MOVX    @DPTR,A
   \   0000BB   85..82       MOV     DPL,?V0 + 0
   \   0000BE   85..83       MOV     DPH,?V0 + 1
   \   0000C1   E0           MOVX    A,@DPTR
   \   0000C2   F8           MOV     R0,A
   \   0000C3   A3           INC     DPTR
   \   0000C4   E0           MOVX    A,@DPTR
   \   0000C5   F9           MOV     R1,A
   \   0000C6   90....       MOV     DPTR,#ZMac_ScanBuf
   \   0000C9   E8           MOV     A,R0
   \   0000CA   F0           MOVX    @DPTR,A
   \   0000CB   A3           INC     DPTR
   \   0000CC   E9           MOV     A,R1
   \   0000CD   F0           MOVX    @DPTR,A
   \   0000CE   90....       MOV     DPTR,#ZMac_ScanBuf
   \   0000D1   E0           MOVX    A,@DPTR
   \   0000D2   7002         JNZ     ??ZMacScanReq_8
   \   0000D4   A3           INC     DPTR
   \   0000D5   E0           MOVX    A,@DPTR
   \                     ??ZMacScanReq_8:
   \   0000D6   6083         JZ      ??ZMacScanReq_7
    301                {
    302                  return MAC_NO_RESOURCES;
    303                }
    304              }
    305            }
    306          
    307            /* Right now, set security to zero */
    308            pData->Sec.SecurityLevel = false;
   \                     ??ZMacScanReq_3:
   \   0000D8   E4           CLR     A
   \   0000D9   C0E0         PUSH    A
   \   0000DB   EE           MOV     A,R6
   \   0000DC   2410         ADD     A,#0x10
   \   0000DE   F582         MOV     DPL,A
   \   0000E0   EF           MOV     A,R7
   \   0000E1   3400         ADDC    A,#0x0
   \   0000E3   F583         MOV     DPH,A
   \   0000E5   D0E0         POP     A
   \   0000E7   F0           MOVX    @DPTR,A
    309          
    310            /* Channel Page */
    311            pData->ChannelPage = 0x00;
   \   0000E8   E4           CLR     A
   \   0000E9   8E82         MOV     DPL,R6
   \   0000EB   8F83         MOV     DPH,R7
   \   0000ED   A3           INC     DPTR
   \   0000EE   A3           INC     DPTR
   \   0000EF   A3           INC     DPTR
   \   0000F0   A3           INC     DPTR
   \   0000F1   A3           INC     DPTR
   \   0000F2   A3           INC     DPTR
   \   0000F3   F0           MOVX    @DPTR,A
    312          
    313            MAC_MlmeScanReq ((macMlmeScanReq_t *)pData);
   \   0000F4                ; Setup parameters for call to function MAC_MlmeScanReq
   \   0000F4   EE           MOV     A,R6
   \   0000F5   FA           MOV     R2,A
   \   0000F6   EF           MOV     A,R7
   \   0000F7   FB           MOV     R3,A
   \   0000F8   12....       LCALL   ??MAC_MlmeScanReq?relay
    314          
    315            return ZMacSuccess;
   \   0000FB   7900         MOV     R1,#0x0
   \                     ??ZMacScanReq_2:
   \   0000FD   7F04         MOV     R7,#0x4
   \   0000FF   02....       LJMP    ?BANKED_LEAVE_XDATA
    316          }
    317          
    318          
    319          /********************************************************************************************************
    320           * @fn      ZMacStartReq
    321           *
    322           * @brief   This function is called to tell the MAC to transmit beacons
    323           *          and become a coordinator.
    324           *
    325           * @param   structure with info need send it.
    326           *
    327           * @return  status
    328           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    329          uint8 ZMacStartReq( ZMacStartReq_t *pData )
   \                     ZMacStartReq:
    330          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    331            uint8 stat;
    332          
    333            // Probably want to keep the receiver on
    334            stat = true;
   \   00000E   7401         MOV     A,#0x1
   \   000010   85..82       MOV     DPL,?XSP + 0
   \   000013   85..83       MOV     DPH,?XSP + 1
   \   000016   F0           MOVX    @DPTR,A
    335            MAC_MlmeSetReq( MAC_RX_ON_WHEN_IDLE, &stat );
   \   000017                ; Setup parameters for call to function MAC_MlmeSetReq
   \   000017   AA82         MOV     R2,DPL
   \   000019   AB83         MOV     R3,DPH
   \   00001B   7952         MOV     R1,#0x52
   \   00001D   12....       LCALL   ??MAC_MlmeSetReq?relay
    336          
    337            /* Right now, set security to zero */
    338            pData->RealignSec.SecurityLevel = false;
   \   000020   E4           CLR     A
   \   000021   C0E0         PUSH    A
   \   000023   EE           MOV     A,R6
   \   000024   2415         ADD     A,#0x15
   \   000026   F582         MOV     DPL,A
   \   000028   EF           MOV     A,R7
   \   000029   3400         ADDC    A,#0x0
   \   00002B   F583         MOV     DPH,A
   \   00002D   D0E0         POP     A
   \   00002F   F0           MOVX    @DPTR,A
    339            pData->BeaconSec.SecurityLevel = false;
   \   000030   E4           CLR     A
   \   000031   C0E0         PUSH    A
   \   000033   EE           MOV     A,R6
   \   000034   2420         ADD     A,#0x20
   \   000036   F582         MOV     DPL,A
   \   000038   EF           MOV     A,R7
   \   000039   3400         ADDC    A,#0x0
   \   00003B   F583         MOV     DPH,A
   \   00003D   D0E0         POP     A
   \   00003F   F0           MOVX    @DPTR,A
    340          
    341          
    342            MAC_MlmeStartReq((macMlmeStartReq_t *) pData);
   \   000040                ; Setup parameters for call to function MAC_MlmeStartReq
   \   000040   EE           MOV     A,R6
   \   000041   FA           MOV     R2,A
   \   000042   EF           MOV     A,R7
   \   000043   FB           MOV     R3,A
   \   000044   12....       LCALL   ??MAC_MlmeStartReq?relay
    343          
    344            // MAC does not issue mlmeStartConfirm(), so we have to
    345            // mlmeStartConfirm( stat );  This needs to be addressed some how
    346          
    347            return ZMacSuccess;
   \   000047   7900         MOV     R1,#0x0
   \   000049   7401         MOV     A,#0x1
   \   00004B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00004E   7F01         MOV     R7,#0x1
   \   000050   02....       LJMP    ?BANKED_LEAVE_XDATA
    348          }
    349          
    350          /********************************************************************************************************
    351           * @fn      ZMacSyncReq
    352           *
    353           * @brief   This function is called to request a sync to the current
    354           *          networks beacons.
    355           *
    356           * @param   LogicalChannel -
    357           * @param   TrackBeacon - true/false
    358           *
    359           * @return  status
    360           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    361          uint8 ZMacSyncReq( ZMacSyncReq_t *pData )
   \                     ZMacSyncReq:
    362          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    363            MAC_MlmeSyncReq( (macMlmeSyncReq_t *)pData);
   \   000004                ; Setup parameters for call to function MAC_MlmeSyncReq
   \   000004   12....       LCALL   ??MAC_MlmeSyncReq?relay
    364            return ZMacSuccess;
   \   000007   7900         MOV     R1,#0x0
   \   000009   D083         POP     DPH
   \   00000B   D082         POP     DPL
   \   00000D   02....       LJMP    ?BRET
    365          }
    366          
    367          /********************************************************************************************************
    368           * @fn      ZMacPollReq
    369           *
    370           * @brief   This function is called to request MAC data request poll.
    371           *
    372           * @param   coordAddr -
    373           * @param   coordPanId -
    374           * @param   SecurityEnable - true or false.
    375           *
    376           * @return  status
    377           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    378          uint8 ZMacPollReq( ZMacPollReq_t *pData )
   \                     ZMacPollReq:
    379          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    380            /* Right now, set security to zero */
    381            pData->Sec.SecurityLevel = false;
   \   000004   E4           CLR     A
   \   000005   C0E0         PUSH    A
   \   000007   EA           MOV     A,R2
   \   000008   2413         ADD     A,#0x13
   \   00000A   F582         MOV     DPL,A
   \   00000C   EB           MOV     A,R3
   \   00000D   3400         ADDC    A,#0x0
   \   00000F   F583         MOV     DPH,A
   \   000011   D0E0         POP     A
   \   000013   F0           MOVX    @DPTR,A
    382          
    383            MAC_MlmePollReq ((macMlmePollReq_t *)pData);
   \   000014                ; Setup parameters for call to function MAC_MlmePollReq
   \   000014   12....       LCALL   ??MAC_MlmePollReq?relay
    384            return ( ZMacSuccess );
   \   000017   7900         MOV     R1,#0x0
   \   000019   D083         POP     DPH
   \   00001B   D082         POP     DPL
   \   00001D   02....       LJMP    ?BRET
    385          }
    386          
    387          /********************************************************************************************************
    388           * @fn      ZMacDataReq
    389           *
    390           * @brief   Send a MAC Data Frame packet.
    391           *
    392           * @param   structure containing data and where to send it.
    393           *
    394           * @return  status
    395           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    396          uint8 ZMacDataReq( ZMacDataReq_t *pData )
   \                     ZMacDataReq:
    397          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 4,R2
   \   000007   8B..         MOV     ?V0 + 5,R3
    398            macMcpsDataReq_t *pBuf;
    399          
    400            /* Allocate memory */
    401            pBuf = MAC_McpsDataAlloc(pData->msduLength, MAC_SEC_LEVEL_NONE, MAC_KEY_ID_MODE_NONE);
   \   000009   EA           MOV     A,R2
   \   00000A   241B         ADD     A,#0x1b
   \   00000C   F5..         MOV     ?V0 + 6,A
   \   00000E   EB           MOV     A,R3
   \   00000F   3400         ADDC    A,#0x0
   \   000011   F5..         MOV     ?V0 + 7,A
   \   000013                ; Setup parameters for call to function MAC_McpsDataAlloc
   \   000013   7B00         MOV     R3,#0x0
   \   000015   7A00         MOV     R2,#0x0
   \   000017   85..82       MOV     DPL,?V0 + 6
   \   00001A   F583         MOV     DPH,A
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F9           MOV     R1,A
   \   00001E   12....       LCALL   ??MAC_McpsDataAlloc?relay
   \   000021   8A..         MOV     ?V0 + 0,R2
   \   000023   8B..         MOV     ?V0 + 1,R3
   \   000025   AE..         MOV     R6,?V0 + 0
   \   000027   AF..         MOV     R7,?V0 + 1
    402          
    403            if (pBuf)
   \   000029   EE           MOV     A,R6
   \   00002A   7001         JNZ     ??ZMacDataReq_0
   \   00002C   EF           MOV     A,R7
   \                     ??ZMacDataReq_0:
   \   00002D   7003         JNZ     $+5
   \   00002F   02....       LJMP    ??ZMacDataReq_1 & 0xFFFF
    404            {
    405              /* Copy the addresses */
    406              osal_memcpy (&pBuf->mac, pData, sizeof (macDataReq_t));
   \   000032                ; Setup parameters for call to function osal_memcpy
   \   000032   85....       MOV     ?V0 + 0,?V0 + 4
   \   000035   85....       MOV     ?V0 + 1,?V0 + 5
   \   000038   75..00       MOV     ?V0 + 2,#0x0
   \   00003B   78..         MOV     R0,#?V0 + 0
   \   00003D   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000040   7C10         MOV     R4,#0x10
   \   000042   7D00         MOV     R5,#0x0
   \   000044   EE           MOV     A,R6
   \   000045   2422         ADD     A,#0x22
   \   000047   FA           MOV     R2,A
   \   000048   EF           MOV     A,R7
   \   000049   3400         ADDC    A,#0x0
   \   00004B   FB           MOV     R3,A
   \   00004C   12....       LCALL   ??osal_memcpy?relay
   \   00004F   7403         MOV     A,#0x3
   \   000051   12....       LCALL   ?DEALLOC_XSTACK8
    407          
    408              /* Copy data */
    409              pBuf->msdu.len = pData->msduLength;
   \   000054   85..82       MOV     DPL,?V0 + 6
   \   000057   85..83       MOV     DPH,?V0 + 7
   \   00005A   E0           MOVX    A,@DPTR
   \   00005B   8E82         MOV     DPL,R6
   \   00005D   8F83         MOV     DPH,R7
   \   00005F   A3           INC     DPTR
   \   000060   A3           INC     DPTR
   \   000061   A3           INC     DPTR
   \   000062   A3           INC     DPTR
   \   000063   F0           MOVX    @DPTR,A
    410              osal_memcpy (pBuf->msdu.p, pData->msdu, pData->msduLength);
   \   000064                ; Setup parameters for call to function osal_memcpy
   \   000064   E5..         MOV     A,?V0 + 4
   \   000066   241C         ADD     A,#0x1c
   \   000068   F582         MOV     DPL,A
   \   00006A   E5..         MOV     A,?V0 + 5
   \   00006C   3400         ADDC    A,#0x0
   \   00006E   F583         MOV     DPH,A
   \   000070   E0           MOVX    A,@DPTR
   \   000071   F5..         MOV     ?V0 + 0,A
   \   000073   A3           INC     DPTR
   \   000074   E0           MOVX    A,@DPTR
   \   000075   F5..         MOV     ?V0 + 1,A
   \   000077   78..         MOV     R0,#?V0 + 0
   \   000079   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00007C   85..82       MOV     DPL,?V0 + 6
   \   00007F   85..83       MOV     DPH,?V0 + 7
   \   000082   E0           MOVX    A,@DPTR
   \   000083   FC           MOV     R4,A
   \   000084   7D00         MOV     R5,#0x0
   \   000086   8E82         MOV     DPL,R6
   \   000088   8F83         MOV     DPH,R7
   \   00008A   A3           INC     DPTR
   \   00008B   A3           INC     DPTR
   \   00008C   E0           MOVX    A,@DPTR
   \   00008D   FA           MOV     R2,A
   \   00008E   A3           INC     DPTR
   \   00008F   E0           MOVX    A,@DPTR
   \   000090   FB           MOV     R3,A
   \   000091   12....       LCALL   ??osal_memcpy?relay
   \   000094   7403         MOV     A,#0x3
   \   000096   12....       LCALL   ?DEALLOC_XSTACK8
    411          
    412              /* Right now, set security to zero */
    413              pBuf->sec.securityLevel = false;
   \   000099   E4           CLR     A
   \   00009A   C0E0         PUSH    A
   \   00009C   EE           MOV     A,R6
   \   00009D   241F         ADD     A,#0x1f
   \   00009F   F582         MOV     DPL,A
   \   0000A1   EF           MOV     A,R7
   \   0000A2   3400         ADDC    A,#0x0
   \   0000A4   F583         MOV     DPH,A
   \   0000A6   D0E0         POP     A
   \   0000A8   F0           MOVX    @DPTR,A
    414          
    415              /* Call Mac Data Request */
    416              MAC_McpsDataReq(pBuf);
   \   0000A9                ; Setup parameters for call to function MAC_McpsDataReq
   \   0000A9   EE           MOV     A,R6
   \   0000AA   FA           MOV     R2,A
   \   0000AB   EF           MOV     A,R7
   \   0000AC   FB           MOV     R3,A
   \   0000AD   12....       LCALL   ??MAC_McpsDataReq?relay
    417          
    418              return ( ZMacSuccess );
   \   0000B0   7900         MOV     R1,#0x0
   \   0000B2   8002         SJMP    ??ZMacDataReq_2
    419            }
    420          
    421            return MAC_NO_RESOURCES;
   \                     ??ZMacDataReq_1:
   \   0000B4   791A         MOV     R1,#0x1a
   \                     ??ZMacDataReq_2:
   \   0000B6   7F08         MOV     R7,#0x8
   \   0000B8   02....       LJMP    ?BANKED_LEAVE_XDATA
    422          }
    423          
    424          /********************************************************************************************************
    425           * @fn      ZMacPurgeReq
    426           *
    427           * @brief   Purge a MAC Data Frame packet.
    428           *
    429           * @param   MSDU data handle.
    430           *
    431           * @return  status
    432           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    433          uint8 ZMacPurgeReq( byte Handle )
   \                     ZMacPurgeReq:
    434          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    435            MAC_McpsPurgeReq( Handle );
   \   000004                ; Setup parameters for call to function MAC_McpsPurgeReq
   \   000004   12....       LCALL   ??MAC_McpsPurgeReq?relay
    436            return ZMacSuccess;
   \   000007   7900         MOV     R1,#0x0
   \   000009   D083         POP     DPH
   \   00000B   D082         POP     DPL
   \   00000D   02....       LJMP    ?BRET
    437          }
    438          
    439          /********************************************************************************************************
    440           * @fn      ZMacSrcMatchEnable
    441           *
    442           * @brief   This function is call to enable AUTOPEND and source address matching.
    443           *
    444           * @param   addressType - address type that the application uses
    445           *                        SADDR_MODE_SHORT or SADDR_MODE_EXT.
    446           *          numEntries  - number of source address table entries to be used
    447           *
    448           * @return  status
    449           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    450          ZMacStatus_t ZMacSrcMatchEnable (uint8 addrType, uint8 numEntries)
   \                     ZMacSrcMatchEnable:
    451          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    452            return (MAC_SrcMatchEnable(addrType, numEntries));
   \   000004                ; Setup parameters for call to function MAC_SrcMatchEnable
   \   000004   12....       LCALL   ??MAC_SrcMatchEnable?relay
   \   000007   D083         POP     DPH
   \   000009   D082         POP     DPL
   \   00000B   02....       LJMP    ?BRET
    453          }
    454          
    455          /********************************************************************************************************
    456           * @fn      ZMacSrcMatchAddEntry
    457           *
    458           * @brief   This function is called to add a short or extended address to source address table.
    459           *
    460           * @param   addr - a pointer to sAddr_t which contains addrMode
    461           *                     and a union of a short 16-bit MAC address or an extended
    462           *                     64-bit MAC address to be added to the source address table.
    463           *          panID - the device PAN ID. It is only used when the addr is
    464           *                      using short address
    465           *
    466           * @return  status
    467           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    468          ZMacStatus_t ZMacSrcMatchAddEntry (zAddrType_t *addr, uint16 panID)
   \                     ZMacSrcMatchAddEntry:
    469          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    470            return (MAC_SrcMatchAddEntry ((sAddr_t*)addr, panID));
   \   000004                ; Setup parameters for call to function MAC_SrcMatchAddEntry
   \   000004   12....       LCALL   ??MAC_SrcMatchAddEntry?relay
   \   000007   D083         POP     DPH
   \   000009   D082         POP     DPL
   \   00000B   02....       LJMP    ?BRET
    471          }
    472          
    473          /********************************************************************************************************
    474           * @fn      ZMacSrcMatchDeleteEntry
    475           *
    476           * @brief   This function is called to delete a short or extended address from source address table.
    477           *
    478           * @param   addr - a pointer to sAddr_t which contains addrMode
    479           *                     and a union of a short 16-bit MAC address or an extended
    480           *                     64-bit MAC address to be added to the source address table.
    481           *          panID - the device PAN ID. It is only used when the addr is
    482           *                      using short address
    483           *
    484           * @return  status
    485           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    486          ZMacStatus_t ZMacSrcMatchDeleteEntry (zAddrType_t *addr, uint16 panID)
   \                     ZMacSrcMatchDeleteEntry:
    487          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    488            return (MAC_SrcMatchDeleteEntry ((sAddr_t*)addr, panID));
   \   000004                ; Setup parameters for call to function MAC_SrcMatchDeleteEntry
   \   000004   12....       LCALL   ??MAC_SrcMatchDeleteEntry?relay
   \   000007   D083         POP     DPH
   \   000009   D082         POP     DPL
   \   00000B   02....       LJMP    ?BRET
    489          }
    490          
    491          /********************************************************************************************************
    492           * @fn       ZMacSrcMatchAckAllPending
    493           *
    494           * @brief    Enabled/disable acknowledging all packets with pending bit set
    495           *           It is normally enabled when adding new entries to
    496           *           the source address table fails due to the table is full, or
    497           *           disabled when more entries are deleted and the table has
    498           *           empty slots.
    499           *
    500           * @param    option - true (acknowledging all packets with pending field set)
    501           *                    false (acknowledging all packets with pending field cleared)
    502           *
    503           * @return   status
    504           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    505          ZMacStatus_t ZMacSrcMatchAckAllPending (uint8 option)
   \                     ZMacSrcMatchAckAllPending:
    506          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    507            MAC_SrcMatchAckAllPending (option);
   \   000004                ; Setup parameters for call to function MAC_SrcMatchAckAllPending
   \   000004   12....       LCALL   ??MAC_SrcMatchAckAllPending?relay
    508          
    509            return ZMacSuccess;
   \   000007   7900         MOV     R1,#0x0
   \   000009   D083         POP     DPH
   \   00000B   D082         POP     DPL
   \   00000D   02....       LJMP    ?BRET
    510          }
    511          
    512          /********************************************************************************************************
    513           * @fn       ZMacSrcMatchCheckAllPending
    514           *
    515           * @brief    This function is called to check if acknowledging all packets with pending bit set is enabled.
    516           *
    517           * @param    none
    518           *
    519           * @return   status
    520           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    521          ZMacStatus_t ZMacSrcMatchCheckAllPending (void)
   \                     ZMacSrcMatchCheckAllPending:
    522          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    523            return (MAC_SrcMatchCheckAllPending ());
   \   000004                ; Setup parameters for call to function MAC_SrcMatchCheckAllPending
   \   000004   12....       LCALL   ??MAC_SrcMatchCheckAllPending?relay
   \   000007   D083         POP     DPH
   \   000009   D082         POP     DPL
   \   00000B   02....       LJMP    ?BRET
    524          }
    525          
    526          /********************************************************************************************************
    527           * @fn      - ZMACPwrOnReq
    528           *
    529           * @brief   - This function requests the MAC to power on the radio hardware
    530           *            and wake up.  When the power on procedure is complete the MAC
    531           *            will send a MAC_PWR_ON_CNF to the application.
    532           *
    533           * @input   - None.
    534           *
    535           * @output  - None.
    536           *
    537           * @return  - None.
    538           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    539          void ZMacPwrOnReq ( void )
   \                     ZMacPwrOnReq:
    540          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    541            MAC_PwrOnReq();
   \   000004                ; Setup parameters for call to function MAC_PwrOnReq
   \   000004   12....       LCALL   ??MAC_PwrOnReq?relay
    542          }
   \   000007   D083         POP     DPH
   \   000009   D082         POP     DPL
   \   00000B   02....       LJMP    ?BRET
    543          
    544          /********************************************************************************************************
    545           * @fn          MAC_PwrMode
    546           *
    547           * @brief       This function returns the current power mode of the MAC.
    548           *
    549           * input parameters
    550           *
    551           * None.
    552           *
    553           * output parameters
    554           *
    555           * None.
    556           *
    557           * @return      The current power mode of the MAC.
    558           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    559          uint8 ZMac_PwrMode(void)
   \                     ZMac_PwrMode:
    560          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    561            return (MAC_PwrMode());
   \   000004                ; Setup parameters for call to function MAC_PwrMode
   \   000004   12....       LCALL   ??MAC_PwrMode?relay
   \   000007   D083         POP     DPH
   \   000009   D082         POP     DPL
   \   00000B   02....       LJMP    ?BRET
    562          }
    563          
    564          /********************************************************************************************************
    565           * @fn      ZMacSetTransmitPower
    566           *
    567           * @brief   Set the transmitter power according to the level setting param.
    568           *
    569           * @param   Valid power level setting as defined in ZMAC.h.
    570           *
    571           * @return  ZMacSuccess if PHY_TRANSMIT_POWER found or ZMacUnsupportedAttribute.
    572           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    573          uint8 ZMacSetTransmitPower( ZMacTransmitPower_t level )
   \                     ZMacSetTransmitPower:
    574          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 1
   \   000004   74FF         MOV     A,#-0x1
   \   000006   12....       LCALL   ?ALLOC_XSTACK8
   \   000009   E9           MOV     A,R1
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   F0           MOVX    @DPTR,A
    575            return MAC_MlmeSetReq( ZMacPhyTransmitPower, &level );
   \   000011                ; Setup parameters for call to function MAC_MlmeSetReq
   \   000011   AA82         MOV     R2,DPL
   \   000013   AB83         MOV     R3,DPH
   \   000015   79E0         MOV     R1,#-0x20
   \   000017   12....       LCALL   ??MAC_MlmeSetReq?relay
   \   00001A   7401         MOV     A,#0x1
   \   00001C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00001F   D083         POP     DPH
   \   000021   D082         POP     DPL
   \   000023   02....       LJMP    ?BRET
    576          }
    577          
    578          /********************************************************************************************************
    579           * @fn      ZMacSendNoData
    580           *
    581           * @brief   This function sends an empty msg
    582           *
    583           * @param   DstAddr   - destination short address
    584           *          DstPANId  - destination pan id
    585           *
    586           * @return  None
    587           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    588          void ZMacSendNoData ( uint16 DstAddr, uint16 DstPANId )
   \                     ZMacSendNoData:
    589          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
   \   000009   EC           MOV     A,R4
   \   00000A   FE           MOV     R6,A
   \   00000B   ED           MOV     A,R5
   \   00000C   FF           MOV     R7,A
    590            macMcpsDataReq_t *pBuf;
    591          
    592            /* Allocate memory */
    593            pBuf = MAC_McpsDataAlloc(0, MAC_SEC_LEVEL_NONE, MAC_KEY_ID_MODE_NONE);
   \   00000D                ; Setup parameters for call to function MAC_McpsDataAlloc
   \   00000D   7B00         MOV     R3,#0x0
   \   00000F   7A00         MOV     R2,#0x0
   \   000011   7900         MOV     R1,#0x0
   \   000013   12....       LCALL   ??MAC_McpsDataAlloc?relay
    594          
    595            if (pBuf)
   \   000016   EA           MOV     A,R2
   \   000017   7001         JNZ     ??ZMacSendNoData_0
   \   000019   EB           MOV     A,R3
   \                     ??ZMacSendNoData_0:
   \   00001A   6076         JZ      ??ZMacSendNoData_1
    596            {
    597              /* Fill in src information */
    598              pBuf->mac.srcAddrMode              = SADDR_MODE_SHORT;
   \   00001C   7402         MOV     A,#0x2
   \   00001E   C0E0         PUSH    A
   \   000020   EA           MOV     A,R2
   \   000021   242D         ADD     A,#0x2d
   \   000023   F582         MOV     DPL,A
   \   000025   EB           MOV     A,R3
   \   000026   3400         ADDC    A,#0x0
   \   000028   F583         MOV     DPH,A
   \   00002A   D0E0         POP     A
   \   00002C   F0           MOVX    @DPTR,A
    599          
    600              /* Fill in dst information */
    601              pBuf->mac.dstAddr.addr.shortAddr   = DstAddr;
   \   00002D   EA           MOV     A,R2
   \   00002E   2422         ADD     A,#0x22
   \   000030   F582         MOV     DPL,A
   \   000032   EB           MOV     A,R3
   \   000033   3400         ADDC    A,#0x0
   \   000035   F583         MOV     DPH,A
   \   000037   E5..         MOV     A,?V0 + 0
   \   000039   F0           MOVX    @DPTR,A
   \   00003A   A3           INC     DPTR
   \   00003B   E5..         MOV     A,?V0 + 1
   \   00003D   F0           MOVX    @DPTR,A
    602              pBuf->mac.dstAddr.addrMode         = SADDR_MODE_SHORT;
   \   00003E   7402         MOV     A,#0x2
   \   000040   C0E0         PUSH    A
   \   000042   EA           MOV     A,R2
   \   000043   242A         ADD     A,#0x2a
   \   000045   F582         MOV     DPL,A
   \   000047   EB           MOV     A,R3
   \   000048   3400         ADDC    A,#0x0
   \   00004A   F583         MOV     DPH,A
   \   00004C   D0E0         POP     A
   \   00004E   F0           MOVX    @DPTR,A
    603              pBuf->mac.dstPanId                 = DstPANId;
   \   00004F   EA           MOV     A,R2
   \   000050   242B         ADD     A,#0x2b
   \   000052   F582         MOV     DPL,A
   \   000054   EB           MOV     A,R3
   \   000055   3400         ADDC    A,#0x0
   \   000057   F583         MOV     DPH,A
   \   000059   EE           MOV     A,R6
   \   00005A   F0           MOVX    @DPTR,A
   \   00005B   A3           INC     DPTR
   \   00005C   EF           MOV     A,R7
   \   00005D   F0           MOVX    @DPTR,A
    604          
    605              /* Misc information */
    606              pBuf->mac.msduHandle               = 0;
   \   00005E   E4           CLR     A
   \   00005F   C0E0         PUSH    A
   \   000061   EA           MOV     A,R2
   \   000062   242E         ADD     A,#0x2e
   \   000064   F582         MOV     DPL,A
   \   000066   EB           MOV     A,R3
   \   000067   3400         ADDC    A,#0x0
   \   000069   F583         MOV     DPH,A
   \   00006B   D0E0         POP     A
   \   00006D   F0           MOVX    @DPTR,A
    607              pBuf->mac.txOptions                = ZMAC_TXOPTION_ACK | ZMAC_TXOPTION_NO_RETRANS | ZMAC_TXOPTION_NO_CNF;
   \   00006E   7431         MOV     A,#0x31
   \   000070   C0E0         PUSH    A
   \   000072   EA           MOV     A,R2
   \   000073   242F         ADD     A,#0x2f
   \   000075   F582         MOV     DPL,A
   \   000077   EB           MOV     A,R3
   \   000078   3400         ADDC    A,#0x0
   \   00007A   F583         MOV     DPH,A
   \   00007C   D0E0         POP     A
   \   00007E   F0           MOVX    @DPTR,A
    608          
    609              /* Right now, set security to zero */
    610              pBuf->sec.securityLevel = false;
   \   00007F   E4           CLR     A
   \   000080   C0E0         PUSH    A
   \   000082   EA           MOV     A,R2
   \   000083   241F         ADD     A,#0x1f
   \   000085   F582         MOV     DPL,A
   \   000087   EB           MOV     A,R3
   \   000088   3400         ADDC    A,#0x0
   \   00008A   F583         MOV     DPH,A
   \   00008C   D0E0         POP     A
   \   00008E   F0           MOVX    @DPTR,A
    611          
    612              /* Call Mac Data Request */
    613              MAC_McpsDataReq(pBuf);
   \   00008F                ; Setup parameters for call to function MAC_McpsDataReq
   \   00008F   12....       LCALL   ??MAC_McpsDataReq?relay
    614            }
    615          
    616          }
   \                     ??ZMacSendNoData_1:
   \   000092   7F04         MOV     R7,#0x4
   \   000094   02....       LJMP    ?BANKED_LEAVE_XDATA
    617          
    618          /********************************************************************************************************
    619           * @fn      ZMacStateIdle
    620           *
    621           * @brief   This function returns true if the MAC state is idle.
    622           *
    623           * @param   none
    624           *
    625           * @return  TRUE if the MAC state is idle, FALSE otherwise.
    626           ********************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    627          uint8 ZMacStateIdle( void )
   \                     ZMacStateIdle:
    628          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    629            return macStateIdle();
   \   000004                ; Setup parameters for call to function macStateIdle
   \   000004   12....       LCALL   ??macStateIdle?relay
   \   000007   D083         POP     DPH
   \   000009   D082         POP     DPL
   \   00000B   02....       LJMP    ?BRET
    630          }

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacReset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacReset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacGetReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacGetReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacSetReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacSetReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacAssociateReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacAssociateReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacAssociateRsp?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacAssociateRsp

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacDisassociateReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacDisassociateReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacOrphanRsp?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacOrphanRsp

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacScanReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacScanReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacStartReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacStartReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacSyncReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacSyncReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacPollReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacPollReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacDataReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacDataReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacPurgeReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacPurgeReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacSrcMatchEnable?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacSrcMatchEnable

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacSrcMatchAddEntry?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacSrcMatchAddEntry

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacSrcMatchDeleteEntry?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacSrcMatchDeleteEntry

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacSrcMatchAckAllPending?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacSrcMatchAckAllPending

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacSrcMatchCheckAllPending?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacSrcMatchCheckAllPending

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacPwrOnReq?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacPwrOnReq

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMac_PwrMode?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMac_PwrMode

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacSetTransmitPower?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacSetTransmitPower

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacSendNoData?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacSendNoData

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZMacStateIdle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZMacStateIdle

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     ZMacAssociateReq                   3      0      0
       -> MAC_MlmeAssociateReq          4      0      0
     ZMacAssociateRsp                   3      0      0
       -> MAC_MlmeAssociateRsp          4      0      0
     ZMacDataReq                        1      0     19
       -> MAC_McpsDataAlloc             0      0     32
       -> osal_memcpy                   0      0     38
       -> osal_memcpy                   0      0     38
       -> MAC_McpsDataReq               0      0     32
     ZMacDisassociateReq                3      0      0
       -> MAC_MlmeDisassociateReq       4      0      0
     ZMacGetReq                         2      0      0
       -> sAddrExtCpy                   4      0      0
       -> MAC_MlmeGetReq                4      0      0
     ZMacInit                           0      0      9
       -> MAC_Init                      0      0     18
       -> MAC_InitDevice                0      0     18
       -> MAC_InitCoord                 0      0     18
       -> ZMacReset                     0      0     18
       -> osal_int_disable              0      0     18
     ZMacOrphanRsp                      3      0      0
       -> MAC_MlmeOrphanRsp             4      0      0
     ZMacPollReq                        3      0      0
       -> MAC_MlmePollReq               4      0      0
     ZMacPurgeReq                       2      0      0
       -> MAC_McpsPurgeReq              4      0      0
     ZMacPwrOnReq                       2      0      0
       -> MAC_PwrOnReq                  4      0      0
     ZMacReset                          1      0     19
       -> MAC_MlmeResetReq              0      0     20
       -> MAC_MlmeSetReq                0      0     20
       -> MAC_MlmeSetReq                0      0     20
       -> osal_mem_free                 0      0     20
     ZMacScanReq                        1      0     12
       -> osal_mem_alloc                0      0     24
       -> osal_memset                   0      0     24
       -> osal_mem_alloc                0      0     24
       -> MAC_MlmeScanReq               0      0     24
     ZMacSendNoData                     1      0     12
       -> MAC_McpsDataAlloc             0      0     24
       -> MAC_McpsDataReq               0      0     24
     ZMacSetReq                         0      0      9
       -> sAddrExtCpy                   0      0     18
       -> MAC_MlmeSetReq                0      0     18
     ZMacSetTransmitPower               3      0      1
       -> MAC_MlmeSetReq                4      0      2
     ZMacSrcMatchAckAllPending          2      0      0
       -> MAC_SrcMatchAckAllPending     4      0      0
     ZMacSrcMatchAddEntry               2      0      0
       -> MAC_SrcMatchAddEntry          4      0      0
     ZMacSrcMatchCheckAllPending        2      0      0
       -> MAC_SrcMatchCheckAllPending
                                        4      0      0
     ZMacSrcMatchDeleteEntry            2      0      0
       -> MAC_SrcMatchDeleteEntry       4      0      0
     ZMacSrcMatchEnable                 2      0      0
       -> MAC_SrcMatchEnable            4      0      0
     ZMacStartReq                       1      0     10
       -> MAC_MlmeSetReq                0      0     20
       -> MAC_MlmeStartReq              0      0     20
     ZMacStateIdle                      2      0      0
       -> macStateIdle                  4      0      0
     ZMacSyncReq                        2      0      0
       -> MAC_MlmeSyncReq               4      0      0
     ZMac_PwrMode                       2      0      0
       -> MAC_PwrMode                   4      0      0


   Segment part sizes:

     Function/Label                      Bytes
     --------------                      -----
     _ScanChannels                          4
     ZMac_ScanBuf                           2
     ZMacInit                              33
     ZMacReset                             81
     ZMacGetReq                            30
     ZMacSetReq                            42
     ZMacAssociateReq                      32
     ZMacAssociateRsp                      32
     ZMacDisassociateReq                   32
     ZMacOrphanRsp                         32
     ZMacScanReq                          258
     ZMacStartReq                          83
     ZMacSyncReq                           16
     ZMacPollReq                           32
     ZMacDataReq                          187
     ZMacPurgeReq                          16
     ZMacSrcMatchEnable                    14
     ZMacSrcMatchAddEntry                  14
     ZMacSrcMatchDeleteEntry               14
     ZMacSrcMatchAckAllPending             16
     ZMacSrcMatchCheckAllPending           14
     ZMacPwrOnReq                          14
     ZMac_PwrMode                          14
     ZMacSetTransmitPower                  38
     ZMacSendNoData                       151
     ZMacStateIdle                         14
     ??ZMacInit?relay                       6
     ??ZMacReset?relay                      6
     ??ZMacGetReq?relay                     6
     ??ZMacSetReq?relay                     6
     ??ZMacAssociateReq?relay               6
     ??ZMacAssociateRsp?relay               6
     ??ZMacDisassociateReq?relay            6
     ??ZMacOrphanRsp?relay                  6
     ??ZMacScanReq?relay                    6
     ??ZMacStartReq?relay                   6
     ??ZMacSyncReq?relay                    6
     ??ZMacPollReq?relay                    6
     ??ZMacDataReq?relay                    6
     ??ZMacPurgeReq?relay                   6
     ??ZMacSrcMatchEnable?relay             6
     ??ZMacSrcMatchAddEntry?relay           6
     ??ZMacSrcMatchDeleteEntry?relay        6
     ??ZMacSrcMatchAckAllPending?relay      6
     ??ZMacSrcMatchCheckAllPending?relay    6
     ??ZMacPwrOnReq?relay                   6
     ??ZMac_PwrMode?relay                   6
     ??ZMacSetTransmitPower?relay           6
     ??ZMacSendNoData?relay                 6
     ??ZMacStateIdle?relay                  6

 
 1 209 bytes in segment BANKED_CODE
   144 bytes in segment BANK_RELAYS
     6 bytes in segment XDATA_Z
 
 1 353 bytes of CODE  memory
     6 bytes of XDATA memory

Errors: none
Warnings: none
