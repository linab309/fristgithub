###############################################################################
#                                                                             #
# IAR C/C++ Compiler V7.51A/W32 for 8051                08/Apr/2013  11:22:18 #
# Copyright 2004-2009 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Com #
#                          ponents\stack\zdo\ZDApp.c                          #
#    Command line       =  -f "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0 #
#                          \Projects\zstack\Samples\WSN_sensors\CC2530DB\..\. #
#                          .\..\Tools\CC2530DB\f8wRouter.cfg" (-DCPU32MHZ     #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DRTR_NWK -DBLINK_LEDS) -f "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\Tools\CC #
#                          2530DB\f8wConfig.cfg" (-DSECURE=0                  #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Co #
#                          mponents\stack\zdo\ZDApp.c" -D ZTOOL_P1 -D         #
#                          MT_TASK -D MT_SYS_FUNC -D MT_ZDO_FUNC -D           #
#                          LCD_SUPPORTED=DEBUG -lC "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\RouterEB\List\"   #
#                          -lA "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3. #
#                          0\Projects\zstack\Samples\WSN_sensors\CC2530DB\Rou #
#                          terEB\List\" --diag_suppress Pe001,Pa010 -o        #
#                          "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Pr #
#                          ojects\zstack\Samples\WSN_sensors\CC2530DB\RouterE #
#                          B\Obj\" -e --require_prototypes --no_unroll        #
#                          --no_inline --no_tbaa --debug --core=plain         #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 8 -I "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\" -I "C:\Texas    #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\SOURCE\" -I    #
#                          "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Pr #
#                          ojects\zstack\Samples\WSN_sensors\CC2530DB\..\..\. #
#                          .\ZMAIN\TI2530DB\" -I "C:\Texas                    #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MT\" -I "C:\Texas                         #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\HAL\INCLUDE\" -I "C:\Texas                #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\HAL\TARGET\CC2530EB\" -I "C:\Texas        #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\OSAL\MCU\CCSOC\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\OSAL\INCLUDE\" -I "C:\Texas               #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\AF\" -I "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\NWK\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\SEC\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\SAPI\" -I "C:\Texas                 #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\SYS\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\ZDO\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\ZMAC\F8W\" -I "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\ZMAC\" -I "C:\Texas                       #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\SERVICES\SADDR\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\SERVICES\SDATA\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\INCLUDE\" -I "C:\Texas                #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\HIGH_LEVEL\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\LOW_LEVEL\srf04\" -I "C:\Texas        #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\LOW_LEVEL\srf04\SINGLE_CHIP\" -I      #
#                          "D:\Program Files\IAR Systems\Embedded Workbench   #
#                          5.3\8051\INC\" -I "D:\Program Files\IAR            #
#                          Systems\Embedded Workbench 5.3\8051\INC\CLIB\" -Om #
#    List file          =  C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Pro #
#                          jects\zstack\Samples\WSN_sensors\CC2530DB\RouterEB #
#                          \List\ZDApp.lst                                    #
#    Object file        =  C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Pro #
#                          jects\zstack\Samples\WSN_sensors\CC2530DB\RouterEB #
#                          \Obj\ZDApp.r51                                     #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Components\stack\zdo\ZDApp.c
      1          /**************************************************************************************************
      2            Filename:       ZDApp.c
      3            Revised:        $Date: 2009-08-17 16:19:36 -0700 (Mon, 17 Aug 2009) $
      4            Revision:       $Revision: 20585 $
      5          
      6            Description:    This file contains the interface to the Zigbee Device Application. This is the
      7                            Application part that the use can change. This also contains the Task functions.
      8          
      9          
     10            Copyright 2004-2009 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com.
     39          **************************************************************************************************/
     40          
     41          /*********************************************************************
     42           * INCLUDES
     43           */
     44          #include "ZComDef.h"
     45          #include "ZMac.h"
     46          #include "OSAL.h"
     47          #include "OSAL_Tasks.h"
     48          #include "OSAL_PwrMgr.h"
     49          #include "OSAL_Nv.h"
     50          #include "AF.h"
     51          #include "APSMEDE.h"
     52          #include "NLMEDE.h"
     53          #include "AddrMgr.h"
     54          #include "ZDProfile.h"
     55          #include "ZDObject.h"
     56          #include "ZDConfig.h"
     57          #include "ZDSecMgr.h"
     58          #include "ZDApp.h"
     59          #include "DebugTrace.h"
     60          #include "nwk_util.h"
     61          #include "OnBoard.h"

   \                                 In  segment SFR_AN, at 0xa8
   \   union <unnamed> volatile __sfr _A_IEN0
   \                     _A_IEN0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xc9
   \   unsigned char volatile __sfr WDCTL
   \                     WDCTL:
   \   000000                DS 1
     62          #include "ZGlobals.h"
     63          #include "ZDNwkMgr.h"
     64          #include "rtg.h"
     65          
     66          #include "ssp.h"
     67          
     68          #if defined( MT_ZDO_FUNC )
     69            #include "MT_ZDO.h"
     70          #endif
     71          
     72          /* HAL */
     73          #include "hal_led.h"
     74          #include "hal_lcd.h"
     75          #include "hal_key.h"
     76          
     77          #if defined( MT_MAC_FUNC ) || defined( MT_MAC_CB_FUNC )
     78            #error "ERROR! MT_MAC functionalities should be disabled on ZDO devices"
     79          #endif
     80          /*********************************************************************
     81           * MACROS
     82           */
     83          
     84          /*********************************************************************
     85           * CONSTANTS
     86           */
     87          #if !defined( NWK_START_DELAY )
     88            #define NWK_START_DELAY             100   // in milliseconds
     89          #endif
     90          
     91          #if !defined( EXTENDED_JOINING_RANDOM_MASK )
     92            #define EXTENDED_JOINING_RANDOM_MASK 0x007F
     93          #endif
     94          
     95          #if !defined( BEACON_REQUEST_DELAY )
     96            #define BEACON_REQUEST_DELAY        100   // in milliseconds
     97          #endif
     98          
     99          #if !defined( BEACON_REQ_DELAY_MASK )
    100            #define BEACON_REQ_DELAY_MASK       0x007F
    101          #endif
    102          
    103          #define MAX_RESUME_RETRY            3
    104          
    105          #define MAX_DEVICE_UNAUTH_TIMEOUT   5000  // 5 seconds
    106          
    107          // Beacon Order Settings (see NLMEDE.h)
    108          #define DEFAULT_BEACON_ORDER        BEACON_ORDER_NO_BEACONS
    109          #define DEFAULT_SUPERFRAME_ORDER    DEFAULT_BEACON_ORDER
    110          
    111          #if !defined( MAX_NWK_FRAMECOUNTER_CHANGES )
    112            // The number of times the frame counter can change before
    113            // saving to NV
    114            #define MAX_NWK_FRAMECOUNTER_CHANGES    1000
    115          #endif
    116          
    117          // Leave control bits
    118          #define ZDAPP_LEAVE_CTRL_INIT 0
    119          #define ZDAPP_LEAVE_CTRL_SET  1
    120          #define ZDAPP_LEAVE_CTRL_RA   2
    121          
    122          // Standard time to update NWK NV data
    123          #define ZDAPP_UPDATE_NWK_NV_TIME 700
    124          
    125          // Address Manager Stub Implementation
    126          #define ZDApp_NwkWriteNVRequest AddrMgrWriteNVRequest
    127          
    128          /*********************************************************************
    129           * TYPEDEFS
    130           */
    131          
    132          /*********************************************************************
    133           * GLOBAL VARIABLES
    134           */
    135          
    136          #if defined( LCD_SUPPORTED )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    137            uint8 MatchRsps = 0;
   \                     MatchRsps:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    138          #endif
    139          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    140          uint8 zdoDiscCounter = 1;
   \                     zdoDiscCounter:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for zdoDiscCounter>`
   \   000001                REQUIRE __INIT_XDATA_I
    141          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    142          zAddrType_t ZDAppNwkAddr;
   \                     ZDAppNwkAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z
    143          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    144          uint8 zdappMgmtNwkDiscRspTransSeq;
   \                     zdappMgmtNwkDiscRspTransSeq:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    145          uint8 zdappMgmtNwkDiscReqInProgress = FALSE;
   \                     zdappMgmtNwkDiscReqInProgress:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    146          zAddrType_t zdappMgmtNwkDiscRspAddr;
   \                     zdappMgmtNwkDiscRspAddr:
   \   000000                DS 9
   \   000009                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    147          uint8 zdappMgmtNwkDiscStartIndex;
   \                     zdappMgmtNwkDiscStartIndex:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    148          uint8 zdappMgmtSavedNwkState;
   \                     zdappMgmtSavedNwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    149          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    150          uint16 nwkFrameCounterChanges = 0;
   \                     nwkFrameCounterChanges:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_I, align 1, keep-with-next
    151          uint8 continueJoining = TRUE;
   \                     continueJoining:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for continueJoining>`
   \   000001                REQUIRE __INIT_XDATA_I
    152          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    153          uint8  _tmpRejoinState;
   \                     _tmpRejoinState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    154          
    155          // The extended PanID used in ZDO layer for rejoin.

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    156          uint8 ZDO_UseExtendedPANID[Z_EXTADDR_LEN];
   \                     ZDO_UseExtendedPANID:
   \   000000                DS 8
   \   000008                REQUIRE __INIT_XDATA_Z
    157          
    158          /*********************************************************************
    159           * EXTERNAL VARIABLES
    160           */
    161          
    162          /*********************************************************************
    163           * EXTERNAL FUNCTIONS
    164           */
    165          
    166          /*********************************************************************
    167           * LOCAL FUNCTIONS
    168           */
    169          
    170          void ZDApp_NetworkStartEvt( void );
    171          void ZDApp_DeviceAuthEvt( void );
    172          void ZDApp_SaveNetworkStateEvt( void );
    173          
    174          uint8 ZDApp_ReadNetworkRestoreState( void );
    175          uint8 ZDApp_RestoreNetworkState( void );
    176          void ZDAppDetermineDeviceType( void );
    177          void ZDApp_InitUserDesc( void );
    178          void ZDAppCheckForHoldKey( void );
    179          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr );
    180          void ZDApp_ProcessNetworkJoin( void );
    181          void ZDApp_SetCoordAddress( uint8 endPoint, uint8 dstEP );
    182          void ZDApp_SaveNwkKey( void );
    183          uint8 ZDApp_RestoreNwkKey( void );
    184          
    185          void ZDApp_SecInit( uint8 state );
    186          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events );
    187          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr );
    188          
    189          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf );
    190          
    191          void ZDApp_ResetTimerStart( uint16 delay );
    192          void ZDApp_ResetTimerCancel( void );
    193          void ZDApp_LeaveCtrlInit( void );
    194          void ZDApp_LeaveCtrlSet( uint8 ra );
    195          uint8 ZDApp_LeaveCtrlBypass( void );
    196          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay );
    197          void ZDApp_LeaveReset( uint8 ra );
    198          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
    199                                  uint8 removeChildren );
    200          void ZDApp_NodeProfileSync( ZDO_NetworkDiscoveryCfm_t* cfm );
    201          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg );
    202          void ZDApp_RegisterCBs( void );
    203          
    204          /*********************************************************************
    205           * LOCAL VARIABLES
    206           */
    207          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    208          uint8 ZDAppTaskID;
   \                     ZDAppTaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    209          uint8 nwkStatus;
   \                     nwkStatus:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    210          endPointDesc_t *ZDApp_AutoFindMode_epDesc = (endPointDesc_t *)NULL;
   \                     ZDApp_AutoFindMode_epDesc:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    211          uint8 ZDApp_LeaveCtrl;
   \                     ZDApp_LeaveCtrl:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    212          
    213          #if defined( HOLD_AUTO_START )
    214            devStates_t devState = DEV_HOLD;
    215          #else

   \                                 In  segment XDATA_I, align 1, keep-with-next
    216            devStates_t devState = DEV_INIT;
   \                     devState:
   \   000000                DS 1
   \   000001                REQUIRE `?<Initializer for devState>`
   \   000001                REQUIRE __INIT_XDATA_I
    217          #endif
    218          
    219          #if ( ZG_BUILD_RTRONLY_TYPE ) || ( ZG_BUILD_ENDDEVICE_TYPE )

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    220            devStartModes_t devStartMode = MODE_JOIN;     // Assume joining
   \                     devStartMode:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    221            //devStartModes_t devStartMode = MODE_RESUME; // if already "directly joined"
    222                                  // to parent. Set to make the device do an Orphan scan.
    223          #else
    224            // Set the default to coodinator
    225            devStartModes_t devStartMode = MODE_HARD;
    226          #endif
    227          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    228          uint8 retryCnt;
   \                     retryCnt:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    229          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    230          endPointDesc_t ZDApp_epDesc =
   \                     ZDApp_epDesc:
   \   000000                DS 6
   \   000006                REQUIRE `?<Initializer for ZDApp_epDesc>`
   \   000006                REQUIRE __INIT_XDATA_I
    231          {
    232            ZDO_EP,
    233            &ZDAppTaskID,
    234            (SimpleDescriptionFormat_t *)NULL,  // No Simple description for ZDO
    235            (afNetworkLatencyReq_t)0            // No Network Latency req
    236          };
    237          

   \                                 In  segment XDATA_I, align 1, keep-with-next
    238          uint16 ZDApp_SavedPollRate = POLL_RATE;
   \                     ZDApp_SavedPollRate:
   \   000000                DS 2
   \   000002                REQUIRE `?<Initializer for ZDApp_SavedPollRate>`
   \   000002                REQUIRE __INIT_XDATA_I
    239          
    240          /*********************************************************************
    241           * @fn      ZDApp_Init
    242           *
    243           * @brief   ZDApp Initialization function.
    244           *
    245           * @param   task_id - ZDApp Task ID
    246           *
    247           * @return  None
    248           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    249          void ZDApp_Init( uint8 task_id )
   \                     ZDApp_Init:
    250          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    251            // Save the task ID
    252            ZDAppTaskID = task_id;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#ZDAppTaskID
   \   000008   F0           MOVX    @DPTR,A
    253          
    254            // Initialize the ZDO global device short address storage
    255            ZDAppNwkAddr.addrMode = Addr16Bit;
   \   000009   7402         MOV     A,#0x2
   \   00000B   90....       MOV     DPTR,#(ZDAppNwkAddr + 8)
   \   00000E   F0           MOVX    @DPTR,A
    256            ZDAppNwkAddr.addr.shortAddr = INVALID_NODE_ADDR;
   \   00000F   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000012   74FE         MOV     A,#-0x2
   \   000014   F0           MOVX    @DPTR,A
   \   000015   A3           INC     DPTR
   \   000016   74FF         MOV     A,#-0x1
   \   000018   F0           MOVX    @DPTR,A
    257            (void)NLME_GetExtAddr();  // Load the saveExtAddr pointer.
   \   000019                ; Setup parameters for call to function NLME_GetExtAddr
   \   000019   12....       LCALL   ??NLME_GetExtAddr?relay
    258          
    259            // Check for manual "Hold Auto Start"
    260            ZDAppCheckForHoldKey();
   \   00001C                ; Setup parameters for call to function ZDAppCheckForHoldKey
   \   00001C   12....       LCALL   ??ZDAppCheckForHoldKey?relay
    261          
    262            // Initialize ZDO items and setup the device - type of device to create.
    263            ZDO_Init();
   \   00001F                ; Setup parameters for call to function ZDO_Init
   \   00001F   12....       LCALL   ??ZDO_Init?relay
    264          
    265            // Register the endpoint description with the AF
    266            // This task doesn't have a Simple description, but we still need
    267            // to register the endpoint.
    268            afRegister( (endPointDesc_t *)&ZDApp_epDesc );
   \   000022                ; Setup parameters for call to function afRegister
   \   000022   7A..         MOV     R2,#(ZDApp_epDesc & 0xff)
   \   000024   7B..         MOV     R3,#((ZDApp_epDesc >> 8) & 0xff)
   \   000026   12....       LCALL   ??afRegister?relay
    269          
    270          #if defined( ZDO_USERDESC_RESPONSE )
    271            ZDApp_InitUserDesc();
   \   000029                ; Setup parameters for call to function ZDApp_InitUserDesc
   \   000029   12....       LCALL   ??ZDApp_InitUserDesc?relay
    272          #endif // ZDO_USERDESC_RESPONSE
    273          
    274            // Start the device?
    275            if ( devState != DEV_HOLD )
   \   00002C   90....       MOV     DPTR,#devState
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   6009         JZ      ??ZDApp_Init_0
    276            {
    277              ZDOInitDevice( 0 );
   \   000032                ; Setup parameters for call to function ZDOInitDevice
   \   000032   7A00         MOV     R2,#0x0
   \   000034   7B00         MOV     R3,#0x0
   \   000036   12....       LCALL   ??ZDOInitDevice?relay
   \   000039   800D         SJMP    ??ZDApp_Init_1
    278            }
    279            else
    280            {
    281              // Blink LED to indicate HOLD_START
    282              HalLedBlink ( HAL_LED_4, 0, 50, 500 );
   \                     ??ZDApp_Init_0:
   \   00003B                ; Setup parameters for call to function HalLedBlink
   \   00003B   7CF4         MOV     R4,#-0xc
   \   00003D   7D01         MOV     R5,#0x1
   \   00003F   7B32         MOV     R3,#0x32
   \   000041   7A00         MOV     R2,#0x0
   \   000043   7908         MOV     R1,#0x8
   \   000045   12....       LCALL   ??HalLedBlink?relay
    283            }
    284          
    285            ZDApp_RegisterCBs();
   \                     ??ZDApp_Init_1:
   \   000048                ; Setup parameters for call to function ZDApp_RegisterCBs
   \   000048   12....       LCALL   ??ZDApp_RegisterCBs?relay
    286          } /* ZDApp_Init() */
   \   00004B   D083         POP     DPH
   \   00004D   D082         POP     DPL
   \   00004F   02....       LJMP    ?BRET
    287          
    288          /*********************************************************************
    289           * @fn          ZDApp_SecInit
    290           *
    291           * @brief       ZDApp initialize security.
    292           *
    293           * @param       state - device initialization state
    294           *
    295           * @return      none
    296           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    297          void ZDApp_SecInit( uint8 state )
   \                     ZDApp_SecInit:
    298          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    299            if ( ZG_SECURE_ENABLED && ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    300            {
    301              // Set the Trust Center bit
    302              ZDO_Config_Node_Descriptor.ServerMask |= PRIM_TRUST_CENTER;
    303            }
    304          
    305            if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
    306            {
    307              ZDO_Config_Node_Descriptor.CapabilityFlags |= CAPINFO_SECURITY_CAPABLE;
    308            }
    309          
    310            // Initialize ZigBee Device Security Manager
    311            ZDSecMgrInit();
   \   000004                ; Setup parameters for call to function ZDSecMgrInit
   \   000004   12....       LCALL   ??ZDSecMgrInit?relay
    312          
    313            if ( ZG_SECURE_ENABLED )
    314            {
    315              if ( state != ZDO_INITDEV_RESTORED_NETWORK_STATE )
    316              {
    317                nwkFrameCounter = 0;
    318          
    319                if( _NIB.nwkKeyLoaded == FALSE )
    320                {
    321                  if ( ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE          ) ||
    322                       ( ( zgSecurityMode == ZG_SECURITY_RESIDENTIAL ) && zgPreConfigKeys )    )
    323                  {
    324                      SSP_UpdateNwkKey( (byte*)zgPreConfigKey, 0);
    325                      SSP_SwitchNwkKey( 0 );
    326                  }
    327                }
    328              }
    329            }
    330          }
   \   000007   D083         POP     DPH
   \   000009   D082         POP     DPL
   \   00000B   02....       LJMP    ?BRET
    331          
    332          /*********************************************************************
    333           * @fn      ZDApp_event_loop()
    334           *
    335           * @brief   Main event loop for Zigbee device objects task. This function
    336           *          should be called at periodic intervals.
    337           *
    338           * @param   task_id - Task ID
    339           * @param   events  - Bitmap of events
    340           *
    341           * @return  none
    342           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    343          UINT16 ZDApp_event_loop( uint8 task_id, UINT16 events )
   \                     ZDApp_event_loop:
    344          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    345            uint8 *msg_ptr;
    346          
    347            if ( events & SYS_EVENT_MSG )
   \   000009   7480         MOV     A,#-0x80
   \   00000B   5F           ANL     A,R7
   \   00000C   F9           MOV     R1,A
   \   00000D   E4           CLR     A
   \   00000E   7001         JNZ     ??ZDApp_event_loop_0
   \   000010   E9           MOV     A,R1
   \                     ??ZDApp_event_loop_0:
   \   000011   7031         JNZ     ??ZDApp_event_loop_1
    348            {
    349              while ( (msg_ptr = osal_msg_receive( ZDAppTaskID )) )
    350              {
    351                ZDApp_ProcessOSALMsg( (osal_event_hdr_t *)msg_ptr );
    352          
    353                // Release the memory
    354                osal_msg_deallocate( msg_ptr );
    355              }
    356          
    357              // Return unprocessed events
    358              return (events ^ SYS_EVENT_MSG);
    359            }
    360          
    361            if ( events & ZDO_NETWORK_INIT )
   \   000013   EE           MOV     A,R6
   \   000014   A2E0         MOV     C,0xE0 /* A   */.0
   \   000016   5045         JNC     ??ZDApp_event_loop_2
    362            {
    363              // Initialize apps and start the network
    364              devState = DEV_INIT;
   \   000018   7401         MOV     A,#0x1
   \   00001A   90....       MOV     DPTR,#devState
   \   00001D   F0           MOVX    @DPTR,A
    365              ZDO_StartDevice( (uint8)ZDO_Config_Node_Descriptor.LogicalType, devStartMode,
    366                               DEFAULT_BEACON_ORDER, DEFAULT_SUPERFRAME_ORDER );
   \   00001E                ; Setup parameters for call to function ZDO_StartDevice
   \   00001E   7C0F         MOV     R4,#0xf
   \   000020   7B0F         MOV     R3,#0xf
   \   000022   90....       MOV     DPTR,#devStartMode
   \   000025   E0           MOVX    A,@DPTR
   \   000026   FA           MOV     R2,A
   \   000027   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   5407         ANL     A,#0x7
   \   00002D   F9           MOV     R1,A
   \   00002E   12....       LCALL   ??ZDO_StartDevice?relay
    367          
    368              // Return unprocessed events
    369              return (events ^ ZDO_NETWORK_INIT);
   \   000031   7401         MOV     A,#0x1
   \                     ??ZDApp_event_loop_3:
   \   000033   6E           XRL     A,R6
   \   000034   FA           MOV     R2,A
   \   000035   EF           MOV     A,R7
   \                     ??ZDApp_event_loop_4:
   \   000036   FB           MOV     R3,A
   \   000037   02....       LJMP    ??ZDApp_event_loop_5 & 0xFFFF
    370            }
   \                     ??ZDApp_event_loop_6:
   \   00003A                ; Setup parameters for call to function ZDApp_ProcessOSALMsg
   \   00003A   12....       LCALL   ??ZDApp_ProcessOSALMsg?relay
   \   00003D                ; Setup parameters for call to function osal_msg_deallocate
   \   00003D   AA..         MOV     R2,?V0 + 0
   \   00003F   AB..         MOV     R3,?V0 + 1
   \   000041   12....       LCALL   ??osal_msg_deallocate?relay
   \                     ??ZDApp_event_loop_1:
   \   000044                ; Setup parameters for call to function osal_msg_receive
   \   000044   90....       MOV     DPTR,#ZDAppTaskID
   \   000047   E0           MOVX    A,@DPTR
   \   000048   F9           MOV     R1,A
   \   000049   12....       LCALL   ??osal_msg_receive?relay
   \   00004C   8A..         MOV     ?V0 + 0,R2
   \   00004E   8B..         MOV     ?V0 + 1,R3
   \   000050   EA           MOV     A,R2
   \   000051   7001         JNZ     ??ZDApp_event_loop_7
   \   000053   EB           MOV     A,R3
   \                     ??ZDApp_event_loop_7:
   \   000054   70E4         JNZ     ??ZDApp_event_loop_6
   \   000056   EE           MOV     A,R6
   \   000057   FA           MOV     R2,A
   \   000058   7480         MOV     A,#-0x80
   \                     ??ZDApp_event_loop_8:
   \   00005A   6F           XRL     A,R7
   \   00005B   80D9         SJMP    ??ZDApp_event_loop_4
    371          
    372            if ( ZSTACK_ROUTER_BUILD )
    373            {
    374              if ( events & ZDO_NETWORK_START )
   \                     ??ZDApp_event_loop_2:
   \   00005D   5402         ANL     A,#0x2
   \   00005F   6007         JZ      ??ZDApp_event_loop_9
    375              {
    376                ZDApp_NetworkStartEvt();
   \   000061                ; Setup parameters for call to function ZDApp_NetworkStartEvt
   \   000061   12....       LCALL   ??ZDApp_NetworkStartEvt?relay
    377          
    378                // Return unprocessed events
    379                return (events ^ ZDO_NETWORK_START);
   \   000064   7402         MOV     A,#0x2
   \   000066   80CB         SJMP    ??ZDApp_event_loop_3
    380              }
    381          
    382              if ( events & ZDO_ROUTER_START )
   \                     ??ZDApp_event_loop_9:
   \   000068   EE           MOV     A,R6
   \   000069   5420         ANL     A,#0x20
   \   00006B   6026         JZ      ??ZDApp_event_loop_10
    383              {
    384                if ( nwkStatus == ZSuccess )
   \   00006D   90....       MOV     DPTR,#nwkStatus
   \   000070   E0           MOVX    A,@DPTR
   \   000071   7010         JNZ     ??ZDApp_event_loop_11
    385                {
    386                  if ( devState == DEV_END_DEVICE )
   \   000073   90....       MOV     DPTR,#devState
   \   000076   E0           MOVX    A,@DPTR
   \   000077   6406         XRL     A,#0x6
   \   000079   7003         JNZ     ??ZDApp_event_loop_12
    387                    devState = DEV_ROUTER;
   \   00007B   7407         MOV     A,#0x7
   \   00007D   F0           MOVX    @DPTR,A
    388          
    389                  osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
   \                     ??ZDApp_event_loop_12:
   \   00007E                ; Setup parameters for call to function osal_pwrmgr_device
   \   00007E   7900         MOV     R1,#0x0
   \   000080   12....       LCALL   ??osal_pwrmgr_device?relay
    390                }
    391                else
    392                {
    393                  // remain as end device!!
    394                }
    395                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \                     ??ZDApp_event_loop_11:
   \   000083                ; Setup parameters for call to function osal_set_event
   \   000083   7A10         MOV     R2,#0x10
   \   000085   7B00         MOV     R3,#0x0
   \   000087   90....       MOV     DPTR,#ZDAppTaskID
   \   00008A   E0           MOVX    A,@DPTR
   \   00008B   F9           MOV     R1,A
   \   00008C   12....       LCALL   ??osal_set_event?relay
    396          
    397                // Return unprocessed events
    398                return (events ^ ZDO_ROUTER_START);
   \   00008F   7420         MOV     A,#0x20
   \   000091   80A0         SJMP    ??ZDApp_event_loop_3
    399              }
    400            }
    401          
    402            if ( events & ZDO_STATE_CHANGE_EVT )
   \                     ??ZDApp_event_loop_10:
   \   000093   EE           MOV     A,R6
   \   000094   5410         ANL     A,#0x10
   \   000096   600C         JZ      ??ZDApp_event_loop_13
    403            {
    404              ZDO_UpdateNwkStatus( devState );
   \   000098                ; Setup parameters for call to function ZDO_UpdateNwkStatus
   \   000098   90....       MOV     DPTR,#devState
   \   00009B   E0           MOVX    A,@DPTR
   \   00009C   F9           MOV     R1,A
   \   00009D   12....       LCALL   ??ZDO_UpdateNwkStatus?relay
    405          
    406              // Return unprocessed events
    407              return (events ^ ZDO_STATE_CHANGE_EVT);
   \   0000A0   7410         MOV     A,#0x10
   \   0000A2   808F         SJMP    ??ZDApp_event_loop_3
    408            }
    409          
    410            if ( events & ZDO_COMMAND_CNF )
   \                     ??ZDApp_event_loop_13:
   \   0000A4   EE           MOV     A,R6
   \   0000A5   5408         ANL     A,#0x8
   \   0000A7   6006         JZ      ??ZDApp_event_loop_14
    411            {
    412              // User defined logic
    413          
    414              // Return unprocessed events
    415              return (events ^ ZDO_COMMAND_CNF);
   \   0000A9   7408         MOV     A,#0x8
   \   0000AB   6E           XRL     A,R6
   \   0000AC   FA           MOV     R2,A
   \   0000AD   8026         SJMP    ??ZDApp_event_loop_5
    416            }
    417          
    418            if ( events & ZDO_NWK_UPDATE_NV )
   \                     ??ZDApp_event_loop_14:
   \   0000AF   7402         MOV     A,#0x2
   \   0000B1   5F           ANL     A,R7
   \   0000B2   F9           MOV     R1,A
   \   0000B3   E4           CLR     A
   \   0000B4   7001         JNZ     ??ZDApp_event_loop_15
   \   0000B6   E9           MOV     A,R1
   \                     ??ZDApp_event_loop_15:
   \   0000B7   6009         JZ      ??ZDApp_event_loop_16
    419            {
    420              ZDApp_SaveNetworkStateEvt();
   \   0000B9                ; Setup parameters for call to function ZDApp_SaveNetworkStateEvt
   \   0000B9   12....       LCALL   ??ZDApp_SaveNetworkStateEvt?relay
    421          
    422              // Return unprocessed events
    423              return (events ^ ZDO_NWK_UPDATE_NV);
   \   0000BC   EE           MOV     A,R6
   \   0000BD   FA           MOV     R2,A
   \   0000BE   7402         MOV     A,#0x2
   \   0000C0   8098         SJMP    ??ZDApp_event_loop_8
    424            }
    425          
    426            if ( events & ZDO_DEVICE_RESET )
   \                     ??ZDApp_event_loop_16:
   \   0000C2   EE           MOV     A,R6
   \   0000C3   5404         ANL     A,#0x4
   \   0000C5   600A         JZ      ??ZDApp_event_loop_17
    427            {
    428              // The device has been in the UNAUTH state, so reset
    429              // Note: there will be no return from this call
    430              SystemReset();
   \   0000C7   C2AF         CLR     0xa8.7
   \   0000C9   75C9AB       MOV     0xc9,#-0x55
   \   0000CC   75C95B       MOV     0xc9,#0x5b
   \                     ??ZDApp_event_loop_18:
   \   0000CF   80FE         SJMP    ??ZDApp_event_loop_18
    431            }
    432          
    433            if ( ZG_SECURE_ENABLED )
    434            {
    435              return ( ZDApp_ProcessSecEvent( task_id, events ) );
    436            }
    437            else
    438            {
    439              // Discard or make more handlers
    440              return 0;
   \                     ??ZDApp_event_loop_17:
   \   0000D1   7A00         MOV     R2,#0x0
   \   0000D3   7B00         MOV     R3,#0x0
   \                     ??ZDApp_event_loop_5:
   \   0000D5   7F02         MOV     R7,#0x2
   \   0000D7   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   0000DA                REQUIRE _A_IEN0
   \   0000DA                REQUIRE WDCTL
    441            }
    442          }
    443          
    444          /*********************************************************************
    445           * @fn      ZDApp_ProcessSecEvent()
    446           *
    447           * @brief   Process incoming security events.
    448           *
    449           * @param   task_id - Task ID
    450           * @param   events  - Bitmap of events
    451           *
    452           * @return  none
    453           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    454          UINT16 ZDApp_ProcessSecEvent( uint8 task_id, UINT16 events )
   \                     ZDApp_ProcessSecEvent:
    455          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    456            (void)task_id;  // Intentionally unreferenced parameter
    457          
    458            if ( ZSTACK_ROUTER_BUILD )
    459            {
    460              if ( events & ZDO_NEW_DEVICE )
   \   000009   EE           MOV     A,R6
   \   00000A   5440         ANL     A,#0x40
   \   00000C   6020         JZ      ??ZDApp_ProcessSecEvent_0
    461              {
    462                // process the new device event
    463                if ( ZDSecMgrNewDeviceEvent() == TRUE )
   \   00000E                ; Setup parameters for call to function ZDSecMgrNewDeviceEvent
   \   00000E   12....       LCALL   ??ZDSecMgrNewDeviceEvent?relay
   \   000011   E9           MOV     A,R1
   \   000012   6401         XRL     A,#0x1
   \   000014   7010         JNZ     ??ZDApp_ProcessSecEvent_1
    464                {
    465                  osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 1000 );
   \   000016                ; Setup parameters for call to function osal_start_timerEx
   \   000016   7CE8         MOV     R4,#-0x18
   \   000018   7D03         MOV     R5,#0x3
   \   00001A   7A40         MOV     R2,#0x40
   \   00001C   7B00         MOV     R3,#0x0
   \   00001E   90....       MOV     DPTR,#ZDAppTaskID
   \   000021   E0           MOVX    A,@DPTR
   \   000022   F9           MOV     R1,A
   \   000023   12....       LCALL   ??osal_start_timerEx?relay
    466                }
    467          
    468                // Return unprocessed events
    469                return (events ^ ZDO_NEW_DEVICE);
   \                     ??ZDApp_ProcessSecEvent_1:
   \   000026   7440         MOV     A,#0x40
   \                     ??ZDApp_ProcessSecEvent_2:
   \   000028   6E           XRL     A,R6
   \   000029   FA           MOV     R2,A
   \   00002A   EF           MOV     A,R7
   \   00002B   FB           MOV     R3,A
   \   00002C   8045         SJMP    ??ZDApp_ProcessSecEvent_3
    470              }
    471            }
    472          
    473            if ( (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH)
    474                || (ZG_CHECK_SECURITY_MODE == ZG_SECURITY_SE_STANDARD) )
    475            {
    476              if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    477              {
    478                if ( events & ZDO_SECMGR_EVENT )
    479                {
    480                  ZDSecMgrEvent();
    481          
    482                  // Return unprocessed events
    483                  return (events ^ ZDO_SECMGR_EVENT);
    484                }
    485              }
    486            }
    487          
    488            if ( events & ZDO_DEVICE_AUTH )
   \                     ??ZDApp_ProcessSecEvent_0:
   \   00002E   EE           MOV     A,R6
   \   00002F   5480         ANL     A,#0x80
   \   000031   6007         JZ      ??ZDApp_ProcessSecEvent_4
    489            {
    490              ZDApp_DeviceAuthEvt();
   \   000033                ; Setup parameters for call to function ZDApp_DeviceAuthEvt
   \   000033   12....       LCALL   ??ZDApp_DeviceAuthEvt?relay
    491          
    492              // Return unprocessed events
    493              return (events ^ ZDO_DEVICE_AUTH);
   \   000036   7480         MOV     A,#-0x80
   \   000038   80EE         SJMP    ??ZDApp_ProcessSecEvent_2
    494            }
    495          
    496            if ( events & ZDO_FRAMECOUNTER_CHANGE )
   \                     ??ZDApp_ProcessSecEvent_4:
   \   00003A   7404         MOV     A,#0x4
   \   00003C   5F           ANL     A,R7
   \   00003D   F9           MOV     R1,A
   \   00003E   E4           CLR     A
   \   00003F   7001         JNZ     ??ZDApp_ProcessSecEvent_5
   \   000041   E9           MOV     A,R1
   \                     ??ZDApp_ProcessSecEvent_5:
   \   000042   602B         JZ      ??ZDApp_ProcessSecEvent_6
    497            {
    498              if ( nwkFrameCounterChanges++ > MAX_NWK_FRAMECOUNTER_CHANGES )
   \   000044   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000047   E0           MOVX    A,@DPTR
   \   000048   F8           MOV     R0,A
   \   000049   A3           INC     DPTR
   \   00004A   E0           MOVX    A,@DPTR
   \   00004B   F9           MOV     R1,A
   \   00004C   7401         MOV     A,#0x1
   \   00004E   28           ADD     A,R0
   \   00004F   FA           MOV     R2,A
   \   000050   E4           CLR     A
   \   000051   39           ADDC    A,R1
   \   000052   FB           MOV     R3,A
   \   000053   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000056   EA           MOV     A,R2
   \   000057   F0           MOVX    @DPTR,A
   \   000058   A3           INC     DPTR
   \   000059   EB           MOV     A,R3
   \   00005A   F0           MOVX    @DPTR,A
   \   00005B   C3           CLR     C
   \   00005C   E8           MOV     A,R0
   \   00005D   94E9         SUBB    A,#-0x17
   \   00005F   E9           MOV     A,R1
   \   000060   9403         SUBB    A,#0x3
   \   000062   4003         JC      ??ZDApp_ProcessSecEvent_7
    499                ZDApp_SaveNwkKey();
   \   000064                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   000064   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    500          
    501              // Return unprocessed events
    502              return (events ^ ZDO_FRAMECOUNTER_CHANGE);
   \                     ??ZDApp_ProcessSecEvent_7:
   \   000067   EE           MOV     A,R6
   \   000068   FA           MOV     R2,A
   \   000069   7404         MOV     A,#0x4
   \   00006B   6F           XRL     A,R7
   \   00006C   FB           MOV     R3,A
   \   00006D   8004         SJMP    ??ZDApp_ProcessSecEvent_3
    503            }
    504          
    505            // Discard or make more handlers
    506            return 0;
   \                     ??ZDApp_ProcessSecEvent_6:
   \   00006F   7A00         MOV     R2,#0x0
   \   000071   7B00         MOV     R3,#0x0
   \                     ??ZDApp_ProcessSecEvent_3:
   \   000073   7F01         MOV     R7,#0x1
   \   000075   02....       LJMP    ?BANKED_LEAVE_XDATA
    507          }
    508          
    509          /*********************************************************************
    510           * Application Functions
    511           */
    512          
    513          /*********************************************************************
    514           * @fn      ZDOInitDevice
    515           *
    516           * @brief   Start the device in the network.  This function will read
    517           *   ZCD_NV_STARTUP_OPTION (NV item) to determine whether or not to
    518           *   restore the network state of the device.
    519           *
    520           * @param   startDelay - timeDelay to start device (in milliseconds).
    521           *      There is a jitter added to this delay:
    522           *              ((NWK_START_DELAY + startDelay)
    523           *              + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK))
    524           *
    525           * NOTE:    If the application would like to force a "new" join, the
    526           *          application should set the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    527           *          bit in the ZCD_NV_STARTUP_OPTION NV item before calling
    528           *          this function. "new" join means to not restore the network
    529           *          state of the device. Use zgWriteStartupOptions() to set these
    530           *          options.
    531           *
    532           * @return
    533           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    534           *          restored.
    535           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was initialized.
    536           *          This could mean that ZCD_NV_STARTUP_OPTION said to not restore, or
    537           *          it could mean that there was no network state to restore.
    538           *    ZDO_INITDEV_LEAVE_NOT_STARTED - Before the reset, a network leave was issued
    539           *          with the rejoin option set to TRUE.  So, the device was not
    540           *          started in the network (one time only).  The next time this
    541           *          function is called it will start.
    542           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    543          uint8 ZDOInitDevice( uint16 startDelay )
   \                     ZDOInitDevice:
    544          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   EA           MOV     A,R2
   \   000011   F0           MOVX    @DPTR,A
   \   000012   A3           INC     DPTR
   \   000013   EB           MOV     A,R3
   \   000014   F0           MOVX    @DPTR,A
    545            uint8 networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
    546            uint16 extendedDelay = 0;
    547          
    548            if ( devState == DEV_HOLD )
   \   000015   90....       MOV     DPTR,#devState
   \   000018   E0           MOVX    A,@DPTR
   \   000019   7005         JNZ     ??ZDOInitDevice_0
    549            {
    550              // Initialize the RAM items table, in case an NV item has been updated.
    551              zgInitItems( FALSE );
   \   00001B                ; Setup parameters for call to function zgInitItems
   \   00001B   7900         MOV     R1,#0x0
   \   00001D   12....       LCALL   ??zgInitItems?relay
    552            }
    553          
    554            ZDConfig_InitDescriptors();
   \                     ??ZDOInitDevice_0:
   \   000020                ; Setup parameters for call to function ZDConfig_InitDescriptors
   \   000020   12....       LCALL   ??ZDConfig_InitDescriptors?relay
    555            //devtag.071807.todo - fix this temporary solution
    556            _NIB.CapabilityInfo = ZDO_Config_Node_Descriptor.CapabilityFlags;
   \   000023   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000026   E0           MOVX    A,@DPTR
   \   000027   90....       MOV     DPTR,#(_NIB + 14)
   \   00002A   F0           MOVX    @DPTR,A
    557          
    558            devState = DEV_INIT;    // Remove the Hold state
   \   00002B   7401         MOV     A,#0x1
   \   00002D   90....       MOV     DPTR,#devState
   \   000030   F0           MOVX    @DPTR,A
    559          
    560            // Initialize leave control logic
    561            ZDApp_LeaveCtrlInit();
   \   000031                ; Setup parameters for call to function ZDApp_LeaveCtrlInit
   \   000031   12....       LCALL   ??ZDApp_LeaveCtrlInit?relay
    562          
    563            // Check leave control reset settings
    564            ZDApp_LeaveCtrlStartup( &devState, &startDelay );
   \   000034                ; Setup parameters for call to function ZDApp_LeaveCtrlStartup
   \   000034   85..82       MOV     DPL,?XSP + 0
   \   000037   85..83       MOV     DPH,?XSP + 1
   \   00003A   AC82         MOV     R4,DPL
   \   00003C   AD83         MOV     R5,DPH
   \   00003E   7A..         MOV     R2,#(devState & 0xff)
   \   000040   7B..         MOV     R3,#((devState >> 8) & 0xff)
   \   000042   12....       LCALL   ??ZDApp_LeaveCtrlStartup?relay
    565          
    566            // Leave may make the hold state come back
    567            if ( devState == DEV_HOLD )
   \   000045   90....       MOV     DPTR,#devState
   \   000048   E0           MOVX    A,@DPTR
   \   000049   7004         JNZ     ??ZDOInitDevice_1
    568              return ( ZDO_INITDEV_LEAVE_NOT_STARTED );   // Don't join - (one time).
   \   00004B   7902         MOV     R1,#0x2
   \   00004D   8039         SJMP    ??ZDOInitDevice_2
    569          
    570          #if defined ( NV_RESTORE )
    571            // Get Keypad directly to see if a reset nv is needed.
    572            // Hold down the SW_BYPASS_NV key (defined in OnBoard.h)
    573            // while booting to skip past NV Restore.
    574            if ( HalKeyRead() == SW_BYPASS_NV )
    575              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
    576            else
    577            {
    578              // Determine if NV should be restored
    579              networkStateNV = ZDApp_ReadNetworkRestoreState();
    580            }
    581          
    582            if ( networkStateNV == ZDO_INITDEV_RESTORED_NETWORK_STATE )
    583            {
    584              networkStateNV = ZDApp_RestoreNetworkState();
    585            }
    586            else
    587            {
    588              // Wipe out the network state in NV
    589              NLME_InitNV();
    590              NLME_SetDefaultNV();
    591            }
    592          #endif
    593          
    594            if ( networkStateNV == ZDO_INITDEV_NEW_NETWORK_STATE )
    595            {
    596              ZDAppDetermineDeviceType();
   \                     ??ZDOInitDevice_1:
   \   00004F                ; Setup parameters for call to function ZDAppDetermineDeviceType
   \   00004F   12....       LCALL   ??ZDAppDetermineDeviceType?relay
    597          
    598              // Only delay if joining network - not restoring network state
    599              extendedDelay = (uint16)((NWK_START_DELAY + startDelay)
    600                        + (osal_rand() & EXTENDED_JOINING_RANDOM_MASK));
   \   000052                ; Setup parameters for call to function osal_rand
   \   000052   12....       LCALL   ??osal_rand?relay
   \   000055   8A..         MOV     ?V0 + 0,R2
   \   000057   A8..         MOV     R0,?V0 + 0
   \   000059   85..82       MOV     DPL,?XSP + 0
   \   00005C   85..83       MOV     DPH,?XSP + 1
   \   00005F   747F         MOV     A,#0x7f
   \   000061   58           ANL     A,R0
   \   000062   F8           MOV     R0,A
   \   000063   E0           MOVX    A,@DPTR
   \   000064   28           ADD     A,R0
   \   000065   F8           MOV     R0,A
   \   000066   A3           INC     DPTR
   \   000067   E0           MOVX    A,@DPTR
   \   000068   3400         ADDC    A,#0x0
   \   00006A   F9           MOV     R1,A
   \   00006B   7464         MOV     A,#0x64
   \   00006D   28           ADD     A,R0
   \   00006E   FE           MOV     R6,A
   \   00006F   E4           CLR     A
   \   000070   39           ADDC    A,R1
   \   000071   FF           MOV     R7,A
    601            }
    602          
    603            // Initialize the security for type of device
    604            ZDApp_SecInit( networkStateNV );
   \   000072                ; Setup parameters for call to function ZDApp_SecInit
   \   000072   7901         MOV     R1,#0x1
   \   000074   12....       LCALL   ??ZDApp_SecInit?relay
    605          
    606            // Trigger the network start
    607            ZDApp_NetworkInit( extendedDelay );
   \   000077                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000077   EE           MOV     A,R6
   \   000078   FA           MOV     R2,A
   \   000079   EF           MOV     A,R7
   \   00007A   FB           MOV     R3,A
   \   00007B   12....       LCALL   ??ZDApp_NetworkInit?relay
    608          
    609            // set broadcast address mask to support broadcast filtering
    610            NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \   00007E                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   00007E   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000081   E0           MOVX    A,@DPTR
   \   000082   F9           MOV     R1,A
   \   000083   12....       LCALL   ??NLME_SetBroadcastFilter?relay
    611          
    612            return ( networkStateNV );
   \   000086   7901         MOV     R1,#0x1
   \                     ??ZDOInitDevice_2:
   \   000088   7402         MOV     A,#0x2
   \   00008A   12....       LCALL   ?DEALLOC_XSTACK8
   \   00008D   7F02         MOV     R7,#0x2
   \   00008F   02....       LJMP    ?BANKED_LEAVE_XDATA
    613          }
    614          
    615          /*********************************************************************
    616           * @fn      ZDApp_ReadNetworkRestoreState
    617           *
    618           * @brief   Read the ZCD_NV_STARTUP_OPTION NV Item to state whether
    619           *          or not to restore the network state.
    620           *          If the read value has the ZCD_STARTOPT_DEFAULT_NETWORK_STATE
    621           *          bit set return the ZDO_INITDEV_NEW_NETWORK_STATE.
    622           *
    623           * @param   none
    624           *
    625           * @return  ZDO_INITDEV_NEW_NETWORK_STATE
    626           *          or ZDO_INITDEV_RESTORED_NETWORK_STATE based on whether or
    627           *          not ZCD_STARTOPT_DEFAULT_NETWORK_STATE bit is set in
    628           *          ZCD_NV_STARTUP_OPTION
    629           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    630          uint8 ZDApp_ReadNetworkRestoreState( void )
   \                     ZDApp_ReadNetworkRestoreState:
    631          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    632            uint8 networkStateNV = ZDO_INITDEV_RESTORED_NETWORK_STATE;
   \   000005   7E00         MOV     R6,#0x0
    633          
    634            // Look for the New Network State option.
    635            if ( zgReadStartupOptions() & ZCD_STARTOPT_DEFAULT_NETWORK_STATE )
   \   000007                ; Setup parameters for call to function zgReadStartupOptions
   \   000007   12....       LCALL   ??zgReadStartupOptions?relay
   \   00000A   E9           MOV     A,R1
   \   00000B   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000D   5001         JNC     ??ZDApp_ReadNetworkRestoreState_0
    636            {
    637              networkStateNV = ZDO_INITDEV_NEW_NETWORK_STATE;
   \   00000F   0E           INC     R6
    638            }
    639          
    640            return ( networkStateNV );
   \                     ??ZDApp_ReadNetworkRestoreState_0:
   \   000010   EE           MOV     A,R6
   \   000011   F9           MOV     R1,A
   \   000012   7F01         MOV     R7,#0x1
   \   000014   02....       LJMP    ?BANKED_LEAVE_XDATA
    641          }
    642          
    643          /*********************************************************************
    644           * @fn      ZDAppDetermineDeviceType()
    645           *
    646           * @brief   Determines the type of device to start.
    647           *
    648           *          Looks at zgDeviceLogicalType and determines what type of
    649           *          device to start.  The types are:
    650           *            ZG_DEVICETYPE_COORDINATOR
    651           *            ZG_DEVICETYPE_ROUTER
    652           *            ZG_DEVICETYPE_ENDDEVICE
    653           *
    654           * @param   none
    655           *
    656           * @return  none
    657           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    658          void ZDAppDetermineDeviceType( void )
   \                     ZDAppDetermineDeviceType:
    659          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    660            if ( zgDeviceLogicalType == ZG_DEVICETYPE_COORDINATOR )
   \   000004   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000007   E0           MOVX    A,@DPTR
   \   000008   700E         JNZ     ??ZDAppDetermineDeviceType_0
    661            {
    662              devStartMode = MODE_HARD;     // Start as a coordinator
   \   00000A   7402         MOV     A,#0x2
   \   00000C   90....       MOV     DPTR,#devStartMode
   \   00000F   F0           MOVX    @DPTR,A
    663              ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   000010   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000013   E0           MOVX    A,@DPTR
   \   000014   54F8         ANL     A,#0xf8
   \   000016   802F         SJMP    ??ZDAppDetermineDeviceType_1
    664            }
    665            else
    666            {
    667              if ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER  )
   \                     ??ZDAppDetermineDeviceType_0:
   \   000018   E0           MOVX    A,@DPTR
   \   000019   6401         XRL     A,#0x1
   \   00001B   700A         JNZ     ??ZDAppDetermineDeviceType_2
    668                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_ROUTER;
   \   00001D   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000020   E0           MOVX    A,@DPTR
   \   000021   54F8         ANL     A,#0xf8
   \   000023   4401         ORL     A,#0x1
   \   000025   800D         SJMP    ??ZDAppDetermineDeviceType_3
    669              else if ( zgDeviceLogicalType == ZG_DEVICETYPE_ENDDEVICE )
   \                     ??ZDAppDetermineDeviceType_2:
   \   000027   E0           MOVX    A,@DPTR
   \   000028   6402         XRL     A,#0x2
   \   00002A   7009         JNZ     ??ZDAppDetermineDeviceType_4
    670                ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   00002C   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   54F8         ANL     A,#0xf8
   \   000032   4402         ORL     A,#0x2
   \                     ??ZDAppDetermineDeviceType_3:
   \   000034   F0           MOVX    @DPTR,A
    671          
    672              // If AIB_apsUseExtendedPANID is set to a non-zero value by commissioning
    673              // The device shall do rejoin the network. Otherwise, do normal join
    674              if ( nwk_ExtPANIDValid( AIB_apsUseExtendedPANID ) == false )
   \                     ??ZDAppDetermineDeviceType_4:
   \   000035                ; Setup parameters for call to function nwk_ExtPANIDValid
   \   000035   7A..         MOV     R2,#(AIB_apsUseExtendedPANID & 0xff)
   \   000037   7B..         MOV     R3,#((AIB_apsUseExtendedPANID >> 8) & 0xff)
   \   000039   12....       LCALL   ??nwk_ExtPANIDValid?relay
   \   00003C   E9           MOV     A,R1
   \   00003D   7003         JNZ     ??ZDAppDetermineDeviceType_5
    675              {
    676                devStartMode = MODE_JOIN;     // Assume joining
   \   00003F   E4           CLR     A
   \   000040   8002         SJMP    ??ZDAppDetermineDeviceType_6
    677              }
    678              else
    679              {
    680                devStartMode = MODE_REJOIN;
   \                     ??ZDAppDetermineDeviceType_5:
   \   000042   7403         MOV     A,#0x3
   \                     ??ZDAppDetermineDeviceType_6:
   \   000044   90....       MOV     DPTR,#devStartMode
   \                     ??ZDAppDetermineDeviceType_1:
   \   000047   F0           MOVX    @DPTR,A
    681              }
    682            }
    683          }
   \   000048   D083         POP     DPH
   \   00004A   D082         POP     DPL
   \   00004C   02....       LJMP    ?BRET
    684          
    685          /*********************************************************************
    686           * @fn      ZDApp_NetworkStartEvt()
    687           *
    688           * @brief   Process the Network Start Event
    689           *
    690           * @param   none
    691           *
    692           * @return  none
    693           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    694          void ZDApp_NetworkStartEvt( void )
   \                     ZDApp_NetworkStartEvt:
    695          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    696            if ( nwkStatus == ZSuccess )
   \   000004   90....       MOV     DPTR,#nwkStatus
   \   000007   E0           MOVX    A,@DPTR
   \   000008   7012         JNZ     ??ZDApp_NetworkStartEvt_0
    697            {
    698              // Successfully started a ZigBee network
    699              if ( devState == DEV_COORD_STARTING )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6408         XRL     A,#0x8
   \   000010   7003         JNZ     ??ZDApp_NetworkStartEvt_1
    700              {
    701                devState = DEV_ZB_COORD;
   \   000012   7409         MOV     A,#0x9
   \   000014   F0           MOVX    @DPTR,A
    702              }
    703          
    704              osal_pwrmgr_device( PWRMGR_ALWAYS_ON );
   \                     ??ZDApp_NetworkStartEvt_1:
   \   000015                ; Setup parameters for call to function osal_pwrmgr_device
   \   000015   7900         MOV     R1,#0x0
   \   000017   12....       LCALL   ??osal_pwrmgr_device?relay
    705              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00001A                ; Setup parameters for call to function osal_set_event
   \   00001A   802D         SJMP    ??ZDApp_NetworkStartEvt_2
    706            }
    707            else
    708            {
    709              // Try again with a higher energy threshold !!
    710              if ( ( NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT ) < 0xff )
   \                     ??ZDApp_NetworkStartEvt_0:
   \   00001C                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   00001C   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   00001F   E9           MOV     A,R1
   \   000020   F8           MOV     R0,A
   \   000021   7410         MOV     A,#0x10
   \   000023   28           ADD     A,R0
   \   000024   F8           MOV     R0,A
   \   000025   E4           CLR     A
   \   000026   3400         ADDC    A,#0x0
   \   000028   F9           MOV     R1,A
   \   000029   E8           MOV     A,R0
   \   00002A   94FF         SUBB    A,#-0x1
   \   00002C   E9           MOV     A,R1
   \   00002D   9400         SUBB    A,#0x0
   \   00002F   C3           CLR     C
   \   000030   65D0         XRL     A,PSW
   \   000032   33           RLC     A
   \   000033   500E         JNC     ??ZDApp_NetworkStartEvt_3
    711              {
    712                NLME_SetEnergyThreshold( (uint8)(NLME_GetEnergyThreshold() + ENERGY_SCAN_INCREMENT) );
   \   000035                ; Setup parameters for call to function NLME_SetEnergyThreshold
   \   000035                ; Setup parameters for call to function NLME_GetEnergyThreshold
   \   000035   12....       LCALL   ??NLME_GetEnergyThreshold?relay
   \   000038   E9           MOV     A,R1
   \   000039   2410         ADD     A,#0x10
   \   00003B   F9           MOV     R1,A
   \   00003C   12....       LCALL   ??NLME_SetEnergyThreshold?relay
    713                osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \   00003F                ; Setup parameters for call to function osal_set_event
   \   00003F   7A01         MOV     R2,#0x1
   \   000041   8008         SJMP    ??ZDApp_NetworkStartEvt_4
    714              }
    715              else
    716              {
    717                // Failed to start network. Enter a dormant state (until user intervenes)
    718                devState = DEV_INIT;
   \                     ??ZDApp_NetworkStartEvt_3:
   \   000043   7401         MOV     A,#0x1
   \   000045   90....       MOV     DPTR,#devState
   \   000048   F0           MOVX    @DPTR,A
    719                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000049                ; Setup parameters for call to function osal_set_event
   \                     ??ZDApp_NetworkStartEvt_2:
   \   000049   7A10         MOV     R2,#0x10
   \                     ??ZDApp_NetworkStartEvt_4:
   \   00004B   7B00         MOV     R3,#0x0
   \   00004D   90....       MOV     DPTR,#ZDAppTaskID
   \   000050   E0           MOVX    A,@DPTR
   \   000051   F9           MOV     R1,A
   \   000052   12....       LCALL   ??osal_set_event?relay
    720              }
    721            }
    722          }
   \   000055   D083         POP     DPH
   \   000057   D082         POP     DPL
   \   000059   02....       LJMP    ?BRET
    723          
    724          /*********************************************************************
    725           * @fn      ZDApp_DeviceAuthEvt()
    726           *
    727           * @brief   Process the Device Authentic Event
    728           *
    729           * @param   none
    730           *
    731           * @return  none
    732           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    733          void ZDApp_DeviceAuthEvt( void )
   \                     ZDApp_DeviceAuthEvt:
    734          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    735            // received authentication from trust center
    736            if ( devState == DEV_END_DEVICE_UNAUTH )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6405         XRL     A,#0x5
   \   00000A   7046         JNZ     ??ZDApp_DeviceAuthEvt_0
    737            {
    738              // Stop the reset timer so it doesn't reset
    739              ZDApp_ResetTimerCancel();
   \   00000C                ; Setup parameters for call to function ZDApp_ResetTimerCancel
   \   00000C   12....       LCALL   ??ZDApp_ResetTimerCancel?relay
    740          
    741              devState = DEV_END_DEVICE;
   \   00000F   7406         MOV     A,#0x6
   \   000011   90....       MOV     DPTR,#devState
   \   000014   F0           MOVX    @DPTR,A
    742              osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000015                ; Setup parameters for call to function osal_set_event
   \   000015   7A10         MOV     R2,#0x10
   \   000017   7B00         MOV     R3,#0x0
   \   000019   90....       MOV     DPTR,#ZDAppTaskID
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F9           MOV     R1,A
   \   00001E   12....       LCALL   ??osal_set_event?relay
    743          
    744              // Set the Power Manager Device
    745          #if defined ( POWER_SAVING )
    746              osal_pwrmgr_device( PWRMGR_BATTERY );
    747          #endif
    748          
    749              if ( ZSTACK_ROUTER_BUILD )
    750              {
    751                if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \   000021   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000024   E0           MOVX    A,@DPTR
   \   000025   5407         ANL     A,#0x7
   \   000027   6402         XRL     A,#0x2
   \   000029   6009         JZ      ??ZDApp_DeviceAuthEvt_1
    752                {
    753                  // NOTE: first two parameters are not used, see NLMEDE.h for details
    754                  NLME_StartRouterRequest( 0, 0, false );
   \   00002B                ; Setup parameters for call to function NLME_StartRouterRequest
   \   00002B   7B00         MOV     R3,#0x0
   \   00002D   7A00         MOV     R2,#0x0
   \   00002F   7900         MOV     R1,#0x0
   \   000031   12....       LCALL   ??NLME_StartRouterRequest?relay
    755                }
    756              }
    757          
    758              // Notify to save info into NV
    759              ZDApp_NVUpdate();
   \                     ??ZDApp_DeviceAuthEvt_1:
   \   000034                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000034   12....       LCALL   ??ZDApp_NVUpdate?relay
    760          
    761              // Save off the security
    762              ZDApp_SaveNwkKey();
   \   000037                ; Setup parameters for call to function ZDApp_SaveNwkKey
   \   000037   12....       LCALL   ??ZDApp_SaveNwkKey?relay
    763          
    764              ZDApp_AnnounceNewAddress();
   \   00003A                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   00003A   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
    765          
    766              if ( (ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE) == 0 )
   \   00003D   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000040   E0           MOVX    A,@DPTR
   \   000041   A2E3         MOV     C,0xE0 /* A   */.3
   \   000043   4010         JC      ??ZDApp_DeviceAuthEvt_2
    767              {
    768                NLME_SetPollRate( ZDApp_SavedPollRate );
   \   000045                ; Setup parameters for call to function NLME_SetPollRate
   \   000045   90....       MOV     DPTR,#ZDApp_SavedPollRate
   \   000048   E0           MOVX    A,@DPTR
   \   000049   FA           MOV     R2,A
   \   00004A   A3           INC     DPTR
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   FB           MOV     R3,A
   \   00004D   12....       LCALL   ??NLME_SetPollRate?relay
   \   000050   8003         SJMP    ??ZDApp_DeviceAuthEvt_2
    769              }
    770            }
    771            else
    772            {
    773              ZDApp_NVUpdate();
   \                     ??ZDApp_DeviceAuthEvt_0:
   \   000052                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000052   12....       LCALL   ??ZDApp_NVUpdate?relay
    774            }
    775          }
   \                     ??ZDApp_DeviceAuthEvt_2:
   \   000055   D083         POP     DPH
   \   000057   D082         POP     DPL
   \   000059   02....       LJMP    ?BRET
    776          
    777          /*********************************************************************
    778           * @fn      ZDApp_SaveNetworkStateEvt()
    779           *
    780           * @brief   Process the Save the Network State Event
    781           *
    782           * @param   none
    783           *
    784           * @return  none
    785           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    786          void ZDApp_SaveNetworkStateEvt( void )
   \                     ZDApp_SaveNetworkStateEvt:
    787          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    788          #if defined ( NV_RESTORE )
    789           #if defined ( NV_TURN_OFF_RADIO )
    790            // Turn off the radio's receiver during an NV update
    791            uint8 RxOnIdle;
    792            uint8 x = false;
    793            ZMacGetReq( ZMacRxOnIdle, &RxOnIdle );
    794            ZMacSetReq( ZMacRxOnIdle, &x );
    795           #endif
    796          
    797            // Update the Network State in NV
    798            NLME_UpdateNV( NWK_NV_NIB_ENABLE        |
    799                           NWK_NV_DEVICELIST_ENABLE |
    800                           NWK_NV_BINDING_ENABLE    |
    801                           NWK_NV_ADDRMGR_ENABLE );
    802          
    803            // Reset the NV startup option to resume from NV by
    804            // clearing the "New" join option.
    805            zgWriteStartupOptions( FALSE, ZCD_STARTOPT_DEFAULT_NETWORK_STATE );
    806          
    807           #if defined ( NV_TURN_OFF_RADIO )
    808            ZMacSetReq( ZMacRxOnIdle, &RxOnIdle );
    809           #endif
    810          #endif  // NV_RESTORE
    811          }
   \   000000   02....       LJMP    ?BRET
    812          
    813          /*********************************************************************
    814           * @fn      ZDApp_RestoreNetworkState()
    815           *
    816           * @brief   This function will restore the network state of the
    817           *          device if the network state is stored in NV.
    818           *
    819           * @param   none
    820           *
    821           * @return
    822           *    ZDO_INITDEV_RESTORED_NETWORK_STATE  - The device's network state was
    823           *          restored.
    824           *    ZDO_INITDEV_NEW_NETWORK_STATE - The network state was not used.
    825           *          This could mean that zgStartupOption said to not restore, or
    826           *          it could mean that there was no network state to restore.
    827           *
    828           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    829          uint8 ZDApp_RestoreNetworkState( void )
   \                     ZDApp_RestoreNetworkState:
    830          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    831            uint8 nvStat;
    832            nwkActiveKeyItems keyItems;
    833          
    834            // Initialize NWK NV items
    835            nvStat = NLME_InitNV();
   \   000005                ; Setup parameters for call to function NLME_InitNV
   \   000005   12....       LCALL   ??NLME_InitNV?relay
   \   000008   E9           MOV     A,R1
   \   000009   FE           MOV     R6,A
    836          
    837            if ( nvStat != NV_OPER_FAILED )
   \   00000A   740A         MOV     A,#0xa
   \   00000C   6E           XRL     A,R6
   \   00000D   6037         JZ      ??ZDApp_RestoreNetworkState_0
    838            {
    839              if ( NLME_RestoreFromNV() )
   \   00000F                ; Setup parameters for call to function NLME_RestoreFromNV
   \   00000F   12....       LCALL   ??NLME_RestoreFromNV?relay
   \   000012   E9           MOV     A,R1
   \   000013   602F         JZ      ??ZDApp_RestoreNetworkState_1
    840              {
    841                // Are we a coordinator
    842                ZDAppNwkAddr.addr.shortAddr = NLME_GetShortAddr();
   \   000015                ; Setup parameters for call to function NLME_GetShortAddr
   \   000015   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000018   90....       MOV     DPTR,#ZDAppNwkAddr
   \   00001B   EA           MOV     A,R2
   \   00001C   F0           MOVX    @DPTR,A
   \   00001D   A3           INC     DPTR
   \   00001E   EB           MOV     A,R3
   \   00001F   F0           MOVX    @DPTR,A
    843                if ( ZDAppNwkAddr.addr.shortAddr == 0 )
   \   000020   90....       MOV     DPTR,#ZDAppNwkAddr
   \   000023   E0           MOVX    A,@DPTR
   \   000024   7002         JNZ     ??ZDApp_RestoreNetworkState_2
   \   000026   A3           INC     DPTR
   \   000027   E0           MOVX    A,@DPTR
   \                     ??ZDApp_RestoreNetworkState_2:
   \   000028   7007         JNZ     ??ZDApp_RestoreNetworkState_3
    844                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_COORDINATOR;
   \   00002A   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   54F8         ANL     A,#0xf8
   \   000030   F0           MOVX    @DPTR,A
    845                devStartMode = MODE_RESUME;
   \                     ??ZDApp_RestoreNetworkState_3:
   \   000031   7401         MOV     A,#0x1
   \   000033   90....       MOV     DPTR,#devStartMode
   \   000036   F0           MOVX    @DPTR,A
    846                osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
   \   000037                ; Setup parameters for call to function sAddrExtCpy
   \   000037   7C..         MOV     R4,#((_NIB + 53) & 0xff)
   \   000039   7D..         MOV     R5,#(((_NIB + 53) >> 8) & 0xff)
   \   00003B   7A..         MOV     R2,#(ZDO_UseExtendedPANID & 0xff)
   \   00003D   7B..         MOV     R3,#((ZDO_UseExtendedPANID >> 8) & 0xff)
   \   00003F   12....       LCALL   ??sAddrExtCpy?relay
   \   000042   8002         SJMP    ??ZDApp_RestoreNetworkState_0
    847              }
    848              else
    849                nvStat = NV_ITEM_UNINIT;
   \                     ??ZDApp_RestoreNetworkState_1:
   \   000044   7E09         MOV     R6,#0x9
    850          
    851              if ( ZG_SECURE_ENABLED )
    852              {
    853                nwkFrameCounterChanges = 0;
    854                osal_memset( &keyItems, 0, sizeof( nwkActiveKeyItems ) );
    855                osal_nv_item_init( ZCD_NV_NWKKEY, sizeof(nwkActiveKeyItems), (void *)&keyItems );
    856          
    857                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
    858                {
    859                  ZDApp_RestoreNwkKey();
    860                }
    861              }
    862          
    863              // The default for RxOnWhenIdle is true for Routers and false for end devices
    864              // [setup in the NLME_RestoreFromNV()].  Change it here if you want something
    865              // other than default.
    866            }
    867          
    868            if ( nvStat == ZSUCCESS )
   \                     ??ZDApp_RestoreNetworkState_0:
   \   000046   EE           MOV     A,R6
   \   000047   7004         JNZ     ??ZDApp_RestoreNetworkState_4
    869              return ( ZDO_INITDEV_RESTORED_NETWORK_STATE );
   \   000049   7900         MOV     R1,#0x0
   \   00004B   8002         SJMP    ??ZDApp_RestoreNetworkState_5
    870            else
    871              return ( ZDO_INITDEV_NEW_NETWORK_STATE );
   \                     ??ZDApp_RestoreNetworkState_4:
   \   00004D   7901         MOV     R1,#0x1
   \                     ??ZDApp_RestoreNetworkState_5:
   \   00004F   7F01         MOV     R7,#0x1
   \   000051   02....       LJMP    ?BANKED_LEAVE_XDATA
    872          }
    873          
    874          /*********************************************************************
    875           * @fn      ZDApp_InitUserDesc()
    876           *
    877           * @brief   Initialize the User Descriptor, the descriptor is read from NV
    878           *          when needed.  If you want to initialize the User descriptor to
    879           *          something other than all zero, do it here.
    880           *
    881           * @param   none
    882           *
    883           * @return  none
    884           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    885          void ZDApp_InitUserDesc( void )
   \                     ZDApp_InitUserDesc:
    886          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 17
   \   000005   74EF         MOV     A,#-0x11
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    887            UserDescriptorFormat_t ZDO_DefaultUserDescriptor;
    888          
    889            // Initialize the User Descriptor, the descriptor is read from NV
    890            // when needed.  If you want to initialize the User descriptor to something
    891            // other than all zero, do it here.
    892            osal_memset( &ZDO_DefaultUserDescriptor, 0, sizeof( UserDescriptorFormat_t ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C11         MOV     R4,#0x11
   \   00000C   7D00         MOV     R5,#0x0
   \   00000E   7900         MOV     R1,#0x0
   \   000010   85..82       MOV     DPL,?XSP + 0
   \   000013   85..83       MOV     DPH,?XSP + 1
   \   000016   AA82         MOV     R2,DPL
   \   000018   AB83         MOV     R3,DPH
   \   00001A   12....       LCALL   ??osal_memset?relay
    893            if ( ZSUCCESS == osal_nv_item_init( ZCD_NV_USERDESC,
    894                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \   00001D                ; Setup parameters for call to function osal_nv_item_init
   \   00001D   85..82       MOV     DPL,?XSP + 0
   \   000020   85..83       MOV     DPH,?XSP + 1
   \   000023   8582..       MOV     ?V0 + 0,DPL
   \   000026   8583..       MOV     ?V0 + 1,DPH
   \   000029   78..         MOV     R0,#?V0 + 0
   \   00002B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002E   7C11         MOV     R4,#0x11
   \   000030   7D00         MOV     R5,#0x0
   \   000032   7A81         MOV     R2,#-0x7f
   \   000034   7B00         MOV     R3,#0x0
   \   000036   12....       LCALL   ??osal_nv_item_init?relay
   \   000039   7402         MOV     A,#0x2
   \   00003B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00003E   E9           MOV     A,R1
   \   00003F   7033         JNZ     ??ZDApp_InitUserDesc_0
    895            {
    896              if ( ZSUCCESS == osal_nv_read( ZCD_NV_USERDESC, 0,
    897                   sizeof(UserDescriptorFormat_t), (void*)&ZDO_DefaultUserDescriptor ) )
   \   000041                ; Setup parameters for call to function osal_nv_read
   \   000041   78..         MOV     R0,#?V0 + 0
   \   000043   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000046   75..11       MOV     ?V0 + 0,#0x11
   \   000049   75..00       MOV     ?V0 + 1,#0x0
   \   00004C   78..         MOV     R0,#?V0 + 0
   \   00004E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000051   7C00         MOV     R4,#0x0
   \   000053   7D00         MOV     R5,#0x0
   \   000055   7A81         MOV     R2,#-0x7f
   \   000057   7B00         MOV     R3,#0x0
   \   000059   12....       LCALL   ??osal_nv_read?relay
   \   00005C   7404         MOV     A,#0x4
   \   00005E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000061   E9           MOV     A,R1
   \   000062   7010         JNZ     ??ZDApp_InitUserDesc_0
    898              {
    899                if ( ZDO_DefaultUserDescriptor.len != 0 )
   \   000064   85..82       MOV     DPL,?XSP + 0
   \   000067   85..83       MOV     DPH,?XSP + 1
   \   00006A   E0           MOVX    A,@DPTR
   \   00006B   6007         JZ      ??ZDApp_InitUserDesc_0
    900                {
    901                  ZDO_Config_Node_Descriptor.UserDescAvail = TRUE;
   \   00006D   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000070   E0           MOVX    A,@DPTR
   \   000071   D2E4         SETB    0xE0 /* A   */.4
   \   000073   F0           MOVX    @DPTR,A
    902                }
    903              }
    904            }
    905          }
   \                     ??ZDApp_InitUserDesc_0:
   \   000074   7411         MOV     A,#0x11
   \   000076   12....       LCALL   ?DEALLOC_XSTACK8
   \   000079   7F02         MOV     R7,#0x2
   \   00007B   02....       LJMP    ?BANKED_LEAVE_XDATA
    906          
    907          /*********************************************************************
    908           * @fn      ZDAppCheckForHoldKey()
    909           *
    910           * @brief   Check for key to set the device into Hold Auto Start
    911           *
    912           * @param   none
    913           *
    914           * @return  none
    915           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    916          void ZDAppCheckForHoldKey( void )
   \                     ZDAppCheckForHoldKey:
    917          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    918          #if (defined HAL_KEY) && (HAL_KEY == TRUE)
    919            // Get Keypad directly to see if a HOLD_START is needed.
    920            // Hold down the SW_BYPASS_START key (see OnBoard.h)
    921            // while booting to avoid starting up the device.
    922            if ( HalKeyRead () == SW_BYPASS_START)
   \   000004                ; Setup parameters for call to function HalKeyRead
   \   000004   12....       LCALL   ??HalKeyRead?relay
   \   000007   E9           MOV     A,R1
   \   000008   6401         XRL     A,#0x1
   \   00000A   7005         JNZ     ??ZDAppCheckForHoldKey_0
    923            {
    924              // Change the device state to HOLD on start up
    925              devState = DEV_HOLD;
   \   00000C   E4           CLR     A
   \   00000D   90....       MOV     DPTR,#devState
   \   000010   F0           MOVX    @DPTR,A
    926            }
    927          #endif // HAL_KEY
    928          }
   \                     ??ZDAppCheckForHoldKey_0:
   \   000011   D083         POP     DPH
   \   000013   D082         POP     DPL
   \   000015   02....       LJMP    ?BRET
    929          
    930          /*********************************************************************
    931           * @fn      ZDApp_ProcessOSALMsg()
    932           *
    933           * @brief   Process the incoming task message.
    934           *
    935           * @param   msgPtr - message to process
    936           *
    937           * @return  none
    938           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    939          void ZDApp_ProcessOSALMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessOSALMsg:
    940          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    941            // Data Confirmation message fields
    942            uint8 sentEP;       // This should always be 0
    943            uint8 sentStatus;
    944            afDataConfirm_t *afDataConfirm;
    945            uint8 tmp;
    946          
    947            switch ( msgPtr->event )
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   E0           MOVX    A,@DPTR
   \   000013   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessOSALMsg>_0`:
   \   000016   00           DB        0
   \   000017   06           DB        6
   \   000018   01           DB        1
   \   000019   ....         DW        ??ZDApp_ProcessOSALMsg_0
   \   00001B   02           DB        2
   \   00001C   ....         DW        ??ZDApp_ProcessOSALMsg_1
   \   00001E   03           DB        3
   \   00001F   ....         DW        ??ZDApp_ProcessOSALMsg_2
   \   000021   1A           DB        26
   \   000022   ....         DW        ??ZDApp_ProcessOSALMsg_3
   \   000024   D3           DB        211
   \   000025   ....         DW        ??ZDApp_ProcessOSALMsg_4
   \   000027   FD           DB        253
   \   000028   ....         DW        ??ZDApp_ProcessOSALMsg_5
   \   00002A   ....         DW        ??ZDApp_ProcessOSALMsg_6
    948            {
    949              // Incoming ZDO Message
    950              case AF_INCOMING_MSG_CMD:
    951                ZDP_IncomingData( (afIncomingMSGPacket_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_3:
   \   00002C                ; Setup parameters for call to function ZDP_IncomingData
   \   00002C   12....       LCALL   ??ZDP_IncomingData?relay
   \   00002F   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
    952                break;
    953          
    954              case ZDO_CB_MSG:
    955                ZDApp_ProcessMsgCBs( (zdoIncomingMsg_t *)msgPtr );
   \                     ??ZDApp_ProcessOSALMsg_4:
   \   000032                ; Setup parameters for call to function ZDApp_ProcessMsgCBs
   \   000032   12....       LCALL   ??ZDApp_ProcessMsgCBs?relay
   \   000035   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
    956                break;
    957          
    958              case AF_DATA_CONFIRM_CMD:
    959                // This message is received as a confirmation of a data packet sent.
    960                // The status is of ZStatus_t type [defined in NLMEDE.h]
    961                // The message fields are defined in AF.h
    962                afDataConfirm = (afDataConfirm_t *)msgPtr;
    963                sentEP = afDataConfirm->endpoint;
    964                sentStatus = afDataConfirm->hdr.status;
    965          
    966                // Action taken when confirmation is received.
    967          #if defined ( ZIGBEE_FREQ_AGILITY )
    968                if ( pZDNwkMgr_ProcessDataConfirm )
   \                     ??ZDApp_ProcessOSALMsg_5:
   \   000038   90....       MOV     DPTR,#pZDNwkMgr_ProcessDataConfirm
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   7002         JNZ     ??ZDApp_ProcessOSALMsg_7
   \   00003E   A3           INC     DPTR
   \   00003F   E0           MOVX    A,@DPTR
   \                     ??ZDApp_ProcessOSALMsg_7:
   \   000040   7003         JNZ     $+5
   \   000042   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
    969                  pZDNwkMgr_ProcessDataConfirm( afDataConfirm );
   \   000045                ; Setup parameters for indirect call
   \   000045   90....       MOV     DPTR,#pZDNwkMgr_ProcessDataConfirm
   \   000048   E0           MOVX    A,@DPTR
   \   000049   F8           MOV     R0,A
   \   00004A   A3           INC     DPTR
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   F583         MOV     DPH,A
   \   00004E   8882         MOV     DPL,R0
   \   000050   12....       LCALL   ?CALL_IND
   \   000053   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
    970          #endif
    971                (void)sentEP;
    972                (void)sentStatus;
    973                break;
    974          
    975              case ZDO_NWK_DISC_CNF:
    976                if (devState != DEV_NWK_DISC)
   \                     ??ZDApp_ProcessOSALMsg_0:
   \   000056   90....       MOV     DPTR,#devState
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   6402         XRL     A,#0x2
   \   00005C   6003         JZ      $+5
   \   00005E   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
    977                  break;
    978          
    979                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \   000061   90....       MOV     DPTR,#zgDeviceLogicalType
   \   000064   E0           MOVX    A,@DPTR
   \   000065   6401         XRL     A,#0x1
   \   000067   6008         JZ      ??ZDApp_ProcessOSALMsg_8
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   6402         XRL     A,#0x2
   \   00006C   6003         JZ      $+5
   \   00006E   02....       LJMP    ??ZDApp_ProcessOSALMsg_6 & 0xFFFF
    980                {
    981                  if ( (((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->hdr.status == ZDO_SUCCESS) && (zdoDiscCounter > NUM_DISC_ATTEMPTS) )
   \                     ??ZDApp_ProcessOSALMsg_8:
   \   000071   8E82         MOV     DPL,R6
   \   000073   8F83         MOV     DPH,R7
   \   000075   A3           INC     DPTR
   \   000076   E0           MOVX    A,@DPTR
   \   000077   6003         JZ      $+5
   \   000079   02....       LJMP    ??ZDApp_ProcessOSALMsg_9 & 0xFFFF
   \   00007C   90....       MOV     DPTR,#zdoDiscCounter
   \   00007F   E0           MOVX    A,@DPTR
   \   000080   C3           CLR     C
   \   000081   9403         SUBB    A,#0x3
   \   000083   5003         JNC     $+5
   \   000085   02....       LJMP    ??ZDApp_ProcessOSALMsg_9 & 0xFFFF
    982                  {
    983                    if ( devStartMode == MODE_JOIN )
   \   000088   90....       MOV     DPTR,#devStartMode
   \   00008B   E0           MOVX    A,@DPTR
   \   00008C   7042         JNZ     ??ZDApp_ProcessOSALMsg_10
    984                    {
    985                      devState = DEV_NWK_JOINING;
   \   00008E   7403         MOV     A,#0x3
   \   000090   90....       MOV     DPTR,#devState
   \   000093   F0           MOVX    @DPTR,A
    986          
    987                      ZDApp_NodeProfileSync((ZDO_NetworkDiscoveryCfm_t *)msgPtr);
   \   000094                ; Setup parameters for call to function ZDApp_NodeProfileSync
   \   000094   12....       LCALL   ??ZDApp_NodeProfileSync?relay
    988          
    989                      if ( NLME_JoinRequest( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->extendedPANID,
    990                           BUILD_UINT16( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdLSB, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdMSB ),
    991                           ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->logicalChannel,
    992                           ZDO_Config_Node_Descriptor.CapabilityFlags ) != ZSuccess )
   \   000097                ; Setup parameters for call to function NLME_JoinRequest
   \   000097   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   00009A   E0           MOVX    A,@DPTR
   \   00009B   F5..         MOV     ?V0 + 0,A
   \   00009D   78..         MOV     R0,#?V0 + 0
   \   00009F   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000A2   8E82         MOV     DPL,R6
   \   0000A4   8F83         MOV     DPH,R7
   \   0000A6   A3           INC     DPTR
   \   0000A7   A3           INC     DPTR
   \   0000A8   A3           INC     DPTR
   \   0000A9   A3           INC     DPTR
   \   0000AA   E0           MOVX    A,@DPTR
   \   0000AB   F9           MOV     R1,A
   \   0000AC   8E82         MOV     DPL,R6
   \   0000AE   8F83         MOV     DPH,R7
   \   0000B0   A3           INC     DPTR
   \   0000B1   A3           INC     DPTR
   \   0000B2   E0           MOVX    A,@DPTR
   \   0000B3   FC           MOV     R4,A
   \   0000B4   8E82         MOV     DPL,R6
   \   0000B6   8F83         MOV     DPH,R7
   \   0000B8   A3           INC     DPTR
   \   0000B9   A3           INC     DPTR
   \   0000BA   A3           INC     DPTR
   \   0000BB   E0           MOVX    A,@DPTR
   \   0000BC   FD           MOV     R5,A
   \   0000BD   EE           MOV     A,R6
   \   0000BE   2406         ADD     A,#0x6
   \   0000C0   FA           MOV     R2,A
   \   0000C1   EF           MOV     A,R7
   \   0000C2   3400         ADDC    A,#0x0
   \   0000C4   FB           MOV     R3,A
   \   0000C5   12....       LCALL   ??NLME_JoinRequest?relay
   \   0000C8   7401         MOV     A,#0x1
   \   0000CA   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000CD   02....       LJMP    ??ZDApp_ProcessOSALMsg_11 & 0xFFFF
    993                      {
    994                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
    995                            + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
    996                      }
    997                    }
    998                    else if ( devStartMode == MODE_REJOIN )
   \                     ??ZDApp_ProcessOSALMsg_10:
   \   0000D0   E0           MOVX    A,@DPTR
   \   0000D1   6403         XRL     A,#0x3
   \   0000D3   6003         JZ      $+5
   \   0000D5   02....       LJMP    ??ZDApp_ProcessOSALMsg_12 & 0xFFFF
    999                    {
   1000                      devState = DEV_NWK_REJOIN;
   \   0000D8   7404         MOV     A,#0x4
   \   0000DA   90....       MOV     DPTR,#devState
   \   0000DD   F0           MOVX    @DPTR,A
   1001          
   1002                      // Before trying to do rejoin, check if the device has a valid short address
   1003                      // If not, generate a random short address for itself
   1004                      if ( _NIB.nwkDevAddress == INVALID_NODE_ADDR )
   \   0000DE   90....       MOV     DPTR,#(_NIB + 20)
   \   0000E1   E0           MOVX    A,@DPTR
   \   0000E2   64FE         XRL     A,#0xfe
   \   0000E4   7004         JNZ     ??ZDApp_ProcessOSALMsg_13
   \   0000E6   A3           INC     DPTR
   \   0000E7   E0           MOVX    A,@DPTR
   \   0000E8   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessOSALMsg_13:
   \   0000EA   7014         JNZ     ??ZDApp_ProcessOSALMsg_14
   1005                      {
   1006                        _NIB.nwkDevAddress = osal_rand();
   \   0000EC                ; Setup parameters for call to function osal_rand
   \   0000EC   12....       LCALL   ??osal_rand?relay
   \   0000EF   90....       MOV     DPTR,#(_NIB + 20)
   \   0000F2   EA           MOV     A,R2
   \   0000F3   F0           MOVX    @DPTR,A
   \   0000F4   A3           INC     DPTR
   \   0000F5   EB           MOV     A,R3
   \   0000F6   F0           MOVX    @DPTR,A
   1007                        ZMacSetReq( ZMacShortAddress, (byte*)&_NIB.nwkDevAddress );
   \   0000F7                ; Setup parameters for call to function ZMacSetReq
   \   0000F7   7A..         MOV     R2,#((_NIB + 20) & 0xff)
   \   0000F9   7B..         MOV     R3,#(((_NIB + 20) >> 8) & 0xff)
   \   0000FB   7953         MOV     R1,#0x53
   \   0000FD   12....       LCALL   ??ZMacSetReq?relay
   1008                      }
   1009          
   1010                      if ( ZG_SECURE_ENABLED )
   1011                      {
   1012                        ZDApp_RestoreNwkKey();
   1013                      }
   1014                      
   1015                      // Check if the device has a valid PanID, if not, set it to the discovered Pan
   1016                      if ( _NIB.nwkPanId == INVALID_PAN_ID )
   \                     ??ZDApp_ProcessOSALMsg_14:
   \   000100   90....       MOV     DPTR,#(_NIB + 33)
   \   000103   E0           MOVX    A,@DPTR
   \   000104   64FE         XRL     A,#0xfe
   \   000106   7004         JNZ     ??ZDApp_ProcessOSALMsg_15
   \   000108   A3           INC     DPTR
   \   000109   E0           MOVX    A,@DPTR
   \   00010A   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessOSALMsg_15:
   \   00010C   7022         JNZ     ??ZDApp_ProcessOSALMsg_16
   1017                      {
   1018                        _NIB.nwkPanId = BUILD_UINT16( ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdLSB, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->panIdMSB );
   \   00010E   8E82         MOV     DPL,R6
   \   000110   8F83         MOV     DPH,R7
   \   000112   A3           INC     DPTR
   \   000113   A3           INC     DPTR
   \   000114   E0           MOVX    A,@DPTR
   \   000115   FA           MOV     R2,A
   \   000116   8E82         MOV     DPL,R6
   \   000118   8F83         MOV     DPH,R7
   \   00011A   A3           INC     DPTR
   \   00011B   A3           INC     DPTR
   \   00011C   A3           INC     DPTR
   \   00011D   E0           MOVX    A,@DPTR
   \   00011E   F9           MOV     R1,A
   \   00011F   EA           MOV     A,R2
   \   000120   90....       MOV     DPTR,#(_NIB + 33)
   \   000123   F0           MOVX    @DPTR,A
   \   000124   A3           INC     DPTR
   \   000125   E9           MOV     A,R1
   \   000126   F0           MOVX    @DPTR,A
   1019                        ZMacSetReq( ZMacPanId, (byte*)&(_NIB.nwkPanId) );
   \   000127                ; Setup parameters for call to function ZMacSetReq
   \   000127   7A..         MOV     R2,#((_NIB + 33) & 0xff)
   \   000129   7B..         MOV     R3,#(((_NIB + 33) >> 8) & 0xff)
   \   00012B   7950         MOV     R1,#0x50
   \   00012D   12....       LCALL   ??ZMacSetReq?relay
   1020                      }
   1021          
   1022                      tmp = true;
   \                     ??ZDApp_ProcessOSALMsg_16:
   \   000130   7401         MOV     A,#0x1
   \   000132   85..82       MOV     DPL,?XSP + 0
   \   000135   85..83       MOV     DPH,?XSP + 1
   \   000138   F0           MOVX    @DPTR,A
   1023                      ZMacSetReq( ZMacRxOnIdle, &tmp ); // Set receiver always on during rejoin
   \   000139                ; Setup parameters for call to function ZMacSetReq
   \   000139   AA82         MOV     R2,DPL
   \   00013B   AB83         MOV     R3,DPH
   \   00013D   7952         MOV     R1,#0x52
   \   00013F   12....       LCALL   ??ZMacSetReq?relay
   1024                      if ( NLME_ReJoinRequest( ZDO_UseExtendedPANID, ((ZDO_NetworkDiscoveryCfm_t *)msgPtr)->logicalChannel) != ZSuccess )
   \   000142                ; Setup parameters for call to function NLME_ReJoinRequest
   \   000142   8E82         MOV     DPL,R6
   \   000144   8F83         MOV     DPH,R7
   \   000146   A3           INC     DPTR
   \   000147   A3           INC     DPTR
   \   000148   A3           INC     DPTR
   \   000149   A3           INC     DPTR
   \   00014A   E0           MOVX    A,@DPTR
   \   00014B   F9           MOV     R1,A
   \   00014C   7A..         MOV     R2,#(ZDO_UseExtendedPANID & 0xff)
   \   00014E   7B..         MOV     R3,#((ZDO_UseExtendedPANID >> 8) & 0xff)
   \   000150   12....       LCALL   ??NLME_ReJoinRequest?relay
   \                     ??ZDApp_ProcessOSALMsg_11:
   \   000153   E9           MOV     A,R1
   \   000154   6013         JZ      ??ZDApp_ProcessOSALMsg_12
   1025                      {
   1026                        ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1027                            + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   000156                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000156                ; Setup parameters for call to function osal_rand
   \   000156   12....       LCALL   ??osal_rand?relay
   \   000159   8A..         MOV     ?V0 + 0,R2
   \   00015B   747F         MOV     A,#0x7f
   \   00015D   55..         ANL     A,?V0 + 0
   \   00015F   F8           MOV     R0,A
   \   000160   7464         MOV     A,#0x64
   \   000162   28           ADD     A,R0
   \   000163   FA           MOV     R2,A
   \   000164   7B00         MOV     R3,#0x0
   \   000166   12....       LCALL   ??ZDApp_NetworkInit?relay
   1028                      }
   1029                    }
   1030          
   1031                    if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \                     ??ZDApp_ProcessOSALMsg_12:
   \   000169   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   00016C   E0           MOVX    A,@DPTR
   \   00016D   A2E3         MOV     C,0xE0 /* A   */.3
   \   00016F   507D         JNC     ??ZDApp_ProcessOSALMsg_6
   1032                    {
   1033                      // The receiver is on, turn network layer polling off.
   1034                      NLME_SetPollRate( 0 );
   \   000171                ; Setup parameters for call to function NLME_SetPollRate
   \   000171   7A00         MOV     R2,#0x0
   \   000173   7B00         MOV     R3,#0x0
   \   000175   12....       LCALL   ??NLME_SetPollRate?relay
   1035                      NLME_SetQueuedPollRate( 0 );
   \   000178                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   000178   7A00         MOV     R2,#0x0
   \   00017A   7B00         MOV     R3,#0x0
   \   00017C   12....       LCALL   ??NLME_SetQueuedPollRate?relay
   1036                      NLME_SetResponseRate( 0 );
   \   00017F                ; Setup parameters for call to function NLME_SetResponseRate
   \   00017F   7A00         MOV     R2,#0x0
   \   000181   7B00         MOV     R3,#0x0
   \   000183   12....       LCALL   ??NLME_SetResponseRate?relay
   \   000186   8066         SJMP    ??ZDApp_ProcessOSALMsg_6
   1037                    }
   1038                    else
   1039                    {
   1040                      if ( (ZG_SECURE_ENABLED) && (devStartMode == MODE_JOIN) )
   1041                      {
   1042                        ZDApp_SavedPollRate = zgPollRate;
   1043                        NLME_SetPollRate( zgRejoinPollRate );
   1044                      }
   1045                    }
   1046                  }
   1047                  else
   1048                  {
   1049                    if ( continueJoining )
   \                     ??ZDApp_ProcessOSALMsg_9:
   \   000188   90....       MOV     DPTR,#continueJoining
   \   00018B   E0           MOVX    A,@DPTR
   \   00018C   6060         JZ      ??ZDApp_ProcessOSALMsg_6
   1050                    {
   1051              #if defined ( MANAGED_SCAN )
   1052                      ZDApp_NetworkInit( MANAGEDSCAN_DELAY_BETWEEN_SCANS );
   1053              #else
   1054                      zdoDiscCounter++;
   \   00018E   90....       MOV     DPTR,#zdoDiscCounter
   \   000191   E0           MOVX    A,@DPTR
   \   000192   04           INC     A
   \   000193   F0           MOVX    @DPTR,A
   1055                      ZDApp_NetworkInit( (uint16)(BEACON_REQUEST_DELAY
   1056                            + ((uint16)(osal_rand()& BEACON_REQ_DELAY_MASK))) );
   \   000194                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000194                ; Setup parameters for call to function osal_rand
   \   000194   12....       LCALL   ??osal_rand?relay
   \   000197   8A..         MOV     ?V0 + 0,R2
   \   000199   74FF         MOV     A,#-0x1
   \   00019B   55..         ANL     A,?V0 + 0
   \   00019D   F8           MOV     R0,A
   \   00019E   7464         MOV     A,#0x64
   \   0001A0   28           ADD     A,R0
   \   0001A1   FA           MOV     R2,A
   \   0001A2   E4           CLR     A
   \   0001A3   3400         ADDC    A,#0x0
   \   0001A5   FB           MOV     R3,A
   \   0001A6   8043         SJMP    ??ZDApp_ProcessOSALMsg_17
   1057              #endif
   1058                    }
   1059                  }
   1060                }
   1061                break;
   1062          
   1063              case ZDO_NWK_JOIN_IND:
   1064                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessOSALMsg_1:
   \   0001A8   90....       MOV     DPTR,#zgDeviceLogicalType
   \   0001AB   E0           MOVX    A,@DPTR
   \   0001AC   6401         XRL     A,#0x1
   \   0001AE   6005         JZ      ??ZDApp_ProcessOSALMsg_18
   \   0001B0   E0           MOVX    A,@DPTR
   \   0001B1   6402         XRL     A,#0x2
   \   0001B3   7039         JNZ     ??ZDApp_ProcessOSALMsg_6
   1065                {
   1066                  ZDApp_ProcessNetworkJoin();
   \                     ??ZDApp_ProcessOSALMsg_18:
   \   0001B5                ; Setup parameters for call to function ZDApp_ProcessNetworkJoin
   \   0001B5   12....       LCALL   ??ZDApp_ProcessNetworkJoin?relay
   \   0001B8   8034         SJMP    ??ZDApp_ProcessOSALMsg_6
   1067                }
   1068                break;
   1069          
   1070              case ZDO_NWK_JOIN_REQ:
   1071                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessOSALMsg_2:
   \   0001BA   90....       MOV     DPTR,#zgDeviceLogicalType
   \   0001BD   E0           MOVX    A,@DPTR
   \   0001BE   6401         XRL     A,#0x1
   \   0001C0   6005         JZ      ??ZDApp_ProcessOSALMsg_19
   \   0001C2   E0           MOVX    A,@DPTR
   \   0001C3   6402         XRL     A,#0x2
   \   0001C5   7027         JNZ     ??ZDApp_ProcessOSALMsg_6
   1072                {
   1073                  retryCnt = 0;
   \                     ??ZDApp_ProcessOSALMsg_19:
   \   0001C7   E4           CLR     A
   \   0001C8   90....       MOV     DPTR,#retryCnt
   \   0001CB   F0           MOVX    @DPTR,A
   1074                  devStartMode = MODE_RESUME;
   \   0001CC   7401         MOV     A,#0x1
   \   0001CE   90....       MOV     DPTR,#devStartMode
   \   0001D1   F0           MOVX    @DPTR,A
   1075                  _tmpRejoinState = true;
   \   0001D2   90....       MOV     DPTR,#_tmpRejoinState
   \   0001D5   F0           MOVX    @DPTR,A
   1076                  osal_cpyExtAddr( ZDO_UseExtendedPANID, _NIB.extendedPANID );
   \   0001D6                ; Setup parameters for call to function sAddrExtCpy
   \   0001D6   7C..         MOV     R4,#((_NIB + 53) & 0xff)
   \   0001D8   7D..         MOV     R5,#(((_NIB + 53) >> 8) & 0xff)
   \   0001DA   7A..         MOV     R2,#(ZDO_UseExtendedPANID & 0xff)
   \   0001DC   7B..         MOV     R3,#((ZDO_UseExtendedPANID >> 8) & 0xff)
   \   0001DE   12....       LCALL   ??sAddrExtCpy?relay
   1077                  zgDefaultStartingScanDuration = BEACON_ORDER_60_MSEC;
   \   0001E1   7402         MOV     A,#0x2
   \   0001E3   90....       MOV     DPTR,#zgDefaultStartingScanDuration
   \   0001E6   F0           MOVX    @DPTR,A
   1078                  ZDApp_NetworkInit( 0 );
   \   0001E7                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0001E7   7A00         MOV     R2,#0x0
   \   0001E9   7B00         MOV     R3,#0x0
   \                     ??ZDApp_ProcessOSALMsg_17:
   \   0001EB   12....       LCALL   ??ZDApp_NetworkInit?relay
   1079                }
   1080                break;
   1081          
   1082              default:
   1083                if ( ZG_SECURE_ENABLED )
   1084                  ZDApp_ProcessSecMsg( msgPtr );
   1085                break;
   1086            }
   1087          
   1088          }
   \                     ??ZDApp_ProcessOSALMsg_6:
   \   0001EE   7401         MOV     A,#0x1
   \   0001F0   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001F3   7F02         MOV     R7,#0x2
   \   0001F5   02....       LJMP    ?BANKED_LEAVE_XDATA
   1089          
   1090          /*********************************************************************
   1091           * @fn      ZDApp_ProcessMsgCBs()
   1092           *
   1093           * @brief   Process response messages
   1094           *
   1095           * @param   none
   1096           *
   1097           * @return  none
   1098           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1099          void ZDApp_ProcessMsgCBs( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_ProcessMsgCBs:
   1100          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   1101            switch ( inMsg->clusterID )
   \   00000E   EE           MOV     A,R6
   \   00000F   240C         ADD     A,#0xc
   \   000011   F582         MOV     DPL,A
   \   000013   EF           MOV     A,R7
   \   000014   3400         ADDC    A,#0x0
   \   000016   F583         MOV     DPH,A
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F5..         MOV     ?V0 + 0,A
   \   00001B   A3           INC     DPTR
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F5..         MOV     ?V0 + 1,A
   \   00001F   78..         MOV     R0,#?V0 + 0
   \   000021   12....       LCALL   ?US_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessMsgCBs>_0`:
   \   000024   0200         DW        2
   \   000026   2100         DW        33
   \   000028   2200         DW        34
   \   00002A   ....         DW        ??ZDApp_ProcessMsgCBs_0
   \   00002C   0080         DW        32768
   \   00002E   0180         DW        32769
   \   000030   ....         DW        ??ZDApp_ProcessMsgCBs_1
   \   000032   0000         DW        0
   \   000034   ....         DW        ??ZDApp_ProcessMsgCBs_2
   1102            {
   1103          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1104              case NWK_addr_rsp:
   1105              case IEEE_addr_rsp:
   1106                {
   1107                  ZDO_NwkIEEEAddrResp_t *pAddrRsp;
   1108                  pAddrRsp = ZDO_ParseAddrRsp( inMsg );
   \                     ??ZDApp_ProcessMsgCBs_1:
   \   000036                ; Setup parameters for call to function ZDO_ParseAddrRsp
   \   000036   12....       LCALL   ??ZDO_ParseAddrRsp?relay
   \   000039   8A..         MOV     ?V0 + 0,R2
   \   00003B   8B..         MOV     ?V0 + 1,R3
   \   00003D   AE..         MOV     R6,?V0 + 0
   \   00003F   AF..         MOV     R7,?V0 + 1
   1109                  if ( pAddrRsp )
   \   000041   EE           MOV     A,R6
   \   000042   7001         JNZ     ??ZDApp_ProcessMsgCBs_3
   \   000044   EF           MOV     A,R7
   \                     ??ZDApp_ProcessMsgCBs_3:
   \   000045   603F         JZ      ??ZDApp_ProcessMsgCBs_2
   1110                  {
   1111                    if ( pAddrRsp->status == ZSuccess )
   \   000047   8E82         MOV     DPL,R6
   \   000049   8F83         MOV     DPH,R7
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   7011         JNZ     ??ZDApp_ProcessMsgCBs_4
   1112                    {
   1113                      ZDO_UpdateAddrManager( pAddrRsp->nwkAddr, pAddrRsp->extAddr );
   \   00004E                ; Setup parameters for call to function ZDO_UpdateAddrManager
   \   00004E   EE           MOV     A,R6
   \   00004F   2403         ADD     A,#0x3
   \   000051   FC           MOV     R4,A
   \   000052   EF           MOV     A,R7
   \   000053   3400         ADDC    A,#0x0
   \   000055   FD           MOV     R5,A
   \   000056   A3           INC     DPTR
   \   000057   E0           MOVX    A,@DPTR
   \   000058   FA           MOV     R2,A
   \   000059   A3           INC     DPTR
   \   00005A   E0           MOVX    A,@DPTR
   \   00005B   FB           MOV     R3,A
   \   00005C   12....       LCALL   ??ZDO_UpdateAddrManager?relay
   1114                    }
   1115                    osal_mem_free( pAddrRsp );
   \                     ??ZDApp_ProcessMsgCBs_4:
   \   00005F                ; Setup parameters for call to function osal_mem_free
   \   00005F   EE           MOV     A,R6
   \   000060   FA           MOV     R2,A
   \   000061   EF           MOV     A,R7
   \   000062   FB           MOV     R3,A
   \   000063   12....       LCALL   ??osal_mem_free?relay
   \   000066   801E         SJMP    ??ZDApp_ProcessMsgCBs_2
   1116                  }
   1117                }
   1118                break;
   1119          #endif
   1120          
   1121          #if defined ( REFLECTOR )
   1122              case Bind_req:
   1123              case Unbind_req:
   1124                {
   1125                  ZDO_BindUnbindReq_t bindReq;
   1126                  ZDO_ParseBindUnbindReq( inMsg, &bindReq );
   \                     ??ZDApp_ProcessMsgCBs_0:
   \   000068                ; Setup parameters for call to function ZDO_ParseBindUnbindReq
   \   000068   85..82       MOV     DPL,?XSP + 0
   \   00006B   85..83       MOV     DPH,?XSP + 1
   \   00006E   AC82         MOV     R4,DPL
   \   000070   AD83         MOV     R5,DPH
   \   000072   12....       LCALL   ??ZDO_ParseBindUnbindReq?relay
   1127                  ZDO_ProcessBindUnbindReq( inMsg, &bindReq );
   \   000075                ; Setup parameters for call to function ZDO_ProcessBindUnbindReq
   \   000075   85..82       MOV     DPL,?XSP + 0
   \   000078   85..83       MOV     DPH,?XSP + 1
   \   00007B   AC82         MOV     R4,DPL
   \   00007D   AD83         MOV     R5,DPH
   \   00007F   EE           MOV     A,R6
   \   000080   FA           MOV     R2,A
   \   000081   EF           MOV     A,R7
   \   000082   FB           MOV     R3,A
   \   000083   12....       LCALL   ??ZDO_ProcessBindUnbindReq?relay
   1128                }
   1129                break;
   1130          #endif
   1131          
   1132          #if defined ( ZDO_COORDINATOR )
   1133              case Bind_rsp:
   1134              case Unbind_rsp:
   1135                if ( matchED )
   1136                {
   1137                  ZDMatchSendState(
   1138                       (uint8)((inMsg->clusterID == Bind_rsp) ? ZDMATCH_REASON_BIND_RSP : ZDMATCH_REASON_UNBIND_RSP),
   1139                       ZDO_ParseBindRsp(inMsg), inMsg->TransSeq );
   1140                }
   1141                break;
   1142          
   1143              case End_Device_Bind_req:
   1144                {
   1145                  ZDEndDeviceBind_t bindReq;
   1146                  ZDO_ParseEndDeviceBindReq( inMsg, &bindReq );
   1147                  ZDO_MatchEndDeviceBind( &bindReq );
   1148          
   1149                  // Freeing the cluster lists - if allocated.
   1150                  if ( bindReq.numInClusters )
   1151                    osal_mem_free( bindReq.inClusters );
   1152                  if ( bindReq.numOutClusters )
   1153                    osal_mem_free( bindReq.outClusters );
   1154                }
   1155                break;
   1156          #endif
   1157            }
   1158          }
   \                     ??ZDApp_ProcessMsgCBs_2:
   \   000086   7415         MOV     A,#0x15
   \   000088   12....       LCALL   ?DEALLOC_XSTACK8
   \   00008B   7F02         MOV     R7,#0x2
   \   00008D   02....       LJMP    ?BANKED_LEAVE_XDATA
   1159          
   1160          /*********************************************************************
   1161           * @fn      ZDApp_RegisterCBs()
   1162           *
   1163           * @brief   Process response messages
   1164           *
   1165           * @param   none
   1166           *
   1167           * @return  none
   1168           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1169          void ZDApp_RegisterCBs( void )
   \                     ZDApp_RegisterCBs:
   1170          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1171          #if defined ( ZDO_IEEEADDR_REQUEST ) || defined ( REFLECTOR )
   1172            ZDO_RegisterForZDOMsg( ZDAppTaskID, IEEE_addr_rsp );
   \   000004                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000004   7A01         MOV     R2,#0x1
   \   000006   7B80         MOV     R3,#-0x80
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   1173          #endif
   1174          #if defined ( ZDO_NWKADDR_REQUEST ) || defined ( REFLECTOR )
   1175            ZDO_RegisterForZDOMsg( ZDAppTaskID, NWK_addr_rsp );
   \   000010                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000010   7A00         MOV     R2,#0x0
   \   000012   7B80         MOV     R3,#-0x80
   \   000014   90....       MOV     DPTR,#ZDAppTaskID
   \   000017   E0           MOVX    A,@DPTR
   \   000018   F9           MOV     R1,A
   \   000019   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   1176          #endif
   1177          #if defined ( ZDO_COORDINATOR )
   1178            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_rsp );
   1179            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_rsp );
   1180            ZDO_RegisterForZDOMsg( ZDAppTaskID, End_Device_Bind_req );
   1181          #endif
   1182          #if defined ( REFLECTOR )
   1183            ZDO_RegisterForZDOMsg( ZDAppTaskID, Bind_req );
   \   00001C                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   00001C   7A21         MOV     R2,#0x21
   \   00001E   7B00         MOV     R3,#0x0
   \   000020   90....       MOV     DPTR,#ZDAppTaskID
   \   000023   E0           MOVX    A,@DPTR
   \   000024   F9           MOV     R1,A
   \   000025   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   1184            ZDO_RegisterForZDOMsg( ZDAppTaskID, Unbind_req );
   \   000028                ; Setup parameters for call to function ZDO_RegisterForZDOMsg
   \   000028   7A22         MOV     R2,#0x22
   \   00002A   7B00         MOV     R3,#0x0
   \   00002C   90....       MOV     DPTR,#ZDAppTaskID
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   F9           MOV     R1,A
   \   000031   12....       LCALL   ??ZDO_RegisterForZDOMsg?relay
   1185          #endif
   1186          }
   \   000034   D083         POP     DPH
   \   000036   D082         POP     DPL
   \   000038   02....       LJMP    ?BRET
   1187          
   1188          /*********************************************************************
   1189           * @fn      ZDApp_ProcessSecMsg()
   1190           *
   1191           * @brief   Process the incoming security message.
   1192           *
   1193           * @param   msgPtr - message to process
   1194           *
   1195           * @return  none
   1196           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1197          void ZDApp_ProcessSecMsg( osal_event_hdr_t *msgPtr )
   \                     ZDApp_ProcessSecMsg:
   1198          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1199            switch ( msgPtr->event )
   \   000004   8A82         MOV     DPL,R2
   \   000006   8B83         MOV     DPH,R3
   \   000008   E0           MOVX    A,@DPTR
   \   000009   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for ZDApp_ProcessSecMsg>_0`:
   \   00000C   00           DB        0
   \   00000D   03           DB        3
   \   00000E   06           DB        6
   \   00000F   ....         DW        ??ZDApp_ProcessSecMsg_0
   \   000011   08           DB        8
   \   000012   ....         DW        ??ZDApp_ProcessSecMsg_1
   \   000014   0A           DB        10
   \   000015   ....         DW        ??ZDApp_ProcessSecMsg_2
   \   000017   ....         DW        ??ZDApp_ProcessSecMsg_3
   1200            {
   1201              case ZDO_ESTABLISH_KEY_CFM:
   1202                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1203                {
   1204                  ZDSecMgrEstablishKeyCfm( (ZDO_EstablishKeyCfm_t*)msgPtr );
   1205                }
   1206                break;
   1207          
   1208              case ZDO_ESTABLISH_KEY_IND:
   1209                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1210                {
   1211                  if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   1212                  {
   1213                    ZDSecMgrEstablishKeyInd( (ZDO_EstablishKeyInd_t*)msgPtr );
   1214                  }
   1215                }
   1216                break;
   1217          
   1218              case ZDO_TRANSPORT_KEY_IND:
   1219                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessSecMsg_0:
   \   000019   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   6401         XRL     A,#0x1
   \   00001F   6005         JZ      ??ZDApp_ProcessSecMsg_4
   \   000021   E0           MOVX    A,@DPTR
   \   000022   6402         XRL     A,#0x2
   \   000024   7022         JNZ     ??ZDApp_ProcessSecMsg_3
   1220                {
   1221                  ZDSecMgrTransportKeyInd( (ZDO_TransportKeyInd_t*)msgPtr );
   \                     ??ZDApp_ProcessSecMsg_4:
   \   000026                ; Setup parameters for call to function ZDSecMgrTransportKeyInd
   \   000026   12....       LCALL   ??ZDSecMgrTransportKeyInd?relay
   \   000029   801D         SJMP    ??ZDApp_ProcessSecMsg_3
   1222                }
   1223                break;
   1224          
   1225              case ZDO_UPDATE_DEVICE_IND:
   1226                if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1227                {
   1228                  ZDSecMgrUpdateDeviceInd( (ZDO_UpdateDeviceInd_t*)msgPtr );
   1229                }
   1230                break;
   1231          
   1232              case ZDO_REMOVE_DEVICE_IND:
   1233                if ( ZG_BUILD_RTRONLY_TYPE && ( zgDeviceLogicalType == ZG_DEVICETYPE_ROUTER ) )
   \                     ??ZDApp_ProcessSecMsg_1:
   \   00002B   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00002E   E0           MOVX    A,@DPTR
   \   00002F   6401         XRL     A,#0x1
   \   000031   7015         JNZ     ??ZDApp_ProcessSecMsg_3
   1234                {
   1235                  ZDSecMgrRemoveDeviceInd( (ZDO_RemoveDeviceInd_t*)msgPtr );
   \   000033                ; Setup parameters for call to function ZDSecMgrRemoveDeviceInd
   \   000033   12....       LCALL   ??ZDSecMgrRemoveDeviceInd?relay
   \   000036   8010         SJMP    ??ZDApp_ProcessSecMsg_3
   1236                }
   1237                break;
   1238          
   1239              case ZDO_REQUEST_KEY_IND:
   1240                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1241                {
   1242                  if ( ZG_BUILD_COORDINATOR_TYPE && ZG_DEVICE_COORDINATOR_TYPE )
   1243                  {
   1244                    ZDSecMgrRequestKeyInd( (ZDO_RequestKeyInd_t*)msgPtr );
   1245                  }
   1246                }
   1247                break;
   1248          
   1249              case ZDO_SWITCH_KEY_IND:
   1250                if ( ZG_BUILD_JOINING_TYPE && ZG_DEVICE_JOINING_TYPE )
   \                     ??ZDApp_ProcessSecMsg_2:
   \   000038   90....       MOV     DPTR,#zgDeviceLogicalType
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   6401         XRL     A,#0x1
   \   00003E   6005         JZ      ??ZDApp_ProcessSecMsg_5
   \   000040   E0           MOVX    A,@DPTR
   \   000041   6402         XRL     A,#0x2
   \   000043   7003         JNZ     ??ZDApp_ProcessSecMsg_3
   1251                {
   1252                  ZDSecMgrSwitchKeyInd( (ZDO_SwitchKeyInd_t*)msgPtr );
   \                     ??ZDApp_ProcessSecMsg_5:
   \   000045                ; Setup parameters for call to function ZDSecMgrSwitchKeyInd
   \   000045   12....       LCALL   ??ZDSecMgrSwitchKeyInd?relay
   1253                }
   1254                break;
   1255          
   1256              case ZDO_AUTHENTICATE_IND:
   1257                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1258                {
   1259                  ZDSecMgrAuthenticateInd( (ZDO_AuthenticateInd_t*)msgPtr );
   1260                }
   1261                break;
   1262          
   1263              case ZDO_AUTHENTICATE_CFM:
   1264                if ( ZG_CHECK_SECURITY_MODE == ZG_SECURITY_PRO_HIGH )
   1265                {
   1266                  ZDSecMgrAuthenticateCfm( (ZDO_AuthenticateCfm_t*)msgPtr );
   1267                }
   1268                break;
   1269          
   1270              default:
   1271                // Unsupported messages
   1272                break;
   1273            }
   1274          }
   \                     ??ZDApp_ProcessSecMsg_3:
   \   000048   D083         POP     DPH
   \   00004A   D082         POP     DPL
   \   00004C   02....       LJMP    ?BRET
   1275          
   1276          /*********************************************************************
   1277           * @fn      ZDApp_ProcessNetworkJoin()
   1278           *
   1279           * @brief
   1280           *
   1281           *   Save off the Network key information.
   1282           *
   1283           * @param   none
   1284           *
   1285           * @return  none
   1286           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1287          void ZDApp_ProcessNetworkJoin( void )
   \                     ZDApp_ProcessNetworkJoin:
   1288          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1289            if ( (devState == DEV_NWK_JOINING) ||
   1290                ((devState == DEV_NWK_ORPHAN)  &&
   1291                 (ZDO_Config_Node_Descriptor.LogicalType == NODETYPE_ROUTER)) )
   \   00000A   90....       MOV     DPTR,#devState
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   6403         XRL     A,#0x3
   \   000010   6015         JZ      ??ZDApp_ProcessNetworkJoin_0
   \   000012   E0           MOVX    A,@DPTR
   \   000013   640A         XRL     A,#0xa
   \   000015   6003         JZ      $+5
   \   000017   02....       LJMP    ??ZDApp_ProcessNetworkJoin_1 & 0xFFFF
   \   00001A   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   5407         ANL     A,#0x7
   \   000020   6401         XRL     A,#0x1
   \   000022   6003         JZ      $+5
   \   000024   02....       LJMP    ??ZDApp_ProcessNetworkJoin_1 & 0xFFFF
   1292            {
   1293              // Result of a Join attempt by this device.
   1294              if ( nwkStatus == ZSuccess )
   \                     ??ZDApp_ProcessNetworkJoin_0:
   \   000027   90....       MOV     DPTR,#nwkStatus
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   704E         JNZ     ??ZDApp_ProcessNetworkJoin_2
   1295              {
   1296                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   00002D                ; Setup parameters for call to function osal_set_event
   \   00002D   7A10         MOV     R2,#0x10
   \   00002F   7B00         MOV     R3,#0x0
   \   000031   90....       MOV     DPTR,#ZDAppTaskID
   \   000034   E0           MOVX    A,@DPTR
   \   000035   F9           MOV     R1,A
   \   000036   12....       LCALL   ??osal_set_event?relay
   1297          
   1298          #if defined ( POWER_SAVING )
   1299                osal_pwrmgr_device( PWRMGR_BATTERY );
   1300          #endif
   1301          
   1302                if ( ZG_SECURE_ENABLED && ( ZDApp_RestoreNwkKey() == false ) )
   1303                {
   1304                  // wait for auth from trust center!!
   1305                  devState = DEV_END_DEVICE_UNAUTH;
   1306          
   1307                  // Start the reset timer for MAX UNAUTH time
   1308                  ZDApp_ResetTimerStart( 10000 );//MAX_DEVICE_UNAUTH_TIMEOUT );
   1309                }
   1310                else
   1311                {
   1312                  if ( ZSTACK_ROUTER_BUILD )
   1313                  {
   1314                    if ( devState == DEV_NWK_ORPHAN
   1315                      && ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \   000039   90....       MOV     DPTR,#devState
   \   00003C   E0           MOVX    A,@DPTR
   \   00003D   640A         XRL     A,#0xa
   \   00003F   7010         JNZ     ??ZDApp_ProcessNetworkJoin_3
   \   000041   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000044   E0           MOVX    A,@DPTR
   \   000045   5407         ANL     A,#0x7
   \   000047   6402         XRL     A,#0x2
   \   000049   6006         JZ      ??ZDApp_ProcessNetworkJoin_3
   1316                    {
   1317                      // Change NIB state to router for restore
   1318                      _NIB.nwkState = NWK_ROUTER;
   \   00004B   7408         MOV     A,#0x8
   \   00004D   90....       MOV     DPTR,#(_NIB + 35)
   \   000050   F0           MOVX    @DPTR,A
   1319                    }
   1320                  }
   1321          
   1322                  if ( devState == DEV_NWK_JOINING )
   \                     ??ZDApp_ProcessNetworkJoin_3:
   \   000051   90....       MOV     DPTR,#devState
   \   000054   E0           MOVX    A,@DPTR
   \   000055   6403         XRL     A,#0x3
   \   000057   7003         JNZ     ??ZDApp_ProcessNetworkJoin_4
   1323                  {
   1324                    ZDApp_AnnounceNewAddress();
   \   000059                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000059   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   1325                  }
   1326          
   1327                  devState = DEV_END_DEVICE;
   \                     ??ZDApp_ProcessNetworkJoin_4:
   \   00005C   7406         MOV     A,#0x6
   \   00005E   90....       MOV     DPTR,#devState
   \   000061   F0           MOVX    @DPTR,A
   1328                  if ( ZSTACK_ROUTER_BUILD )
   1329                  {
   1330                    // NOTE: first two parameters are not used, see NLMEDE.h for details
   1331                    if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \   000062   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000065   E0           MOVX    A,@DPTR
   \   000066   5407         ANL     A,#0x7
   \   000068   6402         XRL     A,#0x2
   \   00006A   7003         JNZ     $+5
   \   00006C   02....       LJMP    ??ZDApp_ProcessNetworkJoin_5 & 0xFFFF
   1332                    {
   1333                      NLME_StartRouterRequest( 0, 0, false );
   \   00006F                ; Setup parameters for call to function NLME_StartRouterRequest
   \   00006F   7B00         MOV     R3,#0x0
   \   000071   7A00         MOV     R2,#0x0
   \   000073   7900         MOV     R1,#0x0
   \   000075   12....       LCALL   ??NLME_StartRouterRequest?relay
   \   000078   02....       LJMP    ??ZDApp_ProcessNetworkJoin_5 & 0xFFFF
   1334                    }
   1335                  }
   1336                }
   1337              }
   1338              else
   1339              {
   1340                if ( (devStartMode == MODE_RESUME) && (++retryCnt >= MAX_RESUME_RETRY) )
   \                     ??ZDApp_ProcessNetworkJoin_2:
   \   00007B   90....       MOV     DPTR,#devStartMode
   \   00007E   E0           MOVX    A,@DPTR
   \   00007F   6401         XRL     A,#0x1
   \   000081   703A         JNZ     ??ZDApp_ProcessNetworkJoin_6
   \   000083   90....       MOV     DPTR,#retryCnt
   \   000086   E0           MOVX    A,@DPTR
   \   000087   04           INC     A
   \   000088   F0           MOVX    @DPTR,A
   \   000089   E0           MOVX    A,@DPTR
   \   00008A   C3           CLR     C
   \   00008B   9403         SUBB    A,#0x3
   \   00008D   402E         JC      ??ZDApp_ProcessNetworkJoin_6
   1341                {
   1342                  if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   00008F   90....       MOV     DPTR,#(_NIB + 33)
   \   000092   E0           MOVX    A,@DPTR
   \   000093   F8           MOV     R0,A
   \   000094   A3           INC     DPTR
   \   000095   E0           MOVX    A,@DPTR
   \   000096   F9           MOV     R1,A
   \   000097   74FF         MOV     A,#-0x1
   \   000099   68           XRL     A,R0
   \   00009A   7003         JNZ     ??ZDApp_ProcessNetworkJoin_7
   \   00009C   74FF         MOV     A,#-0x1
   \   00009E   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_7:
   \   00009F   600A         JZ      ??ZDApp_ProcessNetworkJoin_8
   \   0000A1   74FE         MOV     A,#-0x2
   \   0000A3   68           XRL     A,R0
   \   0000A4   7003         JNZ     ??ZDApp_ProcessNetworkJoin_9
   \   0000A6   74FF         MOV     A,#-0x1
   \   0000A8   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_9:
   \   0000A9   7006         JNZ     ??ZDApp_ProcessNetworkJoin_10
   1343                    devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_8:
   \   0000AB   E4           CLR     A
   \   0000AC   90....       MOV     DPTR,#devStartMode
   \   0000AF   800B         SJMP    ??ZDApp_ProcessNetworkJoin_11
   1344                  else
   1345                  {
   1346                    devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_10:
   \   0000B1   7403         MOV     A,#0x3
   \   0000B3   90....       MOV     DPTR,#devStartMode
   \   0000B6   F0           MOVX    @DPTR,A
   1347                    _tmpRejoinState = true;
   \   0000B7   7401         MOV     A,#0x1
   \   0000B9   90....       MOV     DPTR,#_tmpRejoinState
   \                     ??ZDApp_ProcessNetworkJoin_11:
   \   0000BC   F0           MOVX    @DPTR,A
   1348                  }
   1349                }
   1350          
   1351                if ( (NLME_GetShortAddr() != INVALID_NODE_ADDR) ||
   1352                     (_NIB.nwkDevAddress != INVALID_NODE_ADDR) )
   \                     ??ZDApp_ProcessNetworkJoin_6:
   \   0000BD                ; Setup parameters for call to function NLME_GetShortAddr
   \   0000BD   12....       LCALL   ??NLME_GetShortAddr?relay
   \   0000C0   8A..         MOV     ?V0 + 0,R2
   \   0000C2   8B..         MOV     ?V0 + 1,R3
   \   0000C4   74FE         MOV     A,#-0x2
   \   0000C6   65..         XRL     A,?V0 + 0
   \   0000C8   7004         JNZ     ??ZDApp_ProcessNetworkJoin_12
   \   0000CA   74FF         MOV     A,#-0x1
   \   0000CC   65..         XRL     A,?V0 + 1
   \                     ??ZDApp_ProcessNetworkJoin_12:
   \   0000CE   700E         JNZ     ??ZDApp_ProcessNetworkJoin_13
   \   0000D0   90....       MOV     DPTR,#(_NIB + 20)
   \   0000D3   E0           MOVX    A,@DPTR
   \   0000D4   64FE         XRL     A,#0xfe
   \   0000D6   7004         JNZ     ??ZDApp_ProcessNetworkJoin_14
   \   0000D8   A3           INC     DPTR
   \   0000D9   E0           MOVX    A,@DPTR
   \   0000DA   64FF         XRL     A,#0xff
   \                     ??ZDApp_ProcessNetworkJoin_14:
   \   0000DC   6026         JZ      ??ZDApp_ProcessNetworkJoin_15
   1353                {
   1354                  uint16 addr = INVALID_NODE_ADDR;
   \                     ??ZDApp_ProcessNetworkJoin_13:
   \   0000DE   85..82       MOV     DPL,?XSP + 0
   \   0000E1   85..83       MOV     DPH,?XSP + 1
   \   0000E4   74FE         MOV     A,#-0x2
   \   0000E6   F0           MOVX    @DPTR,A
   \   0000E7   A3           INC     DPTR
   \   0000E8   74FF         MOV     A,#-0x1
   \   0000EA   F0           MOVX    @DPTR,A
   1355                  // Invalidate nwk addr so end device does not use in its data reqs.
   1356                  _NIB.nwkDevAddress = INVALID_NODE_ADDR;
   \   0000EB   90....       MOV     DPTR,#(_NIB + 20)
   \   0000EE   74FE         MOV     A,#-0x2
   \   0000F0   F0           MOVX    @DPTR,A
   \   0000F1   A3           INC     DPTR
   \   0000F2   74FF         MOV     A,#-0x1
   \   0000F4   F0           MOVX    @DPTR,A
   1357                  ZMacSetReq( ZMacShortAddress, (uint8 *)&addr );
   \   0000F5                ; Setup parameters for call to function ZMacSetReq
   \   0000F5   85..82       MOV     DPL,?XSP + 0
   \   0000F8   85..83       MOV     DPH,?XSP + 1
   \   0000FB   AA82         MOV     R2,DPL
   \   0000FD   AB83         MOV     R3,DPH
   \   0000FF   7953         MOV     R1,#0x53
   \   000101   12....       LCALL   ??ZMacSetReq?relay
   1358                }
   1359          
   1360                zdoDiscCounter = 1;
   \                     ??ZDApp_ProcessNetworkJoin_15:
   \   000104   7401         MOV     A,#0x1
   \   000106   90....       MOV     DPTR,#zdoDiscCounter
   \                     ??ZDApp_ProcessNetworkJoin_16:
   \   000109   F0           MOVX    @DPTR,A
   1361          
   1362          //      ZDApp_NetworkInit( (uint16)
   1363          //                         ((NWK_START_DELAY * (osal_rand() & 0x0F)) +
   1364          //                          (NWK_START_DELAY * 5)) );
   1365                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1366                     + ((uint16)(osal_rand()& EXTENDED_JOINING_RANDOM_MASK))) );
   \   00010A                ; Setup parameters for call to function ZDApp_NetworkInit
   \   00010A                ; Setup parameters for call to function osal_rand
   \   00010A   02....       LJMP    ??ZDApp_ProcessNetworkJoin_17 & 0xFFFF
   1367              }
   1368            }
   1369            else if ( devState == DEV_NWK_ORPHAN || devState == DEV_NWK_REJOIN )
   \                     ??ZDApp_ProcessNetworkJoin_1:
   \   00010D   90....       MOV     DPTR,#devState
   \   000110   E0           MOVX    A,@DPTR
   \   000111   640A         XRL     A,#0xa
   \   000113   6008         JZ      ??ZDApp_ProcessNetworkJoin_18
   \   000115   E0           MOVX    A,@DPTR
   \   000116   6404         XRL     A,#0x4
   \   000118   6003         JZ      $+5
   \   00011A   02....       LJMP    ??ZDApp_ProcessNetworkJoin_5 & 0xFFFF
   1370            {
   1371              // results of an orphaning attempt by this device
   1372              if (nwkStatus == ZSuccess)
   \                     ??ZDApp_ProcessNetworkJoin_18:
   \   00011D   90....       MOV     DPTR,#nwkStatus
   \   000120   E0           MOVX    A,@DPTR
   \   000121   7047         JNZ     ??ZDApp_ProcessNetworkJoin_19
   1373              {
   1374                if ( ZG_SECURE_ENABLED )
   1375                {
   1376                  ZDApp_RestoreNwkKey();
   1377                }
   1378          
   1379                devState = DEV_END_DEVICE;
   \   000123   7406         MOV     A,#0x6
   \   000125   90....       MOV     DPTR,#devState
   \   000128   F0           MOVX    @DPTR,A
   1380                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000129                ; Setup parameters for call to function osal_set_event
   \   000129   7A10         MOV     R2,#0x10
   \   00012B   7B00         MOV     R3,#0x0
   \   00012D   90....       MOV     DPTR,#ZDAppTaskID
   \   000130   E0           MOVX    A,@DPTR
   \   000131   F9           MOV     R1,A
   \   000132   12....       LCALL   ??osal_set_event?relay
   1381                // setup Power Manager Device
   1382          #if defined ( POWER_SAVING )
   1383                osal_pwrmgr_device( PWRMGR_BATTERY );
   1384          #endif
   1385          
   1386                if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_RCVR_ON_IDLE )
   \   000135   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000138   E0           MOVX    A,@DPTR
   \   000139   A2E3         MOV     C,0xE0 /* A   */.3
   \   00013B   5015         JNC     ??ZDApp_ProcessNetworkJoin_20
   1387                {
   1388                  // The receiver is on, turn network layer polling off.
   1389                  NLME_SetPollRate( 0 );
   \   00013D                ; Setup parameters for call to function NLME_SetPollRate
   \   00013D   7A00         MOV     R2,#0x0
   \   00013F   7B00         MOV     R3,#0x0
   \   000141   12....       LCALL   ??NLME_SetPollRate?relay
   1390                  NLME_SetQueuedPollRate( 0 );
   \   000144                ; Setup parameters for call to function NLME_SetQueuedPollRate
   \   000144   7A00         MOV     R2,#0x0
   \   000146   7B00         MOV     R3,#0x0
   \   000148   12....       LCALL   ??NLME_SetQueuedPollRate?relay
   1391                  NLME_SetResponseRate( 0 );
   \   00014B                ; Setup parameters for call to function NLME_SetResponseRate
   \   00014B   7A00         MOV     R2,#0x0
   \   00014D   7B00         MOV     R3,#0x0
   \   00014F   12....       LCALL   ??NLME_SetResponseRate?relay
   1392                }
   1393          
   1394                if ( ZSTACK_ROUTER_BUILD )
   1395                {
   1396                  // NOTE: first two parameters are not used, see NLMEDE.h for details
   1397                  if ( ZDO_Config_Node_Descriptor.LogicalType != NODETYPE_DEVICE )
   \                     ??ZDApp_ProcessNetworkJoin_20:
   \   000152   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000155   E0           MOVX    A,@DPTR
   \   000156   5407         ANL     A,#0x7
   \   000158   6402         XRL     A,#0x2
   \   00015A   6009         JZ      ??ZDApp_ProcessNetworkJoin_21
   1398                  {
   1399                    NLME_StartRouterRequest( 0, 0, false );
   \   00015C                ; Setup parameters for call to function NLME_StartRouterRequest
   \   00015C   7B00         MOV     R3,#0x0
   \   00015E   7A00         MOV     R2,#0x0
   \   000160   7900         MOV     R1,#0x0
   \   000162   12....       LCALL   ??NLME_StartRouterRequest?relay
   1400                  }
   1401                }
   1402          
   1403                ZDApp_AnnounceNewAddress();
   \                     ??ZDApp_ProcessNetworkJoin_21:
   \   000165                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000165   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   \   000168   805F         SJMP    ??ZDApp_ProcessNetworkJoin_5
   1404              }
   1405              else
   1406              {
   1407                if ( devStartMode == MODE_RESUME )
   \                     ??ZDApp_ProcessNetworkJoin_19:
   \   00016A   90....       MOV     DPTR,#devStartMode
   \   00016D   E0           MOVX    A,@DPTR
   \   00016E   6401         XRL     A,#0x1
   \   000170   7044         JNZ     ??ZDApp_ProcessNetworkJoin_17
   1408                {
   1409                  if ( ++retryCnt <= MAX_RESUME_RETRY )
   \   000172   90....       MOV     DPTR,#retryCnt
   \   000175   E0           MOVX    A,@DPTR
   \   000176   04           INC     A
   \   000177   F0           MOVX    @DPTR,A
   \   000178   E0           MOVX    A,@DPTR
   \   000179   C3           CLR     C
   \   00017A   9404         SUBB    A,#0x4
   \   00017C   5030         JNC     ??ZDApp_ProcessNetworkJoin_22
   1410                  {
   1411                    if ( _NIB.nwkPanId == 0xFFFF || _NIB.nwkPanId == INVALID_PAN_ID )
   \   00017E   90....       MOV     DPTR,#(_NIB + 33)
   \   000181   E0           MOVX    A,@DPTR
   \   000182   F8           MOV     R0,A
   \   000183   A3           INC     DPTR
   \   000184   E0           MOVX    A,@DPTR
   \   000185   F9           MOV     R1,A
   \   000186   74FF         MOV     A,#-0x1
   \   000188   68           XRL     A,R0
   \   000189   7003         JNZ     ??ZDApp_ProcessNetworkJoin_23
   \   00018B   74FF         MOV     A,#-0x1
   \   00018D   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_23:
   \   00018E   600A         JZ      ??ZDApp_ProcessNetworkJoin_24
   \   000190   74FE         MOV     A,#-0x2
   \   000192   68           XRL     A,R0
   \   000193   7003         JNZ     ??ZDApp_ProcessNetworkJoin_25
   \   000195   74FF         MOV     A,#-0x1
   \   000197   69           XRL     A,R1
   \                     ??ZDApp_ProcessNetworkJoin_25:
   \   000198   7007         JNZ     ??ZDApp_ProcessNetworkJoin_26
   1412                      devStartMode = MODE_JOIN;
   \                     ??ZDApp_ProcessNetworkJoin_24:
   \   00019A   E4           CLR     A
   \   00019B   90....       MOV     DPTR,#devStartMode
   \                     ??ZDApp_ProcessNetworkJoin_27:
   \   00019E   02....       LJMP    ??ZDApp_ProcessNetworkJoin_16 & 0xFFFF
   1413                    else
   1414                    {
   1415                      devStartMode = MODE_REJOIN;
   \                     ??ZDApp_ProcessNetworkJoin_26:
   \   0001A1   7403         MOV     A,#0x3
   \   0001A3   90....       MOV     DPTR,#devStartMode
   \   0001A6   F0           MOVX    @DPTR,A
   1416                      _tmpRejoinState = true;
   \   0001A7   7401         MOV     A,#0x1
   \   0001A9   90....       MOV     DPTR,#_tmpRejoinState
   \   0001AC   80F0         SJMP    ??ZDApp_ProcessNetworkJoin_27
   1417                    }
   1418                  }
   1419                  // Do a normal join to the network after certain times of rejoin retries
   1420                  else if( AIB_apsUseInsecureJoin == true )
   \                     ??ZDApp_ProcessNetworkJoin_22:
   \   0001AE   90....       MOV     DPTR,#AIB_apsUseInsecureJoin
   \   0001B1   E0           MOVX    A,@DPTR
   \   0001B2   6401         XRL     A,#0x1
   \   0001B4   60E4         JZ      ??ZDApp_ProcessNetworkJoin_24
   1421                  {
   1422                    devStartMode = MODE_JOIN;
   1423                  }
   1424                }
   1425          
   1426          
   1427                // setup a retry for later...
   1428                ZDApp_NetworkInit( (uint16)(NWK_START_DELAY
   1429                     + (osal_rand()& EXTENDED_JOINING_RANDOM_MASK)) );
   \                     ??ZDApp_ProcessNetworkJoin_17:
   \   0001B6                ; Setup parameters for call to function ZDApp_NetworkInit
   \   0001B6                ; Setup parameters for call to function osal_rand
   \   0001B6   12....       LCALL   ??osal_rand?relay
   \   0001B9   8A..         MOV     ?V0 + 0,R2
   \   0001BB   747F         MOV     A,#0x7f
   \   0001BD   55..         ANL     A,?V0 + 0
   \   0001BF   F8           MOV     R0,A
   \   0001C0   7464         MOV     A,#0x64
   \   0001C2   28           ADD     A,R0
   \   0001C3   FA           MOV     R2,A
   \   0001C4   7B00         MOV     R3,#0x0
   \   0001C6   12....       LCALL   ??ZDApp_NetworkInit?relay
   1430              }
   1431            }
   1432          #if defined ( ZIGBEE_STOCHASTIC_ADDRESSING )
   1433            else
   1434            {
   1435              // Assume from address conflict
   1436              if ( _NIB.nwkAddrAlloc == NWK_ADDRESSING_STOCHASTIC )
   1437              {
   1438                // Notify the network
   1439                ZDApp_AnnounceNewAddress();
   1440          
   1441                // Notify apps
   1442                osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   1443              }
   1444            }
   1445          #endif
   1446          }
   \                     ??ZDApp_ProcessNetworkJoin_5:
   \   0001C9   7402         MOV     A,#0x2
   \   0001CB   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001CE   7F02         MOV     R7,#0x2
   \   0001D0   02....       LJMP    ?BANKED_LEAVE_XDATA
   1447          
   1448          /*********************************************************************
   1449           * @fn      ZDApp_SaveNwkKey()
   1450           *
   1451           * @brief   Save off the Network key information.
   1452           *
   1453           * @param   none
   1454           *
   1455           * @return  none
   1456           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1457          void ZDApp_SaveNwkKey( void )
   \                     ZDApp_SaveNwkKey:
   1458          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1459            nwkActiveKeyItems keyItems;
   1460          
   1461            SSP_ReadNwkActiveKey( &keyItems );
   \   00000A                ; Setup parameters for call to function SSP_ReadNwkActiveKey
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   AA82         MOV     R2,DPL
   \   000012   AB83         MOV     R3,DPH
   \   000014   12....       LCALL   ??SSP_ReadNwkActiveKey?relay
   1462            keyItems.frameCounter++;
   \   000017   90....       MOV     DPTR,#__Constant_1
   \   00001A   78..         MOV     R0,#?V0 + 0
   \   00001C   12....       LCALL   ?L_MOV_X
   \   00001F   7411         MOV     A,#0x11
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   78..         MOV     R0,#?V0 + 0
   \   000026   12....       LCALL   ?L_ADD_TO_X
   1463          
   1464            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1465                          (void *)&keyItems );
   \   000029                ; Setup parameters for call to function osal_nv_write
   \   000029   85..82       MOV     DPL,?XSP + 0
   \   00002C   85..83       MOV     DPH,?XSP + 1
   \   00002F   8582..       MOV     ?V0 + 0,DPL
   \   000032   8583..       MOV     ?V0 + 1,DPH
   \   000035   78..         MOV     R0,#?V0 + 0
   \   000037   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003A   75..15       MOV     ?V0 + 0,#0x15
   \   00003D   75..00       MOV     ?V0 + 1,#0x0
   \   000040   78..         MOV     R0,#?V0 + 0
   \   000042   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000045   7C00         MOV     R4,#0x0
   \   000047   7D00         MOV     R5,#0x0
   \   000049   7A82         MOV     R2,#-0x7e
   \   00004B   7B00         MOV     R3,#0x0
   \   00004D   12....       LCALL   ??osal_nv_write?relay
   \   000050   7404         MOV     A,#0x4
   \   000052   12....       LCALL   ?DEALLOC_XSTACK8
   1466          
   1467            nwkFrameCounterChanges = 0;
   \   000055   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000058   E4           CLR     A
   \   000059   F0           MOVX    @DPTR,A
   \   00005A   A3           INC     DPTR
   \   00005B   F0           MOVX    @DPTR,A
   1468          }
   \   00005C   7415         MOV     A,#0x15
   \   00005E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000061   7F04         MOV     R7,#0x4
   \   000063   02....       LJMP    ?BANKED_LEAVE_XDATA
   1469          
   1470          /*********************************************************************
   1471           * @fn      ZDApp_ResetNwkKey()
   1472           *
   1473           * @brief   Reset the Network key information in NV.
   1474           *
   1475           * @param   none
   1476           *
   1477           * @return  none
   1478           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1479          void ZDApp_ResetNwkKey( void )
   \                     ZDApp_ResetNwkKey:
   1480          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1481            nwkActiveKeyItems keyItems;
   1482          
   1483            osal_memset( &keyItems, 0, sizeof( nwkActiveKeyItems ) );
   \   00000A                ; Setup parameters for call to function osal_memset
   \   00000A   7C15         MOV     R4,#0x15
   \   00000C   7D00         MOV     R5,#0x0
   \   00000E   7900         MOV     R1,#0x0
   \   000010   85..82       MOV     DPL,?XSP + 0
   \   000013   85..83       MOV     DPH,?XSP + 1
   \   000016   AA82         MOV     R2,DPL
   \   000018   AB83         MOV     R3,DPH
   \   00001A   12....       LCALL   ??osal_memset?relay
   1484            osal_nv_write( ZCD_NV_NWKKEY, 0, sizeof( nwkActiveKeyItems ),
   1485                          (void *)&keyItems );
   \   00001D                ; Setup parameters for call to function osal_nv_write
   \   00001D   85..82       MOV     DPL,?XSP + 0
   \   000020   85..83       MOV     DPH,?XSP + 1
   \   000023   8582..       MOV     ?V0 + 0,DPL
   \   000026   8583..       MOV     ?V0 + 1,DPH
   \   000029   78..         MOV     R0,#?V0 + 0
   \   00002B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002E   75..15       MOV     ?V0 + 0,#0x15
   \   000031   75..00       MOV     ?V0 + 1,#0x0
   \   000034   78..         MOV     R0,#?V0 + 0
   \   000036   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000039   7C00         MOV     R4,#0x0
   \   00003B   7D00         MOV     R5,#0x0
   \   00003D   7A82         MOV     R2,#-0x7e
   \   00003F   7B00         MOV     R3,#0x0
   \   000041   12....       LCALL   ??osal_nv_write?relay
   \   000044   7404         MOV     A,#0x4
   \   000046   12....       LCALL   ?DEALLOC_XSTACK8
   1486          }
   \   000049   7415         MOV     A,#0x15
   \   00004B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00004E   7F02         MOV     R7,#0x2
   \   000050   02....       LJMP    ?BANKED_LEAVE_XDATA
   1487          
   1488          /*********************************************************************
   1489           * @fn      ZDApp_RestoreNwkKey()
   1490           *
   1491           * @brief
   1492           *
   1493           *   Save off the Network key information.
   1494           *
   1495           * @param   none
   1496           *
   1497           * @return  true if restored from NV, false if not
   1498           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1499          uint8 ZDApp_RestoreNwkKey( void )
   \                     ZDApp_RestoreNwkKey:
   1500          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 21
   \   000005   74EB         MOV     A,#-0x15
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1501            nwkActiveKeyItems keyItems;
   1502            uint8 ret = false;
   \   00000A   7E00         MOV     R6,#0x0
   1503          
   1504            if ( osal_nv_read( ZCD_NV_NWKKEY, 0, sizeof(nwkActiveKeyItems), (void*)&keyItems )
   1505                == ZSUCCESS )
   \   00000C                ; Setup parameters for call to function osal_nv_read
   \   00000C   85..82       MOV     DPL,?XSP + 0
   \   00000F   85..83       MOV     DPH,?XSP + 1
   \   000012   8582..       MOV     ?V0 + 0,DPL
   \   000015   8583..       MOV     ?V0 + 1,DPH
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001D   75..15       MOV     ?V0 + 0,#0x15
   \   000020   8E..         MOV     ?V0 + 1,R6
   \   000022   78..         MOV     R0,#?V0 + 0
   \   000024   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000027   7C00         MOV     R4,#0x0
   \   000029   7D00         MOV     R5,#0x0
   \   00002B   7A82         MOV     R2,#-0x7e
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   12....       LCALL   ??osal_nv_read?relay
   \   000032   7404         MOV     A,#0x4
   \   000034   12....       LCALL   ?DEALLOC_XSTACK8
   \   000037   E9           MOV     A,R1
   \   000038   702F         JNZ     ??ZDApp_RestoreNwkKey_0
   1506            {
   1507              if ( keyItems.frameCounter > 0 )
   \   00003A   7411         MOV     A,#0x11
   \   00003C   12....       LCALL   ?XSTACK_DISP0_8
   \   00003F   78..         MOV     R0,#?V0 + 0
   \   000041   12....       LCALL   ?L_MOV_X
   \   000044   90....       MOV     DPTR,#__Constant_0
   \   000047   78..         MOV     R0,#?V0 + 0
   \   000049   12....       LCALL   ?L_EQ_X
   \   00004C   6011         JZ      ??ZDApp_RestoreNwkKey_1
   1508              {
   1509                // Restore the key information
   1510                keyItems.frameCounter += MAX_NWK_FRAMECOUNTER_CHANGES;
   1511                nwkFrameCounter = keyItems.frameCounter;
   \   00004E   90....       MOV     DPTR,#__Constant_3e8
   \   000051   78..         MOV     R0,#?V0 + 0
   \   000053   12....       LCALL   ?L_ADD_X
   \   000056   90....       MOV     DPTR,#nwkFrameCounter
   \   000059   78..         MOV     R0,#?V0 + 0
   \   00005B   12....       LCALL   ?L_MOV_TO_X
   1512                ret = true;
   \   00005E   0E           INC     R6
   1513              }
   1514          
   1515              // Force a save for the first frame counter increment
   1516              nwkFrameCounterChanges = MAX_NWK_FRAMECOUNTER_CHANGES + 1;
   \                     ??ZDApp_RestoreNwkKey_1:
   \   00005F   90....       MOV     DPTR,#nwkFrameCounterChanges
   \   000062   74E9         MOV     A,#-0x17
   \   000064   F0           MOVX    @DPTR,A
   \   000065   A3           INC     DPTR
   \   000066   7403         MOV     A,#0x3
   \   000068   F0           MOVX    @DPTR,A
   1517            }
   1518            return ( ret );
   \                     ??ZDApp_RestoreNwkKey_0:
   \   000069   EE           MOV     A,R6
   \   00006A   F9           MOV     R1,A
   \   00006B   7415         MOV     A,#0x15
   \   00006D   12....       LCALL   ?DEALLOC_XSTACK8
   \   000070   7F04         MOV     R7,#0x4
   \   000072   02....       LJMP    ?BANKED_LEAVE_XDATA
   1519          }
   1520          
   1521          /*********************************************************************
   1522           * @fn      ZDApp_ResetTimerStart
   1523           *
   1524           * @brief   Start the reset timer.
   1525           *
   1526           * @param   delay - delay time(ms) before reset
   1527           *
   1528           * @return  none
   1529           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1530          void ZDApp_ResetTimerStart( uint16 delay )
   \                     ZDApp_ResetTimerStart:
   1531          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1532            // Start the rest timer
   1533            osal_start_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET, delay );
   \   000004                ; Setup parameters for call to function osal_start_timerEx
   \   000004   EA           MOV     A,R2
   \   000005   FC           MOV     R4,A
   \   000006   EB           MOV     A,R3
   \   000007   FD           MOV     R5,A
   \   000008   7A04         MOV     R2,#0x4
   \   00000A   7B00         MOV     R3,#0x0
   \   00000C   90....       MOV     DPTR,#ZDAppTaskID
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   F9           MOV     R1,A
   \   000011   12....       LCALL   ??osal_start_timerEx?relay
   1534          }
   \   000014   D083         POP     DPH
   \   000016   D082         POP     DPL
   \   000018   02....       LJMP    ?BRET
   1535          
   1536          /*********************************************************************
   1537           * @fn      ZDApp_ResetTimerCancel
   1538           *
   1539           * @brief   Cancel the reset timer.
   1540           *
   1541           * @param   none
   1542           *
   1543           * @return  none
   1544           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1545          void ZDApp_ResetTimerCancel( void )
   \                     ZDApp_ResetTimerCancel:
   1546          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1547            // Cancel the reset timer
   1548            osal_stop_timerEx( ZDAppTaskID, ZDO_DEVICE_RESET );
   \   000004                ; Setup parameters for call to function osal_stop_timerEx
   \   000004   7A04         MOV     R2,#0x4
   \   000006   7B00         MOV     R3,#0x0
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??osal_stop_timerEx?relay
   1549          }
   \   000010   D083         POP     DPH
   \   000012   D082         POP     DPL
   \   000014   02....       LJMP    ?BRET
   1550          
   1551          /*********************************************************************
   1552           * @fn      ZDApp_LeaveCtrlInit
   1553           *
   1554           * @brief   Initialize the leave control logic.
   1555           *
   1556           * @param   none
   1557           *
   1558           * @return  none
   1559           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1560          void ZDApp_LeaveCtrlInit( void )
   \                     ZDApp_LeaveCtrlInit:
   1561          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1562            uint8 status;
   1563          
   1564          
   1565            // Initialize control state
   1566            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   000005   E4           CLR     A
   \   000006   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000009   F0           MOVX    @DPTR,A
   1567          
   1568            status = osal_nv_item_init( ZCD_NV_LEAVE_CTRL,
   1569                                        sizeof(ZDApp_LeaveCtrl),
   1570                                        &ZDApp_LeaveCtrl );
   1571          
   1572            if ( status == ZSUCCESS )
   \   00000A                ; Setup parameters for call to function osal_nv_item_init
   \   00000A   75....       MOV     ?V0 + 0,#(ZDApp_LeaveCtrl & 0xff)
   \   00000D   75....       MOV     ?V0 + 1,#((ZDApp_LeaveCtrl >> 8) & 0xff)
   \   000010   78..         MOV     R0,#?V0 + 0
   \   000012   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000015   7C01         MOV     R4,#0x1
   \   000017   7D00         MOV     R5,#0x0
   \   000019   7A85         MOV     R2,#-0x7b
   \   00001B   7B00         MOV     R3,#0x0
   \   00001D   12....       LCALL   ??osal_nv_item_init?relay
   \   000020   7402         MOV     A,#0x2
   \   000022   12....       LCALL   ?DEALLOC_XSTACK8
   \   000025   E9           MOV     A,R1
   \   000026   7020         JNZ     ??ZDApp_LeaveCtrlInit_0
   1573            {
   1574              // Read saved control
   1575              osal_nv_read( ZCD_NV_LEAVE_CTRL,
   1576                            0,
   1577                            sizeof( uint8 ),
   1578                            &ZDApp_LeaveCtrl);
   \   000028                ; Setup parameters for call to function osal_nv_read
   \   000028   78..         MOV     R0,#?V0 + 0
   \   00002A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002D   75..01       MOV     ?V0 + 0,#0x1
   \   000030   75..00       MOV     ?V0 + 1,#0x0
   \   000033   78..         MOV     R0,#?V0 + 0
   \   000035   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000038   7C00         MOV     R4,#0x0
   \   00003A   7D00         MOV     R5,#0x0
   \   00003C   7A85         MOV     R2,#-0x7b
   \   00003E   7B00         MOV     R3,#0x0
   \   000040   12....       LCALL   ??osal_nv_read?relay
   \   000043   7404         MOV     A,#0x4
   \   000045   12....       LCALL   ?DEALLOC_XSTACK8
   1579            }
   1580          }
   \                     ??ZDApp_LeaveCtrlInit_0:
   \   000048   7F02         MOV     R7,#0x2
   \   00004A   02....       LJMP    ?BANKED_LEAVE_XDATA
   1581          
   1582          /*********************************************************************
   1583           * @fn      ZDApp_LeaveCtrlSet
   1584           *
   1585           * @brief   Set the leave control logic.
   1586           *
   1587           * @param   ra - reassociate flag
   1588           *
   1589           * @return  none
   1590           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1591          void ZDApp_LeaveCtrlSet( uint8 ra )
   \                     ZDApp_LeaveCtrlSet:
   1592          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1593            ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_SET;
   \   000005   7401         MOV     A,#0x1
   \   000007   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   00000A   F0           MOVX    @DPTR,A
   1594          
   1595            if ( ra == TRUE )
   \   00000B   69           XRL     A,R1
   \   00000C   7003         JNZ     ??ZDApp_LeaveCtrlSet_0
   1596            {
   1597              ZDApp_LeaveCtrl |= ZDAPP_LEAVE_CTRL_RA;
   \   00000E   7403         MOV     A,#0x3
   \   000010   F0           MOVX    @DPTR,A
   1598            }
   1599          
   1600            // Write the leave control
   1601            osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1602                           0,
   1603                           sizeof( uint8 ),
   1604                           &ZDApp_LeaveCtrl);
   \                     ??ZDApp_LeaveCtrlSet_0:
   \   000011                ; Setup parameters for call to function osal_nv_write
   \   000011   75....       MOV     ?V0 + 0,#(ZDApp_LeaveCtrl & 0xff)
   \   000014   75....       MOV     ?V0 + 1,#((ZDApp_LeaveCtrl >> 8) & 0xff)
   \   000017   78..         MOV     R0,#?V0 + 0
   \   000019   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001C   75..01       MOV     ?V0 + 0,#0x1
   \   00001F   75..00       MOV     ?V0 + 1,#0x0
   \   000022   78..         MOV     R0,#?V0 + 0
   \   000024   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000027   7C00         MOV     R4,#0x0
   \   000029   7D00         MOV     R5,#0x0
   \   00002B   7A85         MOV     R2,#-0x7b
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   12....       LCALL   ??osal_nv_write?relay
   \   000032   7404         MOV     A,#0x4
   \   000034   12....       LCALL   ?DEALLOC_XSTACK8
   1605          }
   \   000037   7F02         MOV     R7,#0x2
   \   000039   02....       LJMP    ?BANKED_LEAVE_XDATA
   1606          
   1607          /*********************************************************************
   1608           * @fn      ZDApp_LeaveCtrlBypass
   1609           *
   1610           * @brief   Check if NV restore should be skipped during a leave reset.
   1611           *
   1612           * @param   none
   1613           *
   1614           * @return  uint8 - (TRUE bypass:FALSE do not bypass)
   1615           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1616          uint8 ZDApp_LeaveCtrlBypass( void )
   \                     ZDApp_LeaveCtrlBypass:
   1617          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1618            uint8 bypass;
   1619          
   1620            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   1621            {
   1622              bypass = TRUE;
   1623            }
   1624            else
   1625            {
   1626              bypass = FALSE;
   1627            }
   1628          
   1629            return bypass;
   \   000004   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000007   E0           MOVX    A,@DPTR
   \   000008   A2E0         MOV     C,0xE0 /* A   */.0
   \   00000A   E4           CLR     A
   \   00000B   92E0         MOV     0xE0 /* A   */.0,C
   \   00000D   F9           MOV     R1,A
   \   00000E   D083         POP     DPH
   \   000010   D082         POP     DPL
   \   000012   02....       LJMP    ?BRET
   1630          }
   1631          
   1632          /*********************************************************************
   1633           * @fn      ZDApp_LeaveCtrlStartup
   1634           *
   1635           * @brief   Check for startup conditions during a leave reset.
   1636           *
   1637           * @param   state      - devState_t determined by leave control logic
   1638           * @param   startDelay - startup delay
   1639           *
   1640           * @return  none
   1641           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1642          void ZDApp_LeaveCtrlStartup( devStates_t* state, uint16* startDelay )
   \                     ZDApp_LeaveCtrlStartup:
   1643          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   1644            *startDelay = 0;
   \   000005   8C82         MOV     DPL,R4
   \   000007   8D83         MOV     DPH,R5
   \   000009   E4           CLR     A
   \   00000A   F0           MOVX    @DPTR,A
   \   00000B   A3           INC     DPTR
   \   00000C   F0           MOVX    @DPTR,A
   1645          
   1646            if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_SET )
   \   00000D   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000010   E0           MOVX    A,@DPTR
   \   000011   A2E0         MOV     C,0xE0 /* A   */.0
   \   000013   5042         JNC     ??ZDApp_LeaveCtrlStartup_0
   1647            {
   1648              if ( ZDApp_LeaveCtrl & ZDAPP_LEAVE_CTRL_RA )
   \   000015   E0           MOVX    A,@DPTR
   \   000016   A2E1         MOV     C,0xE0 /* A   */.1
   \   000018   500C         JNC     ??ZDApp_LeaveCtrlStartup_1
   1649              {
   1650                *startDelay = 5000;
   \   00001A   8C82         MOV     DPL,R4
   \   00001C   8D83         MOV     DPH,R5
   \   00001E   7488         MOV     A,#-0x78
   \   000020   F0           MOVX    @DPTR,A
   \   000021   A3           INC     DPTR
   \   000022   7413         MOV     A,#0x13
   \   000024   8005         SJMP    ??ZDApp_LeaveCtrlStartup_2
   1651              }
   1652              else
   1653              {
   1654                *state = DEV_HOLD;
   \                     ??ZDApp_LeaveCtrlStartup_1:
   \   000026   E4           CLR     A
   \   000027   8A82         MOV     DPL,R2
   \   000029   8B83         MOV     DPH,R3
   \                     ??ZDApp_LeaveCtrlStartup_2:
   \   00002B   F0           MOVX    @DPTR,A
   1655              }
   1656          
   1657              // Set leave control to initialized state
   1658              ZDApp_LeaveCtrl = ZDAPP_LEAVE_CTRL_INIT;
   \   00002C   E4           CLR     A
   \   00002D   90....       MOV     DPTR,#ZDApp_LeaveCtrl
   \   000030   F0           MOVX    @DPTR,A
   1659          
   1660              // Write initialized control
   1661              osal_nv_write( ZCD_NV_LEAVE_CTRL,
   1662                            0,
   1663                            sizeof( uint8 ),
   1664                            &ZDApp_LeaveCtrl);
   \   000031                ; Setup parameters for call to function osal_nv_write
   \   000031   75....       MOV     ?V0 + 0,#(ZDApp_LeaveCtrl & 0xff)
   \   000034   75....       MOV     ?V0 + 1,#((ZDApp_LeaveCtrl >> 8) & 0xff)
   \   000037   78..         MOV     R0,#?V0 + 0
   \   000039   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003C   75..01       MOV     ?V0 + 0,#0x1
   \   00003F   75..00       MOV     ?V0 + 1,#0x0
   \   000042   78..         MOV     R0,#?V0 + 0
   \   000044   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000047   7C00         MOV     R4,#0x0
   \   000049   7D00         MOV     R5,#0x0
   \   00004B   7A85         MOV     R2,#-0x7b
   \   00004D   7B00         MOV     R3,#0x0
   \   00004F   12....       LCALL   ??osal_nv_write?relay
   \   000052   7404         MOV     A,#0x4
   \   000054   12....       LCALL   ?DEALLOC_XSTACK8
   1665            }
   1666          }
   \                     ??ZDApp_LeaveCtrlStartup_0:
   \   000057   7F02         MOV     R7,#0x2
   \   000059   02....       LJMP    ?BANKED_LEAVE_XDATA
   1667          
   1668          /*********************************************************************
   1669           * @fn      ZDApp_LeaveReset
   1670           *
   1671           * @brief   Setup a device reset due to a leave indication/confirm.
   1672           *
   1673           * @param   ra - reassociate flag
   1674           *
   1675           * @return  none
   1676           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1677          void ZDApp_LeaveReset( uint8 ra )
   \                     ZDApp_LeaveReset:
   1678          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1679            ZDApp_LeaveCtrlSet( ra );
   \   000004                ; Setup parameters for call to function ZDApp_LeaveCtrlSet
   \   000004   12....       LCALL   ??ZDApp_LeaveCtrlSet?relay
   1680          
   1681            ZDApp_ResetTimerStart( 5000 );
   \   000007                ; Setup parameters for call to function ZDApp_ResetTimerStart
   \   000007   7A88         MOV     R2,#-0x78
   \   000009   7B13         MOV     R3,#0x13
   \   00000B   12....       LCALL   ??ZDApp_ResetTimerStart?relay
   1682          }
   \   00000E   D083         POP     DPH
   \   000010   D082         POP     DPL
   \   000012   02....       LJMP    ?BRET
   1683          
   1684          /*********************************************************************
   1685           * @fn      ZDApp_LeaveUpdate
   1686           *
   1687           * @brief   Update local device data related to leaving device.
   1688           *
   1689           * @param   nwkAddr        - NWK address of leaving device
   1690           * @param   extAddr        - EXT address of leaving device
   1691           * @param   removeChildren - remove children of leaving device
   1692           *
   1693           * @return  none
   1694           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1695          void ZDApp_LeaveUpdate( uint16 nwkAddr, uint8* extAddr,
   \                     ZDApp_LeaveUpdate:
   1696                                  uint8 removeChildren )
   1697          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   \   000004   EC           MOV     A,R4
   \   000005   FA           MOV     R2,A
   \   000006   ED           MOV     A,R5
   \   000007   FB           MOV     R3,A
   1698            /*
   1699            AddrMgrEntry_t entry;
   1700            */
   1701            (void)nwkAddr;  // Intentionally unreferenced parameter
   1702          
   1703            // Remove if child
   1704            if ( ZSTACK_ROUTER_BUILD )
   1705            {
   1706              NLME_RemoveChild( extAddr, removeChildren );
   \   000008                ; Setup parameters for call to function NLME_RemoveChild
   \   000008   12....       LCALL   ??NLME_RemoveChild?relay
   1707            }
   1708          
   1709            /*
   1710            // Set NWK address to invalid
   1711            entry.user    = ADDRMGR_USER_DEFAULT;
   1712            entry.nwkAddr = INVALID_NODE_ADDR;
   1713            AddrMgrExtAddrSet( entry.extAddr, extAddr );
   1714            AddrMgrEntryUpdate( &entry );
   1715          
   1716            // Check
   1717            if ( removeChildren == TRUE )
   1718            {
   1719              // Set index to INVALID_NODE_ADDR to start search
   1720              entry.index = INVALID_NODE_ADDR;
   1721          
   1722              // Get first entry
   1723              AddrMgrEntryGetNext( &entry );
   1724          
   1725              // Remove all descendents
   1726              while ( entry.index != INVALID_NODE_ADDR )
   1727              {
   1728                // Check NWK address allocation algorithm
   1729                if ( RTG_ANCESTOR( entry.nwkAddr, thisAddr ) != 0 )
   1730                {
   1731                  // Set NWK address to invalid
   1732                  entry.nwkAddr = INVALID_NODE_ADDR;
   1733                  AddrMgrEntryUpdate( &entry );
   1734                }
   1735          
   1736                // Get next entry
   1737                AddrMgrEntryGetNext( &entry );
   1738              }
   1739            }
   1740            */
   1741          }
   \   00000B   D083         POP     DPH
   \   00000D   D082         POP     DPL
   \   00000F   02....       LJMP    ?BRET
   1742          
   1743          /*********************************************************************
   1744           * CALLBACK FUNCTIONS
   1745           */
   1746          
   1747          
   1748          /*********************************************************************
   1749           * @fn      ZDApp_SendEventMsg()
   1750           *
   1751           * @brief
   1752           *
   1753           *   Sends a Network Join message
   1754           *
   1755           * @param  cmd - command ID
   1756           * @param  len - length (in bytes) of the buf field
   1757           * @param  buf - buffer for the rest of the message.
   1758           *
   1759           * @return  none
   1760           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1761          void ZDApp_SendEventMsg( uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendEventMsg:
   1762          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1763            ZDApp_SendMsg( ZDAppTaskID, cmd, len, buf );
   \   000004                ; Setup parameters for call to function ZDApp_SendMsg
   \   000004   EA           MOV     A,R2
   \   000005   FB           MOV     R3,A
   \   000006   E9           MOV     A,R1
   \   000007   FA           MOV     R2,A
   \   000008   90....       MOV     DPTR,#ZDAppTaskID
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??ZDApp_SendMsg?relay
   1764          }
   \   000010   D083         POP     DPH
   \   000012   D082         POP     DPL
   \   000014   02....       LJMP    ?BRET
   1765          
   1766          /*********************************************************************
   1767           * @fn      ZDApp_SendMsg()
   1768           *
   1769           * @brief   Sends a OSAL message
   1770           *
   1771           * @param  taskID - Where to send the message
   1772           * @param  cmd - command ID
   1773           * @param  len - length (in bytes) of the buf field
   1774           * @param  buf - buffer for the rest of the message.
   1775           *
   1776           * @return  none
   1777           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1778          void ZDApp_SendMsg( uint8 taskID, uint8 cmd, uint8 len, uint8 *buf )
   \                     ZDApp_SendMsg:
   1779          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 3
   \   000005   74FD         MOV     A,#-0x3
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   85..82       MOV     DPL,?XSP + 0
   \   00000E   85..83       MOV     DPH,?XSP + 1
   \   000011   F0           MOVX    @DPTR,A
   \   000012   7401         MOV     A,#0x1
   \   000014   12....       LCALL   ?XSTACK_DISP0_8
   \   000017   EC           MOV     A,R4
   \   000018   F0           MOVX    @DPTR,A
   \   000019   A3           INC     DPTR
   \   00001A   ED           MOV     A,R5
   \   00001B   F0           MOVX    @DPTR,A
   \   00001C   89..         MOV     ?V0 + 3,R1
   1780            osal_event_hdr_t *msgPtr;
   1781          
   1782            // Send the address to the task
   1783            msgPtr = (osal_event_hdr_t *)osal_msg_allocate( len );
   \   00001E   8B82         MOV     DPL,R3
   \   000020   AE82         MOV     R6,DPL
   \   000022                ; Setup parameters for call to function osal_msg_allocate
   \   000022   EE           MOV     A,R6
   \   000023   FA           MOV     R2,A
   \   000024   7B00         MOV     R3,#0x0
   \   000026   12....       LCALL   ??osal_msg_allocate?relay
   \   000029   8A..         MOV     ?V0 + 4,R2
   \   00002B   8B..         MOV     ?V0 + 5,R3
   1784            if ( msgPtr )
   \   00002D   EA           MOV     A,R2
   \   00002E   7001         JNZ     ??ZDApp_SendMsg_0
   \   000030   EB           MOV     A,R3
   \                     ??ZDApp_SendMsg_0:
   \   000031   6046         JZ      ??ZDApp_SendMsg_1
   1785            {
   1786              if ( (len > 0) && (buf != NULL) )
   \   000033   EE           MOV     A,R6
   \   000034   602C         JZ      ??ZDApp_SendMsg_2
   \   000036   7401         MOV     A,#0x1
   \   000038   12....       LCALL   ?XSTACK_DISP0_8
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   7002         JNZ     ??ZDApp_SendMsg_3
   \   00003E   A3           INC     DPTR
   \   00003F   E0           MOVX    A,@DPTR
   \                     ??ZDApp_SendMsg_3:
   \   000040   6020         JZ      ??ZDApp_SendMsg_2
   1787                osal_memcpy( msgPtr, buf, len );
   \   000042                ; Setup parameters for call to function osal_memcpy
   \   000042   7401         MOV     A,#0x1
   \   000044   12....       LCALL   ?XSTACK_DISP0_8
   \   000047   E0           MOVX    A,@DPTR
   \   000048   F5..         MOV     ?V0 + 0,A
   \   00004A   A3           INC     DPTR
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   F5..         MOV     ?V0 + 1,A
   \   00004E   75..00       MOV     ?V0 + 2,#0x0
   \   000051   78..         MOV     R0,#?V0 + 0
   \   000053   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000056   EE           MOV     A,R6
   \   000057   FC           MOV     R4,A
   \   000058   7D00         MOV     R5,#0x0
   \   00005A   12....       LCALL   ??osal_memcpy?relay
   \   00005D   7403         MOV     A,#0x3
   \   00005F   12....       LCALL   ?DEALLOC_XSTACK8
   1788          
   1789              msgPtr->event = cmd;
   \                     ??ZDApp_SendMsg_2:
   \   000062   85..82       MOV     DPL,?XSP + 0
   \   000065   85..83       MOV     DPH,?XSP + 1
   \   000068   E0           MOVX    A,@DPTR
   \   000069   85..82       MOV     DPL,?V0 + 4
   \   00006C   85..83       MOV     DPH,?V0 + 5
   \   00006F   F0           MOVX    @DPTR,A
   1790              osal_msg_send( taskID, (uint8 *)msgPtr );
   \   000070                ; Setup parameters for call to function osal_msg_send
   \   000070   AA..         MOV     R2,?V0 + 4
   \   000072   AB..         MOV     R3,?V0 + 5
   \   000074   A9..         MOV     R1,?V0 + 3
   \   000076   12....       LCALL   ??osal_msg_send?relay
   1791            }
   1792          }
   \                     ??ZDApp_SendMsg_1:
   \   000079   7403         MOV     A,#0x3
   \   00007B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00007E   7F06         MOV     R7,#0x6
   \   000080   02....       LJMP    ?BANKED_LEAVE_XDATA
   1793          
   1794          /*********************************************************************
   1795           * Call Back Functions from NWK  - API
   1796           */
   1797          
   1798          /*********************************************************************
   1799           * @fn          ZDO_NetworkDiscoveryConfirmCB
   1800           *
   1801           * @brief       This function returns a choice of PAN to join.
   1802           *
   1803           * @param       ResultCount - Number of routers discovered
   1804           * @param               NetworkList - Pointer to list of network descriptors
   1805           *
   1806           * @return      ZStatus_t
   1807           */
   1808          #define STACK_PROFILE_MAX 2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1809          ZStatus_t ZDO_NetworkDiscoveryConfirmCB( uint8 ResultCount,
   \                     ZDO_NetworkDiscoveryConfirmCB:
   1810                                                   networkDesc_t *NetworkList )
   1811          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 14
   \   000005   74F2         MOV     A,#-0xe
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   89..         MOV     ?V0 + 3,R1
   \   00000C   8A..         MOV     ?V0 + 4,R2
   \   00000E   8B..         MOV     ?V0 + 5,R3
   1812            networkDesc_t *pNwkDesc = NetworkList;
   \   000010   AE..         MOV     R6,?V0 + 4
   \   000012   AF..         MOV     R7,?V0 + 5
   1813            ZDO_NetworkDiscoveryCfm_t msg;
   1814            uint8 i = ResultCount;
   \   000014   89..         MOV     ?V0 + 0,R1
   1815            uint8 stackProfile;
   1816            uint8 stackProfilePro;
   1817            uint8 selected;
   1818          
   1819          #if defined ( ZDO_MGMT_NWKDISC_RESPONSE )
   1820            if ( zdappMgmtNwkDiscReqInProgress )
   1821            {
   1822              zdappMgmtNwkDiscReqInProgress = false;
   1823              ZDO_FinishProcessingMgmtNwkDiscReq( ResultCount, NetworkList );
   1824              return ( ZSuccess );
   1825            }
   1826          #endif
   1827          
   1828            // process discovery results
   1829            stackProfilePro = FALSE;
   \   000016   75..00       MOV     ?V0 + 1,#0x0
   1830            selected = FALSE;
   1831          
   1832            for ( stackProfile = 0; stackProfile < STACK_PROFILE_MAX; stackProfile++ )
   \   000019   75..00       MOV     ?V0 + 2,#0x0
   \   00001C   8002         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_0
   \                     ??ZDO_NetworkDiscoveryConfirmCB_1:
   \   00001E   05..         INC     ?V0 + 2
   \                     ??ZDO_NetworkDiscoveryConfirmCB_0:
   \   000020   E5..         MOV     A,?V0 + 2
   \   000022   C3           CLR     C
   \   000023   9402         SUBB    A,#0x2
   \   000025   4003         JC      $+5
   \   000027   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_2 & 0xFFFF
   1833            {
   1834              pNwkDesc = NetworkList;
   \   00002A   AE..         MOV     R6,?V0 + 4
   \   00002C   AF..         MOV     R7,?V0 + 5
   1835              for ( i = 0; i < ResultCount; i++, pNwkDesc = pNwkDesc->nextDesc )
   \   00002E   75..00       MOV     ?V0 + 0,#0x0
   \   000031   8014         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_3
   1836              {
   1837                if ( zgConfigPANID != 0xFFFF )
   1838                {
   1839                  // PAN Id is preconfigured. check if it matches
   1840                  if ( pNwkDesc->panId != zgConfigPANID )
   1841                    continue;
   1842                }
   1843          
   1844          
   1845                if ( nwk_ExtPANIDValid( ZDO_UseExtendedPANID) == true )
   1846                {
   1847                  // If the extended Pan ID is commissioned to a non zero value
   1848                  // Only join the Pan that has match EPID
   1849                  if ( osal_ExtAddrEqual( ZDO_UseExtendedPANID, pNwkDesc->extendedPANID) == false )
   1850                    continue;
   1851          
   1852                }
   1853          
   1854          
   1855                  // check that network is allowing joining
   1856                  if ( ZSTACK_ROUTER_BUILD )
   1857                  {
   1858                    if ( stackProfilePro == FALSE )
   1859                    {
   1860                      if ( !pNwkDesc->routerCapacity )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_4:
   \   000033   E0           MOVX    A,@DPTR
   \   000034   706D         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_5
   1861                      {
   1862                        continue;
   1863                      }
   1864                    }
   \                     ??ZDO_NetworkDiscoveryConfirmCB_6:
   \   000036   05..         INC     ?V0 + 0
   \   000038   EE           MOV     A,R6
   \   000039   2416         ADD     A,#0x16
   \   00003B   F582         MOV     DPL,A
   \   00003D   EF           MOV     A,R7
   \   00003E   3400         ADDC    A,#0x0
   \   000040   F583         MOV     DPH,A
   \   000042   E0           MOVX    A,@DPTR
   \   000043   FE           MOV     R6,A
   \   000044   A3           INC     DPTR
   \   000045   E0           MOVX    A,@DPTR
   \   000046   FF           MOV     R7,A
   \                     ??ZDO_NetworkDiscoveryConfirmCB_3:
   \   000047   E5..         MOV     A,?V0 + 0
   \   000049   C3           CLR     C
   \   00004A   95..         SUBB    A,?V0 + 3
   \   00004C   4003         JC      $+5
   \   00004E   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_7 & 0xFFFF
   \   000051   90....       MOV     DPTR,#zgConfigPANID
   \   000054   E0           MOVX    A,@DPTR
   \   000055   64FF         XRL     A,#0xff
   \   000057   7004         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_8
   \   000059   A3           INC     DPTR
   \   00005A   E0           MOVX    A,@DPTR
   \   00005B   64FF         XRL     A,#0xff
   \                     ??ZDO_NetworkDiscoveryConfirmCB_8:
   \   00005D   6015         JZ      ??ZDO_NetworkDiscoveryConfirmCB_9
   \   00005F   8E82         MOV     DPL,R6
   \   000061   8F83         MOV     DPH,R7
   \   000063   E0           MOVX    A,@DPTR
   \   000064   F8           MOV     R0,A
   \   000065   A3           INC     DPTR
   \   000066   E0           MOVX    A,@DPTR
   \   000067   F9           MOV     R1,A
   \   000068   90....       MOV     DPTR,#zgConfigPANID
   \   00006B   E0           MOVX    A,@DPTR
   \   00006C   68           XRL     A,R0
   \   00006D   7003         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_10
   \   00006F   A3           INC     DPTR
   \   000070   E0           MOVX    A,@DPTR
   \   000071   69           XRL     A,R1
   \                     ??ZDO_NetworkDiscoveryConfirmCB_10:
   \   000072   70C2         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_9:
   \   000074                ; Setup parameters for call to function nwk_ExtPANIDValid
   \   000074   7A..         MOV     R2,#(ZDO_UseExtendedPANID & 0xff)
   \   000076   7B..         MOV     R3,#((ZDO_UseExtendedPANID >> 8) & 0xff)
   \   000078   12....       LCALL   ??nwk_ExtPANIDValid?relay
   \   00007B   E9           MOV     A,R1
   \   00007C   6401         XRL     A,#0x1
   \   00007E   7012         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_11
   \   000080                ; Setup parameters for call to function sAddrExtCmp
   \   000080   EE           MOV     A,R6
   \   000081   240D         ADD     A,#0xd
   \   000083   FC           MOV     R4,A
   \   000084   EF           MOV     A,R7
   \   000085   3400         ADDC    A,#0x0
   \   000087   FD           MOV     R5,A
   \   000088   7A..         MOV     R2,#(ZDO_UseExtendedPANID & 0xff)
   \   00008A   7B..         MOV     R3,#((ZDO_UseExtendedPANID >> 8) & 0xff)
   \   00008C   12....       LCALL   ??sAddrExtCmp?relay
   \   00008F   E9           MOV     A,R1
   \   000090   60A4         JZ      ??ZDO_NetworkDiscoveryConfirmCB_6
   \                     ??ZDO_NetworkDiscoveryConfirmCB_11:
   \   000092   E5..         MOV     A,?V0 + 1
   \   000094   8E82         MOV     DPL,R6
   \   000096   8F83         MOV     DPH,R7
   \   000098   A3           INC     DPTR
   \   000099   A3           INC     DPTR
   \   00009A   A3           INC     DPTR
   \   00009B   A3           INC     DPTR
   \   00009C   A3           INC     DPTR
   \   00009D   6094         JZ      ??ZDO_NetworkDiscoveryConfirmCB_4
   1865                    else
   1866                    {
   1867                      if ( !pNwkDesc->deviceCapacity )
   \   00009F   A3           INC     DPTR
   \   0000A0   E0           MOVX    A,@DPTR
   \   0000A1   6093         JZ      ??ZDO_NetworkDiscoveryConfirmCB_6
   1868                      {
   1869                        continue;
   1870                      }
   1871                    }
   1872                  }
   1873                  else if ( ZSTACK_END_DEVICE_BUILD )
   1874                  {
   1875                    if ( !pNwkDesc->deviceCapacity )
   1876                    {
   1877                      continue;
   1878                    }
   1879                  }
   1880          
   1881                  // check version of zigbee protocol
   1882                  if ( pNwkDesc->version != _NIB.nwkProtocolVersion )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_5:
   \   0000A3   8E82         MOV     DPL,R6
   \   0000A5   8F83         MOV     DPH,R7
   \   0000A7   A3           INC     DPTR
   \   0000A8   A3           INC     DPTR
   \   0000A9   A3           INC     DPTR
   \   0000AA   A3           INC     DPTR
   \   0000AB   A3           INC     DPTR
   \   0000AC   A3           INC     DPTR
   \   0000AD   A3           INC     DPTR
   \   0000AE   E0           MOVX    A,@DPTR
   \   0000AF   FA           MOV     R2,A
   \   0000B0   90....       MOV     DPTR,#(_NIB + 17)
   \   0000B3   E0           MOVX    A,@DPTR
   \   0000B4   6A           XRL     A,R2
   \   0000B5   6003         JZ      $+5
   \   0000B7   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_6 & 0xFFFF
   1883                    continue;
   1884          
   1885                  // check version of stack profile
   1886                  if ( pNwkDesc->stackProfile != zgStackProfile  )
   \   0000BA   EE           MOV     A,R6
   \   0000BB   2408         ADD     A,#0x8
   \   0000BD   F8           MOV     R0,A
   \   0000BE   EF           MOV     A,R7
   \   0000BF   3400         ADDC    A,#0x0
   \   0000C1   F9           MOV     R1,A
   \   0000C2   8882         MOV     DPL,R0
   \   0000C4   8983         MOV     DPH,R1
   \   0000C6   E0           MOVX    A,@DPTR
   \   0000C7   FA           MOV     R2,A
   \   0000C8   90....       MOV     DPTR,#zgStackProfile
   \   0000CB   E0           MOVX    A,@DPTR
   \   0000CC   6A           XRL     A,R2
   \   0000CD   6029         JZ      ??ZDO_NetworkDiscoveryConfirmCB_7
   1887                  {
   1888                    if ( ((zgStackProfile == HOME_CONTROLS) && (pNwkDesc->stackProfile == ZIGBEEPRO_PROFILE))
   1889                        || ((zgStackProfile == ZIGBEEPRO_PROFILE) && (pNwkDesc->stackProfile == HOME_CONTROLS))  )
   \   0000CF   E0           MOVX    A,@DPTR
   \   0000D0   6401         XRL     A,#0x1
   \   0000D2   7009         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_12
   \   0000D4   8882         MOV     DPL,R0
   \   0000D6   8983         MOV     DPH,R1
   \   0000D8   E0           MOVX    A,@DPTR
   \   0000D9   6402         XRL     A,#0x2
   \   0000DB   6011         JZ      ??ZDO_NetworkDiscoveryConfirmCB_13
   \                     ??ZDO_NetworkDiscoveryConfirmCB_12:
   \   0000DD   90....       MOV     DPTR,#zgStackProfile
   \   0000E0   E0           MOVX    A,@DPTR
   \   0000E1   6402         XRL     A,#0x2
   \   0000E3   700C         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_14
   \   0000E5   8882         MOV     DPL,R0
   \   0000E7   8983         MOV     DPH,R1
   \   0000E9   E0           MOVX    A,@DPTR
   \   0000EA   6401         XRL     A,#0x1
   \   0000EC   7003         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_14
   1890                      stackProfilePro = TRUE;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_13:
   \   0000EE   75..01       MOV     ?V0 + 1,#0x1
   1891          
   1892                    if ( stackProfile == 0 )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_14:
   \   0000F1   E5..         MOV     A,?V0 + 2
   \   0000F3   7003         JNZ     $+5
   \   0000F5   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_6 & 0xFFFF
   1893                    {
   1894                      continue;
   1895                    }
   1896                  }
   1897          
   1898                // check if beacon order is the right value..
   1899                //  if ( pNwkDesc->beaconOrder < ZDO_CONFIG_MAX_BO )
   1900                //    continue;
   1901          
   1902                // choose this pan for joining
   1903                break;
   1904              }
   1905              if (i < ResultCount)
   \                     ??ZDO_NetworkDiscoveryConfirmCB_7:
   \   0000F8   E5..         MOV     A,?V0 + 0
   \   0000FA   C3           CLR     C
   \   0000FB   95..         SUBB    A,?V0 + 3
   \   0000FD   4007         JC      ??ZDO_NetworkDiscoveryConfirmCB_2
   1906              {
   1907               selected = TRUE;
   1908                break;
   1909              }
   1910          
   1911              // break if selected or stack profile pro wasn't found
   1912              if ( (selected == TRUE) || (stackProfilePro == FALSE) )
   \   0000FF   E5..         MOV     A,?V0 + 1
   \   000101   6003         JZ      $+5
   \   000103   02....       LJMP    ??ZDO_NetworkDiscoveryConfirmCB_1 & 0xFFFF
   1913              {
   1914                break;
   1915              }
   1916            }
   1917          
   1918            if ( i == ResultCount )
   \                     ??ZDO_NetworkDiscoveryConfirmCB_2:
   \   000106   E5..         MOV     A,?V0 + 3
   \   000108   65..         XRL     A,?V0 + 0
   \   00010A   700C         JNZ     ??ZDO_NetworkDiscoveryConfirmCB_15
   1919            {
   1920              msg.hdr.status = ZDO_FAIL;   // couldn't find appropriate PAN to join !
   \   00010C   7401         MOV     A,#0x1
   \   00010E   C0E0         PUSH    A
   \   000110   12....       LCALL   ?XSTACK_DISP0_8
   \   000113   D0E0         POP     A
   \   000115   F0           MOVX    @DPTR,A
   \   000116   8065         SJMP    ??ZDO_NetworkDiscoveryConfirmCB_16
   1921            }
   1922            else
   1923            {
   1924              msg.hdr.status = ZDO_SUCCESS;
   \                     ??ZDO_NetworkDiscoveryConfirmCB_15:
   \   000118   E4           CLR     A
   \   000119   C0E0         PUSH    A
   \   00011B   7401         MOV     A,#0x1
   \   00011D   12....       LCALL   ?XSTACK_DISP0_8
   \   000120   D0E0         POP     A
   \   000122   F0           MOVX    @DPTR,A
   1925              msg.panIdLSB = LO_UINT16( pNwkDesc->panId );
   \   000123   8E82         MOV     DPL,R6
   \   000125   8F83         MOV     DPH,R7
   \   000127   E0           MOVX    A,@DPTR
   \   000128   C0E0         PUSH    A
   \   00012A   7402         MOV     A,#0x2
   \   00012C   12....       LCALL   ?XSTACK_DISP0_8
   \   00012F   D0E0         POP     A
   \   000131   F0           MOVX    @DPTR,A
   1926              msg.panIdMSB = HI_UINT16( pNwkDesc->panId );
   \   000132   8E82         MOV     DPL,R6
   \   000134   8F83         MOV     DPH,R7
   \   000136   A3           INC     DPTR
   \   000137   E0           MOVX    A,@DPTR
   \   000138   C0E0         PUSH    A
   \   00013A   7403         MOV     A,#0x3
   \   00013C   12....       LCALL   ?XSTACK_DISP0_8
   \   00013F   D0E0         POP     A
   \   000141   F0           MOVX    @DPTR,A
   1927              msg.logicalChannel = pNwkDesc->logicalChannel;
   \   000142   8E82         MOV     DPL,R6
   \   000144   8F83         MOV     DPH,R7
   \   000146   A3           INC     DPTR
   \   000147   A3           INC     DPTR
   \   000148   E0           MOVX    A,@DPTR
   \   000149   C0E0         PUSH    A
   \   00014B   7404         MOV     A,#0x4
   \   00014D   12....       LCALL   ?XSTACK_DISP0_8
   \   000150   D0E0         POP     A
   \   000152   F0           MOVX    @DPTR,A
   1928              msg.version = pNwkDesc->version;
   \   000153   8E82         MOV     DPL,R6
   \   000155   8F83         MOV     DPH,R7
   \   000157   A3           INC     DPTR
   \   000158   A3           INC     DPTR
   \   000159   A3           INC     DPTR
   \   00015A   A3           INC     DPTR
   \   00015B   A3           INC     DPTR
   \   00015C   A3           INC     DPTR
   \   00015D   A3           INC     DPTR
   \   00015E   E0           MOVX    A,@DPTR
   \   00015F   C0E0         PUSH    A
   \   000161   7405         MOV     A,#0x5
   \   000163   12....       LCALL   ?XSTACK_DISP0_8
   \   000166   D0E0         POP     A
   \   000168   F0           MOVX    @DPTR,A
   1929              osal_cpyExtAddr( msg.extendedPANID, pNwkDesc->extendedPANID );
   \   000169                ; Setup parameters for call to function sAddrExtCpy
   \   000169   EE           MOV     A,R6
   \   00016A   240D         ADD     A,#0xd
   \   00016C   FC           MOV     R4,A
   \   00016D   EF           MOV     A,R7
   \   00016E   3400         ADDC    A,#0x0
   \   000170   FD           MOV     R5,A
   \   000171   7406         MOV     A,#0x6
   \   000173   12....       LCALL   ?XSTACK_DISP0_8
   \   000176   AA82         MOV     R2,DPL
   \   000178   AB83         MOV     R3,DPH
   \   00017A   12....       LCALL   ??sAddrExtCpy?relay
   1930            }
   1931          
   1932            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_DISC_CNF, sizeof(ZDO_NetworkDiscoveryCfm_t), (uint8 *)&msg );
   \                     ??ZDO_NetworkDiscoveryConfirmCB_16:
   \   00017D                ; Setup parameters for call to function ZDApp_SendMsg
   \   00017D   85..82       MOV     DPL,?XSP + 0
   \   000180   85..83       MOV     DPH,?XSP + 1
   \   000183   AC82         MOV     R4,DPL
   \   000185   AD83         MOV     R5,DPH
   \   000187   7B0E         MOV     R3,#0xe
   \   000189   7A01         MOV     R2,#0x1
   \   00018B   90....       MOV     DPTR,#ZDAppTaskID
   \   00018E   E0           MOVX    A,@DPTR
   \   00018F   F9           MOV     R1,A
   \   000190   12....       LCALL   ??ZDApp_SendMsg?relay
   1933          
   1934            return (ZSuccess);
   \   000193   7900         MOV     R1,#0x0
   \   000195   740E         MOV     A,#0xe
   \   000197   12....       LCALL   ?DEALLOC_XSTACK8
   \   00019A   7F06         MOV     R7,#0x6
   \   00019C   02....       LJMP    ?BANKED_LEAVE_XDATA
   1935          }  // ZDO_NetworkDiscoveryConfirmCB
   1936          
   1937          /*********************************************************************
   1938           * @fn          ZDO_NetworkFormationConfirmCB
   1939           *
   1940           * @brief       This function reports the results of the request to
   1941           *              initialize a coordinator in a network.
   1942           *
   1943           * @param       Status - Result of NLME_NetworkFormationRequest()
   1944           *
   1945           * @return      none
   1946           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1947          void ZDO_NetworkFormationConfirmCB( ZStatus_t Status )
   \                     ZDO_NetworkFormationConfirmCB:
   1948          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1949            nwkStatus = (byte)Status;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#nwkStatus
   \   000008   F0           MOVX    @DPTR,A
   1950          
   1951            if ( Status == ZSUCCESS )
   \   000009   7019         JNZ     ??ZDO_NetworkFormationConfirmCB_0
   1952            {
   1953              // LED on shows Coordinator started
   1954              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   \   00000B                ; Setup parameters for call to function HalLedSet
   \   00000B   7A01         MOV     R2,#0x1
   \   00000D   7904         MOV     R1,#0x4
   \   00000F   12....       LCALL   ??HalLedSet?relay
   1955          
   1956              // LED off forgets HOLD_AUTO_START
   1957              HalLedSet (HAL_LED_4, HAL_LED_MODE_OFF);
   \   000012                ; Setup parameters for call to function HalLedSet
   \   000012   7A00         MOV     R2,#0x0
   \   000014   7908         MOV     R1,#0x8
   \   000016   12....       LCALL   ??HalLedSet?relay
   1958          
   1959          #if defined ( ZBIT )
   1960              SIM_SetColor(0xd0ffd0);
   1961          #endif
   1962          
   1963              if ( devState == DEV_HOLD )
   \   000019   90....       MOV     DPTR,#devState
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   700C         JNZ     ??ZDO_NetworkFormationConfirmCB_1
   1964              {
   1965                // Began with HOLD_AUTO_START
   1966                devState = DEV_COORD_STARTING;
   \   00001F   7408         MOV     A,#0x8
   \   000021   F0           MOVX    @DPTR,A
   \   000022   8007         SJMP    ??ZDO_NetworkFormationConfirmCB_1
   1967              }
   1968            }
   1969          #if defined(BLINK_LEDS)
   1970            else
   1971              HalLedSet ( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   \                     ??ZDO_NetworkFormationConfirmCB_0:
   \   000024                ; Setup parameters for call to function HalLedSet
   \   000024   7A04         MOV     R2,#0x4
   \   000026   7904         MOV     R1,#0x4
   \   000028   12....       LCALL   ??HalLedSet?relay
   1972          #endif
   1973          
   1974            osal_set_event( ZDAppTaskID, ZDO_NETWORK_START );
   \                     ??ZDO_NetworkFormationConfirmCB_1:
   \   00002B                ; Setup parameters for call to function osal_set_event
   \   00002B   7A02         MOV     R2,#0x2
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   90....       MOV     DPTR,#ZDAppTaskID
   \   000032   E0           MOVX    A,@DPTR
   \   000033   F9           MOV     R1,A
   \   000034   12....       LCALL   ??osal_set_event?relay
   1975          }
   \   000037   D083         POP     DPH
   \   000039   D082         POP     DPL
   \   00003B   02....       LJMP    ?BRET
   1976          
   1977          /*********************************************************************
   1978           * @fn          ZDO_StartRouterConfirmCB
   1979           *
   1980           * @brief       This function reports the results of the request to
   1981           *              start functioning as a router in a network.
   1982           *
   1983           * @param       Status - Result of NLME_StartRouterRequest()
   1984           *
   1985           * @return      none
   1986           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1987          void ZDO_StartRouterConfirmCB( ZStatus_t Status )
   \                     ZDO_StartRouterConfirmCB:
   1988          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   1989            nwkStatus = (byte)Status;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#nwkStatus
   \   000008   F0           MOVX    @DPTR,A
   1990          
   1991            if ( Status == ZSUCCESS )
   \   000009   7019         JNZ     ??ZDO_StartRouterConfirmCB_0
   1992            {
   1993              // LED on shows Router started
   1994              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   \   00000B                ; Setup parameters for call to function HalLedSet
   \   00000B   7A01         MOV     R2,#0x1
   \   00000D   7904         MOV     R1,#0x4
   \   00000F   12....       LCALL   ??HalLedSet?relay
   1995              // LED off forgets HOLD_AUTO_START
   1996              HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF);
   \   000012                ; Setup parameters for call to function HalLedSet
   \   000012   7A00         MOV     R2,#0x0
   \   000014   7908         MOV     R1,#0x8
   \   000016   12....       LCALL   ??HalLedSet?relay
   1997              if ( devState == DEV_HOLD )
   \   000019   90....       MOV     DPTR,#devState
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   700C         JNZ     ??ZDO_StartRouterConfirmCB_1
   1998              {
   1999                // Began with HOLD_AUTO_START
   2000                devState = DEV_END_DEVICE;
   \   00001F   7406         MOV     A,#0x6
   \   000021   F0           MOVX    @DPTR,A
   \   000022   8007         SJMP    ??ZDO_StartRouterConfirmCB_1
   2001              }
   2002            }
   2003          #if defined(BLINK_LEDS)
   2004            else
   2005              HalLedSet( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   \                     ??ZDO_StartRouterConfirmCB_0:
   \   000024                ; Setup parameters for call to function HalLedSet
   \   000024   7A04         MOV     R2,#0x4
   \   000026   7904         MOV     R1,#0x4
   \   000028   12....       LCALL   ??HalLedSet?relay
   2006          #endif
   2007          
   2008            osal_set_event( ZDAppTaskID, ZDO_ROUTER_START );
   \                     ??ZDO_StartRouterConfirmCB_1:
   \   00002B                ; Setup parameters for call to function osal_set_event
   \   00002B   7A20         MOV     R2,#0x20
   \   00002D   7B00         MOV     R3,#0x0
   \   00002F   90....       MOV     DPTR,#ZDAppTaskID
   \   000032   E0           MOVX    A,@DPTR
   \   000033   F9           MOV     R1,A
   \   000034   12....       LCALL   ??osal_set_event?relay
   2009          }
   \   000037   D083         POP     DPH
   \   000039   D082         POP     DPL
   \   00003B   02....       LJMP    ?BRET
   2010          
   2011          /*********************************************************************
   2012           * @fn          ZDO_JoinConfirmCB
   2013           *
   2014           * @brief       This function allows the next hight layer to be notified
   2015           *              of the results of its request to join itself or another
   2016           *              device to a network.
   2017           *
   2018           * @param       Status - Result of NLME_JoinRequest()
   2019           *
   2020           * @return      none
   2021           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2022          void ZDO_JoinConfirmCB( uint16 PanId, ZStatus_t Status )
   \                     ZDO_JoinConfirmCB:
   2023          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2024            (void)PanId;  // remove if this parameter is used.
   2025          
   2026            nwkStatus = (byte)Status;
   \   000004   E9           MOV     A,R1
   \   000005   90....       MOV     DPTR,#nwkStatus
   \   000008   F0           MOVX    @DPTR,A
   2027          
   2028            if ( Status == ZSUCCESS )
   \   000009   701C         JNZ     ??ZDO_JoinConfirmCB_0
   2029            {
   2030              // LED on shows device joined
   2031              HalLedSet ( HAL_LED_3, HAL_LED_MODE_ON );
   \   00000B                ; Setup parameters for call to function HalLedSet
   \   00000B   7A01         MOV     R2,#0x1
   \   00000D   7904         MOV     R1,#0x4
   \   00000F   12....       LCALL   ??HalLedSet?relay
   2032              // LED off forgets HOLD_AUTO_START
   2033              HalLedSet ( HAL_LED_4, HAL_LED_MODE_OFF);
   \   000012                ; Setup parameters for call to function HalLedSet
   \   000012   7A00         MOV     R2,#0x0
   \   000014   7908         MOV     R1,#0x8
   \   000016   12....       LCALL   ??HalLedSet?relay
   2034              if ( (devState == DEV_HOLD) )
   \   000019   90....       MOV     DPTR,#devState
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   7003         JNZ     ??ZDO_JoinConfirmCB_1
   2035              {
   2036                // Began with HOLD_AUTO_START
   2037                devState = DEV_NWK_JOINING;
   \   00001F   7403         MOV     A,#0x3
   \   000021   F0           MOVX    @DPTR,A
   2038              }
   2039          
   2040              if ( !ZG_SECURE_ENABLED )
   2041              {
   2042                // Notify to save info into NV
   2043                ZDApp_NVUpdate();
   \                     ??ZDO_JoinConfirmCB_1:
   \   000022                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000022   12....       LCALL   ??ZDApp_NVUpdate?relay
   \   000025   8007         SJMP    ??ZDO_JoinConfirmCB_2
   2044              }
   2045            }
   2046          #if defined(BLINK_LEDS)
   2047            else
   2048              HalLedSet ( HAL_LED_3, HAL_LED_MODE_FLASH );  // Flash LED to show failure
   \                     ??ZDO_JoinConfirmCB_0:
   \   000027                ; Setup parameters for call to function HalLedSet
   \   000027   7A04         MOV     R2,#0x4
   \   000029   7904         MOV     R1,#0x4
   \   00002B   12....       LCALL   ??HalLedSet?relay
   2049          #endif
   2050          
   2051            // Notify ZDApp
   2052            ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_IND, sizeof(osal_event_hdr_t), (byte*)NULL );
   \                     ??ZDO_JoinConfirmCB_2:
   \   00002E                ; Setup parameters for call to function ZDApp_SendMsg
   \   00002E   7C00         MOV     R4,#0x0
   \   000030   7D00         MOV     R5,#0x0
   \   000032   7B02         MOV     R3,#0x2
   \   000034   7A02         MOV     R2,#0x2
   \   000036   90....       MOV     DPTR,#ZDAppTaskID
   \   000039   E0           MOVX    A,@DPTR
   \   00003A   F9           MOV     R1,A
   \   00003B   12....       LCALL   ??ZDApp_SendMsg?relay
   2053          }
   \   00003E   D083         POP     DPH
   \   000040   D082         POP     DPL
   \   000042   02....       LJMP    ?BRET
   2054          
   2055          /*********************************************************************
   2056           * @fn          ZDO_AddrChangeIndicationCB
   2057           *
   2058           * @brief       This function notifies the application that this
   2059           *              device's address has changed.  Could happen in
   2060           *              a network with stochastic addressing (PRO).
   2061           *
   2062           * @param       newAddr - the new address
   2063           *
   2064           * @return      none
   2065           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2066          void ZDO_AddrChangeIndicationCB( uint16 newAddr )
   \                     ZDO_AddrChangeIndicationCB:
   2067          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2068            (void)newAddr;  // remove if this parameter is used
   2069          
   2070            // Notify to save info into NV
   2071            ZDApp_NVUpdate();
   \   000004                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000004   12....       LCALL   ??ZDApp_NVUpdate?relay
   2072          
   2073            // Notify the applications
   2074            osal_set_event( ZDAppTaskID, ZDO_STATE_CHANGE_EVT );
   \   000007                ; Setup parameters for call to function osal_set_event
   \   000007   7A10         MOV     R2,#0x10
   \   000009   7B00         MOV     R3,#0x0
   \   00000B   90....       MOV     DPTR,#ZDAppTaskID
   \   00000E   E0           MOVX    A,@DPTR
   \   00000F   F9           MOV     R1,A
   \   000010   12....       LCALL   ??osal_set_event?relay
   2075          
   2076            // Send out a device announce
   2077            ZDApp_AnnounceNewAddress();
   \   000013                ; Setup parameters for call to function ZDApp_AnnounceNewAddress
   \   000013   12....       LCALL   ??ZDApp_AnnounceNewAddress?relay
   2078          }
   \   000016   D083         POP     DPH
   \   000018   D082         POP     DPL
   \   00001A   02....       LJMP    ?BRET
   2079          
   2080          /*********************************************************************
   2081           * @fn          ZDO_JoinIndicationCB
   2082           *
   2083           * @brief       This function allows the next higher layer of a
   2084           *              coordinator to be notified of a remote join request.
   2085           *
   2086           * @param       ShortAddress - 16-bit address
   2087           * @param       ExtendedAddress - IEEE (64-bit) address
   2088           * @param       CapabilityInformation - Association Capability Information
   2089           * @param       type - of joining -
   2090           *                          NWK_ASSOC_JOIN
   2091           *                          NWK_ASSOC_REJOIN_UNSECURE
   2092           *                          NWK_ASSOC_REJOIN_SECURE
   2093           *
   2094           * @return      ZStatus_t
   2095           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2096          ZStatus_t ZDO_JoinIndicationCB( uint16 ShortAddress, uint8 *ExtendedAddress,
   \                     ZDO_JoinIndicationCB:
   2097                                          uint8 CapabilityInformation, uint8 type )
   2098          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2099            (void)ShortAddress;
   2100            (void)ExtendedAddress;
   2101            (void)CapabilityInformation;
   2102          
   2103              // Notify to save info into NV
   2104              ZDApp_NVUpdate();
   \   000004                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000004   12....       LCALL   ??ZDApp_NVUpdate?relay
   2105          
   2106              // send notification to TC of new device..
   2107              if ( ZG_SECURE_ENABLED )
   2108              {
   2109                if ( type == NWK_ASSOC_JOIN || type == NWK_ASSOC_REJOIN_UNSECURE )
   2110                {
   2111                  osal_start_timerEx( ZDAppTaskID, ZDO_NEW_DEVICE, 600 );
   2112                }
   2113              }
   2114          
   2115              return ( ZSuccess );
   \   000007   7900         MOV     R1,#0x0
   \   000009   D083         POP     DPH
   \   00000B   D082         POP     DPL
   \   00000D   02....       LJMP    ?BRET
   2116          }
   2117          
   2118          /*********************************************************************
   2119           * @fn          ZDO_ConcentratorIndicationCB
   2120           *
   2121           * @brief       This function allows the next higher layer of a
   2122           *              device to be notified of existence of the concentrator.
   2123           *
   2124           * @param       nwkAddr - 16-bit NWK address of the concentrator
   2125           *
   2126           * @return      void
   2127           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2128          void ZDO_ConcentratorIndicationCB( uint16 nwkAddr )
   \                     ZDO_ConcentratorIndicationCB:
   2129          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2130            // Write your code here to do something with the concentrator's
   2131            // address.
   2132            (void)nwkAddr;
   2133          }
   \   000000   02....       LJMP    ?BRET
   2134          
   2135          /*********************************************************************
   2136           * @fn          ZDO_LeaveCnf
   2137           *
   2138           * @brief       This function allows the next higher layer to be
   2139           *              notified of the results of its request for this or
   2140           *              a child device to leave the network.
   2141           *
   2142           * @param       cnf - NLME_LeaveCnf_t
   2143           *
   2144           * @return      none
   2145           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2146          void ZDO_LeaveCnf( NLME_LeaveCnf_t* cnf )
   \                     ZDO_LeaveCnf:
   2147          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2148            // Check for this device
   2149            if ( osal_ExtAddrEqual( cnf->extAddr,
   2150                                    NLME_GetExtAddr() ) == TRUE )
   \   000009   EE           MOV     A,R6
   \   00000A   2402         ADD     A,#0x2
   \   00000C   F5..         MOV     ?V0 + 0,A
   \   00000E   EF           MOV     A,R7
   \   00000F   3400         ADDC    A,#0x0
   \   000011   F5..         MOV     ?V0 + 1,A
   \   000013                ; Setup parameters for call to function sAddrExtCmp
   \   000013                ; Setup parameters for call to function NLME_GetExtAddr
   \   000013   12....       LCALL   ??NLME_GetExtAddr?relay
   \   000016   EA           MOV     A,R2
   \   000017   FC           MOV     R4,A
   \   000018   EB           MOV     A,R3
   \   000019   FD           MOV     R5,A
   \   00001A   AA..         MOV     R2,?V0 + 0
   \   00001C   AB..         MOV     R3,?V0 + 1
   \   00001E   12....       LCALL   ??sAddrExtCmp?relay
   \   000021   E9           MOV     A,R1
   \   000022   6401         XRL     A,#0x1
   \   000024   7011         JNZ     ??ZDO_LeaveCnf_0
   2151            {
   2152              // Prepare to leave with reset
   2153              ZDApp_LeaveReset( cnf->rejoin );
   \   000026                ; Setup parameters for call to function ZDApp_LeaveReset
   \   000026   EE           MOV     A,R6
   \   000027   240B         ADD     A,#0xb
   \   000029   F582         MOV     DPL,A
   \   00002B   EF           MOV     A,R7
   \   00002C   3400         ADDC    A,#0x0
   \   00002E   F583         MOV     DPH,A
   \   000030   E0           MOVX    A,@DPTR
   \   000031   F9           MOV     R1,A
   \   000032   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   000035   8020         SJMP    ??ZDO_LeaveCnf_1
   2154            }
   2155            else if ( ZSTACK_ROUTER_BUILD )
   2156            {
   2157              // Remove device address(optionally descendents) from data
   2158              ZDApp_LeaveUpdate( cnf->dstAddr,
   2159                                 cnf->extAddr,
   2160                                 cnf->removeChildren );
   \                     ??ZDO_LeaveCnf_0:
   \   000037                ; Setup parameters for call to function ZDApp_LeaveUpdate
   \   000037   8E82         MOV     DPL,R6
   \   000039   8F83         MOV     DPH,R7
   \   00003B   A3           INC     DPTR
   \   00003C   A3           INC     DPTR
   \   00003D   A3           INC     DPTR
   \   00003E   A3           INC     DPTR
   \   00003F   A3           INC     DPTR
   \   000040   A3           INC     DPTR
   \   000041   A3           INC     DPTR
   \   000042   A3           INC     DPTR
   \   000043   A3           INC     DPTR
   \   000044   A3           INC     DPTR
   \   000045   E0           MOVX    A,@DPTR
   \   000046   F9           MOV     R1,A
   \   000047   AC..         MOV     R4,?V0 + 0
   \   000049   AD..         MOV     R5,?V0 + 1
   \   00004B   8E82         MOV     DPL,R6
   \   00004D   8F83         MOV     DPH,R7
   \   00004F   E0           MOVX    A,@DPTR
   \   000050   FA           MOV     R2,A
   \   000051   A3           INC     DPTR
   \   000052   E0           MOVX    A,@DPTR
   \   000053   FB           MOV     R3,A
   \   000054   12....       LCALL   ??ZDApp_LeaveUpdate?relay
   2161            }
   2162          }
   \                     ??ZDO_LeaveCnf_1:
   \   000057   7F02         MOV     R7,#0x2
   \   000059   02....       LJMP    ?BANKED_LEAVE_XDATA
   2163          
   2164          /*********************************************************************
   2165           * @fn          ZDO_LeaveInd
   2166           *
   2167           * @brief       This function allows the next higher layer of a
   2168           *              device to be notified of a remote leave request or
   2169           *              indication.
   2170           *
   2171           * @param       ind - NLME_LeaveInd_t
   2172           *
   2173           * @return      none
   2174           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2175          void ZDO_LeaveInd( NLME_LeaveInd_t* ind )
   \                     ZDO_LeaveInd:
   2176          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
   2177            uint8 leave;
   2178          
   2179          
   2180            // Parent is requesting the leave - NWK layer filters out illegal
   2181            // requests
   2182            if ( ind->request == TRUE )
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   A3           INC     DPTR
   \   000015   A3           INC     DPTR
   \   000016   A3           INC     DPTR
   \   000017   A3           INC     DPTR
   \   000018   A3           INC     DPTR
   \   000019   A3           INC     DPTR
   \   00001A   A3           INC     DPTR
   \   00001B   A3           INC     DPTR
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   6401         XRL     A,#0x1
   \   00001F   7040         JNZ     ??ZDO_LeaveInd_0
   2183            {
   2184              // Notify network of leave
   2185              if ( ZSTACK_ROUTER_BUILD )
   2186              {
   2187                NLME_LeaveRsp_t rsp;
   2188                rsp.rejoin         = ind->rejoin;
   \   000021   EE           MOV     A,R6
   \   000022   240C         ADD     A,#0xc
   \   000024   F5..         MOV     ?V0 + 0,A
   \   000026   EF           MOV     A,R7
   \   000027   3400         ADDC    A,#0x0
   \   000029   F5..         MOV     ?V0 + 1,A
   \   00002B   85..82       MOV     DPL,?V0 + 0
   \   00002E   F583         MOV     DPH,A
   \   000030   E0           MOVX    A,@DPTR
   \   000031   C0E0         PUSH    A
   \   000033   7401         MOV     A,#0x1
   \   000035   12....       LCALL   ?XSTACK_DISP0_8
   \   000038   D0E0         POP     A
   \   00003A   F0           MOVX    @DPTR,A
   2189                rsp.removeChildren = ind->removeChildren;
   \   00003B   EE           MOV     A,R6
   \   00003C   240B         ADD     A,#0xb
   \   00003E   F582         MOV     DPL,A
   \   000040   EF           MOV     A,R7
   \   000041   3400         ADDC    A,#0x0
   \   000043   F583         MOV     DPH,A
   \   000045   E0           MOVX    A,@DPTR
   \   000046   85..82       MOV     DPL,?XSP + 0
   \   000049   85..83       MOV     DPH,?XSP + 1
   \   00004C   F0           MOVX    @DPTR,A
   2190                NLME_LeaveRsp( &rsp );
   \   00004D                ; Setup parameters for call to function NLME_LeaveRsp
   \   00004D   AA82         MOV     R2,DPL
   \   00004F   AB83         MOV     R3,DPH
   \   000051   12....       LCALL   ??NLME_LeaveRsp?relay
   2191              }
   2192          
   2193              // Prepare to leave with reset
   2194              ZDApp_LeaveReset( ind->rejoin );
   \   000054                ; Setup parameters for call to function ZDApp_LeaveReset
   \   000054   85..82       MOV     DPL,?V0 + 0
   \   000057   85..83       MOV     DPH,?V0 + 1
   \                     ??ZDO_LeaveInd_1:
   \   00005A   E0           MOVX    A,@DPTR
   \   00005B   F9           MOV     R1,A
   \   00005C   12....       LCALL   ??ZDApp_LeaveReset?relay
   \   00005F   806F         SJMP    ??ZDO_LeaveInd_2
   2195            }
   2196            else
   2197            {
   2198              leave = FALSE;
   \                     ??ZDO_LeaveInd_0:
   \   000061   75..00       MOV     ?V0 + 0,#0x0
   2199          
   2200              // Check if this device needs to leave as a child or descendent
   2201              if ( ind->srcAddr == NLME_GetCoordShortAddr() )
   \   000064   8E82         MOV     DPL,R6
   \   000066   8F83         MOV     DPH,R7
   \   000068   C082         PUSH    DPL
   \   00006A   C083         PUSH    DPH
   \   00006C                ; Setup parameters for call to function NLME_GetCoordShortAddr
   \   00006C   12....       LCALL   ??NLME_GetCoordShortAddr?relay
   \   00006F   8A..         MOV     ?V0 + 2,R2
   \   000071   8B..         MOV     ?V0 + 3,R3
   \   000073   D083         POP     DPH
   \   000075   D082         POP     DPL
   \   000077   E0           MOVX    A,@DPTR
   \   000078   65..         XRL     A,?V0 + 2
   \   00007A   7004         JNZ     ??ZDO_LeaveInd_3
   \   00007C   A3           INC     DPTR
   \   00007D   E0           MOVX    A,@DPTR
   \   00007E   65..         XRL     A,?V0 + 3
   \                     ??ZDO_LeaveInd_3:
   \   000080   701C         JNZ     ??ZDO_LeaveInd_4
   2202              {
   2203                if ( ( ind->removeChildren == TRUE               ) ||
   2204                     ( ZDO_Config_Node_Descriptor.LogicalType ==
   2205                       NODETYPE_DEVICE                           )    )
   \   000082   EE           MOV     A,R6
   \   000083   240B         ADD     A,#0xb
   \   000085   F582         MOV     DPL,A
   \   000087   EF           MOV     A,R7
   \   000088   3400         ADDC    A,#0x0
   \   00008A   F583         MOV     DPH,A
   \   00008C   E0           MOVX    A,@DPTR
   \   00008D   6401         XRL     A,#0x1
   \   00008F   600A         JZ      ??ZDO_LeaveInd_5
   \   000091   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000094   E0           MOVX    A,@DPTR
   \   000095   5407         ANL     A,#0x7
   \   000097   6402         XRL     A,#0x2
   \   000099   7003         JNZ     ??ZDO_LeaveInd_4
   2206                {
   2207                  leave = TRUE;
   \                     ??ZDO_LeaveInd_5:
   \   00009B   75..01       MOV     ?V0 + 0,#0x1
   2208                }
   2209              }
   2210              else if ( ind->removeChildren == TRUE )
   2211              {
   2212                // Check NWK address allocation algorithm
   2213                //leave = RTG_ANCESTOR(nwkAddr,thisAddr);
   2214              }
   2215          
   2216              if ( leave == TRUE )
   \                     ??ZDO_LeaveInd_4:
   \   00009E   7401         MOV     A,#0x1
   \   0000A0   65..         XRL     A,?V0 + 0
   \   0000A2   700C         JNZ     ??ZDO_LeaveInd_6
   2217              {
   2218                // Prepare to leave with reset
   2219                ZDApp_LeaveReset( ind->rejoin );
   \   0000A4                ; Setup parameters for call to function ZDApp_LeaveReset
   \   0000A4   EE           MOV     A,R6
   \   0000A5   240C         ADD     A,#0xc
   \   0000A7   F582         MOV     DPL,A
   \   0000A9   EF           MOV     A,R7
   \   0000AA   3400         ADDC    A,#0x0
   \   0000AC   F583         MOV     DPH,A
   \   0000AE   80AA         SJMP    ??ZDO_LeaveInd_1
   2220              }
   2221              else
   2222              {
   2223                // Remove device address(optionally descendents) from data
   2224                ZDApp_LeaveUpdate( ind->srcAddr,
   2225                                   ind->extAddr,
   2226                                   ind->removeChildren );
   \                     ??ZDO_LeaveInd_6:
   \   0000B0                ; Setup parameters for call to function ZDApp_LeaveUpdate
   \   0000B0   EE           MOV     A,R6
   \   0000B1   240B         ADD     A,#0xb
   \   0000B3   F582         MOV     DPL,A
   \   0000B5   EF           MOV     A,R7
   \   0000B6   3400         ADDC    A,#0x0
   \   0000B8   F583         MOV     DPH,A
   \   0000BA   E0           MOVX    A,@DPTR
   \   0000BB   F9           MOV     R1,A
   \   0000BC   EE           MOV     A,R6
   \   0000BD   2402         ADD     A,#0x2
   \   0000BF   FC           MOV     R4,A
   \   0000C0   EF           MOV     A,R7
   \   0000C1   3400         ADDC    A,#0x0
   \   0000C3   FD           MOV     R5,A
   \   0000C4   8E82         MOV     DPL,R6
   \   0000C6   8F83         MOV     DPH,R7
   \   0000C8   E0           MOVX    A,@DPTR
   \   0000C9   FA           MOV     R2,A
   \   0000CA   A3           INC     DPTR
   \   0000CB   E0           MOVX    A,@DPTR
   \   0000CC   FB           MOV     R3,A
   \   0000CD   12....       LCALL   ??ZDApp_LeaveUpdate?relay
   2227              }
   2228            }
   2229          }
   \                     ??ZDO_LeaveInd_2:
   \   0000D0   7402         MOV     A,#0x2
   \   0000D2   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000D5   7F04         MOV     R7,#0x4
   \   0000D7   02....       LJMP    ?BANKED_LEAVE_XDATA
   2230          
   2231          /*********************************************************************
   2232           * @fn          ZDO_SyncIndicationCB
   2233           *
   2234           * @brief       This function allows the next higher layer of a
   2235           *              coordinator to be notified of a loss of synchronization
   2236           *                          with the parent/child device.
   2237           *
   2238           * @param       type: 0 - child; 1 - parent
   2239           *
   2240           *
   2241           * @return      none
   2242           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2243          void ZDO_SyncIndicationCB( uint8 type, uint16 shortAddr )
   \                     ZDO_SyncIndicationCB:
   2244          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2245            (void)shortAddr;  // Remove this line if this parameter is used.
   2246          
   2247            if ( ZSTACK_END_DEVICE_BUILD
   2248              || (ZSTACK_ROUTER_BUILD && ((_NIB.CapabilityInfo & ZMAC_ASSOC_CAPINFO_FFD_TYPE) == 0)))
   \   000004   90....       MOV     DPTR,#(_NIB + 14)
   \   000007   E0           MOVX    A,@DPTR
   \   000008   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000A   4018         JC      ??ZDO_SyncIndicationCB_0
   2249            {
   2250              if ( type == 1 )
   \   00000C   7401         MOV     A,#0x1
   \   00000E   69           XRL     A,R1
   \   00000F   7013         JNZ     ??ZDO_SyncIndicationCB_0
   2251              {
   2252                // We lost contact with our parent.  Clear the neighbor Table.
   2253                nwkNeighborInitTable();
   \   000011                ; Setup parameters for call to function nwkNeighborInitTable
   \   000011   12....       LCALL   ??nwkNeighborInitTable?relay
   2254          
   2255                // Start the rejoin process.
   2256                ZDApp_SendMsg( ZDAppTaskID, ZDO_NWK_JOIN_REQ, sizeof(osal_event_hdr_t), NULL );
   \   000014                ; Setup parameters for call to function ZDApp_SendMsg
   \   000014   7C00         MOV     R4,#0x0
   \   000016   7D00         MOV     R5,#0x0
   \   000018   7B02         MOV     R3,#0x2
   \   00001A   7A03         MOV     R2,#0x3
   \   00001C   90....       MOV     DPTR,#ZDAppTaskID
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   F9           MOV     R1,A
   \   000021   12....       LCALL   ??ZDApp_SendMsg?relay
   2257              }
   2258            }
   2259          }
   \                     ??ZDO_SyncIndicationCB_0:
   \   000024   D083         POP     DPH
   \   000026   D082         POP     DPL
   \   000028   02....       LJMP    ?BRET
   2260          
   2261          /*********************************************************************
   2262           * @fn          ZDO_ManytoOneFailureIndicationCB
   2263           *
   2264           * @brief       This function allows the next higher layer of a
   2265           *              concentrator to be notified of a many-to-one route
   2266           *              failure.
   2267           *
   2268           * @param       none
   2269           *
   2270           *
   2271           * @return      none
   2272           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2273          void ZDO_ManytoOneFailureIndicationCB()
   \                     ZDO_ManytoOneFailureIndicationCB:
   2274          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2275            // By default, the concentrator automatically redo many-to-one route
   2276            // discovery to update all many-to-one routes in the network
   2277            // If you want anything processing other than the default,
   2278            // please replace the following code.
   2279          
   2280            if( zgConcentratorRC == true )  // concentrator with route cache
   \   000004   90....       MOV     DPTR,#zgConcentratorRC
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   90....       MOV     DPTR,#zgConcentratorRadius
   \   00000D   7006         JNZ     ??ZDO_ManytoOneFailureIndicationCB_0
   2281            {
   2282              NLME_RouteDiscoveryRequest( 0x00, MTO_ROUTE, zgConcentratorRadius);
   \   00000F                ; Setup parameters for call to function NLME_RouteDiscoveryRequest
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   FC           MOV     R4,A
   \   000011   7901         MOV     R1,#0x1
   \   000013   8004         SJMP    ??ZDO_ManytoOneFailureIndicationCB_1
   2283            }
   2284            else
   2285            { // Concentrator with no route cache
   2286              NLME_RouteDiscoveryRequest( 0x00, MTO_ROUTE | NO_ROUTE_CACHE, zgConcentratorRadius);
   \                     ??ZDO_ManytoOneFailureIndicationCB_0:
   \   000015                ; Setup parameters for call to function NLME_RouteDiscoveryRequest
   \   000015   E0           MOVX    A,@DPTR
   \   000016   FC           MOV     R4,A
   \   000017   7903         MOV     R1,#0x3
   \                     ??ZDO_ManytoOneFailureIndicationCB_1:
   \   000019   7A00         MOV     R2,#0x0
   \   00001B   7B00         MOV     R3,#0x0
   \   00001D   12....       LCALL   ??NLME_RouteDiscoveryRequest?relay
   2287            }
   2288          }
   \   000020   D083         POP     DPH
   \   000022   D082         POP     DPL
   \   000024   02....       LJMP    ?BRET
   2289          
   2290          
   2291          /*********************************************************************
   2292           * @fn          ZDO_PollConfirmCB
   2293           *
   2294           * @brief       This function allows the next higher layer to be
   2295           *              notified of a Poll Confirm.
   2296           *
   2297           * @param       none
   2298           *
   2299           * @return      none
   2300           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2301          void ZDO_PollConfirmCB( uint8 status )
   \                     ZDO_PollConfirmCB:
   2302          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2303            (void)status;  // Remove this line if this parameter is used.
   2304            return;
   \   000000   02....       LJMP    ?BRET
   2305          }
   2306          
   2307          /******************************************************************************
   2308           * @fn          ZDApp_NwkWriteNVRequest (stubs AddrMgrWriteNVRequest)
   2309           *
   2310           * @brief       Stub routine implemented by NHLE. NHLE should call
   2311           *              <AddrMgrWriteNV> when appropriate.
   2312           *
   2313           * @param       none
   2314           *
   2315           * @return      none
   2316           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2317          void ZDApp_NwkWriteNVRequest( void )
   \                     AddrMgrWriteNVRequest:
   2318          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2319          #if defined ( NV_RESTORE )
   2320            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   2321            {
   2322              // Trigger to save info into NV
   2323              ZDApp_NVUpdate();
   2324            }
   2325          #endif
   2326          }
   \   000000   02....       LJMP    ?BRET
   2327          
   2328          /*********************************************************************
   2329           * Call Back Functions from Security  - API
   2330           */
   2331          
   2332           /*********************************************************************
   2333           * @fn          ZDO_UpdateDeviceIndication
   2334           *
   2335           * @brief       This function notifies the "Trust Center" of a
   2336           *              network when a device joins or leaves the network.
   2337           *
   2338           * @param       extAddr - pointer to 64 bit address of new device
   2339           * @param       status  - 0 if a new device joined securely
   2340           *                      - 1 if a new device joined un-securely
   2341           *                      - 2 if a device left the network
   2342           *
   2343           * @return      true if newly joined device should be allowed to
   2344           *                                              remain on network
   2345           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2346          ZStatus_t ZDO_UpdateDeviceIndication( uint8 *extAddr, uint8 status )
   \                     ZDO_UpdateDeviceIndication:
   2347          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2348            // can implement a network access policy based on the
   2349            // IEEE address of newly joining devices...
   2350            (void)extAddr;
   2351            (void)status;
   2352          
   2353            return ZSuccess;
   \   000000   7900         MOV     R1,#0x0
   \   000002   02....       LJMP    ?BRET
   2354          }
   2355          
   2356          /*********************************************************************
   2357           * @fn          ZDApp_InMsgCB
   2358           *
   2359           * @brief       This function is called to pass up any message that is
   2360           *              not yet supported.  This allows for the developer to
   2361           *              support features themselves..
   2362           *
   2363           * @return      none
   2364           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2365          void ZDApp_InMsgCB( zdoIncomingMsg_t *inMsg )
   \                     ZDApp_InMsgCB:
   2366          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   2367            if ( inMsg->clusterID & ZDO_RESPONSE_BIT )
   \   000009   EE           MOV     A,R6
   \   00000A   240C         ADD     A,#0xc
   \   00000C   F8           MOV     R0,A
   \   00000D   EF           MOV     A,R7
   \   00000E   3400         ADDC    A,#0x0
   \   000010   F9           MOV     R1,A
   \   000011   8882         MOV     DPL,R0
   \   000013   8983         MOV     DPH,R1
   \   000015   A3           INC     DPTR
   \   000016   E0           MOVX    A,@DPTR
   \   000017   5480         ANL     A,#0x80
   \   000019   FB           MOV     R3,A
   \   00001A   E4           CLR     A
   \   00001B   7001         JNZ     ??ZDApp_InMsgCB_0
   \   00001D   EB           MOV     A,R3
   \                     ??ZDApp_InMsgCB_0:
   \   00001E   7062         JNZ     ??ZDApp_InMsgCB_1
   2368            {
   2369              // Handle the response message
   2370            }
   2371            else
   2372            {
   2373              // Handle the request message by sending a generic "not supported".
   2374              // Device Announce doesn't have a response.
   2375              if ( !(inMsg->wasBroadcast) && inMsg->clusterID != Device_annce )
   \   000020   EE           MOV     A,R6
   \   000021   240B         ADD     A,#0xb
   \   000023   F582         MOV     DPL,A
   \   000025   EF           MOV     A,R7
   \   000026   3400         ADDC    A,#0x0
   \   000028   F583         MOV     DPH,A
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   7055         JNZ     ??ZDApp_InMsgCB_1
   \   00002D   8882         MOV     DPL,R0
   \   00002F   8983         MOV     DPH,R1
   \   000031   E0           MOVX    A,@DPTR
   \   000032   6413         XRL     A,#0x13
   \   000034   7002         JNZ     ??ZDApp_InMsgCB_2
   \   000036   A3           INC     DPTR
   \   000037   E0           MOVX    A,@DPTR
   \                     ??ZDApp_InMsgCB_2:
   \   000038   6048         JZ      ??ZDApp_InMsgCB_1
   2376              {
   2377                ZDP_GenericRsp( inMsg->TransSeq, &(inMsg->srcAddr), ZDP_NOT_SUPPORTED, 0,
   2378                                (uint16)(inMsg->clusterID | ZDO_RESPONSE_BIT), inMsg->SecurityUse );
   \   00003A                ; Setup parameters for call to function ZDP_GenericRsp
   \   00003A   8882         MOV     DPL,R0
   \   00003C   8983         MOV     DPH,R1
   \   00003E   E0           MOVX    A,@DPTR
   \   00003F   F5..         MOV     ?V0 + 0,A
   \   000041   A3           INC     DPTR
   \   000042   E0           MOVX    A,@DPTR
   \   000043   4480         ORL     A,#0x80
   \   000045   F5..         MOV     ?V0 + 1,A
   \   000047   78..         MOV     R0,#?V0 + 0
   \   000049   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00004C   75..00       MOV     ?V0 + 0,#0x0
   \   00004F   75..00       MOV     ?V0 + 1,#0x0
   \   000052   78..         MOV     R0,#?V0 + 0
   \   000054   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000057   EE           MOV     A,R6
   \   000058   240E         ADD     A,#0xe
   \   00005A   F582         MOV     DPL,A
   \   00005C   EF           MOV     A,R7
   \   00005D   3400         ADDC    A,#0x0
   \   00005F   F583         MOV     DPH,A
   \   000061   E0           MOVX    A,@DPTR
   \   000062   FD           MOV     R5,A
   \   000063   7C84         MOV     R4,#-0x7c
   \   000065   EE           MOV     A,R6
   \   000066   2402         ADD     A,#0x2
   \   000068   0A           INC     R2
   \   000069   0A           INC     R2
   \   00006A   EF           MOV     A,R7
   \   00006B   3400         ADDC    A,#0x0
   \   00006D   FB           MOV     R3,A
   \   00006E   EE           MOV     A,R6
   \   00006F   240F         ADD     A,#0xf
   \   000071   F582         MOV     DPL,A
   \   000073   EF           MOV     A,R7
   \   000074   3400         ADDC    A,#0x0
   \   000076   F583         MOV     DPH,A
   \   000078   E0           MOVX    A,@DPTR
   \   000079   F9           MOV     R1,A
   \   00007A   12....       LCALL   ??ZDP_GenericRsp?relay
   \   00007D   7404         MOV     A,#0x4
   \   00007F   12....       LCALL   ?DEALLOC_XSTACK8
   2379              }
   2380            }
   2381          }
   \                     ??ZDApp_InMsgCB_1:
   \   000082   7F02         MOV     R7,#0x2
   \   000084   02....       LJMP    ?BANKED_LEAVE_XDATA
   2382          
   2383          
   2384          /*********************************************************************
   2385           * @fn      ZDApp_ChangeMatchDescRespPermission()
   2386           *
   2387           * @brief   Changes the Match Descriptor Response permission.
   2388           *
   2389           * @param   endpoint - endpoint to allow responses
   2390           * @param   action - true to allow responses, false to not
   2391           *
   2392           * @return  none
   2393           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2394          void ZDApp_ChangeMatchDescRespPermission( uint8 endpoint, uint8 action )
   \                     ZDApp_ChangeMatchDescRespPermission:
   2395          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2396            // Store the action
   2397            afSetMatch( endpoint, action );
   \   000004                ; Setup parameters for call to function afSetMatch
   \   000004   12....       LCALL   ??afSetMatch?relay
   2398          }
   \   000007   D083         POP     DPH
   \   000009   D082         POP     DPL
   \   00000B   02....       LJMP    ?BRET
   2399          
   2400          /*********************************************************************
   2401           * @fn      ZDApp_NetworkInit()
   2402           *
   2403           * @brief   Used to start the network joining process
   2404           *
   2405           * @param   delay - mSec delay to wait before starting
   2406           *
   2407           * @return  none
   2408           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2409          void ZDApp_NetworkInit( uint16 delay )
   \                     ZDApp_NetworkInit:
   2410          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2411            if ( delay )
   \   000004   EA           MOV     A,R2
   \   000005   7001         JNZ     ??ZDApp_NetworkInit_0
   \   000007   EB           MOV     A,R3
   \                     ??ZDApp_NetworkInit_0:
   \   000008   6012         JZ      ??ZDApp_NetworkInit_1
   2412            {
   2413              // Wait awhile before starting the device
   2414              osal_start_timerEx( ZDAppTaskID, ZDO_NETWORK_INIT, delay );
   \   00000A                ; Setup parameters for call to function osal_start_timerEx
   \   00000A   EA           MOV     A,R2
   \   00000B   FC           MOV     R4,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FD           MOV     R5,A
   \   00000E   7A01         MOV     R2,#0x1
   \   000010   7B00         MOV     R3,#0x0
   \   000012   90....       MOV     DPTR,#ZDAppTaskID
   \   000015   E0           MOVX    A,@DPTR
   \   000016   F9           MOV     R1,A
   \   000017   12....       LCALL   ??osal_start_timerEx?relay
   \   00001A   800C         SJMP    ??ZDApp_NetworkInit_2
   2415            }
   2416            else
   2417            {
   2418              osal_set_event( ZDAppTaskID, ZDO_NETWORK_INIT );
   \                     ??ZDApp_NetworkInit_1:
   \   00001C                ; Setup parameters for call to function osal_set_event
   \   00001C   7A01         MOV     R2,#0x1
   \   00001E   7B00         MOV     R3,#0x0
   \   000020   90....       MOV     DPTR,#ZDAppTaskID
   \   000023   E0           MOVX    A,@DPTR
   \   000024   F9           MOV     R1,A
   \   000025   12....       LCALL   ??osal_set_event?relay
   2419            }
   2420          }
   \                     ??ZDApp_NetworkInit_2:
   \   000028   D083         POP     DPH
   \   00002A   D082         POP     DPL
   \   00002C   02....       LJMP    ?BRET
   2421          
   2422          /*********************************************************************
   2423           * @fn      ZDApp_NwkStateUpdateCB()
   2424           *
   2425           * @brief   This function notifies that this device's network
   2426           *          state info has been changed.
   2427           *
   2428           * @param   none
   2429           *
   2430           * @return  none
   2431           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2432          void ZDApp_NwkStateUpdateCB( void )
   \                     ZDApp_NwkStateUpdateCB:
   2433          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2434            // Notify to save info into NV
   2435            if ( !osal_get_timeoutEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV ) )
   \   000005                ; Setup parameters for call to function osal_get_timeoutEx
   \   000005   7A00         MOV     R2,#0x0
   \   000007   7B02         MOV     R3,#0x2
   \   000009   90....       MOV     DPTR,#ZDAppTaskID
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   F9           MOV     R1,A
   \   00000E   12....       LCALL   ??osal_get_timeoutEx?relay
   \   000011   EA           MOV     A,R2
   \   000012   7001         JNZ     ??ZDApp_NwkStateUpdateCB_0
   \   000014   EB           MOV     A,R3
   \                     ??ZDApp_NwkStateUpdateCB_0:
   \   000015   7003         JNZ     ??ZDApp_NwkStateUpdateCB_1
   2436            {
   2437              // Trigger to save info into NV
   2438              ZDApp_NVUpdate();
   \   000017                ; Setup parameters for call to function ZDApp_NVUpdate
   \   000017   12....       LCALL   ??ZDApp_NVUpdate?relay
   2439            }
   2440          }
   \                     ??ZDApp_NwkStateUpdateCB_1:
   \   00001A   7F02         MOV     R7,#0x2
   \   00001C   02....       LJMP    ?BANKED_LEAVE_XDATA
   2441          
   2442          /*********************************************************************
   2443           * @fn      ZDApp_NodeProfileSync()
   2444           *
   2445           * @brief   Sync node with stack profile.
   2446           *
   2447           * @param   cfm - ZDO_NetworkDiscoveryCfm_t
   2448           *
   2449           * @return  none
   2450           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2451          void ZDApp_NodeProfileSync( ZDO_NetworkDiscoveryCfm_t* cfm )
   \                     ZDApp_NodeProfileSync:
   2452          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2453            networkDesc_t* desc;
   2454            uint16         panID;
   2455          
   2456            if ( ZDO_Config_Node_Descriptor.CapabilityFlags & CAPINFO_DEVICETYPE_FFD  )
   \   000005   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000008   E0           MOVX    A,@DPTR
   \   000009   A2E1         MOV     C,0xE0 /* A   */.1
   \   00000B   5058         JNC     ??ZDApp_NodeProfileSync_0
   2457            {
   2458              panID = BUILD_UINT16( cfm->panIdLSB, cfm->panIdMSB );
   2459          
   2460              desc = nwk_getNetworkDesc( cfm->extendedPANID, panID, cfm->logicalChannel );
   \   00000D                ; Setup parameters for call to function nwk_getNetworkDesc
   \   00000D   8A82         MOV     DPL,R2
   \   00000F   8B83         MOV     DPH,R3
   \   000011   A3           INC     DPTR
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   A3           INC     DPTR
   \   000015   E0           MOVX    A,@DPTR
   \   000016   F9           MOV     R1,A
   \   000017   8A82         MOV     DPL,R2
   \   000019   8B83         MOV     DPH,R3
   \   00001B   A3           INC     DPTR
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   FE           MOV     R6,A
   \   00001F   8A82         MOV     DPL,R2
   \   000021   8B83         MOV     DPH,R3
   \   000023   A3           INC     DPTR
   \   000024   A3           INC     DPTR
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   FD           MOV     R5,A
   \   000028   EE           MOV     A,R6
   \   000029   FC           MOV     R4,A
   \   00002A   EA           MOV     A,R2
   \   00002B   2406         ADD     A,#0x6
   \   00002D   FA           MOV     R2,A
   \   00002E   EB           MOV     A,R3
   \   00002F   3400         ADDC    A,#0x0
   \   000031   FB           MOV     R3,A
   \   000032   12....       LCALL   ??nwk_getNetworkDesc?relay
   \   000035   8A82         MOV     DPL,R2
   \   000037   8B83         MOV     DPH,R3
   2461          
   2462              if (desc != NULL)
   \   000039   E582         MOV     A,DPL
   \   00003B   7002         JNZ     ??ZDApp_NodeProfileSync_1
   \   00003D   E583         MOV     A,DPH
   \                     ??ZDApp_NodeProfileSync_1:
   \   00003F   6024         JZ      ??ZDApp_NodeProfileSync_0
   2463              {
   2464                if ( desc->stackProfile != zgStackProfile )
   \   000041   A3           INC     DPTR
   \   000042   A3           INC     DPTR
   \   000043   A3           INC     DPTR
   \   000044   A3           INC     DPTR
   \   000045   A3           INC     DPTR
   \   000046   A3           INC     DPTR
   \   000047   A3           INC     DPTR
   \   000048   A3           INC     DPTR
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   FA           MOV     R2,A
   \   00004B   90....       MOV     DPTR,#zgStackProfile
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   6A           XRL     A,R2
   \   000050   6013         JZ      ??ZDApp_NodeProfileSync_0
   2465                {
   2466                  ZDO_Config_Node_Descriptor.LogicalType = NODETYPE_DEVICE;
   \   000052   90....       MOV     DPTR,#ZDO_Config_Node_Descriptor
   \   000055   E0           MOVX    A,@DPTR
   \   000056   54F8         ANL     A,#0xf8
   \   000058   4402         ORL     A,#0x2
   \   00005A   F0           MOVX    @DPTR,A
   2467                  ZDO_Config_Node_Descriptor.CapabilityFlags = CAPINFO_DEVICETYPE_RFD | CAPINFO_POWER_AC | CAPINFO_RCVR_ON_IDLE;
   \   00005B   740C         MOV     A,#0xc
   \   00005D   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   000060   F0           MOVX    @DPTR,A
   2468                  NLME_SetBroadcastFilter( ZDO_Config_Node_Descriptor.CapabilityFlags );
   \   000061                ; Setup parameters for call to function NLME_SetBroadcastFilter
   \   000061   F9           MOV     R1,A
   \   000062   12....       LCALL   ??NLME_SetBroadcastFilter?relay
   2469                }
   2470              }
   2471            }
   2472          }
   \                     ??ZDApp_NodeProfileSync_0:
   \   000065   7F02         MOV     R7,#0x2
   \   000067   02....       LJMP    ?BANKED_LEAVE_XDATA
   2473          
   2474          /*********************************************************************
   2475           * @fn      ZDApp_StartJoiningCycle()
   2476           *
   2477           * @brief   Starts the joining cycle of a device.  This will only
   2478           *          continue an already started (or stopped) joining cycle.
   2479           *
   2480           * @param   none
   2481           *
   2482           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2483           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2484          uint8 ZDApp_StartJoiningCycle( void )
   \                     ZDApp_StartJoiningCycle:
   2485          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2486            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6005         JZ      ??ZDApp_StartJoiningCycle_0
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6402         XRL     A,#0x2
   \   00000F   7011         JNZ     ??ZDApp_StartJoiningCycle_1
   2487            {
   2488              continueJoining = TRUE;
   \                     ??ZDApp_StartJoiningCycle_0:
   \   000011   7401         MOV     A,#0x1
   \   000013   90....       MOV     DPTR,#continueJoining
   \   000016   F0           MOVX    @DPTR,A
   2489              ZDApp_NetworkInit( 0 );
   \   000017                ; Setup parameters for call to function ZDApp_NetworkInit
   \   000017   7A00         MOV     R2,#0x0
   \   000019   7B00         MOV     R3,#0x0
   \   00001B   12....       LCALL   ??ZDApp_NetworkInit?relay
   2490          
   2491              return ( TRUE );
   \   00001E   7901         MOV     R1,#0x1
   \   000020   8002         SJMP    ??ZDApp_StartJoiningCycle_2
   2492            }
   2493            else
   2494              return ( FALSE );
   \                     ??ZDApp_StartJoiningCycle_1:
   \   000022   7900         MOV     R1,#0x0
   \                     ??ZDApp_StartJoiningCycle_2:
   \   000024   D083         POP     DPH
   \   000026   D082         POP     DPL
   \   000028   02....       LJMP    ?BRET
   2495          }
   2496          
   2497          /*********************************************************************
   2498           * @fn      ZDApp_StopJoiningCycle()
   2499           *
   2500           * @brief   Stops the joining or rejoining process of a device.
   2501           *
   2502           * @param   none
   2503           *
   2504           * @return  TRUE if joining stopped, FALSE if joining or rejoining
   2505           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2506          uint8 ZDApp_StopJoiningCycle( void )
   \                     ZDApp_StopJoiningCycle:
   2507          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
   2508            if ( devState == DEV_INIT || devState == DEV_NWK_DISC )
   \   000004   90....       MOV     DPTR,#devState
   \   000007   E0           MOVX    A,@DPTR
   \   000008   6401         XRL     A,#0x1
   \   00000A   6005         JZ      ??ZDApp_StopJoiningCycle_0
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   6402         XRL     A,#0x2
   \   00000F   7009         JNZ     ??ZDApp_StopJoiningCycle_1
   2509            {
   2510              continueJoining = FALSE;
   \                     ??ZDApp_StopJoiningCycle_0:
   \   000011   E4           CLR     A
   \   000012   90....       MOV     DPTR,#continueJoining
   \   000015   F0           MOVX    @DPTR,A
   2511              return ( TRUE );
   \   000016   7901         MOV     R1,#0x1
   \   000018   8002         SJMP    ??ZDApp_StopJoiningCycle_2
   2512            }
   2513            else
   2514              return ( FALSE );
   \                     ??ZDApp_StopJoiningCycle_1:
   \   00001A   7900         MOV     R1,#0x0
   \                     ??ZDApp_StopJoiningCycle_2:
   \   00001C   D083         POP     DPH
   \   00001E   D082         POP     DPL
   \   000020   02....       LJMP    ?BRET
   2515          }
   2516          
   2517          /*********************************************************************
   2518           * @fn      ZDApp_AnnounceNewAddress()
   2519           *
   2520           * @brief   Send Device Announce and hold all transmissions for
   2521           *          new address timeout.
   2522           *
   2523           * @param   none
   2524           *
   2525           * @return  none
   2526           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2527          void ZDApp_AnnounceNewAddress( void )
   \                     ZDApp_AnnounceNewAddress:
   2528          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   2529          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   2530            // Turn off data request hold
   2531            APSME_HoldDataRequests( 0 );
   2532          #endif
   2533          
   2534            ZDP_DeviceAnnce( NLME_GetShortAddr(), NLME_GetExtAddr(),
   2535                               ZDO_Config_Node_Descriptor.CapabilityFlags, 0 );
   \   000005                ; Setup parameters for call to function NLME_GetExtAddr
   \   000005   12....       LCALL   ??NLME_GetExtAddr?relay
   \   000008   8A..         MOV     ?V0 + 0,R2
   \   00000A   8B..         MOV     ?V0 + 1,R3
   \   00000C   AE..         MOV     R6,?V0 + 0
   \   00000E                ; Setup parameters for call to function NLME_GetShortAddr
   \   00000E   12....       LCALL   ??NLME_GetShortAddr?relay
   \   000011                ; Setup parameters for call to function ZDP_DeviceAnnce
   \   000011   75..00       MOV     ?V0 + 0,#0x0
   \   000014   78..         MOV     R0,#?V0 + 0
   \   000016   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000019   90....       MOV     DPTR,#(ZDO_Config_Node_Descriptor + 2)
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F9           MOV     R1,A
   \   00001E   EE           MOV     A,R6
   \   00001F   FC           MOV     R4,A
   \   000020   AD..         MOV     R5,?V0 + 1
   \   000022   12....       LCALL   ??ZDP_DeviceAnnce?relay
   \   000025   7401         MOV     A,#0x1
   \   000027   12....       LCALL   ?DEALLOC_XSTACK8
   2536          
   2537          #if defined ( ZIGBEE_NWK_UNIQUE_ADDR_CHECK )
   2538            // Setup the timeout
   2539            APSME_HoldDataRequests( ZDAPP_HOLD_DATA_REQUESTS_TIMEOUT );
   2540          #endif
   2541          }
   \   00002A   7F02         MOV     R7,#0x2
   \   00002C   02....       LJMP    ?BANKED_LEAVE_XDATA
   2542          
   2543          /*********************************************************************
   2544           * @fn          ZDApp_NVUpdate
   2545           *
   2546           * @brief       Set the NV Update Timer.
   2547           *
   2548           * @param       none
   2549           *
   2550           * @return      none
   2551           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2552          void ZDApp_NVUpdate( void )
   \                     ZDApp_NVUpdate:
   2553          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2554          #if defined ( NV_RESTORE )
   2555            osal_start_timerEx( ZDAppTaskID, ZDO_NWK_UPDATE_NV, ZDAPP_UPDATE_NWK_NV_TIME );
   2556          #endif
   2557          }
   \   000000   02....       LJMP    ?BRET
   2558          
   2559          /*********************************************************************
   2560           * @fn      ZDApp_CoordStartPANIDConflictCB()
   2561           *
   2562           * @brief   Returns a PAN ID for the network layer to use during
   2563           *          a coordinator start and there is another network with
   2564           *          the intended PANID.
   2565           *
   2566           * @param   panid - the intended PAN ID
   2567           *
   2568           * @return  PANID to try
   2569           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   2570          uint16 ZDApp_CoordStartPANIDConflictCB( uint16 panid )
   \                     ZDApp_CoordStartPANIDConflictCB:
   2571          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   2572            return ( panid + 1 );
   \   000000   7401         MOV     A,#0x1
   \   000002   2A           ADD     A,R2
   \   000003   0A           INC     R2
   \   000004   E4           CLR     A
   \   000005   3B           ADDC    A,R3
   \   000006   FB           MOV     R3,A
   \   000007   02....       LJMP    ?BRET
   2573          }

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for zdoDiscCounter>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for continueJoining>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for devState>`:
   \   000000   01           DB 1

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_epDesc>`:
   \   000000   00           DB 0
   \   000001   ....0000     DW ZDAppTaskID, 0H
   \   000005   00           DB 0

   \                                 In  segment XDATA_ID, align 1, keep-with-next
   \                     `?<Initializer for ZDApp_SavedPollRate>`:
   \   000000   E803         DW 1000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_1:
   \   000000   01000000     DD 1

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_0:
   \   000000   00000000     DD 0

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3e8:
   \   000000   E8030000     DD 1000

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SecInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SecInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_event_loop?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_event_loop

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDOInitDevice?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDOInitDevice

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ReadNetworkRestoreState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ReadNetworkRestoreState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppDetermineDeviceType?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppDetermineDeviceType

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkStartEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkStartEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_DeviceAuthEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_DeviceAuthEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNetworkStateEvt?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNetworkStateEvt

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNetworkState?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNetworkState

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InitUserDesc?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InitUserDesc

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDAppCheckForHoldKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDAppCheckForHoldKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessOSALMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessOSALMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessMsgCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessMsgCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RegisterCBs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RegisterCBs

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessSecMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessSecMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ProcessNetworkJoin?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ProcessNetworkJoin

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SaveNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SaveNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_RestoreNwkKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_RestoreNwkKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerStart?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerStart

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ResetTimerCancel?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ResetTimerCancel

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlSet?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlSet

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlBypass?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlBypass

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveCtrlStartup?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveCtrlStartup

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveReset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveReset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_LeaveUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_LeaveUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendEventMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendEventMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_SendMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_SendMsg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkDiscoveryConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkDiscoveryConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_NetworkFormationConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_NetworkFormationConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_StartRouterConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_StartRouterConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_AddrChangeIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_AddrChangeIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_JoinIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_JoinIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ConcentratorIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ConcentratorIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveCnf?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveCnf

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_LeaveInd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_LeaveInd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_SyncIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_SyncIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_ManytoOneFailureIndicationCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_ManytoOneFailureIndicationCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_PollConfirmCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_PollConfirmCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??AddrMgrWriteNVRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    AddrMgrWriteNVRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDO_UpdateDeviceIndication?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDO_UpdateDeviceIndication

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_InMsgCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_InMsgCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_ChangeMatchDescRespPermission?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_ChangeMatchDescRespPermission

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NetworkInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NetworkInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NwkStateUpdateCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NwkStateUpdateCB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NodeProfileSync?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NodeProfileSync

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StartJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StartJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_StopJoiningCycle?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_StopJoiningCycle

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_AnnounceNewAddress?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_AnnounceNewAddress

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_NVUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_NVUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ZDApp_CoordStartPANIDConflictCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ZDApp_CoordStartPANIDConflictCB
   2574          
   2575          /*********************************************************************
   2576          *********************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     AddrMgrWriteNVRequest              0      0      0
     ZDAppCheckForHoldKey               2      0      0
       -> HalKeyRead                    4      0      0
     ZDAppDetermineDeviceType           2      0     12
       -> nwk_ExtPANIDValid             4      0      0
     ZDApp_AnnounceNewAddress           0      0     23
       -> NLME_GetExtAddr               0      0     20
       -> NLME_GetShortAddr             0      0     20
       -> ZDP_DeviceAnnce               0      0     22
     ZDApp_ChangeMatchDescRespPermission
                                        2      0      0
       -> afSetMatch                    4      0      0
     ZDApp_CoordStartPANIDConflictCB
                                        0      0      0
     ZDApp_DeviceAuthEvt                2      0      9
       -> ZDApp_ResetTimerCancel        4      0      0
       -> osal_set_event                4      0      0
       -> NLME_StartRouterRequest       4      0      0
       -> ZDApp_NVUpdate                4      0      0
       -> ZDApp_SaveNwkKey              4      0      0
       -> ZDApp_AnnounceNewAddress      4      0      0
       -> NLME_SetPollRate              4      0      0
       -> ZDApp_NVUpdate                4      0      0
     ZDApp_InMsgCB                      0      0     14
       -> ZDP_GenericRsp                0      0     28
     ZDApp_Init                         2      0      0
       -> NLME_GetExtAddr               4      0      0
       -> ZDAppCheckForHoldKey          4      0      0
       -> ZDO_Init                      4      0      0
       -> afRegister                    4      0      0
       -> ZDApp_InitUserDesc            4      0      0
       -> ZDOInitDevice                 4      0      0
       -> HalLedBlink                   4      0      0
       -> ZDApp_RegisterCBs             4      0      0
     ZDApp_InitUserDesc                 0      0     31
       -> osal_memset                   0      0     54
       -> osal_nv_item_init             0      0     58
       -> osal_nv_read                  0      0     62
     ZDApp_LeaveCtrlBypass              2      0      0
     ZDApp_LeaveCtrlInit                0      0     26
       -> osal_nv_item_init             0      0     24
       -> osal_nv_read                  0      0     28
     ZDApp_LeaveCtrlSet                 0      0     14
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveCtrlStartup             1      0     26
       -> osal_nv_write                 0      0     28
     ZDApp_LeaveReset                   2      0     14
       -> ZDApp_LeaveCtrlSet            4      0      0
       -> ZDApp_ResetTimerStart         4      0      0
     ZDApp_LeaveUpdate                  2      0     14
       -> NLME_RemoveChild              4      0      0
     ZDApp_NVUpdate                     0      0     10
     ZDApp_NetworkInit                  2      0     12
       -> osal_start_timerEx            4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NetworkStartEvt              2      0     10
       -> osal_pwrmgr_device            4      0      0
       -> osal_set_event                4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_GetEnergyThreshold       4      0      0
       -> NLME_SetEnergyThreshold       4      0      0
       -> osal_set_event                4      0      0
       -> osal_set_event                4      0      0
     ZDApp_NodeProfileSync              0      0     21
       -> nwk_getNetworkDesc            0      0     20
       -> NLME_SetBroadcastFilter       0      0     20
     ZDApp_NwkStateUpdateCB             0      0     10
       -> osal_get_timeoutEx            0      0     20
       -> ZDApp_NVUpdate                0      0     20
     ZDApp_ProcessMsgCBs                0      0     42
       -> ZDO_ParseAddrRsp              0      0     62
       -> ZDO_UpdateAddrManager         0      0     62
       -> osal_mem_free                 0      0     62
       -> ZDO_ParseBindUnbindReq        0      0     62
       -> ZDO_ProcessBindUnbindReq      0      0     62
     ZDApp_ProcessNetworkJoin           0      0     23
       -> osal_set_event                0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> NLME_StartRouterRequest       0      0     24
       -> NLME_GetShortAddr             0      0     24
       -> ZMacSetReq                    0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> osal_set_event                0      0     24
       -> NLME_SetPollRate              0      0     24
       -> NLME_SetQueuedPollRate        0      0     24
       -> NLME_SetResponseRate          0      0     24
       -> NLME_StartRouterRequest       0      0     24
       -> ZDApp_AnnounceNewAddress      0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_NetworkInit             0      0     24
     ZDApp_ProcessOSALMsg               1      0     22
       -> ZDP_IncomingData              0      0     22
       -> ZDApp_ProcessMsgCBs           0      0     22
       -> ZDApp_NodeProfileSync         0      0     22
       -> NLME_JoinRequest              0      0     24
       -> osal_rand                     0      0     22
       -> ZDApp_NetworkInit             0      0     22
       -> osal_rand                     0      0     22
       -> ZMacSetReq                    0      0     22
       -> ZMacSetReq                    0      0     22
       -> ZMacSetReq                    0      0     22
       -> NLME_ReJoinRequest            0      0     22
       -> osal_rand                     0      0     22
       -> ZDApp_NetworkInit             0      0     22
       -> NLME_SetPollRate              0      0     22
       -> NLME_SetQueuedPollRate        0      0     22
       -> NLME_SetResponseRate          0      0     22
       -> osal_rand                     0      0     22
       -> ZDApp_NetworkInit             0      0     22
       -> ZDApp_ProcessNetworkJoin      0      0     22
       -> sAddrExtCpy                   0      0     22
       -> ZDApp_NetworkInit             0      0     22
     ZDApp_ProcessSecEvent              0      0      9
       -> ZDSecMgrNewDeviceEvent        0      0     18
       -> osal_start_timerEx            0      0     18
       -> ZDApp_DeviceAuthEvt           0      0     18
       -> ZDApp_SaveNwkKey              0      0     18
     ZDApp_ProcessSecMsg                2      0      0
       -> ZDSecMgrTransportKeyInd       4      0      0
       -> ZDSecMgrRemoveDeviceInd       4      0      0
       -> ZDSecMgrSwitchKeyInd          4      0      0
     ZDApp_ReadNetworkRestoreState      0      0      9
       -> zgReadStartupOptions          0      0     18
     ZDApp_RegisterCBs                  2      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
       -> ZDO_RegisterForZDOMsg         4      0      0
     ZDApp_ResetNwkKey                  0      0     35
       -> osal_memset                   0      0     62
       -> osal_nv_write                 0      0     70
     ZDApp_ResetTimerCancel             2      0      0
       -> osal_stop_timerEx             4      0      0
     ZDApp_ResetTimerStart              2      0      0
       -> osal_start_timerEx            4      0      0
     ZDApp_RestoreNetworkState          0      0      9
       -> NLME_InitNV                   0      0     18
       -> NLME_RestoreFromNV            0      0     18
       -> NLME_GetShortAddr             0      0     18
       -> sAddrExtCpy                   0      0     18
     ZDApp_RestoreNwkKey                0      0     37
       -> osal_nv_read                  0      0     74
     ZDApp_SaveNetworkStateEvt          0      0     10
     ZDApp_SaveNwkKey                   0      0     46
       -> SSP_ReadNwkActiveKey          0      0     66
       -> osal_nv_write                 0      0     74
     ZDApp_SecInit                      2      0     12
       -> ZDSecMgrInit                  4      0      0
     ZDApp_SendEventMsg                 2      0      0
       -> ZDApp_SendMsg                 4      0      0
     ZDApp_SendMsg                      1      0     48
       -> osal_msg_allocate             0      0     34
       -> osal_memcpy                   0      0     40
       -> osal_msg_send                 0      0     34
     ZDApp_StartJoiningCycle            2      0      0
       -> ZDApp_NetworkInit             4      0      0
     ZDApp_StopJoiningCycle             2      0      0
     ZDApp_event_loop                   0      0     10
       -> ZDO_StartDevice               0      0     20
       -> ZDApp_ProcessOSALMsg          0      0     20
       -> osal_msg_deallocate           0      0     20
       -> osal_msg_receive              0      0     20
       -> ZDApp_NetworkStartEvt         0      0     20
       -> osal_pwrmgr_device            0      0     20
       -> osal_set_event                0      0     20
       -> ZDO_UpdateNwkStatus           0      0     20
       -> ZDApp_SaveNetworkStateEvt     0      0     20
     ZDOInitDevice                      0      0     12
       -> zgInitItems                   0      0     24
       -> ZDConfig_InitDescriptors      0      0     24
       -> ZDApp_LeaveCtrlInit           0      0     24
       -> ZDApp_LeaveCtrlStartup        0      0     24
       -> ZDAppDetermineDeviceType      0      0     24
       -> osal_rand                     0      0     24
       -> ZDApp_SecInit                 0      0     24
       -> ZDApp_NetworkInit             0      0     24
       -> NLME_SetBroadcastFilter       0      0     24
     ZDO_AddrChangeIndicationCB         2      0      0
       -> ZDApp_NVUpdate                4      0      0
       -> osal_set_event                4      0      0
       -> ZDApp_AnnounceNewAddress      4      0      0
     ZDO_ConcentratorIndicationCB       0      0      0
     ZDO_JoinConfirmCB                  2      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> ZDApp_NVUpdate                4      0      0
       -> HalLedSet                     4      0      0
       -> ZDApp_SendMsg                 4      0      0
     ZDO_JoinIndicationCB               2      0      1
       -> ZDApp_NVUpdate                4      0      0
     ZDO_LeaveCnf                       0      0     10
       -> NLME_GetExtAddr               0      0     20
       -> sAddrExtCmp                   0      0     20
       -> ZDApp_LeaveReset              0      0     20
       -> ZDApp_LeaveUpdate             0      0     20
     ZDO_LeaveInd                       2      0     14
       -> NLME_LeaveRsp                 0      0     28
       -> ZDApp_LeaveReset              0      0     28
       -> NLME_GetCoordShortAddr        4      0     28
       -> ZDApp_LeaveReset              0      0     28
       -> ZDApp_LeaveUpdate             0      0     28
     ZDO_ManytoOneFailureIndicationCB
                                        2      0      0
       -> NLME_RouteDiscoveryRequest
                                        4      0      0
       -> NLME_RouteDiscoveryRequest
                                        4      0      0
     ZDO_NetworkDiscoveryConfirmCB      1      0     28
       -> nwk_ExtPANIDValid             0      0     56
       -> sAddrExtCmp                   0      0     56
       -> sAddrExtCpy                   0      0     56
       -> ZDApp_SendMsg                 0      0     56
     ZDO_NetworkFormationConfirmCB      2      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> osal_set_event                4      0      0
     ZDO_PollConfirmCB                  0      0      0
     ZDO_StartRouterConfirmCB           2      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> HalLedSet                     4      0      0
       -> osal_set_event                4      0      0
     ZDO_SyncIndicationCB               2      0      0
       -> nwkNeighborInitTable          4      0      0
       -> ZDApp_SendMsg                 4      0      0
     ZDO_UpdateDeviceIndication         0      0      0


   Segment part sizes:

     Function/Label                              Bytes
     --------------                              -----
     _A_IEN0                                        1
     WDCTL                                          1
     MatchRsps                                      1
     zdoDiscCounter                                 1
     ZDAppNwkAddr                                   9
     zdappMgmtNwkDiscRspTransSeq                    1
     zdappMgmtNwkDiscReqInProgress                  1
     zdappMgmtNwkDiscRspAddr                        9
     zdappMgmtNwkDiscStartIndex                     1
     zdappMgmtSavedNwkState                         1
     nwkFrameCounterChanges                         2
     continueJoining                                1
     _tmpRejoinState                                1
     ZDO_UseExtendedPANID                           8
     ZDAppTaskID                                    1
     nwkStatus                                      1
     ZDApp_AutoFindMode_epDesc                      2
     ZDApp_LeaveCtrl                                1
     devState                                       1
     devStartMode                                   1
     retryCnt                                       1
     ZDApp_epDesc                                   6
     ZDApp_SavedPollRate                            2
     ZDApp_Init                                    82
     ZDApp_SecInit                                 14
     ZDApp_event_loop                             218
     ZDApp_ProcessSecEvent                        120
     ZDOInitDevice                                146
     ZDApp_ReadNetworkRestoreState                 23
     ZDAppDetermineDeviceType                      79
     ZDApp_NetworkStartEvt                         92
     ZDApp_DeviceAuthEvt                           92
     ZDApp_SaveNetworkStateEvt                      3
     ZDApp_RestoreNetworkState                     84
     ZDApp_InitUserDesc                           126
     ZDAppCheckForHoldKey                          24
     ZDApp_ProcessOSALMsg                         504
     ZDApp_ProcessMsgCBs                          144
     ZDApp_RegisterCBs                             59
     ZDApp_ProcessSecMsg                           79
     ZDApp_ProcessNetworkJoin                     467
     ZDApp_SaveNwkKey                             102
     ZDApp_ResetNwkKey                             83
     ZDApp_RestoreNwkKey                          117
     ZDApp_ResetTimerStart                         27
     ZDApp_ResetTimerCancel                        23
     ZDApp_LeaveCtrlInit                           77
     ZDApp_LeaveCtrlSet                            60
     ZDApp_LeaveCtrlBypass                         21
     ZDApp_LeaveCtrlStartup                        92
     ZDApp_LeaveReset                              21
     ZDApp_LeaveUpdate                             18
     ZDApp_SendEventMsg                            23
     ZDApp_SendMsg                                131
     ZDO_NetworkDiscoveryConfirmCB                415
     ZDO_NetworkFormationConfirmCB                 62
     ZDO_StartRouterConfirmCB                      62
     ZDO_JoinConfirmCB                             69
     ZDO_AddrChangeIndicationCB                    29
     ZDO_JoinIndicationCB                          16
     ZDO_ConcentratorIndicationCB                   3
     ZDO_LeaveCnf                                  92
     ZDO_LeaveInd                                 218
     ZDO_SyncIndicationCB                          43
     ZDO_ManytoOneFailureIndicationCB
                                                   39
     ZDO_PollConfirmCB                              3
     AddrMgrWriteNVRequest                          3
     ZDO_UpdateDeviceIndication                     5
     ZDApp_InMsgCB                                135
     ZDApp_ChangeMatchDescRespPermission
                                                   14
     ZDApp_NetworkInit                             47
     ZDApp_NwkStateUpdateCB                        31
     ZDApp_NodeProfileSync                        106
     ZDApp_StartJoiningCycle                       43
     ZDApp_StopJoiningCycle                        35
     ZDApp_AnnounceNewAddress                      47
     ZDApp_NVUpdate                                 3
     ZDApp_CoordStartPANIDConflictCB
                                                   10
     ?<Initializer for zdoDiscCounter>              1
     ?<Initializer for continueJoining>             1
     ?<Initializer for devState>                    1
     ?<Initializer for ZDApp_epDesc>                6
     ?<Initializer for ZDApp_SavedPollRate>         2
     __Constant_1                                   4
     __Constant_0                                   4
     __Constant_3e8                                 4
     ??ZDApp_Init?relay                             6
     ??ZDApp_SecInit?relay                          6
     ??ZDApp_event_loop?relay                       6
     ??ZDApp_ProcessSecEvent?relay                  6
     ??ZDOInitDevice?relay                          6
     ??ZDApp_ReadNetworkRestoreState?relay          6
     ??ZDAppDetermineDeviceType?relay               6
     ??ZDApp_NetworkStartEvt?relay                  6
     ??ZDApp_DeviceAuthEvt?relay                    6
     ??ZDApp_SaveNetworkStateEvt?relay              6
     ??ZDApp_RestoreNetworkState?relay              6
     ??ZDApp_InitUserDesc?relay                     6
     ??ZDAppCheckForHoldKey?relay                   6
     ??ZDApp_ProcessOSALMsg?relay                   6
     ??ZDApp_ProcessMsgCBs?relay                    6
     ??ZDApp_RegisterCBs?relay                      6
     ??ZDApp_ProcessSecMsg?relay                    6
     ??ZDApp_ProcessNetworkJoin?relay               6
     ??ZDApp_SaveNwkKey?relay                       6
     ??ZDApp_ResetNwkKey?relay                      6
     ??ZDApp_RestoreNwkKey?relay                    6
     ??ZDApp_ResetTimerStart?relay                  6
     ??ZDApp_ResetTimerCancel?relay                 6
     ??ZDApp_LeaveCtrlInit?relay                    6
     ??ZDApp_LeaveCtrlSet?relay                     6
     ??ZDApp_LeaveCtrlBypass?relay                  6
     ??ZDApp_LeaveCtrlStartup?relay                 6
     ??ZDApp_LeaveReset?relay                       6
     ??ZDApp_LeaveUpdate?relay                      6
     ??ZDApp_SendEventMsg?relay                     6
     ??ZDApp_SendMsg?relay                          6
     ??ZDO_NetworkDiscoveryConfirmCB?relay          6
     ??ZDO_NetworkFormationConfirmCB?relay          6
     ??ZDO_StartRouterConfirmCB?relay               6
     ??ZDO_JoinConfirmCB?relay                      6
     ??ZDO_AddrChangeIndicationCB?relay             6
     ??ZDO_JoinIndicationCB?relay                   6
     ??ZDO_ConcentratorIndicationCB?relay           6
     ??ZDO_LeaveCnf?relay                           6
     ??ZDO_LeaveInd?relay                           6
     ??ZDO_SyncIndicationCB?relay                   6
     ??ZDO_ManytoOneFailureIndicationCB?relay       6
     ??ZDO_PollConfirmCB?relay                      6
     ??AddrMgrWriteNVRequest?relay                  6
     ??ZDO_UpdateDeviceIndication?relay             6
     ??ZDApp_InMsgCB?relay                          6
     ??ZDApp_ChangeMatchDescRespPermission?relay    6
     ??ZDApp_NetworkInit?relay                      6
     ??ZDApp_NwkStateUpdateCB?relay                 6
     ??ZDApp_NodeProfileSync?relay                  6
     ??ZDApp_StartJoiningCycle?relay                6
     ??ZDApp_StopJoiningCycle?relay                 6
     ??ZDApp_AnnounceNewAddress?relay               6
     ??ZDApp_NVUpdate?relay                         6
     ??ZDApp_CoordStartPANIDConflictCB?relay        6

 
 4 681 bytes in segment BANKED_CODE
   330 bytes in segment BANK_RELAYS
     2 bytes in segment SFR_AN
    11 bytes in segment XDATA_I
    11 bytes in segment XDATA_ID
    12 bytes in segment XDATA_ROM_C
    41 bytes in segment XDATA_Z
 
 5 022 bytes of CODE  memory
     0 bytes of CONST memory (+ 12 bytes shared)
     0 bytes of DATA  memory (+  2 bytes shared)
    52 bytes of XDATA memory

Errors: none
Warnings: none
