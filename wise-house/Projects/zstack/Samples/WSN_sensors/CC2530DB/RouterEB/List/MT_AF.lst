###############################################################################
#                                                                             #
# IAR C/C++ Compiler V7.51A/W32 for 8051                08/Apr/2013  11:22:04 #
# Copyright 2004-2009 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Com #
#                          ponents\mt\MT_AF.c                                 #
#    Command line       =  -f "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0 #
#                          \Projects\zstack\Samples\WSN_sensors\CC2530DB\..\. #
#                          .\..\Tools\CC2530DB\f8wRouter.cfg" (-DCPU32MHZ     #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DRTR_NWK -DBLINK_LEDS) -f "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\Tools\CC #
#                          2530DB\f8wConfig.cfg" (-DSECURE=0                  #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Co #
#                          mponents\mt\MT_AF.c" -D ZTOOL_P1 -D MT_TASK -D     #
#                          MT_SYS_FUNC -D MT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG  #
#                          -lC "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3. #
#                          0\Projects\zstack\Samples\WSN_sensors\CC2530DB\Rou #
#                          terEB\List\" -lA "C:\Texas                         #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\RouterEB\List\"   #
#                          --diag_suppress Pe001,Pa010 -o "C:\Texas           #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\RouterEB\Obj\"    #
#                          -e --require_prototypes --no_unroll --no_inline    #
#                          --no_tbaa --debug --core=plain --dptr=16,1         #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 8 -I  #
#                          "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Pr #
#                          ojects\zstack\Samples\WSN_sensors\CC2530DB\" -I    #
#                          "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Pr #
#                          ojects\zstack\Samples\WSN_sensors\CC2530DB\..\SOUR #
#                          CE\" -I "C:\Texas Instruments\ZStack-CC2530-2.2.2- #
#                          1.3.0\Projects\zstack\Samples\WSN_sensors\CC2530DB #
#                          \..\..\..\ZMAIN\TI2530DB\" -I "C:\Texas            #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MT\" -I "C:\Texas                         #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\HAL\INCLUDE\" -I "C:\Texas                #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\HAL\TARGET\CC2530EB\" -I "C:\Texas        #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\OSAL\MCU\CCSOC\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\OSAL\INCLUDE\" -I "C:\Texas               #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\AF\" -I "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\NWK\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\SEC\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\SAPI\" -I "C:\Texas                 #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\SYS\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\ZDO\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\ZMAC\F8W\" -I "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\ZMAC\" -I "C:\Texas                       #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\SERVICES\SADDR\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\SERVICES\SDATA\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\INCLUDE\" -I "C:\Texas                #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\HIGH_LEVEL\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\LOW_LEVEL\srf04\" -I "C:\Texas        #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\LOW_LEVEL\srf04\SINGLE_CHIP\" -I      #
#                          "D:\Program Files\IAR Systems\Embedded Workbench   #
#                          5.3\8051\INC\" -I "D:\Program Files\IAR            #
#                          Systems\Embedded Workbench 5.3\8051\INC\CLIB\" -Om #
#    List file          =  C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Pro #
#                          jects\zstack\Samples\WSN_sensors\CC2530DB\RouterEB #
#                          \List\MT_AF.lst                                    #
#    Object file        =  C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Pro #
#                          jects\zstack\Samples\WSN_sensors\CC2530DB\RouterEB #
#                          \Obj\MT_AF.r51                                     #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Components\mt\MT_AF.c
      1          /**************************************************************************************************
      2            Filename:       MT_AF.c
      3            Revised:        $Date: 2008-10-10 09:56:24 -0700 (Fri, 10 Oct 2008) $
      4            Revision:       $Revision: 18257 $
      5          
      6          
      7            Description:    MonitorTest functions for the AF layer.
      8          
      9          
     10            Copyright 2007 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com.
     39          
     40          **************************************************************************************************/
     41          
     42          /***************************************************************************************************
     43           * INCLUDES
     44           ***************************************************************************************************/
     45          #include "ZComDef.h"
     46          #include "OSAL.h"
     47          #include "MT.h"
     48          #include "MT_AF.h"
     49          #include "nwk.h"
     50          #include "OnBoard.h"
     51          #include "MT_UART.h"
     52          
     53          
     54          /***************************************************************************************************
     55           * GLOBAL VARIABLES
     56           ***************************************************************************************************/
     57          
     58          #if defined ( MT_AF_CB_FUNC )
     59          uint16 _afCallbackSub;
     60          #endif
     61          
     62          /***************************************************************************************************
     63           * LOCAL FUNCTIONS
     64           ***************************************************************************************************/
     65          void MT_AfRegister(uint8 *pBuf);
     66          void MT_AfDataRequest(uint8 *pBuf);
     67          
     68          /***************************************************************************************************
     69           * @fn      MT_afCommandProcessing
     70           *
     71           * @brief   Process all the AF commands that are issued by test tool
     72           *
     73           * @param   pBuf - pointer to the received buffer
     74           *
     75           * @return  status
     76           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     77          uint8 MT_AfCommandProcessing(uint8 *pBuf)
   \                     MT_AfCommandProcessing:
     78          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
     79            uint8 status = MT_RPC_SUCCESS;
   \   000005   7E00         MOV     R6,#0x0
     80          
     81            switch (pBuf[MT_RPC_POS_CMD1])
   \   000007   8A82         MOV     DPL,R2
   \   000009   8B83         MOV     DPH,R3
   \   00000B   A3           INC     DPTR
   \   00000C   A3           INC     DPTR
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   12....       LCALL   ?UC_SWITCH_DENSE
   \                     `?<Jumptable for MT_AfCommandProcessing>_0`:
   \   000011   00           DB        0
   \   000012   01           DB        1
   \   000013   ....         DW        ??MT_AfCommandProcessing_0
   \   000015   ....         DW        ??MT_AfCommandProcessing_1
   \   000017   ....         DW        ??MT_AfCommandProcessing_2
     82            {
     83              case MT_AF_REGISTER:
     84                MT_AfRegister(pBuf);
   \                     ??MT_AfCommandProcessing_1:
   \   000019                ; Setup parameters for call to function MT_AfRegister
   \   000019   12....       LCALL   ??MT_AfRegister?relay
   \   00001C   8007         SJMP    ??MT_AfCommandProcessing_3
     85                break;
     86          
     87              case MT_AF_DATA_REQUEST:
     88                MT_AfDataRequest(pBuf);
   \                     ??MT_AfCommandProcessing_2:
   \   00001E                ; Setup parameters for call to function MT_AfDataRequest
   \   00001E   12....       LCALL   ??MT_AfDataRequest?relay
   \   000021   8002         SJMP    ??MT_AfCommandProcessing_3
     89                break;
     90          
     91              default:
     92                status = MT_RPC_ERR_COMMAND_ID;
   \                     ??MT_AfCommandProcessing_0:
   \   000023   0E           INC     R6
   \   000024   0E           INC     R6
     93                break;
     94            }
     95          
     96            return status;
   \                     ??MT_AfCommandProcessing_3:
   \   000025   EE           MOV     A,R6
   \   000026   F9           MOV     R1,A
   \   000027   7F01         MOV     R7,#0x1
   \   000029   02....       LJMP    ?BANKED_LEAVE_XDATA
     97          }
     98          
     99          /***************************************************************************************************
    100           * @fn      MT_AfRegister
    101           *
    102           * @brief   Process AF Register command
    103           *
    104           * @param   pBuf - pointer to the received buffer
    105           *
    106           * @return  none
    107           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    108          void MT_AfRegister(uint8 *pBuf)
   \                     MT_AfRegister:
    109          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
    110            uint8 cmdId;
    111            uint8 retValue = ZMemError;
   \   00000E   7410         MOV     A,#0x10
   \   000010   85..82       MOV     DPL,?XSP + 0
   \   000013   85..83       MOV     DPH,?XSP + 1
   \   000016   F0           MOVX    @DPTR,A
    112            endPointDesc_t *epDesc;
    113          
    114            /* parse header */
    115            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   000017   8A82         MOV     DPL,R2
   \   000019   8B83         MOV     DPH,R3
   \   00001B   A3           INC     DPTR
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   F5..         MOV     ?V0 + 2,A
    116            pBuf += MT_RPC_FRAME_HDR_SZ;
    117          
    118            epDesc = (endPointDesc_t *)osal_mem_alloc(sizeof(endPointDesc_t));
   \   000020                ; Setup parameters for call to function osal_mem_alloc
   \   000020   7A06         MOV     R2,#0x6
   \   000022   7B00         MOV     R3,#0x0
   \   000024   12....       LCALL   ??osal_mem_alloc?relay
   \   000027   8A..         MOV     ?V0 + 4,R2
   \   000029   8B..         MOV     ?V0 + 5,R3
   \   00002B   AE..         MOV     R6,?V0 + 4
   \   00002D   AF..         MOV     R7,?V0 + 5
    119            if ( epDesc )
   \   00002F   EE           MOV     A,R6
   \   000030   7001         JNZ     ??MT_AfRegister_0
   \   000032   EF           MOV     A,R7
   \                     ??MT_AfRegister_0:
   \   000033   6041         JZ      ??MT_AfRegister_1
    120            {
    121              epDesc->task_id = &MT_TaskID;
   \   000035   8E82         MOV     DPL,R6
   \   000037   8F83         MOV     DPH,R7
   \   000039   A3           INC     DPTR
   \   00003A   74..         MOV     A,#(MT_TaskID & 0xff)
   \   00003C   F0           MOVX    @DPTR,A
   \   00003D   A3           INC     DPTR
   \   00003E   74..         MOV     A,#((MT_TaskID >> 8) & 0xff)
   \   000040   F0           MOVX    @DPTR,A
    122              retValue = MT_BuildEndpointDesc( pBuf, epDesc );
   \   000041                ; Setup parameters for call to function MT_BuildEndpointDesc
   \   000041   EE           MOV     A,R6
   \   000042   FC           MOV     R4,A
   \   000043   EF           MOV     A,R7
   \   000044   FD           MOV     R5,A
   \   000045   E5..         MOV     A,?V0 + 0
   \   000047   2403         ADD     A,#0x3
   \   000049   FA           MOV     R2,A
   \   00004A   E5..         MOV     A,?V0 + 1
   \   00004C   3400         ADDC    A,#0x0
   \   00004E   FB           MOV     R3,A
   \   00004F   12....       LCALL   ??MT_BuildEndpointDesc?relay
   \   000052   E9           MOV     A,R1
   \   000053   85..82       MOV     DPL,?XSP + 0
   \   000056   85..83       MOV     DPH,?XSP + 1
   \   000059   F0           MOVX    @DPTR,A
    123              if ( retValue == ZSuccess )
   \   00005A   E0           MOVX    A,@DPTR
   \   00005B   700F         JNZ     ??MT_AfRegister_2
    124              {
    125                retValue = afRegister( epDesc );
   \   00005D                ; Setup parameters for call to function afRegister
   \   00005D   EE           MOV     A,R6
   \   00005E   FA           MOV     R2,A
   \   00005F   EF           MOV     A,R7
   \   000060   FB           MOV     R3,A
   \   000061   12....       LCALL   ??afRegister?relay
   \   000064   E9           MOV     A,R1
   \   000065   85..82       MOV     DPL,?XSP + 0
   \   000068   85..83       MOV     DPH,?XSP + 1
   \   00006B   F0           MOVX    @DPTR,A
    126              }
    127          
    128              if ( retValue != ZSuccess )
   \                     ??MT_AfRegister_2:
   \   00006C   E0           MOVX    A,@DPTR
   \   00006D   6007         JZ      ??MT_AfRegister_1
    129              {
    130                osal_mem_free( epDesc );
   \   00006F                ; Setup parameters for call to function osal_mem_free
   \   00006F   EE           MOV     A,R6
   \   000070   FA           MOV     R2,A
   \   000071   EF           MOV     A,R7
   \   000072   FB           MOV     R3,A
   \   000073   12....       LCALL   ??osal_mem_free?relay
    131              }
    132            }
    133          
    134            /* Build and send back the response */
    135            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_AF), cmdId, 1, &retValue);
   \                     ??MT_AfRegister_1:
   \   000076                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000076   85..82       MOV     DPL,?XSP + 0
   \   000079   85..83       MOV     DPH,?XSP + 1
   \   00007C   AC82         MOV     R4,DPL
   \   00007E   AD83         MOV     R5,DPH
   \   000080   7B01         MOV     R3,#0x1
   \   000082   AA..         MOV     R2,?V0 + 2
   \   000084   7964         MOV     R1,#0x64
   \   000086   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    136          }
   \   000089   7401         MOV     A,#0x1
   \   00008B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00008E   7F06         MOV     R7,#0x6
   \   000090   02....       LJMP    ?BANKED_LEAVE_XDATA
    137          
    138          /***************************************************************************************************
    139           * @fn      MT_AfDataRequest
    140           *
    141           * @brief   Process AF Register command
    142           *
    143           * @param   pBuf - pointer to the received buffer
    144           *
    145           * @return  none
    146           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    147          void MT_AfDataRequest(uint8 *pBuf)
   \                     MT_AfDataRequest:
    148          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 14
   \   000005   74F2         MOV     A,#-0xe
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    149            uint8 cmdId, tempLen = 0;
    150            uint8 retValue = ZFailure;
   \   00000A   7401         MOV     A,#0x1
   \   00000C   85..82       MOV     DPL,?XSP + 0
   \   00000F   85..83       MOV     DPH,?XSP + 1
   \   000012   F0           MOVX    @DPTR,A
    151            endPointDesc_t *epDesc;
    152            byte transId;
    153            afAddrType_t dstAddr;
    154            cId_t cId;
    155            byte txOpts, radius, srcEP;
    156          
    157              /* parse header */
    158            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   000013   8A82         MOV     DPL,R2
   \   000015   8B83         MOV     DPH,R3
   \   000017   A3           INC     DPTR
   \   000018   A3           INC     DPTR
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   FE           MOV     R6,A
    159            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   00001B   EA           MOV     A,R2
   \   00001C   2403         ADD     A,#0x3
   \   00001E   F5..         MOV     ?V0 + 0,A
   \   000020   EB           MOV     A,R3
   \   000021   3400         ADDC    A,#0x0
   \   000023   F5..         MOV     ?V0 + 1,A
    160          
    161            /* Destination address */
    162            dstAddr.addrMode = afAddr16Bit;
   \   000025   7402         MOV     A,#0x2
   \   000027   C0E0         PUSH    A
   \   000029   740A         MOV     A,#0xa
   \   00002B   12....       LCALL   ?XSTACK_DISP0_8
   \   00002E   D0E0         POP     A
   \   000030   F0           MOVX    @DPTR,A
    163            dstAddr.addr.shortAddr = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   000031   85..82       MOV     DPL,?V0 + 0
   \   000034   85..83       MOV     DPH,?V0 + 1
   \   000037   E0           MOVX    A,@DPTR
   \   000038   FA           MOV     R2,A
   \   000039   A3           INC     DPTR
   \   00003A   E0           MOVX    A,@DPTR
   \   00003B   F9           MOV     R1,A
   \   00003C   EA           MOV     A,R2
   \   00003D   F8           MOV     R0,A
   \   00003E   7402         MOV     A,#0x2
   \   000040   12....       LCALL   ?XSTACK_DISP0_8
   \   000043   E8           MOV     A,R0
   \   000044   F0           MOVX    @DPTR,A
   \   000045   A3           INC     DPTR
   \   000046   E9           MOV     A,R1
   \   000047   F0           MOVX    @DPTR,A
    164            pBuf += 2;
   \   000048   E5..         MOV     A,?V0 + 0
   \   00004A   2402         ADD     A,#0x2
   \   00004C   F5..         MOV     ?V0 + 0,A
   \   00004E   E5..         MOV     A,?V0 + 1
   \   000050   3400         ADDC    A,#0x0
   \   000052   F5..         MOV     ?V0 + 1,A
    165          
    166            /* Destination endpoint */
    167            dstAddr.endPoint = *pBuf++;
   \   000054   85..82       MOV     DPL,?V0 + 0
   \   000057   F583         MOV     DPH,A
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   C0E0         PUSH    A
   \   00005C   740B         MOV     A,#0xb
   \   00005E   12....       LCALL   ?XSTACK_DISP0_8
   \   000061   D0E0         POP     A
   \   000063   F0           MOVX    @DPTR,A
   \   000064   85..82       MOV     DPL,?V0 + 0
   \   000067   85..83       MOV     DPH,?V0 + 1
   \   00006A   A3           INC     DPTR
    168          
    169            /* Source endpoint */
    170            srcEP = *pBuf++;
   \   00006B   E0           MOVX    A,@DPTR
   \   00006C   F9           MOV     R1,A
   \   00006D   A3           INC     DPTR
   \   00006E   8582..       MOV     ?V0 + 0,DPL
   \   000071   8583..       MOV     ?V0 + 1,DPH
    171            epDesc = afFindEndPointDesc( srcEP );
   \   000074                ; Setup parameters for call to function afFindEndPointDesc
   \   000074   12....       LCALL   ??afFindEndPointDesc?relay
   \   000077   8A..         MOV     ?V0 + 2,R2
   \   000079   8B..         MOV     ?V0 + 3,R3
   \   00007B   AC..         MOV     R4,?V0 + 2
   \   00007D   AD..         MOV     R5,?V0 + 3
    172          
    173            /* ClusterId */
    174            cId = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   00007F   85..82       MOV     DPL,?V0 + 0
   \   000082   85..83       MOV     DPH,?V0 + 1
   \   000085   E0           MOVX    A,@DPTR
   \   000086   FA           MOV     R2,A
   \   000087   A3           INC     DPTR
   \   000088   E0           MOVX    A,@DPTR
   \   000089   FB           MOV     R3,A
    175            pBuf +=2;
   \   00008A   E5..         MOV     A,?V0 + 0
   \   00008C   2402         ADD     A,#0x2
   \   00008E   F5..         MOV     ?V0 + 0,A
   \   000090   E5..         MOV     A,?V0 + 1
   \   000092   3400         ADDC    A,#0x0
   \   000094   F5..         MOV     ?V0 + 1,A
    176          
    177            /* TransId */
    178            transId = *pBuf++;
   \   000096   85..82       MOV     DPL,?V0 + 0
   \   000099   F583         MOV     DPH,A
   \   00009B   E0           MOVX    A,@DPTR
   \   00009C   C0E0         PUSH    A
   \   00009E   7401         MOV     A,#0x1
   \   0000A0   12....       LCALL   ?XSTACK_DISP0_8
   \   0000A3   D0E0         POP     A
   \   0000A5   F0           MOVX    @DPTR,A
   \   0000A6   85..82       MOV     DPL,?V0 + 0
   \   0000A9   85..83       MOV     DPH,?V0 + 1
   \   0000AC   A3           INC     DPTR
    179          
    180            /* TxOption */
    181            txOpts = *pBuf++;
   \   0000AD   E0           MOVX    A,@DPTR
   \   0000AE   F9           MOV     R1,A
   \   0000AF   A3           INC     DPTR
    182          
    183            /* Radius */
    184            radius = *pBuf++;
   \   0000B0   E0           MOVX    A,@DPTR
   \   0000B1   F5..         MOV     ?V0 + 2,A
   \   0000B3   A3           INC     DPTR
    185          
    186            /* Length */
    187            tempLen = *pBuf++;
   \   0000B4   E0           MOVX    A,@DPTR
   \   0000B5   FF           MOV     R7,A
   \   0000B6   A3           INC     DPTR
   \   0000B7   8582..       MOV     ?V0 + 0,DPL
   \   0000BA   8583..       MOV     ?V0 + 1,DPH
    188          
    189            if ( epDesc == NULL )
   \   0000BD   EC           MOV     A,R4
   \   0000BE   7001         JNZ     ??MT_AfDataRequest_0
   \   0000C0   ED           MOV     A,R5
   \                     ??MT_AfDataRequest_0:
   \   0000C1   7004         JNZ     ??MT_AfDataRequest_1
    190            {
    191              retValue = afStatus_INVALID_PARAMETER;
   \   0000C3   7402         MOV     A,#0x2
   \   0000C5   803F         SJMP    ??MT_AfDataRequest_2
    192            }
    193            else
    194            {
    195              retValue = AF_DataRequest( &dstAddr, epDesc, cId, tempLen, pBuf, &transId, txOpts, radius );
   \                     ??MT_AfDataRequest_1:
   \   0000C7                ; Setup parameters for call to function AF_DataRequest
   \   0000C7   78..         MOV     R0,#?V0 + 2
   \   0000C9   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000CC   7402         MOV     A,#0x2
   \   0000CE   12....       LCALL   ?XSTACK_DISP0_8
   \   0000D1   8582..       MOV     ?V0 + 2,DPL
   \   0000D4   8583..       MOV     ?V0 + 3,DPH
   \   0000D7   78..         MOV     R0,#?V0 + 2
   \   0000D9   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000DC   78..         MOV     R0,#?V0 + 0
   \   0000DE   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000E1   8F..         MOV     ?V0 + 0,R7
   \   0000E3   75..00       MOV     ?V0 + 1,#0x0
   \   0000E6   78..         MOV     R0,#?V0 + 0
   \   0000E8   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000EB   8A..         MOV     ?V0 + 0,R2
   \   0000ED   8B..         MOV     ?V0 + 1,R3
   \   0000EF   78..         MOV     R0,#?V0 + 0
   \   0000F1   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000F4   740B         MOV     A,#0xb
   \   0000F6   12....       LCALL   ?XSTACK_DISP0_8
   \   0000F9   AA82         MOV     R2,DPL
   \   0000FB   AB83         MOV     R3,DPH
   \   0000FD   12....       LCALL   ??AF_DataRequest?relay
   \   000100   7409         MOV     A,#0x9
   \   000102   12....       LCALL   ?DEALLOC_XSTACK8
   \   000105   E9           MOV     A,R1
   \                     ??MT_AfDataRequest_2:
   \   000106   85..82       MOV     DPL,?XSP + 0
   \   000109   85..83       MOV     DPH,?XSP + 1
   \   00010C   F0           MOVX    @DPTR,A
    196            }
    197          
    198            /* Build and send back the response */
    199            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_AF), cmdId, 1, &retValue);
   \   00010D                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   00010D   AC82         MOV     R4,DPL
   \   00010F   AD83         MOV     R5,DPH
   \   000111   7B01         MOV     R3,#0x1
   \   000113   EE           MOV     A,R6
   \   000114   FA           MOV     R2,A
   \   000115   7964         MOV     R1,#0x64
   \   000117   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    200          }
   \   00011A   740E         MOV     A,#0xe
   \   00011C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00011F   7F04         MOV     R7,#0x4
   \   000121   02....       LJMP    ?BANKED_LEAVE_XDATA
    201          
    202          /***************************************************************************************************
    203           * @fn      MT_AfDataConfirm
    204           *
    205           * @brief   Process
    206           *
    207           * @param   pBuf - pointer to the received buffer
    208           *
    209           * @return  none
    210           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    211          void MT_AfDataConfirm(afDataConfirm_t *pMsg)
   \                     MT_AfDataConfirm:
    212          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 3
   \   000004   74FD         MOV     A,#-0x3
   \   000006   12....       LCALL   ?ALLOC_XSTACK8
    213            uint8 retArray[3];
    214          
    215            retArray[0] = pMsg->hdr.status;
   \   000009   8A82         MOV     DPL,R2
   \   00000B   8B83         MOV     DPH,R3
   \   00000D   A3           INC     DPTR
   \   00000E   E0           MOVX    A,@DPTR
   \   00000F   85..82       MOV     DPL,?XSP + 0
   \   000012   85..83       MOV     DPH,?XSP + 1
   \   000015   F0           MOVX    @DPTR,A
    216            retArray[1] = pMsg->endpoint;
   \   000016   8A82         MOV     DPL,R2
   \   000018   8B83         MOV     DPH,R3
   \   00001A   A3           INC     DPTR
   \   00001B   A3           INC     DPTR
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   C0E0         PUSH    A
   \   00001F   7401         MOV     A,#0x1
   \   000021   12....       LCALL   ?XSTACK_DISP0_8
   \   000024   D0E0         POP     A
   \   000026   F0           MOVX    @DPTR,A
    217            retArray[2] = pMsg->transID;
   \   000027   8A82         MOV     DPL,R2
   \   000029   8B83         MOV     DPH,R3
   \   00002B   A3           INC     DPTR
   \   00002C   A3           INC     DPTR
   \   00002D   A3           INC     DPTR
   \   00002E   E0           MOVX    A,@DPTR
   \   00002F   C0E0         PUSH    A
   \   000031   7402         MOV     A,#0x2
   \   000033   12....       LCALL   ?XSTACK_DISP0_8
   \   000036   D0E0         POP     A
   \   000038   F0           MOVX    @DPTR,A
    218          
    219            /* Build and send back the response */
    220            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_AF), MT_AF_DATA_CONFIRM, 3, retArray);
   \   000039                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000039   85..82       MOV     DPL,?XSP + 0
   \   00003C   85..83       MOV     DPH,?XSP + 1
   \   00003F   AC82         MOV     R4,DPL
   \   000041   AD83         MOV     R5,DPH
   \   000043   7B03         MOV     R3,#0x3
   \   000045   7A80         MOV     R2,#-0x80
   \   000047   7944         MOV     R1,#0x44
   \   000049   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    221          }
   \   00004C   7403         MOV     A,#0x3
   \   00004E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000051   D083         POP     DPH
   \   000053   D082         POP     DPL
   \   000055   02....       LJMP    ?BRET
    222          
    223          /***************************************************************************************************
    224           * @fn          MT_AfIncomingMsg
    225           *
    226           * @brief       Process the callback subscription for AF Incoming data.
    227           *
    228           * @param       pkt - Incoming AF data.
    229           *
    230           * @return      none
    231           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    232          void MT_AfIncomingMsg(afIncomingMSGPacket_t *pMsg)
   \                     MT_AfIncomingMsg:
    233          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    234            uint8 respLen;            /* Length of the whole response packet */
    235            uint8 dataLen;            /* Length of the data section in the response packet */
    236            uint8 *respPtr, *tempPtr;
    237          
    238            /* dataLen */
    239            dataLen = pMsg->cmd.DataLength;
   \   000009   EE           MOV     A,R6
   \   00000A   241F         ADD     A,#0x1f
   \   00000C   F582         MOV     DPL,A
   \   00000E   EF           MOV     A,R7
   \   00000F   3400         ADDC    A,#0x0
   \   000011   F583         MOV     DPH,A
   \   000013   E0           MOVX    A,@DPTR
   \   000014   F5..         MOV     ?V0 + 4,A
    240            /* respLen */
    241            respLen = 17 + dataLen;
   \   000016   7411         MOV     A,#0x11
   \   000018   25..         ADD     A,?V0 + 4
   \   00001A   F5..         MOV     ?V0 + 5,A
    242          
    243            /* Allocate memory for the response packet */
    244            respPtr = osal_mem_alloc(respLen);
   \   00001C                ; Setup parameters for call to function osal_mem_alloc
   \   00001C   FA           MOV     R2,A
   \   00001D   7B00         MOV     R3,#0x0
   \   00001F   12....       LCALL   ??osal_mem_alloc?relay
   \   000022   8A..         MOV     ?V0 + 6,R2
   \   000024   8B..         MOV     ?V0 + 7,R3
    245            if (!respPtr)
   \   000026   EA           MOV     A,R2
   \   000027   7001         JNZ     ??MT_AfIncomingMsg_0
   \   000029   EB           MOV     A,R3
   \                     ??MT_AfIncomingMsg_0:
   \   00002A   7003         JNZ     $+5
   \   00002C   02....       LJMP    ??MT_AfIncomingMsg_1 & 0xFFFF
    246            {
    247              return;
    248            }
    249            tempPtr = respPtr;
    250          
    251            /* Fill in the data */
    252          
    253            /* Group ID */
    254            *tempPtr++ = LO_UINT16(pMsg->groupId);
   \   00002F   EE           MOV     A,R6
   \   000030   2402         ADD     A,#0x2
   \   000032   F8           MOV     R0,A
   \   000033   EF           MOV     A,R7
   \   000034   3400         ADDC    A,#0x0
   \   000036   F9           MOV     R1,A
   \   000037   8882         MOV     DPL,R0
   \   000039   8983         MOV     DPH,R1
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   8A82         MOV     DPL,R2
   \   00003E   8B83         MOV     DPH,R3
   \   000040   F0           MOVX    @DPTR,A
   \   000041   A3           INC     DPTR
   \   000042   AA82         MOV     R2,DPL
   \   000044   AB83         MOV     R3,DPH
    255            *tempPtr++ = HI_UINT16(pMsg->groupId);
   \   000046   8882         MOV     DPL,R0
   \   000048   8983         MOV     DPH,R1
   \   00004A   A3           INC     DPTR
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   8A82         MOV     DPL,R2
   \   00004E   8B83         MOV     DPH,R3
   \   000050   F0           MOVX    @DPTR,A
   \   000051   A3           INC     DPTR
   \   000052   0A           INC     R2
   \   000053   AB83         MOV     R3,DPH
    256          
    257            /* Cluster ID */
    258            *tempPtr++ = LO_UINT16(pMsg->clusterId);
   \   000055   EE           MOV     A,R6
   \   000056   2404         ADD     A,#0x4
   \   000058   08           INC     R0
   \   000059   08           INC     R0
   \   00005A   EF           MOV     A,R7
   \   00005B   3400         ADDC    A,#0x0
   \   00005D   F9           MOV     R1,A
   \   00005E   8882         MOV     DPL,R0
   \   000060   8983         MOV     DPH,R1
   \   000062   E0           MOVX    A,@DPTR
   \   000063   8A82         MOV     DPL,R2
   \   000065   8B83         MOV     DPH,R3
   \   000067   F0           MOVX    @DPTR,A
   \   000068   A3           INC     DPTR
   \   000069   0A           INC     R2
   \   00006A   AB83         MOV     R3,DPH
    259            *tempPtr++ = HI_UINT16(pMsg->clusterId);
   \   00006C   8882         MOV     DPL,R0
   \   00006E   8983         MOV     DPH,R1
   \   000070   A3           INC     DPTR
   \   000071   E0           MOVX    A,@DPTR
   \   000072   8A82         MOV     DPL,R2
   \   000074   8B83         MOV     DPH,R3
   \   000076   F0           MOVX    @DPTR,A
   \   000077   A3           INC     DPTR
   \   000078   0A           INC     R2
   \   000079   AB83         MOV     R3,DPH
    260          
    261            /* Source Address */
    262            *tempPtr++ = LO_UINT16(pMsg->srcAddr.addr.shortAddr);
   \   00007B   EE           MOV     A,R6
   \   00007C   2406         ADD     A,#0x6
   \   00007E   08           INC     R0
   \   00007F   08           INC     R0
   \   000080   EF           MOV     A,R7
   \   000081   3400         ADDC    A,#0x0
   \   000083   F9           MOV     R1,A
   \   000084   8882         MOV     DPL,R0
   \   000086   8983         MOV     DPH,R1
   \   000088   E0           MOVX    A,@DPTR
   \   000089   8A82         MOV     DPL,R2
   \   00008B   8B83         MOV     DPH,R3
   \   00008D   F0           MOVX    @DPTR,A
   \   00008E   A3           INC     DPTR
   \   00008F   0A           INC     R2
   \   000090   AB83         MOV     R3,DPH
    263            *tempPtr++ = HI_UINT16(pMsg->srcAddr.addr.shortAddr);
   \   000092   8882         MOV     DPL,R0
   \   000094   8983         MOV     DPH,R1
   \   000096   A3           INC     DPTR
   \   000097   E0           MOVX    A,@DPTR
   \   000098   8A82         MOV     DPL,R2
   \   00009A   8B83         MOV     DPH,R3
   \   00009C   F0           MOVX    @DPTR,A
   \   00009D   A3           INC     DPTR
   \   00009E   0A           INC     R2
   \   00009F   AB83         MOV     R3,DPH
    264          
    265            /* Source EP */
    266            *tempPtr++ = pMsg->srcAddr.endPoint;
   \   0000A1   EE           MOV     A,R6
   \   0000A2   240F         ADD     A,#0xf
   \   0000A4   F582         MOV     DPL,A
   \   0000A6   EF           MOV     A,R7
   \   0000A7   3400         ADDC    A,#0x0
   \   0000A9   F583         MOV     DPH,A
   \   0000AB   E0           MOVX    A,@DPTR
   \   0000AC   8A82         MOV     DPL,R2
   \   0000AE   8B83         MOV     DPH,R3
   \   0000B0   F0           MOVX    @DPTR,A
   \   0000B1   A3           INC     DPTR
   \   0000B2   0A           INC     R2
   \   0000B3   AB83         MOV     R3,DPH
    267          
    268            /* Destination EP */
    269            *tempPtr++ = pMsg->endPoint;
   \   0000B5   EE           MOV     A,R6
   \   0000B6   2414         ADD     A,#0x14
   \   0000B8   F582         MOV     DPL,A
   \   0000BA   EF           MOV     A,R7
   \   0000BB   3400         ADDC    A,#0x0
   \   0000BD   F583         MOV     DPH,A
   \   0000BF   E0           MOVX    A,@DPTR
   \   0000C0   8A82         MOV     DPL,R2
   \   0000C2   8B83         MOV     DPH,R3
   \   0000C4   F0           MOVX    @DPTR,A
   \   0000C5   A3           INC     DPTR
   \   0000C6   0A           INC     R2
   \   0000C7   AB83         MOV     R3,DPH
    270          
    271            /* WasBroadCast */
    272            *tempPtr++ = pMsg->wasBroadcast;
   \   0000C9   EE           MOV     A,R6
   \   0000CA   2415         ADD     A,#0x15
   \   0000CC   F582         MOV     DPL,A
   \   0000CE   EF           MOV     A,R7
   \   0000CF   3400         ADDC    A,#0x0
   \   0000D1   F583         MOV     DPH,A
   \   0000D3   E0           MOVX    A,@DPTR
   \   0000D4   8A82         MOV     DPL,R2
   \   0000D6   8B83         MOV     DPH,R3
   \   0000D8   F0           MOVX    @DPTR,A
   \   0000D9   A3           INC     DPTR
   \   0000DA   0A           INC     R2
   \   0000DB   AB83         MOV     R3,DPH
    273          
    274            /* LinkQuality */
    275            *tempPtr++ = pMsg->LinkQuality;
   \   0000DD   EE           MOV     A,R6
   \   0000DE   2416         ADD     A,#0x16
   \   0000E0   F582         MOV     DPL,A
   \   0000E2   EF           MOV     A,R7
   \   0000E3   3400         ADDC    A,#0x0
   \   0000E5   F583         MOV     DPH,A
   \   0000E7   E0           MOVX    A,@DPTR
   \   0000E8   8A82         MOV     DPL,R2
   \   0000EA   8B83         MOV     DPH,R3
   \   0000EC   F0           MOVX    @DPTR,A
   \   0000ED   A3           INC     DPTR
   \   0000EE   0A           INC     R2
   \   0000EF   AB83         MOV     R3,DPH
    276          
    277            /* SecurityUse */
    278            *tempPtr++ = pMsg->SecurityUse;
   \   0000F1   EE           MOV     A,R6
   \   0000F2   2419         ADD     A,#0x19
   \   0000F4   F582         MOV     DPL,A
   \   0000F6   EF           MOV     A,R7
   \   0000F7   3400         ADDC    A,#0x0
   \   0000F9   F583         MOV     DPH,A
   \   0000FB   E0           MOVX    A,@DPTR
   \   0000FC   8A82         MOV     DPL,R2
   \   0000FE   8B83         MOV     DPH,R3
   \   000100   F0           MOVX    @DPTR,A
   \   000101   A3           INC     DPTR
   \   000102   0A           INC     R2
   \   000103   AB83         MOV     R3,DPH
    279          
    280            /* Timestamp */
    281            *tempPtr++ = BREAK_UINT32(pMsg->timestamp, 0);
   \   000105   EE           MOV     A,R6
   \   000106   241A         ADD     A,#0x1a
   \   000108   FC           MOV     R4,A
   \   000109   EF           MOV     A,R7
   \   00010A   3400         ADDC    A,#0x0
   \   00010C   FD           MOV     R5,A
   \   00010D   8C82         MOV     DPL,R4
   \   00010F   8D83         MOV     DPH,R5
   \   000111   78..         MOV     R0,#?V0 + 0
   \   000113   12....       LCALL   ?L_MOV_X
   \   000116   8A82         MOV     DPL,R2
   \   000118   8B83         MOV     DPH,R3
   \   00011A   E5..         MOV     A,?V0 + 0
   \   00011C   F0           MOVX    @DPTR,A
   \   00011D   A3           INC     DPTR
   \   00011E   0A           INC     R2
   \   00011F   AB83         MOV     R3,DPH
    282            *tempPtr++ = BREAK_UINT32(pMsg->timestamp, 1);
   \   000121   8C82         MOV     DPL,R4
   \   000123   8D83         MOV     DPH,R5
   \   000125   78..         MOV     R0,#?V0 + 0
   \   000127   12....       LCALL   ?L_MOV_X
   \   00012A   E5..         MOV     A,?V0 + 1
   \   00012C   8A82         MOV     DPL,R2
   \   00012E   8B83         MOV     DPH,R3
   \   000130   F0           MOVX    @DPTR,A
   \   000131   A3           INC     DPTR
   \   000132   0A           INC     R2
   \   000133   AB83         MOV     R3,DPH
    283            *tempPtr++ = BREAK_UINT32(pMsg->timestamp, 2);
   \   000135   8C82         MOV     DPL,R4
   \   000137   8D83         MOV     DPH,R5
   \   000139   78..         MOV     R0,#?V0 + 0
   \   00013B   12....       LCALL   ?L_MOV_X
   \   00013E   7410         MOV     A,#0x10
   \   000140   78..         MOV     R0,#?V0 + 0
   \   000142   12....       LCALL   ?UL_SHR
   \   000145   8A82         MOV     DPL,R2
   \   000147   8B83         MOV     DPH,R3
   \   000149   E5..         MOV     A,?V0 + 0
   \   00014B   F0           MOVX    @DPTR,A
   \   00014C   A3           INC     DPTR
   \   00014D   0A           INC     R2
   \   00014E   AB83         MOV     R3,DPH
    284            *tempPtr++ = BREAK_UINT32(pMsg->timestamp, 3);
   \   000150   8C82         MOV     DPL,R4
   \   000152   8D83         MOV     DPH,R5
   \   000154   78..         MOV     R0,#?V0 + 0
   \   000156   12....       LCALL   ?L_MOV_X
   \   000159   7418         MOV     A,#0x18
   \   00015B   78..         MOV     R0,#?V0 + 0
   \   00015D   12....       LCALL   ?UL_SHR
   \   000160   8A82         MOV     DPL,R2
   \   000162   8B83         MOV     DPH,R3
   \   000164   E5..         MOV     A,?V0 + 0
   \   000166   F0           MOVX    @DPTR,A
   \   000167   A3           INC     DPTR
   \   000168   0A           INC     R2
   \   000169   AB83         MOV     R3,DPH
    285          
    286            /* Transmit Sequence Number */
    287            *tempPtr++ = pMsg->cmd.TransSeqNumber;
   \   00016B   EE           MOV     A,R6
   \   00016C   241E         ADD     A,#0x1e
   \   00016E   F582         MOV     DPL,A
   \   000170   EF           MOV     A,R7
   \   000171   3400         ADDC    A,#0x0
   \   000173   F583         MOV     DPH,A
   \   000175   E0           MOVX    A,@DPTR
   \   000176   8A82         MOV     DPL,R2
   \   000178   8B83         MOV     DPH,R3
   \   00017A   F0           MOVX    @DPTR,A
   \   00017B   A3           INC     DPTR
    288          
    289            /* Data Length */
    290            *tempPtr++ = dataLen;
   \   00017C   E5..         MOV     A,?V0 + 4
   \   00017E   F0           MOVX    @DPTR,A
   \   00017F   A3           INC     DPTR
   \   000180   0A           INC     R2
   \   000181   0A           INC     R2
   \   000182   AB83         MOV     R3,DPH
    291          
    292            /* Data */
    293            if (dataLen)
   \   000184   6022         JZ      ??MT_AfIncomingMsg_2
    294            {
    295              osal_memcpy(tempPtr, pMsg->cmd.Data, dataLen);
   \   000186                ; Setup parameters for call to function osal_memcpy
   \   000186   EE           MOV     A,R6
   \   000187   2421         ADD     A,#0x21
   \   000189   F582         MOV     DPL,A
   \   00018B   EF           MOV     A,R7
   \   00018C   3400         ADDC    A,#0x0
   \   00018E   F583         MOV     DPH,A
   \   000190   E0           MOVX    A,@DPTR
   \   000191   F5..         MOV     ?V0 + 0,A
   \   000193   A3           INC     DPTR
   \   000194   E0           MOVX    A,@DPTR
   \   000195   F5..         MOV     ?V0 + 1,A
   \   000197   78..         MOV     R0,#?V0 + 0
   \   000199   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00019C   AC..         MOV     R4,?V0 + 4
   \   00019E   7D00         MOV     R5,#0x0
   \   0001A0   12....       LCALL   ??osal_memcpy?relay
   \   0001A3   7403         MOV     A,#0x3
   \   0001A5   12....       LCALL   ?DEALLOC_XSTACK8
    296            }
    297          
    298            /* Build and send back the response */
    299            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_AF), MT_AF_INCOMING_MSG, respLen, respPtr );
   \                     ??MT_AfIncomingMsg_2:
   \   0001A8                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   0001A8   AC..         MOV     R4,?V0 + 6
   \   0001AA   AD..         MOV     R5,?V0 + 7
   \   0001AC   AB..         MOV     R3,?V0 + 5
   \   0001AE   7A81         MOV     R2,#-0x7f
   \   0001B0   7944         MOV     R1,#0x44
   \   0001B2   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    300          
    301            /* Free memory */
    302            osal_mem_free(respPtr);
   \   0001B5                ; Setup parameters for call to function osal_mem_free
   \   0001B5   AA..         MOV     R2,?V0 + 6
   \   0001B7   AB..         MOV     R3,?V0 + 7
   \   0001B9   12....       LCALL   ??osal_mem_free?relay
    303          
    304          }
   \                     ??MT_AfIncomingMsg_1:
   \   0001BC   7F08         MOV     R7,#0x8
   \   0001BE   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfCommandProcessing?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfCommandProcessing

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfRegister?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfRegister

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfDataRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfDataRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfDataConfirm?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfDataConfirm

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfIncomingMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfIncomingMsg
    305          
    306          /***************************************************************************************************
    307          ***************************************************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     MT_AfCommandProcessing             0      0      9
       -> MT_AfRegister                 0      0     18
       -> MT_AfDataRequest              0      0     18
     MT_AfDataConfirm                   3      0      3
       -> MT_BuildAndSendZToolResponse
                                        4      0      6
     MT_AfDataRequest                   1      0     44
       -> afFindEndPointDesc            0      0     52
       -> AF_DataRequest                0      0     70
       -> MT_BuildAndSendZToolResponse
                                        0      0     52
     MT_AfIncomingMsg                   1      0     19
       -> osal_mem_alloc                0      0     32
       -> osal_memcpy                   0      0     38
       -> MT_BuildAndSendZToolResponse
                                        0      0     32
       -> osal_mem_free                 0      0     32
     MT_AfRegister                      1      0     24
       -> osal_mem_alloc                0      0     30
       -> MT_BuildEndpointDesc          0      0     30
       -> afRegister                    0      0     30
       -> osal_mem_free                 0      0     30
       -> MT_BuildAndSendZToolResponse
                                        0      0     30


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     MT_AfCommandProcessing           44
     MT_AfRegister                   147
     MT_AfDataRequest                292
     MT_AfDataConfirm                 88
     MT_AfIncomingMsg                449
     ??MT_AfCommandProcessing?relay    6
     ??MT_AfRegister?relay             6
     ??MT_AfDataRequest?relay          6
     ??MT_AfDataConfirm?relay          6
     ??MT_AfIncomingMsg?relay          6

 
 1 020 bytes in segment BANKED_CODE
    30 bytes in segment BANK_RELAYS
 
 1 050 bytes of CODE memory

Errors: none
Warnings: none
