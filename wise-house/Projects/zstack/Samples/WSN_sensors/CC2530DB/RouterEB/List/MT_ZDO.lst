###############################################################################
#                                                                             #
# IAR C/C++ Compiler V7.51A/W32 for 8051                08/Apr/2013  11:22:10 #
# Copyright 2004-2009 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Com #
#                          ponents\mt\MT_ZDO.c                                #
#    Command line       =  -f "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0 #
#                          \Projects\zstack\Samples\WSN_sensors\CC2530DB\..\. #
#                          .\..\Tools\CC2530DB\f8wRouter.cfg" (-DCPU32MHZ     #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DRTR_NWK -DBLINK_LEDS) -f "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\Tools\CC #
#                          2530DB\f8wConfig.cfg" (-DSECURE=0                  #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=FALSE     #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Co #
#                          mponents\mt\MT_ZDO.c" -D ZTOOL_P1 -D MT_TASK -D    #
#                          MT_SYS_FUNC -D MT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG  #
#                          -lC "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3. #
#                          0\Projects\zstack\Samples\WSN_sensors\CC2530DB\Rou #
#                          terEB\List\" -lA "C:\Texas                         #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\RouterEB\List\"   #
#                          --diag_suppress Pe001,Pa010 -o "C:\Texas           #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\RouterEB\Obj\"    #
#                          -e --require_prototypes --no_unroll --no_inline    #
#                          --no_tbaa --debug --core=plain --dptr=16,1         #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 8 -I  #
#                          "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Pr #
#                          ojects\zstack\Samples\WSN_sensors\CC2530DB\" -I    #
#                          "C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Pr #
#                          ojects\zstack\Samples\WSN_sensors\CC2530DB\..\SOUR #
#                          CE\" -I "C:\Texas Instruments\ZStack-CC2530-2.2.2- #
#                          1.3.0\Projects\zstack\Samples\WSN_sensors\CC2530DB #
#                          \..\..\..\ZMAIN\TI2530DB\" -I "C:\Texas            #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MT\" -I "C:\Texas                         #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\HAL\INCLUDE\" -I "C:\Texas                #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\HAL\TARGET\CC2530EB\" -I "C:\Texas        #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\OSAL\MCU\CCSOC\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\OSAL\INCLUDE\" -I "C:\Texas               #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\AF\" -I "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\NWK\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\SEC\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\SAPI\" -I "C:\Texas                 #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\SYS\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\STACK\ZDO\" -I "C:\Texas                  #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\ZMAC\F8W\" -I "C:\Texas                   #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\ZMAC\" -I "C:\Texas                       #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\SERVICES\SADDR\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\SERVICES\SDATA\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\INCLUDE\" -I "C:\Texas                #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\HIGH_LEVEL\" -I "C:\Texas             #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\LOW_LEVEL\srf04\" -I "C:\Texas        #
#                          Instruments\ZStack-CC2530-2.2.2-1.3.0\Projects\zst #
#                          ack\Samples\WSN_sensors\CC2530DB\..\..\..\..\..\CO #
#                          MPONENTS\MAC\LOW_LEVEL\srf04\SINGLE_CHIP\" -I      #
#                          "D:\Program Files\IAR Systems\Embedded Workbench   #
#                          5.3\8051\INC\" -I "D:\Program Files\IAR            #
#                          Systems\Embedded Workbench 5.3\8051\INC\CLIB\" -Om #
#    List file          =  C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Pro #
#                          jects\zstack\Samples\WSN_sensors\CC2530DB\RouterEB #
#                          \List\MT_ZDO.lst                                   #
#    Object file        =  C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Pro #
#                          jects\zstack\Samples\WSN_sensors\CC2530DB\RouterEB #
#                          \Obj\MT_ZDO.r51                                    #
#                                                                             #
#                                                                             #
###############################################################################

C:\Texas Instruments\ZStack-CC2530-2.2.2-1.3.0\Components\mt\MT_ZDO.c
      1          /**************************************************************************************************
      2            Filename:       MT_ZDO.c
      3            Revised:        $Date: 2009-08-03 14:20:19 -0700 (Mon, 03 Aug 2009) $
      4            Revision:       $Revision: 20438 $
      5          
      6            Description:    MonitorTest functions for the ZDO layer.
      7          
      8          
      9            Copyright 2004-2007 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          #ifdef MT_ZDO_FUNC
     41          
     42          /**************************************************************************************************
     43           * INCLUDES
     44           **************************************************************************************************/
     45          #include "ZComDef.h"
     46          #include "OSAL.h"
     47          #include "MT.h"
     48          #include "MT_ZDO.h"
     49          #include "APSMEDE.h"
     50          #include "ZDConfig.h"
     51          #include "ZDProfile.h"
     52          #include "ZDObject.h"
     53          #include "ZDApp.h"
     54          
     55          #if !defined( WIN32 )
     56            #include "OnBoard.h"
     57          #endif
     58          
     59          #include "nwk_util.h"
     60          
     61          /**************************************************************************************************
     62           * CONSTANTS
     63           **************************************************************************************************/
     64          #define MT_ZDO_END_DEVICE_ANNCE_IND_LEN   0x0D
     65          #define MT_ZDO_ADDR_RSP_LEN               0x0D
     66          #define MT_ZDO_BIND_UNBIND_RSP_LEN        0x03
     67          
     68          #define MTZDO_RESPONSE_BUFFER_LEN   100
     69          
     70          #define MTZDO_MAX_MATCH_CLUSTERS    16
     71          #define MTZDO_MAX_ED_BIND_CLUSTERS  15
     72          
     73          /**************************************************************************************************
     74           * GLOBAL VARIABLES
     75           **************************************************************************************************/

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     76          uint32 _zdoCallbackSub;
   \                     _zdoCallbackSub:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z
     77          
     78          /**************************************************************************************************
     79           * LOCAL VARIABLES
     80           **************************************************************************************************/

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     81          uint8 mtzdoResponseBuffer[MTZDO_RESPONSE_BUFFER_LEN];
   \                     mtzdoResponseBuffer:
   \   000000                DS 100
   \   000064                REQUIRE __INIT_XDATA_Z
     82          
     83          /**************************************************************************************************
     84           * LOCAL FUNCTIONS
     85           **************************************************************************************************/
     86          #if defined (MT_ZDO_FUNC)
     87          void MT_ZdoNWKAddressRequest(uint8 *pBuf);
     88          void MT_ZdoIEEEAddrRequest(uint8 *pBuf);
     89          void MT_ZdoNodeDescRequest(uint8 *pBuf);
     90          void MT_ZdoPowerDescRequest(uint8 *pBuf);
     91          void MT_ZdoSimpleDescRequest(uint8 *pBuf);
     92          void MT_ZdoActiveEpRequest(uint8 *pBuf);
     93          void MT_ZdoMatchDescRequest(uint8 *pBuf);
     94          void MT_ZdoComplexDescRequest(uint8 *pBuf);
     95          void MT_ZdoUserDescRequest(uint8 *pBuf);
     96          void MT_ZdoEndDevAnnce(uint8 *pBuf);
     97          void MT_ZdoUserDescSet(uint8 *pBuf);
     98          void MT_ZdoServiceDiscRequest(uint8 *pBuf);
     99          void MT_ZdoEndDevBindRequest(uint8 *pBuf);
    100          void MT_ZdoBindRequest(uint8 *pBuf);
    101          void MT_ZdoUnbindRequest(uint8 *pBuf);
    102          void MT_ZdoMgmtNwkDiscRequest(uint8 *pBuf);
    103          void MT_ZdoStartupFromApp(uint8 *pBuf);
    104          #if defined (MT_ZDO_MGMT)
    105          void MT_ZdoMgmtLqiRequest(uint8 *pBuf);
    106          void MT_ZdoMgmtRtgRequest(uint8 *pBuf);
    107          void MT_ZdoMgmtBindRequest(uint8 *pBuf);
    108          void MT_ZdoMgmtLeaveRequest(uint8 *pBuf);
    109          void MT_ZdoMgmtDirectJoinRequest(uint8 *pBuf);
    110          void MT_ZdoMgmtPermitJoinRequest(uint8 *pBuf);
    111          void MT_ZdoMgmtNwkUpdateRequest(uint8 *pBuf);
    112          #endif /* MT_ZDO_MGMT */
    113          #endif /* MT_ZDO_FUNC */
    114          
    115          #if defined (MT_ZDO_CB_FUNC)
    116          uint8 MT_ZdoHandleExceptions( afIncomingMSGPacket_t *pData, zdoIncomingMsg_t *inMsg );
    117          void MT_ZdoAddrRspCB( ZDO_NwkIEEEAddrResp_t *pMsg, uint16 clusterID );
    118          void MT_ZdoEndDevAnnceCB( ZDO_DeviceAnnce_t *pMsg, uint16 srcAddr );
    119          void MT_ZdoBindUnbindRspCB( uint16 clusterID, uint16 srcAddr, uint8 status );
    120          
    121          /* ZDO cluster ID to MT response command ID lookup */
    122          static const uint8 CODE mtZdoCluster2Rsp[4][7] =
    123          {
    124            {
    125              MT_ZDO_NWK_ADDR_RSP,         /* NWK_addr_req */
    126              MT_ZDO_IEEE_ADDR_RSP,        /* IEEE_addr_req */
    127              MT_ZDO_NODE_DESC_RSP,        /* Node_Desc_req */
    128              MT_ZDO_POWER_DESC_RSP,       /* Power_Desc_req */
    129              MT_ZDO_SIMPLE_DESC_RSP,      /* Simple_Desc_req */
    130              MT_ZDO_ACTIVE_EP_RSP,        /* Active_EP_req */
    131              MT_ZDO_MATCH_DESC_RSP        /* Match_Desc_req */
    132            },
    133            {
    134              MT_ZDO_COMPLEX_DESC_RSP,     /* Complex_Desc_req */
    135              MT_ZDO_USER_DESC_RSP,        /* User_Desc_req */
    136              0,                           /* Discovery_Cache_req */
    137              0,                           /* End_Device_annce */
    138              MT_ZDO_USER_DESC_CONF,       /* User_Desc_set */
    139              MT_ZDO_SERVER_DISC_RSP,      /* Server_Discovery_req */
    140              0
    141            },
    142            {
    143              MT_ZDO_END_DEVICE_BIND_RSP,  /* End_Device_Bind_req */
    144              MT_ZDO_BIND_RSP,             /* Bind_req */
    145              MT_ZDO_UNBIND_RSP,           /* Unbind_req */
    146              0,
    147              0,
    148              0,
    149              MT_ZDO_STATUS_ERROR_RSP      /* default error status msg */
    150            },
    151            {
    152              MT_ZDO_MGMT_NWK_DISC_RSP,    /* Mgmt_NWK_Disc_req */
    153              MT_ZDO_MGMT_LQI_RSP,         /* Mgmt_Lqi_req */
    154              MT_ZDO_MGMT_RTG_RSP,         /* Mgmt_Rtg_req */
    155              MT_ZDO_MGMT_BIND_RSP,        /* Mgmt_Bind_req */
    156              MT_ZDO_MGMT_LEAVE_RSP,       /* Mgmt_Leave_req */
    157              MT_ZDO_MGMT_DIRECT_JOIN_RSP, /* Mgmt_Direct_Join_req */
    158              MT_ZDO_MGMT_PERMIT_JOIN_RSP  /* Mgmt_Permit_Join_req */
    159            }
    160          };
    161          #endif /* MT_ZDO_CB_FUNC */
    162          
    163          #if defined (MT_ZDO_FUNC)
    164          /***************************************************************************************************
    165           * @fn      MT_ZdoCommandProcessing
    166           *
    167           * @brief
    168           *
    169           *   Process all the ZDO commands that are issued by test tool
    170           *
    171           * @param   pBuf - pointer to the msg buffer
    172           *
    173           *          | LEN  | CMD0  | CMD1  |  DATA  |
    174           *          |  1   |   1   |   1   |  0-255 |
    175           *
    176           * @return  status
    177           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    178          uint8 MT_ZdoCommandProcessing(uint8* pBuf)
   \                     MT_ZdoCommandProcessing:
    179          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    180            uint8 status = MT_RPC_SUCCESS;
   \   000005   7E00         MOV     R6,#0x0
    181          
    182            switch (pBuf[MT_RPC_POS_CMD1])
   \   000007   8A82         MOV     DPL,R2
   \   000009   8B83         MOV     DPH,R3
   \   00000B   A3           INC     DPTR
   \   00000C   A3           INC     DPTR
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   12....       LCALL   ?UC_SWITCH_SPARSE
   \                     `?<Jumptable for MT_ZdoCommandProcessing>_0`:
   \   000011   00           DB        0
   \   000012   10           DB        16
   \   000013   00           DB        0
   \   000014   ....         DW        ??MT_ZdoCommandProcessing_0
   \   000016   01           DB        1
   \   000017   ....         DW        ??MT_ZdoCommandProcessing_1
   \   000019   02           DB        2
   \   00001A   ....         DW        ??MT_ZdoCommandProcessing_2
   \   00001C   03           DB        3
   \   00001D   ....         DW        ??MT_ZdoCommandProcessing_3
   \   00001F   04           DB        4
   \   000020   ....         DW        ??MT_ZdoCommandProcessing_4
   \   000022   05           DB        5
   \   000023   ....         DW        ??MT_ZdoCommandProcessing_5
   \   000025   06           DB        6
   \   000026   ....         DW        ??MT_ZdoCommandProcessing_6
   \   000028   07           DB        7
   \   000029   ....         DW        ??MT_ZdoCommandProcessing_7
   \   00002B   08           DB        8
   \   00002C   ....         DW        ??MT_ZdoCommandProcessing_8
   \   00002E   0A           DB        10
   \   00002F   ....         DW        ??MT_ZdoCommandProcessing_9
   \   000031   0B           DB        11
   \   000032   ....         DW        ??MT_ZdoCommandProcessing_10
   \   000034   0C           DB        12
   \   000035   ....         DW        ??MT_ZdoCommandProcessing_11
   \   000037   20           DB        32
   \   000038   ....         DW        ??MT_ZdoCommandProcessing_12
   \   00003A   21           DB        33
   \   00003B   ....         DW        ??MT_ZdoCommandProcessing_13
   \   00003D   22           DB        34
   \   00003E   ....         DW        ??MT_ZdoCommandProcessing_14
   \   000040   40           DB        64
   \   000041   ....         DW        ??MT_ZdoCommandProcessing_15
   \   000043   ....         DW        ??MT_ZdoCommandProcessing_16
    183            {
    184          #if defined ( ZDO_NWKADDR_REQUEST )
    185              case MT_ZDO_NWK_ADDR_REQ:
    186                MT_ZdoNWKAddressRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_0:
   \   000045                ; Setup parameters for call to function MT_ZdoNWKAddressRequest
   \   000045   12....       LCALL   ??MT_ZdoNWKAddressRequest?relay
   \   000048   804D         SJMP    ??MT_ZdoCommandProcessing_17
    187                break;
    188          #endif
    189          
    190          #if defined ( ZDO_IEEEADDR_REQUEST )
    191              case MT_ZDO_IEEE_ADDR_REQ:
    192                MT_ZdoIEEEAddrRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_1:
   \   00004A                ; Setup parameters for call to function MT_ZdoIEEEAddrRequest
   \   00004A   12....       LCALL   ??MT_ZdoIEEEAddrRequest?relay
   \   00004D   8048         SJMP    ??MT_ZdoCommandProcessing_17
    193                break;
    194          #endif
    195          
    196          #if defined ( ZDO_NODEDESC_REQUEST )
    197              case MT_ZDO_NODE_DESC_REQ:
    198                MT_ZdoNodeDescRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_2:
   \   00004F                ; Setup parameters for call to function MT_ZdoNodeDescRequest
   \   00004F   12....       LCALL   ??MT_ZdoNodeDescRequest?relay
   \   000052   8043         SJMP    ??MT_ZdoCommandProcessing_17
    199                break;
    200          #endif
    201          
    202          #if defined ( ZDO_POWERDESC_REQUEST )
    203              case MT_ZDO_POWER_DESC_REQ:
    204                MT_ZdoPowerDescRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_3:
   \   000054                ; Setup parameters for call to function MT_ZdoPowerDescRequest
   \   000054   12....       LCALL   ??MT_ZdoPowerDescRequest?relay
   \   000057   803E         SJMP    ??MT_ZdoCommandProcessing_17
    205                break;
    206          #endif
    207          
    208          #if defined ( ZDO_SIMPLEDESC_REQUEST )
    209              case MT_ZDO_SIMPLE_DESC_REQ:
    210                MT_ZdoSimpleDescRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_4:
   \   000059                ; Setup parameters for call to function MT_ZdoSimpleDescRequest
   \   000059   12....       LCALL   ??MT_ZdoSimpleDescRequest?relay
   \   00005C   8039         SJMP    ??MT_ZdoCommandProcessing_17
    211                break;
    212          #endif
    213          
    214          #if defined ( ZDO_ACTIVEEP_REQUEST )
    215              case MT_ZDO_ACTIVE_EP_REQ:
    216                MT_ZdoActiveEpRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_5:
   \   00005E                ; Setup parameters for call to function MT_ZdoActiveEpRequest
   \   00005E   12....       LCALL   ??MT_ZdoActiveEpRequest?relay
   \   000061   8034         SJMP    ??MT_ZdoCommandProcessing_17
    217                break;
    218          #endif
    219          
    220          #if defined ( ZDO_MATCH_REQUEST )
    221              case MT_ZDO_MATCH_DESC_REQ:
    222                MT_ZdoMatchDescRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_6:
   \   000063                ; Setup parameters for call to function MT_ZdoMatchDescRequest
   \   000063   12....       LCALL   ??MT_ZdoMatchDescRequest?relay
   \   000066   802F         SJMP    ??MT_ZdoCommandProcessing_17
    223                break;
    224          #endif
    225          
    226          #if defined ( ZDO_COMPLEXDESC_REQUEST )
    227              case MT_ZDO_COMPLEX_DESC_REQ:
    228                MT_ZdoComplexDescRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_7:
   \   000068                ; Setup parameters for call to function MT_ZdoComplexDescRequest
   \   000068   12....       LCALL   ??MT_ZdoComplexDescRequest?relay
   \   00006B   802A         SJMP    ??MT_ZdoCommandProcessing_17
    229                break;
    230          #endif
    231          
    232          #if defined ( ZDO_USERDESC_REQUEST )
    233              case MT_ZDO_USER_DESC_REQ:
    234                MT_ZdoUserDescRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_8:
   \   00006D                ; Setup parameters for call to function MT_ZdoUserDescRequest
   \   00006D   12....       LCALL   ??MT_ZdoUserDescRequest?relay
   \   000070   8025         SJMP    ??MT_ZdoCommandProcessing_17
    235                break;
    236          #endif
    237          
    238          #if defined ( ZDO_ENDDEVICE_ANNCE )
    239              case MT_ZDO_END_DEV_ANNCE:
    240                MT_ZdoEndDevAnnce(pBuf);
   \                     ??MT_ZdoCommandProcessing_9:
   \   000072                ; Setup parameters for call to function MT_ZdoEndDevAnnce
   \   000072   12....       LCALL   ??MT_ZdoEndDevAnnce?relay
   \   000075   8020         SJMP    ??MT_ZdoCommandProcessing_17
    241                break;
    242          #endif      
    243          
    244          #if defined ( ZDO_USERDESCSET_REQUEST )
    245              case MT_ZDO_USER_DESC_SET:
    246                MT_ZdoUserDescSet(pBuf);
   \                     ??MT_ZdoCommandProcessing_10:
   \   000077                ; Setup parameters for call to function MT_ZdoUserDescSet
   \   000077   12....       LCALL   ??MT_ZdoUserDescSet?relay
   \   00007A   801B         SJMP    ??MT_ZdoCommandProcessing_17
    247                break;
    248          #endif
    249          
    250          #if defined ( ZDO_SERVERDISC_REQUEST )
    251              case MT_ZDO_SERVICE_DISC_REQ:
    252                MT_ZdoServiceDiscRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_11:
   \   00007C                ; Setup parameters for call to function MT_ZdoServiceDiscRequest
   \   00007C   12....       LCALL   ??MT_ZdoServiceDiscRequest?relay
   \   00007F   8016         SJMP    ??MT_ZdoCommandProcessing_17
    253                break;
    254          #endif
    255          
    256          #if defined ( ZDO_ENDDEVICEBIND_REQUEST )
    257              case MT_ZDO_END_DEV_BIND_REQ:
    258                MT_ZdoEndDevBindRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_12:
   \   000081                ; Setup parameters for call to function MT_ZdoEndDevBindRequest
   \   000081   12....       LCALL   ??MT_ZdoEndDevBindRequest?relay
   \   000084   8011         SJMP    ??MT_ZdoCommandProcessing_17
    259                break;
    260          #endif
    261          
    262          #if defined ( ZDO_BIND_UNBIND_REQUEST )
    263              case MT_ZDO_BIND_REQ:
    264                MT_ZdoBindRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_13:
   \   000086                ; Setup parameters for call to function MT_ZdoBindRequest
   \   000086   12....       LCALL   ??MT_ZdoBindRequest?relay
   \   000089   800C         SJMP    ??MT_ZdoCommandProcessing_17
    265                break;
    266          #endif
    267          
    268          #if defined ( ZDO_BIND_UNBIND_REQUEST )
    269              case MT_ZDO_UNBIND_REQ:
    270                MT_ZdoUnbindRequest(pBuf);
   \                     ??MT_ZdoCommandProcessing_14:
   \   00008B                ; Setup parameters for call to function MT_ZdoUnbindRequest
   \   00008B   12....       LCALL   ??MT_ZdoUnbindRequest?relay
   \   00008E   8007         SJMP    ??MT_ZdoCommandProcessing_17
    271                break;
    272          #endif
    273          
    274          #if defined ( ZDO_NETWORKSTART_REQUEST )
    275              case MT_ZDO_STARTUP_FROM_APP:
    276                MT_ZdoStartupFromApp(pBuf);
   \                     ??MT_ZdoCommandProcessing_15:
   \   000090                ; Setup parameters for call to function MT_ZdoStartupFromApp
   \   000090   12....       LCALL   ??MT_ZdoStartupFromApp?relay
   \   000093   8002         SJMP    ??MT_ZdoCommandProcessing_17
    277                break;
    278          #endif
    279          
    280          #if defined ( ZDO_MGMT_NWKDISC_REQUEST )
    281              case MT_ZDO_MGMT_NWKDISC_REQ:
    282                MT_ZdoMgmtNwkDiscRequest(pBuf);
    283                break;
    284          #endif
    285          
    286          #if defined ( ZDO_MGMT_LQI_REQUEST )
    287              case MT_ZDO_MGMT_LQI_REQ:
    288                MT_ZdoMgmtLqiRequest(pBuf);
    289                break;
    290          #endif
    291          
    292          #if defined ( ZDO_MGMT_RTG_REQUEST )
    293              case MT_ZDO_MGMT_RTG_REQ:
    294                MT_ZdoMgmtRtgRequest(pBuf);
    295                break;
    296          #endif
    297          
    298          #if defined ( ZDO_MGMT_BIND_REQUEST )
    299              case MT_ZDO_MGMT_BIND_REQ:
    300                MT_ZdoMgmtBindRequest(pBuf);
    301                break;
    302          #endif
    303          
    304          #if defined ( ZDO_MGMT_LEAVE_REQUEST )
    305              case MT_ZDO_MGMT_LEAVE_REQ:
    306                MT_ZdoMgmtLeaveRequest(pBuf);
    307                break;
    308          #endif
    309          
    310          #if defined ( ZDO_MGMT_JOINDIRECT_REQUEST )
    311              case MT_ZDO_MGMT_DIRECT_JOIN_REQ:
    312                MT_ZdoMgmtDirectJoinRequest(pBuf);
    313                break;
    314          #endif
    315          
    316          #if defined ( ZDO_MGMT_PERMIT_JOIN_REQUEST )
    317              case MT_ZDO_MGMT_PERMIT_JOIN_REQ:
    318                MT_ZdoMgmtPermitJoinRequest(pBuf);
    319                break;
    320          #endif
    321          
    322          #if defined ( ZDO_MGMT_NWKUPDATE_REQUEST )
    323              case MT_ZDO_MGMT_NWK_UPDATE_REQ:
    324                MT_ZdoMgmtNwkUpdateRequest(pBuf);
    325                break;
    326          #endif 
    327          
    328              default:
    329                status = MT_RPC_ERR_COMMAND_ID;
   \                     ??MT_ZdoCommandProcessing_16:
   \   000095   0E           INC     R6
   \   000096   0E           INC     R6
    330                break;
    331            }
    332          
    333            return status;
   \                     ??MT_ZdoCommandProcessing_17:
   \   000097   EE           MOV     A,R6
   \   000098   F9           MOV     R1,A
   \   000099   7F01         MOV     R7,#0x1
   \   00009B   02....       LJMP    ?BANKED_LEAVE_XDATA
    334          }
    335          
    336          /***************************************************************************************************
    337           * @fn      MT_ZdoNwkAddrReq
    338           *
    339           * @brief   Handle a nwk address request.
    340           *
    341           * @param   pData  - MT message data
    342           *
    343           * @return  void
    344           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    345          void MT_ZdoNWKAddressRequest(uint8 *pBuf)
   \                     MT_ZdoNWKAddressRequest:
    346          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    347            uint8 cmdId;
    348            uint8 retValue;
    349            uint8 reqType;
    350            uint8 startIndex;
    351            uint8 *pExtAddr;
    352          
    353            /* parse header */
    354            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000A   8A82         MOV     DPL,R2
   \   00000C   8B83         MOV     DPH,R3
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   E0           MOVX    A,@DPTR
   \   000011   FE           MOV     R6,A
    355            pBuf += MT_RPC_FRAME_HDR_SZ;
    356          
    357            /* parse parameters */
    358            pExtAddr = pBuf;
   \   000012   EA           MOV     A,R2
   \   000013   2403         ADD     A,#0x3
   \   000015   F5..         MOV     ?V0 + 0,A
   \   000017   EB           MOV     A,R3
   \   000018   3400         ADDC    A,#0x0
   \   00001A   F5..         MOV     ?V0 + 1,A
    359            pBuf += Z_EXTADDR_LEN;
   \   00001C   E5..         MOV     A,?V0 + 0
   \   00001E   2408         ADD     A,#0x8
   \   000020   FA           MOV     R2,A
   \   000021   E5..         MOV     A,?V0 + 1
   \   000023   3400         ADDC    A,#0x0
   \   000025   FB           MOV     R3,A
    360          
    361            /* Request type */
    362            reqType = *pBuf++;
   \   000026   8A82         MOV     DPL,R2
   \   000028   8B83         MOV     DPH,R3
   \   00002A   E0           MOVX    A,@DPTR
   \   00002B   F9           MOV     R1,A
   \   00002C   A3           INC     DPTR
    363          
    364            /* Start index */
    365            startIndex = *pBuf;
    366          
    367            retValue = (uint8)ZDP_NwkAddrReq(pExtAddr, reqType, startIndex, 0);
   \   00002D                ; Setup parameters for call to function ZDP_NwkAddrReq
   \   00002D   7D00         MOV     R5,#0x0
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   FC           MOV     R4,A
   \   000031   AA..         MOV     R2,?V0 + 0
   \   000033   AB..         MOV     R3,?V0 + 1
   \   000035   12....       LCALL   ??ZDP_NwkAddrReq?relay
   \   000038   E9           MOV     A,R1
   \   000039   85..82       MOV     DPL,?XSP + 0
   \   00003C   85..83       MOV     DPH,?XSP + 1
   \   00003F   F0           MOVX    @DPTR,A
    368          
    369            /* Build and send back the response */
    370            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   000040                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000040   AC82         MOV     R4,DPL
   \   000042   AD83         MOV     R5,DPH
   \   000044   7B01         MOV     R3,#0x1
   \   000046   EE           MOV     A,R6
   \   000047   FA           MOV     R2,A
   \   000048   7965         MOV     R1,#0x65
   \   00004A   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    371          }
   \   00004D   7401         MOV     A,#0x1
   \   00004F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000052   7F02         MOV     R7,#0x2
   \   000054   02....       LJMP    ?BANKED_LEAVE_XDATA
    372          
    373          /***************************************************************************************************
    374           * @fn      MT_ZdoIEEEAddrRequest
    375           *
    376           * @brief   Handle a IEEE address request.
    377           *
    378           * @param   pData  - MT message data
    379           *
    380           * @return  void
    381           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    382          void MT_ZdoIEEEAddrRequest (uint8 *pBuf)
   \                     MT_ZdoIEEEAddrRequest:
    383          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    384            uint8 cmdId;
    385            uint8 retValue;
    386            uint16 shortAddr;
    387            uint8 reqType;
    388            uint8 startIndex;
    389          
    390            /* parse header */
    391            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000A   8A82         MOV     DPL,R2
   \   00000C   8B83         MOV     DPH,R3
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   E0           MOVX    A,@DPTR
   \   000011   F5..         MOV     ?V0 + 0,A
    392            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000013   EA           MOV     A,R2
   \   000014   2403         ADD     A,#0x3
   \   000016   0A           INC     R2
   \   000017   0A           INC     R2
   \   000018   0A           INC     R2
   \   000019   EB           MOV     A,R3
   \   00001A   3400         ADDC    A,#0x0
   \   00001C   FB           MOV     R3,A
    393          
    394            /* Dev address */
    395            shortAddr = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   00001D   8A82         MOV     DPL,R2
   \   00001F   8B83         MOV     DPH,R3
   \   000021   E0           MOVX    A,@DPTR
   \   000022   FC           MOV     R4,A
   \   000023   A3           INC     DPTR
   \   000024   E0           MOVX    A,@DPTR
   \   000025   F9           MOV     R1,A
   \   000026   EC           MOV     A,R4
   \   000027   FE           MOV     R6,A
   \   000028   E9           MOV     A,R1
   \   000029   FF           MOV     R7,A
    396            pBuf += 2;
   \   00002A   EA           MOV     A,R2
   \   00002B   2402         ADD     A,#0x2
   \   00002D   0A           INC     R2
   \   00002E   0A           INC     R2
   \   00002F   EB           MOV     A,R3
   \   000030   3400         ADDC    A,#0x0
   \   000032   FB           MOV     R3,A
    397          
    398            /* request type */
    399            reqType = *pBuf++;
   \   000033   8A82         MOV     DPL,R2
   \   000035   8B83         MOV     DPH,R3
   \   000037   E0           MOVX    A,@DPTR
   \   000038   F9           MOV     R1,A
   \   000039   A3           INC     DPTR
    400          
    401            /* start index */
    402            startIndex = *pBuf;
    403          
    404            retValue = (uint8)ZDP_IEEEAddrReq(shortAddr, reqType, startIndex, 0);
   \   00003A                ; Setup parameters for call to function ZDP_IEEEAddrReq
   \   00003A   7D00         MOV     R5,#0x0
   \   00003C   E0           MOVX    A,@DPTR
   \   00003D   FC           MOV     R4,A
   \   00003E   EE           MOV     A,R6
   \   00003F   FA           MOV     R2,A
   \   000040   EF           MOV     A,R7
   \   000041   FB           MOV     R3,A
   \   000042   12....       LCALL   ??ZDP_IEEEAddrReq?relay
   \   000045   E9           MOV     A,R1
   \   000046   85..82       MOV     DPL,?XSP + 0
   \   000049   85..83       MOV     DPH,?XSP + 1
   \   00004C   F0           MOVX    @DPTR,A
    405          
    406            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   00004D                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   00004D   AC82         MOV     R4,DPL
   \   00004F   AD83         MOV     R5,DPH
   \   000051   7B01         MOV     R3,#0x1
   \   000053   AA..         MOV     R2,?V0 + 0
   \   000055   7965         MOV     R1,#0x65
   \   000057   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    407          }
   \   00005A   7401         MOV     A,#0x1
   \   00005C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00005F   7F01         MOV     R7,#0x1
   \   000061   02....       LJMP    ?BANKED_LEAVE_XDATA
    408          
    409          /***************************************************************************************************
    410           * @fn      MT_ZdoNodeDescRequest
    411           *
    412           * @brief   Handle a Node Descriptor request.
    413           *
    414           * @param   pData  - MT message data
    415           *
    416           * @return  void
    417           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    418          void MT_ZdoNodeDescRequest (uint8 *pBuf)
   \                     MT_ZdoNodeDescRequest:
    419          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 10
   \   000005   74F6         MOV     A,#-0xa
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    420            uint8 cmdId;
    421            uint8 retValue;
    422            zAddrType_t destAddr;
    423            uint16 shortAddr;
    424          
    425            /* parse header */
    426            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000A   8A82         MOV     DPL,R2
   \   00000C   8B83         MOV     DPH,R3
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   E0           MOVX    A,@DPTR
   \   000011   FE           MOV     R6,A
    427            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000012   EA           MOV     A,R2
   \   000013   2403         ADD     A,#0x3
   \   000015   0A           INC     R2
   \   000016   0A           INC     R2
   \   000017   0A           INC     R2
   \   000018   EB           MOV     A,R3
   \   000019   3400         ADDC    A,#0x0
   \   00001B   FB           MOV     R3,A
    428          
    429            /* Destination address */
    430            destAddr.addrMode = Addr16Bit;
   \   00001C   7402         MOV     A,#0x2
   \   00001E   C0E0         PUSH    A
   \   000020   7409         MOV     A,#0x9
   \   000022   12....       LCALL   ?XSTACK_DISP0_8
   \   000025   D0E0         POP     A
   \   000027   F0           MOVX    @DPTR,A
    431            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000028   8A82         MOV     DPL,R2
   \   00002A   8B83         MOV     DPH,R3
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   FC           MOV     R4,A
   \   00002E   A3           INC     DPTR
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   F9           MOV     R1,A
   \   000031   EC           MOV     A,R4
   \   000032   F8           MOV     R0,A
   \   000033   7401         MOV     A,#0x1
   \   000035   12....       LCALL   ?XSTACK_DISP0_8
   \   000038   E8           MOV     A,R0
   \   000039   F0           MOVX    @DPTR,A
   \   00003A   A3           INC     DPTR
   \   00003B   E9           MOV     A,R1
   \   00003C   F0           MOVX    @DPTR,A
    432            pBuf += 2;
   \   00003D   EA           MOV     A,R2
   \   00003E   2402         ADD     A,#0x2
   \   000040   0A           INC     R2
   \   000041   0A           INC     R2
   \   000042   EB           MOV     A,R3
   \   000043   3400         ADDC    A,#0x0
   \   000045   FB           MOV     R3,A
    433          
    434            /* Network address of interest */
    435            shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
    436            pBuf += 2;
    437          
    438            retValue = (uint8)ZDP_NodeDescReq( &destAddr, shortAddr, 0);
   \   000046                ; Setup parameters for call to function ZDP_NWKAddrOfInterestReq
   \   000046   75..00       MOV     ?V0 + 0,#0x0
   \   000049   78..         MOV     R0,#?V0 + 0
   \   00004B   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00004E   7902         MOV     R1,#0x2
   \   000050   8A82         MOV     DPL,R2
   \   000052   8B83         MOV     DPH,R3
   \   000054   E0           MOVX    A,@DPTR
   \   000055   FC           MOV     R4,A
   \   000056   A3           INC     DPTR
   \   000057   E0           MOVX    A,@DPTR
   \   000058   FD           MOV     R5,A
   \   000059   E9           MOV     A,R1
   \   00005A   12....       LCALL   ?XSTACK_DISP0_8
   \   00005D   AA82         MOV     R2,DPL
   \   00005F   AB83         MOV     R3,DPH
   \   000061   12....       LCALL   ??ZDP_NWKAddrOfInterestReq?relay
   \   000064   7401         MOV     A,#0x1
   \   000066   12....       LCALL   ?DEALLOC_XSTACK8
   \   000069   E9           MOV     A,R1
   \   00006A   85..82       MOV     DPL,?XSP + 0
   \   00006D   85..83       MOV     DPH,?XSP + 1
   \   000070   F0           MOVX    @DPTR,A
    439          
    440            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   000071                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000071   AC82         MOV     R4,DPL
   \   000073   AD83         MOV     R5,DPH
   \   000075   7B01         MOV     R3,#0x1
   \   000077   EE           MOV     A,R6
   \   000078   FA           MOV     R2,A
   \   000079   7965         MOV     R1,#0x65
   \   00007B   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    441          }
   \   00007E   740A         MOV     A,#0xa
   \   000080   12....       LCALL   ?DEALLOC_XSTACK8
   \   000083   7F01         MOV     R7,#0x1
   \   000085   02....       LJMP    ?BANKED_LEAVE_XDATA
    442          
    443          /***************************************************************************************************
    444           * @fn      MT_ZdoPowerDescRequest
    445           *
    446           * @brief   Handle a Power Descriptor request.
    447           *
    448           * @param   pData  - MT message data
    449           *
    450           * @return  void
    451           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    452          void MT_ZdoPowerDescRequest(uint8 *pBuf)
   \                     MT_ZdoPowerDescRequest:
    453          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 10
   \   000005   74F6         MOV     A,#-0xa
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    454            uint8 cmdId;
    455            uint8 retValue;
    456            zAddrType_t destAddr;
    457            uint16 shortAddr;
    458          
    459            /* parse header */
    460            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000A   8A82         MOV     DPL,R2
   \   00000C   8B83         MOV     DPH,R3
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   E0           MOVX    A,@DPTR
   \   000011   FE           MOV     R6,A
    461            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000012   EA           MOV     A,R2
   \   000013   2403         ADD     A,#0x3
   \   000015   0A           INC     R2
   \   000016   0A           INC     R2
   \   000017   0A           INC     R2
   \   000018   EB           MOV     A,R3
   \   000019   3400         ADDC    A,#0x0
   \   00001B   FB           MOV     R3,A
    462          
    463            /* Dev address */
    464            destAddr.addrMode = Addr16Bit;
   \   00001C   7402         MOV     A,#0x2
   \   00001E   C0E0         PUSH    A
   \   000020   7409         MOV     A,#0x9
   \   000022   12....       LCALL   ?XSTACK_DISP0_8
   \   000025   D0E0         POP     A
   \   000027   F0           MOVX    @DPTR,A
    465            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000028   8A82         MOV     DPL,R2
   \   00002A   8B83         MOV     DPH,R3
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   FC           MOV     R4,A
   \   00002E   A3           INC     DPTR
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   F9           MOV     R1,A
   \   000031   EC           MOV     A,R4
   \   000032   F8           MOV     R0,A
   \   000033   7401         MOV     A,#0x1
   \   000035   12....       LCALL   ?XSTACK_DISP0_8
   \   000038   E8           MOV     A,R0
   \   000039   F0           MOVX    @DPTR,A
   \   00003A   A3           INC     DPTR
   \   00003B   E9           MOV     A,R1
   \   00003C   F0           MOVX    @DPTR,A
    466            pBuf += 2;
   \   00003D   EA           MOV     A,R2
   \   00003E   2402         ADD     A,#0x2
   \   000040   0A           INC     R2
   \   000041   0A           INC     R2
   \   000042   EB           MOV     A,R3
   \   000043   3400         ADDC    A,#0x0
   \   000045   FB           MOV     R3,A
    467          
    468            /* Network address of interest */
    469            shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
    470            pBuf += 2;
    471          
    472            retValue = (uint8)ZDP_PowerDescReq( &destAddr, shortAddr, 0);
   \   000046                ; Setup parameters for call to function ZDP_NWKAddrOfInterestReq
   \   000046   75..00       MOV     ?V0 + 0,#0x0
   \   000049   78..         MOV     R0,#?V0 + 0
   \   00004B   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00004E   7903         MOV     R1,#0x3
   \   000050   8A82         MOV     DPL,R2
   \   000052   8B83         MOV     DPH,R3
   \   000054   E0           MOVX    A,@DPTR
   \   000055   FC           MOV     R4,A
   \   000056   A3           INC     DPTR
   \   000057   E0           MOVX    A,@DPTR
   \   000058   FD           MOV     R5,A
   \   000059   7402         MOV     A,#0x2
   \   00005B   12....       LCALL   ?XSTACK_DISP0_8
   \   00005E   AA82         MOV     R2,DPL
   \   000060   AB83         MOV     R3,DPH
   \   000062   12....       LCALL   ??ZDP_NWKAddrOfInterestReq?relay
   \   000065   7401         MOV     A,#0x1
   \   000067   12....       LCALL   ?DEALLOC_XSTACK8
   \   00006A   E9           MOV     A,R1
   \   00006B   85..82       MOV     DPL,?XSP + 0
   \   00006E   85..83       MOV     DPH,?XSP + 1
   \   000071   F0           MOVX    @DPTR,A
    473          
    474            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   000072                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000072   AC82         MOV     R4,DPL
   \   000074   AD83         MOV     R5,DPH
   \   000076   7B01         MOV     R3,#0x1
   \   000078   EE           MOV     A,R6
   \   000079   FA           MOV     R2,A
   \   00007A   7965         MOV     R1,#0x65
   \   00007C   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    475          }
   \   00007F   740A         MOV     A,#0xa
   \   000081   12....       LCALL   ?DEALLOC_XSTACK8
   \   000084   7F01         MOV     R7,#0x1
   \   000086   02....       LJMP    ?BANKED_LEAVE_XDATA
    476          
    477          /***************************************************************************************************
    478           * @fn      MT_ZdoSimpleDescRequest
    479           *
    480           * @brief   Handle a Simple Descriptor request.
    481           *
    482           * @param   pBuf  - MT message data
    483           *
    484           * @return  void
    485           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    486          void MT_ZdoSimpleDescRequest(uint8 *pBuf)
   \                     MT_ZdoSimpleDescRequest:
    487          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 10
   \   000005   74F6         MOV     A,#-0xa
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    488            uint8 cmdId;
    489            uint8 retValue;
    490            uint8 epInt;
    491            zAddrType_t destAddr;
    492            uint16 shortAddr;
    493          
    494            /* parse header */
    495            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000A   8A82         MOV     DPL,R2
   \   00000C   8B83         MOV     DPH,R3
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   E0           MOVX    A,@DPTR
   \   000011   FE           MOV     R6,A
    496            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000012   EA           MOV     A,R2
   \   000013   2403         ADD     A,#0x3
   \   000015   0A           INC     R2
   \   000016   0A           INC     R2
   \   000017   0A           INC     R2
   \   000018   EB           MOV     A,R3
   \   000019   3400         ADDC    A,#0x0
   \   00001B   FB           MOV     R3,A
    497          
    498            /* Dev address */
    499            destAddr.addrMode = Addr16Bit;
   \   00001C   7402         MOV     A,#0x2
   \   00001E   C0E0         PUSH    A
   \   000020   7409         MOV     A,#0x9
   \   000022   12....       LCALL   ?XSTACK_DISP0_8
   \   000025   D0E0         POP     A
   \   000027   F0           MOVX    @DPTR,A
    500            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000028   8A82         MOV     DPL,R2
   \   00002A   8B83         MOV     DPH,R3
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   FC           MOV     R4,A
   \   00002E   A3           INC     DPTR
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   F9           MOV     R1,A
   \   000031   EC           MOV     A,R4
   \   000032   F8           MOV     R0,A
   \   000033   7401         MOV     A,#0x1
   \   000035   12....       LCALL   ?XSTACK_DISP0_8
   \   000038   E8           MOV     A,R0
   \   000039   F0           MOVX    @DPTR,A
   \   00003A   A3           INC     DPTR
   \   00003B   E9           MOV     A,R1
   \   00003C   F0           MOVX    @DPTR,A
    501            pBuf += 2;
   \   00003D   EA           MOV     A,R2
   \   00003E   2402         ADD     A,#0x2
   \   000040   0A           INC     R2
   \   000041   0A           INC     R2
   \   000042   EB           MOV     A,R3
   \   000043   3400         ADDC    A,#0x0
   \   000045   FB           MOV     R3,A
    502          
    503            /* Network address of interest */
    504            shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
    505            pBuf += 2;
    506          
    507            /* endpoint/interface */
    508            epInt = *pBuf++;
    509          
    510            retValue = (uint8)ZDP_SimpleDescReq( &destAddr, shortAddr, epInt, 0);
   \   000046                ; Setup parameters for call to function ZDP_SimpleDescReq
   \   000046   75..00       MOV     ?V0 + 0,#0x0
   \   000049   78..         MOV     R0,#?V0 + 0
   \   00004B   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00004E   8A82         MOV     DPL,R2
   \   000050   8B83         MOV     DPH,R3
   \   000052   A3           INC     DPTR
   \   000053   A3           INC     DPTR
   \   000054   E0           MOVX    A,@DPTR
   \   000055   F9           MOV     R1,A
   \   000056   8A82         MOV     DPL,R2
   \   000058   8B83         MOV     DPH,R3
   \   00005A   E0           MOVX    A,@DPTR
   \   00005B   FC           MOV     R4,A
   \   00005C   A3           INC     DPTR
   \   00005D   E0           MOVX    A,@DPTR
   \   00005E   FD           MOV     R5,A
   \   00005F   7402         MOV     A,#0x2
   \   000061   12....       LCALL   ?XSTACK_DISP0_8
   \   000064   AA82         MOV     R2,DPL
   \   000066   AB83         MOV     R3,DPH
   \   000068   12....       LCALL   ??ZDP_SimpleDescReq?relay
   \   00006B   7401         MOV     A,#0x1
   \   00006D   12....       LCALL   ?DEALLOC_XSTACK8
   \   000070   E9           MOV     A,R1
   \   000071   85..82       MOV     DPL,?XSP + 0
   \   000074   85..83       MOV     DPH,?XSP + 1
   \   000077   F0           MOVX    @DPTR,A
    511          
    512            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   000078                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000078   AC82         MOV     R4,DPL
   \   00007A   AD83         MOV     R5,DPH
   \   00007C   7B01         MOV     R3,#0x1
   \   00007E   EE           MOV     A,R6
   \   00007F   FA           MOV     R2,A
   \   000080   7965         MOV     R1,#0x65
   \   000082   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    513          }
   \   000085   740A         MOV     A,#0xa
   \   000087   12....       LCALL   ?DEALLOC_XSTACK8
   \   00008A   7F01         MOV     R7,#0x1
   \   00008C   02....       LJMP    ?BANKED_LEAVE_XDATA
    514          
    515          /***************************************************************************************************
    516           * @fn      MT_ZdoSimpleDescRequest
    517           *
    518           * @brief   Handle a Active EP request.
    519           *
    520           * @param   pBuf  - MT message data
    521           *
    522           * @return  void
    523           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    524          void MT_ZdoActiveEpRequest(uint8 *pBuf)
   \                     MT_ZdoActiveEpRequest:
    525          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 10
   \   000005   74F6         MOV     A,#-0xa
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    526            uint8 cmdId;
    527            uint8 retValue;
    528            zAddrType_t destAddr;
    529            uint16 shortAddr;
    530          
    531            /* parse header */
    532            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000A   8A82         MOV     DPL,R2
   \   00000C   8B83         MOV     DPH,R3
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   E0           MOVX    A,@DPTR
   \   000011   FE           MOV     R6,A
    533            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000012   EA           MOV     A,R2
   \   000013   2403         ADD     A,#0x3
   \   000015   0A           INC     R2
   \   000016   0A           INC     R2
   \   000017   0A           INC     R2
   \   000018   EB           MOV     A,R3
   \   000019   3400         ADDC    A,#0x0
   \   00001B   FB           MOV     R3,A
    534          
    535            /* Dev address */
    536            destAddr.addrMode = Addr16Bit;
   \   00001C   7402         MOV     A,#0x2
   \   00001E   C0E0         PUSH    A
   \   000020   7409         MOV     A,#0x9
   \   000022   12....       LCALL   ?XSTACK_DISP0_8
   \   000025   D0E0         POP     A
   \   000027   F0           MOVX    @DPTR,A
    537            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000028   8A82         MOV     DPL,R2
   \   00002A   8B83         MOV     DPH,R3
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   FC           MOV     R4,A
   \   00002E   A3           INC     DPTR
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   F9           MOV     R1,A
   \   000031   EC           MOV     A,R4
   \   000032   F8           MOV     R0,A
   \   000033   7401         MOV     A,#0x1
   \   000035   12....       LCALL   ?XSTACK_DISP0_8
   \   000038   E8           MOV     A,R0
   \   000039   F0           MOVX    @DPTR,A
   \   00003A   A3           INC     DPTR
   \   00003B   E9           MOV     A,R1
   \   00003C   F0           MOVX    @DPTR,A
    538            pBuf += 2;
   \   00003D   EA           MOV     A,R2
   \   00003E   2402         ADD     A,#0x2
   \   000040   0A           INC     R2
   \   000041   0A           INC     R2
   \   000042   EB           MOV     A,R3
   \   000043   3400         ADDC    A,#0x0
   \   000045   FB           MOV     R3,A
    539          
    540            /* Network address of interest */
    541            shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
    542            pBuf += 2;
    543          
    544            retValue = (uint8)ZDP_ActiveEPReq( &destAddr, shortAddr, 0);
   \   000046                ; Setup parameters for call to function ZDP_NWKAddrOfInterestReq
   \   000046   75..00       MOV     ?V0 + 0,#0x0
   \   000049   78..         MOV     R0,#?V0 + 0
   \   00004B   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00004E   7905         MOV     R1,#0x5
   \   000050   8A82         MOV     DPL,R2
   \   000052   8B83         MOV     DPH,R3
   \   000054   E0           MOVX    A,@DPTR
   \   000055   FC           MOV     R4,A
   \   000056   A3           INC     DPTR
   \   000057   E0           MOVX    A,@DPTR
   \   000058   FD           MOV     R5,A
   \   000059   7402         MOV     A,#0x2
   \   00005B   12....       LCALL   ?XSTACK_DISP0_8
   \   00005E   AA82         MOV     R2,DPL
   \   000060   AB83         MOV     R3,DPH
   \   000062   12....       LCALL   ??ZDP_NWKAddrOfInterestReq?relay
   \   000065   7401         MOV     A,#0x1
   \   000067   12....       LCALL   ?DEALLOC_XSTACK8
   \   00006A   E9           MOV     A,R1
   \   00006B   85..82       MOV     DPL,?XSP + 0
   \   00006E   85..83       MOV     DPH,?XSP + 1
   \   000071   F0           MOVX    @DPTR,A
    545          
    546            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   000072                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000072   AC82         MOV     R4,DPL
   \   000074   AD83         MOV     R5,DPH
   \   000076   7B01         MOV     R3,#0x1
   \   000078   EE           MOV     A,R6
   \   000079   FA           MOV     R2,A
   \   00007A   7965         MOV     R1,#0x65
   \   00007C   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    547          }
   \   00007F   740A         MOV     A,#0xa
   \   000081   12....       LCALL   ?DEALLOC_XSTACK8
   \   000084   7F01         MOV     R7,#0x1
   \   000086   02....       LJMP    ?BANKED_LEAVE_XDATA
    548          
    549          /***************************************************************************************************
    550           * @fn      MT_ZdoMatchDescRequest
    551           *
    552           * @brief   Handle a Match Descriptor request.
    553           *
    554           * @param   pBuf  - MT message data
    555           *
    556           * @return  void
    557           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    558          void MT_ZdoMatchDescRequest(uint8 *pBuf)
   \                     MT_ZdoMatchDescRequest:
    559          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 74
   \   000005   74B6         MOV     A,#-0x4a
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    560            uint8 cmdId;
    561            uint8 retValue = 0;
   \   00000A   E4           CLR     A
   \   00000B   85..82       MOV     DPL,?XSP + 0
   \   00000E   85..83       MOV     DPH,?XSP + 1
   \   000011   F0           MOVX    @DPTR,A
    562            uint8 i, numInClusters, numOutClusters;
    563            uint16 profileId;
    564            zAddrType_t destAddr;
    565            uint16 shortAddr;
    566            uint16 inClusters[MTZDO_MAX_MATCH_CLUSTERS], outClusters[MTZDO_MAX_MATCH_CLUSTERS];
    567          
    568            /* parse header */
    569            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   000012   8A82         MOV     DPL,R2
   \   000014   8B83         MOV     DPH,R3
   \   000016   A3           INC     DPTR
   \   000017   A3           INC     DPTR
   \   000018   E0           MOVX    A,@DPTR
   \   000019   FE           MOV     R6,A
    570            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   00001A   EA           MOV     A,R2
   \   00001B   2403         ADD     A,#0x3
   \   00001D   0A           INC     R2
   \   00001E   0A           INC     R2
   \   00001F   0A           INC     R2
   \   000020   EB           MOV     A,R3
   \   000021   3400         ADDC    A,#0x0
   \   000023   FB           MOV     R3,A
    571          
    572            /* Dev address */
    573            destAddr.addrMode = Addr16Bit;
   \   000024   7402         MOV     A,#0x2
   \   000026   C0E0         PUSH    A
   \   000028   7409         MOV     A,#0x9
   \   00002A   12....       LCALL   ?XSTACK_DISP0_8
   \   00002D   D0E0         POP     A
   \   00002F   F0           MOVX    @DPTR,A
    574            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000030   8A82         MOV     DPL,R2
   \   000032   8B83         MOV     DPH,R3
   \   000034   E0           MOVX    A,@DPTR
   \   000035   FC           MOV     R4,A
   \   000036   A3           INC     DPTR
   \   000037   E0           MOVX    A,@DPTR
   \   000038   F9           MOV     R1,A
   \   000039   EC           MOV     A,R4
   \   00003A   F8           MOV     R0,A
   \   00003B   7401         MOV     A,#0x1
   \   00003D   12....       LCALL   ?XSTACK_DISP0_8
   \   000040   E8           MOV     A,R0
   \   000041   F0           MOVX    @DPTR,A
   \   000042   A3           INC     DPTR
   \   000043   E9           MOV     A,R1
   \   000044   F0           MOVX    @DPTR,A
    575            pBuf += 2;
   \   000045   EA           MOV     A,R2
   \   000046   2402         ADD     A,#0x2
   \   000048   0A           INC     R2
   \   000049   0A           INC     R2
   \   00004A   EB           MOV     A,R3
   \   00004B   3400         ADDC    A,#0x0
   \   00004D   FB           MOV     R3,A
    576          
    577            /* Network address of interest */
    578            shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   00004E   8A82         MOV     DPL,R2
   \   000050   8B83         MOV     DPH,R3
   \   000052   E0           MOVX    A,@DPTR
   \   000053   FC           MOV     R4,A
   \   000054   A3           INC     DPTR
   \   000055   E0           MOVX    A,@DPTR
   \   000056   FD           MOV     R5,A
    579            pBuf += 2;
   \   000057   EA           MOV     A,R2
   \   000058   2402         ADD     A,#0x2
   \   00005A   0A           INC     R2
   \   00005B   0A           INC     R2
   \   00005C   EB           MOV     A,R3
   \   00005D   3400         ADDC    A,#0x0
   \   00005F   FB           MOV     R3,A
    580          
    581            /* Profile ID */
    582            profileId = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000060   8A82         MOV     DPL,R2
   \   000062   8B83         MOV     DPH,R3
   \   000064   E0           MOVX    A,@DPTR
   \   000065   F5..         MOV     ?V0 + 0,A
   \   000067   A3           INC     DPTR
   \   000068   E0           MOVX    A,@DPTR
   \   000069   F8           MOV     R0,A
   \   00006A   E4           CLR     A
   \   00006B   C8           XCH     A,R0
   \   00006C   F5..         MOV     ?V0 + 1,A
    583            pBuf += 2;
   \   00006E   EA           MOV     A,R2
   \   00006F   2402         ADD     A,#0x2
   \   000071   0A           INC     R2
   \   000072   0A           INC     R2
   \   000073   EB           MOV     A,R3
   \   000074   3400         ADDC    A,#0x0
   \   000076   FB           MOV     R3,A
    584          
    585            /* NumInClusters */
    586            numInClusters = *pBuf++;
   \   000077   8A82         MOV     DPL,R2
   \   000079   8B83         MOV     DPH,R3
   \   00007B   E0           MOVX    A,@DPTR
   \   00007C   F9           MOV     R1,A
   \   00007D   A3           INC     DPTR
   \   00007E   AA82         MOV     R2,DPL
   \   000080   AB83         MOV     R3,DPH
    587            if ( numInClusters <= MTZDO_MAX_MATCH_CLUSTERS )
   \   000082   C3           CLR     C
   \   000083   9411         SUBB    A,#0x11
   \   000085   5043         JNC     ??MT_ZdoMatchDescRequest_0
    588            {
    589              /* IN clusters */
    590              for ( i = 0; i < numInClusters; i++ )
   \                     ??MT_ZdoMatchDescRequest_1:
   \   000087   E8           MOV     A,R0
   \   000088   C3           CLR     C
   \   000089   99           SUBB    A,R1
   \   00008A   5047         JNC     ??MT_ZdoMatchDescRequest_2
    591              {
    592                inClusters[i] = BUILD_UINT16( pBuf[0], pBuf[1]);
   \   00008C   8A82         MOV     DPL,R2
   \   00008E   8B83         MOV     DPH,R3
   \   000090   E0           MOVX    A,@DPTR
   \   000091   F5..         MOV     ?V0 + 4,A
   \   000093   A3           INC     DPTR
   \   000094   E0           MOVX    A,@DPTR
   \   000095   F5..         MOV     ?V0 + 3,A
   \   000097   E4           CLR     A
   \   000098   25..         ADD     A,?V0 + 4
   \   00009A   E5..         MOV     A,?V0 + 3
   \   00009C   F5..         MOV     ?V0 + 5,A
   \   00009E   E8           MOV     A,R0
   \   00009F   33           RLC     A
   \   0000A0   F5..         MOV     ?V0 + 2,A
   \   0000A2   E4           CLR     A
   \   0000A3   33           RLC     A
   \   0000A4   F5..         MOV     ?V0 + 3,A
   \   0000A6   742A         MOV     A,#0x2a
   \   0000A8   12....       LCALL   ?XSTACK_DISP0_8
   \   0000AB   E582         MOV     A,DPL
   \   0000AD   25..         ADD     A,?V0 + 2
   \   0000AF   F582         MOV     DPL,A
   \   0000B1   E583         MOV     A,DPH
   \   0000B3   35..         ADDC    A,?V0 + 3
   \   0000B5   F583         MOV     DPH,A
   \   0000B7   E5..         MOV     A,?V0 + 4
   \   0000B9   F0           MOVX    @DPTR,A
   \   0000BA   A3           INC     DPTR
   \   0000BB   E5..         MOV     A,?V0 + 5
   \   0000BD   F0           MOVX    @DPTR,A
    593                pBuf += 2;
   \   0000BE   EA           MOV     A,R2
   \   0000BF   2402         ADD     A,#0x2
   \   0000C1   0A           INC     R2
   \   0000C2   0A           INC     R2
   \   0000C3   EB           MOV     A,R3
   \   0000C4   3400         ADDC    A,#0x0
   \   0000C6   FB           MOV     R3,A
    594              }
   \   0000C7   08           INC     R0
   \   0000C8   80BD         SJMP    ??MT_ZdoMatchDescRequest_1
    595            }
    596            else
    597            {
    598              retValue = ZDP_INVALID_REQTYPE;
   \                     ??MT_ZdoMatchDescRequest_0:
   \   0000CA   7480         MOV     A,#-0x80
   \   0000CC   85..82       MOV     DPL,?XSP + 0
   \   0000CF   85..83       MOV     DPH,?XSP + 1
   \   0000D2   F0           MOVX    @DPTR,A
    599            }
    600          
    601            /* NumOutClusters */
    602            numOutClusters = *pBuf++;
   \                     ??MT_ZdoMatchDescRequest_2:
   \   0000D3   8A82         MOV     DPL,R2
   \   0000D5   8B83         MOV     DPH,R3
   \   0000D7   E0           MOVX    A,@DPTR
   \   0000D8   FF           MOV     R7,A
   \   0000D9   A3           INC     DPTR
   \   0000DA   AA82         MOV     R2,DPL
   \   0000DC   AB83         MOV     R3,DPH
    603            if ( numOutClusters <= MTZDO_MAX_MATCH_CLUSTERS )
   \   0000DE   C3           CLR     C
   \   0000DF   9411         SUBB    A,#0x11
   \   0000E1   5043         JNC     ??MT_ZdoMatchDescRequest_3
    604            {
    605              /* OUT Clusters */
    606              for ( i = 0; i < numOutClusters; i++ )
   \   0000E3   7800         MOV     R0,#0x0
   \                     ??MT_ZdoMatchDescRequest_4:
   \   0000E5   E8           MOV     A,R0
   \   0000E6   C3           CLR     C
   \   0000E7   9F           SUBB    A,R7
   \   0000E8   5045         JNC     ??MT_ZdoMatchDescRequest_5
    607              {
    608                outClusters[i] = BUILD_UINT16( pBuf[0], pBuf[1]);
   \   0000EA   8A82         MOV     DPL,R2
   \   0000EC   8B83         MOV     DPH,R3
   \   0000EE   E0           MOVX    A,@DPTR
   \   0000EF   F5..         MOV     ?V0 + 2,A
   \   0000F1   A3           INC     DPTR
   \   0000F2   E0           MOVX    A,@DPTR
   \   0000F3   F5..         MOV     ?V0 + 5,A
   \   0000F5   E4           CLR     A
   \   0000F6   25..         ADD     A,?V0 + 2
   \   0000F8   F5..         MOV     ?V0 + 4,A
   \   0000FA   E8           MOV     A,R0
   \   0000FB   33           RLC     A
   \   0000FC   F5..         MOV     ?V0 + 2,A
   \   0000FE   E4           CLR     A
   \   0000FF   33           RLC     A
   \   000100   F5..         MOV     ?V0 + 3,A
   \   000102   740A         MOV     A,#0xa
   \   000104   12....       LCALL   ?XSTACK_DISP0_8
   \   000107   E582         MOV     A,DPL
   \   000109   25..         ADD     A,?V0 + 2
   \   00010B   F582         MOV     DPL,A
   \   00010D   E583         MOV     A,DPH
   \   00010F   35..         ADDC    A,?V0 + 3
   \   000111   F583         MOV     DPH,A
   \   000113   E5..         MOV     A,?V0 + 4
   \   000115   F0           MOVX    @DPTR,A
   \   000116   A3           INC     DPTR
   \   000117   E5..         MOV     A,?V0 + 5
   \   000119   F0           MOVX    @DPTR,A
    609                pBuf += 2;
   \   00011A   EA           MOV     A,R2
   \   00011B   2402         ADD     A,#0x2
   \   00011D   0A           INC     R2
   \   00011E   0A           INC     R2
   \   00011F   EB           MOV     A,R3
   \   000120   3400         ADDC    A,#0x0
   \   000122   FB           MOV     R3,A
    610              }
   \   000123   08           INC     R0
   \   000124   80BF         SJMP    ??MT_ZdoMatchDescRequest_4
    611            }
    612            else
    613            {
    614              retValue = ZDP_INVALID_REQTYPE;
   \                     ??MT_ZdoMatchDescRequest_3:
   \   000126   7480         MOV     A,#-0x80
   \   000128   85..82       MOV     DPL,?XSP + 0
   \   00012B   85..83       MOV     DPH,?XSP + 1
   \   00012E   F0           MOVX    @DPTR,A
    615            }
    616          
    617            if ( retValue == 0 )
   \                     ??MT_ZdoMatchDescRequest_5:
   \   00012F   85..82       MOV     DPL,?XSP + 0
   \   000132   85..83       MOV     DPH,?XSP + 1
   \   000135   E0           MOVX    A,@DPTR
   \   000136   704E         JNZ     ??MT_ZdoMatchDescRequest_6
    618            {
    619              retValue = (uint8)ZDP_MatchDescReq( &destAddr, shortAddr, profileId, numInClusters,
    620                                                 inClusters, numOutClusters, outClusters, 0);
   \   000138                ; Setup parameters for call to function ZDP_MatchDescReq
   \   000138   75..00       MOV     ?V0 + 2,#0x0
   \   00013B   78..         MOV     R0,#?V0 + 2
   \   00013D   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000140   740B         MOV     A,#0xb
   \   000142   12....       LCALL   ?XSTACK_DISP0_8
   \   000145   8582..       MOV     ?V0 + 2,DPL
   \   000148   8583..       MOV     ?V0 + 3,DPH
   \   00014B   78..         MOV     R0,#?V0 + 2
   \   00014D   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000150   EF           MOV     A,R7
   \   000151   F5..         MOV     ?V0 + 2,A
   \   000153   78..         MOV     R0,#?V0 + 2
   \   000155   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000158   742E         MOV     A,#0x2e
   \   00015A   12....       LCALL   ?XSTACK_DISP0_8
   \   00015D   8582..       MOV     ?V0 + 2,DPL
   \   000160   8583..       MOV     ?V0 + 3,DPH
   \   000163   78..         MOV     R0,#?V0 + 2
   \   000165   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000168   78..         MOV     R0,#?V0 + 0
   \   00016A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00016D   7409         MOV     A,#0x9
   \   00016F   12....       LCALL   ?XSTACK_DISP0_8
   \   000172   AA82         MOV     R2,DPL
   \   000174   AB83         MOV     R3,DPH
   \   000176   12....       LCALL   ??ZDP_MatchDescReq?relay
   \   000179   7408         MOV     A,#0x8
   \   00017B   12....       LCALL   ?DEALLOC_XSTACK8
   \   00017E   E9           MOV     A,R1
   \   00017F   85..82       MOV     DPL,?XSP + 0
   \   000182   85..83       MOV     DPH,?XSP + 1
   \   000185   F0           MOVX    @DPTR,A
    621            }
    622          
    623            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \                     ??MT_ZdoMatchDescRequest_6:
   \   000186                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000186   AC82         MOV     R4,DPL
   \   000188   AD83         MOV     R5,DPH
   \   00018A   7B01         MOV     R3,#0x1
   \   00018C   EE           MOV     A,R6
   \   00018D   FA           MOV     R2,A
   \   00018E   7965         MOV     R1,#0x65
   \   000190   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    624          }
   \   000193   744A         MOV     A,#0x4a
   \   000195   12....       LCALL   ?DEALLOC_XSTACK8
   \   000198   7F06         MOV     R7,#0x6
   \   00019A   02....       LJMP    ?BANKED_LEAVE_XDATA
    625          
    626          /***************************************************************************************************
    627           * @fn      MT_ZdoComplexDescRequest
    628           *
    629           * @brief   Handle a Complex Descriptor request.
    630           *
    631           * @param   pBuf  - MT message data
    632           *
    633           * @return  void
    634           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    635          void MT_ZdoComplexDescRequest(uint8 *pBuf)
   \                     MT_ZdoComplexDescRequest:
    636          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 10
   \   000005   74F6         MOV     A,#-0xa
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    637            uint8 cmdId;
    638            uint8 retValue;
    639            zAddrType_t destAddr;
    640            uint16 shortAddr;
    641          
    642            /* parse header */
    643            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000A   8A82         MOV     DPL,R2
   \   00000C   8B83         MOV     DPH,R3
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   E0           MOVX    A,@DPTR
   \   000011   FE           MOV     R6,A
    644            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000012   EA           MOV     A,R2
   \   000013   2403         ADD     A,#0x3
   \   000015   0A           INC     R2
   \   000016   0A           INC     R2
   \   000017   0A           INC     R2
   \   000018   EB           MOV     A,R3
   \   000019   3400         ADDC    A,#0x0
   \   00001B   FB           MOV     R3,A
    645          
    646            /* Dev address */
    647            destAddr.addrMode = Addr16Bit;
   \   00001C   7402         MOV     A,#0x2
   \   00001E   C0E0         PUSH    A
   \   000020   7409         MOV     A,#0x9
   \   000022   12....       LCALL   ?XSTACK_DISP0_8
   \   000025   D0E0         POP     A
   \   000027   F0           MOVX    @DPTR,A
    648            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000028   8A82         MOV     DPL,R2
   \   00002A   8B83         MOV     DPH,R3
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   FC           MOV     R4,A
   \   00002E   A3           INC     DPTR
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   F9           MOV     R1,A
   \   000031   EC           MOV     A,R4
   \   000032   F8           MOV     R0,A
   \   000033   7401         MOV     A,#0x1
   \   000035   12....       LCALL   ?XSTACK_DISP0_8
   \   000038   E8           MOV     A,R0
   \   000039   F0           MOVX    @DPTR,A
   \   00003A   A3           INC     DPTR
   \   00003B   E9           MOV     A,R1
   \   00003C   F0           MOVX    @DPTR,A
    649            pBuf += 2;
   \   00003D   EA           MOV     A,R2
   \   00003E   2402         ADD     A,#0x2
   \   000040   0A           INC     R2
   \   000041   0A           INC     R2
   \   000042   EB           MOV     A,R3
   \   000043   3400         ADDC    A,#0x0
   \   000045   FB           MOV     R3,A
    650          
    651            /* Network address of interest */
    652            shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
    653            pBuf += 2;
    654          
    655            retValue = (uint8)ZDP_ComplexDescReq( &destAddr, shortAddr, 0);
   \   000046                ; Setup parameters for call to function ZDP_NWKAddrOfInterestReq
   \   000046   75..00       MOV     ?V0 + 0,#0x0
   \   000049   78..         MOV     R0,#?V0 + 0
   \   00004B   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00004E   7910         MOV     R1,#0x10
   \   000050   8A82         MOV     DPL,R2
   \   000052   8B83         MOV     DPH,R3
   \   000054   E0           MOVX    A,@DPTR
   \   000055   FC           MOV     R4,A
   \   000056   A3           INC     DPTR
   \   000057   E0           MOVX    A,@DPTR
   \   000058   FD           MOV     R5,A
   \   000059   7402         MOV     A,#0x2
   \   00005B   12....       LCALL   ?XSTACK_DISP0_8
   \   00005E   AA82         MOV     R2,DPL
   \   000060   AB83         MOV     R3,DPH
   \   000062   12....       LCALL   ??ZDP_NWKAddrOfInterestReq?relay
   \   000065   7401         MOV     A,#0x1
   \   000067   12....       LCALL   ?DEALLOC_XSTACK8
   \   00006A   E9           MOV     A,R1
   \   00006B   85..82       MOV     DPL,?XSP + 0
   \   00006E   85..83       MOV     DPH,?XSP + 1
   \   000071   F0           MOVX    @DPTR,A
    656          
    657            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   000072                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000072   AC82         MOV     R4,DPL
   \   000074   AD83         MOV     R5,DPH
   \   000076   7B01         MOV     R3,#0x1
   \   000078   EE           MOV     A,R6
   \   000079   FA           MOV     R2,A
   \   00007A   7965         MOV     R1,#0x65
   \   00007C   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    658          }
   \   00007F   740A         MOV     A,#0xa
   \   000081   12....       LCALL   ?DEALLOC_XSTACK8
   \   000084   7F01         MOV     R7,#0x1
   \   000086   02....       LJMP    ?BANKED_LEAVE_XDATA
    659          
    660          /***************************************************************************************************
    661           * @fn      MT_ZdoUserDescRequest
    662           *
    663           * @brief   Handle a User Descriptor request.
    664           *
    665           * @param   pBuf  - MT message data
    666           *
    667           * @return  void
    668           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    669          void MT_ZdoUserDescRequest(uint8 *pBuf)
   \                     MT_ZdoUserDescRequest:
    670          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 10
   \   000005   74F6         MOV     A,#-0xa
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    671            uint8 cmdId;
    672            uint8 retValue;
    673            zAddrType_t destAddr;
    674            uint16 shortAddr;
    675          
    676            /* parse header */
    677            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000A   8A82         MOV     DPL,R2
   \   00000C   8B83         MOV     DPH,R3
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   E0           MOVX    A,@DPTR
   \   000011   FE           MOV     R6,A
    678            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000012   EA           MOV     A,R2
   \   000013   2403         ADD     A,#0x3
   \   000015   0A           INC     R2
   \   000016   0A           INC     R2
   \   000017   0A           INC     R2
   \   000018   EB           MOV     A,R3
   \   000019   3400         ADDC    A,#0x0
   \   00001B   FB           MOV     R3,A
    679          
    680            /* Dev address */
    681            destAddr.addrMode = Addr16Bit;
   \   00001C   7402         MOV     A,#0x2
   \   00001E   C0E0         PUSH    A
   \   000020   7409         MOV     A,#0x9
   \   000022   12....       LCALL   ?XSTACK_DISP0_8
   \   000025   D0E0         POP     A
   \   000027   F0           MOVX    @DPTR,A
    682            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1]);
   \   000028   8A82         MOV     DPL,R2
   \   00002A   8B83         MOV     DPH,R3
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   FC           MOV     R4,A
   \   00002E   A3           INC     DPTR
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   F9           MOV     R1,A
   \   000031   EC           MOV     A,R4
   \   000032   F8           MOV     R0,A
   \   000033   7401         MOV     A,#0x1
   \   000035   12....       LCALL   ?XSTACK_DISP0_8
   \   000038   E8           MOV     A,R0
   \   000039   F0           MOVX    @DPTR,A
   \   00003A   A3           INC     DPTR
   \   00003B   E9           MOV     A,R1
   \   00003C   F0           MOVX    @DPTR,A
    683            pBuf += 2;
   \   00003D   EA           MOV     A,R2
   \   00003E   2402         ADD     A,#0x2
   \   000040   0A           INC     R2
   \   000041   0A           INC     R2
   \   000042   EB           MOV     A,R3
   \   000043   3400         ADDC    A,#0x0
   \   000045   FB           MOV     R3,A
    684          
    685            /* Network address of interest */
    686            shortAddr = BUILD_UINT16( pBuf[0], pBuf[1]);
    687            pBuf += 2;
    688          
    689            retValue = (uint8)ZDP_UserDescReq( &destAddr, shortAddr, 0);
   \   000046                ; Setup parameters for call to function ZDP_NWKAddrOfInterestReq
   \   000046   75..00       MOV     ?V0 + 0,#0x0
   \   000049   78..         MOV     R0,#?V0 + 0
   \   00004B   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00004E   7911         MOV     R1,#0x11
   \   000050   8A82         MOV     DPL,R2
   \   000052   8B83         MOV     DPH,R3
   \   000054   E0           MOVX    A,@DPTR
   \   000055   FC           MOV     R4,A
   \   000056   A3           INC     DPTR
   \   000057   E0           MOVX    A,@DPTR
   \   000058   FD           MOV     R5,A
   \   000059   7402         MOV     A,#0x2
   \   00005B   12....       LCALL   ?XSTACK_DISP0_8
   \   00005E   AA82         MOV     R2,DPL
   \   000060   AB83         MOV     R3,DPH
   \   000062   12....       LCALL   ??ZDP_NWKAddrOfInterestReq?relay
   \   000065   7401         MOV     A,#0x1
   \   000067   12....       LCALL   ?DEALLOC_XSTACK8
   \   00006A   E9           MOV     A,R1
   \   00006B   85..82       MOV     DPL,?XSP + 0
   \   00006E   85..83       MOV     DPH,?XSP + 1
   \   000071   F0           MOVX    @DPTR,A
    690          
    691            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   000072                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000072   AC82         MOV     R4,DPL
   \   000074   AD83         MOV     R5,DPH
   \   000076   7B01         MOV     R3,#0x1
   \   000078   EE           MOV     A,R6
   \   000079   FA           MOV     R2,A
   \   00007A   7965         MOV     R1,#0x65
   \   00007C   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    692          }
   \   00007F   740A         MOV     A,#0xa
   \   000081   12....       LCALL   ?DEALLOC_XSTACK8
   \   000084   7F01         MOV     R7,#0x1
   \   000086   02....       LJMP    ?BANKED_LEAVE_XDATA
    693          
    694          /***************************************************************************************************
    695           * @fn      MT_ZdoEndDevAnnce
    696           *
    697           * @brief   Handle a End Device Announce Descriptor request.
    698           *
    699           * @param   pBuf  - MT message data
    700           *
    701           * @return  void
    702           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    703          void MT_ZdoEndDevAnnce(uint8 *pBuf)
   \                     MT_ZdoEndDevAnnce:
    704          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FC           MOV     R4,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FD           MOV     R5,A
    705            uint8 cmdId;
    706            uint8 retValue;
    707            uint16 shortAddr;
    708            uint8 *pIEEEAddr;
    709          
    710            /* parse header */
    711            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000E   8C82         MOV     DPL,R4
   \   000010   8D83         MOV     DPH,R5
   \   000012   A3           INC     DPTR
   \   000013   A3           INC     DPTR
   \   000014   E0           MOVX    A,@DPTR
   \   000015   FE           MOV     R6,A
    712            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000016   EC           MOV     A,R4
   \   000017   2403         ADD     A,#0x3
   \   000019   0C           INC     R4
   \   00001A   0C           INC     R4
   \   00001B   0C           INC     R4
   \   00001C   ED           MOV     A,R5
   \   00001D   3400         ADDC    A,#0x0
   \   00001F   FD           MOV     R5,A
    713          
    714            /* network address */
    715            shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000020   8C82         MOV     DPL,R4
   \   000022   8D83         MOV     DPH,R5
   \   000024   E0           MOVX    A,@DPTR
   \   000025   FA           MOV     R2,A
   \   000026   A3           INC     DPTR
   \   000027   E0           MOVX    A,@DPTR
   \   000028   F8           MOV     R0,A
   \   000029   E4           CLR     A
   \   00002A   C8           XCH     A,R0
   \   00002B   FB           MOV     R3,A
    716            pBuf += 2;
   \   00002C   EC           MOV     A,R4
   \   00002D   2402         ADD     A,#0x2
   \   00002F   0C           INC     R4
   \   000030   0C           INC     R4
   \   000031   ED           MOV     A,R5
   \   000032   3400         ADDC    A,#0x0
   \   000034   FD           MOV     R5,A
    717          
    718            /* extended address */
    719            pIEEEAddr = pBuf;
    720            pBuf += Z_EXTADDR_LEN;
    721          
    722            retValue = (uint8)ZDP_DeviceAnnce( shortAddr, pIEEEAddr, *pBuf, 0);
   \   000035                ; Setup parameters for call to function ZDP_DeviceAnnce
   \   000035   88..         MOV     ?V0 + 0,R0
   \   000037   78..         MOV     R0,#?V0 + 0
   \   000039   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00003C   8C82         MOV     DPL,R4
   \   00003E   8D83         MOV     DPH,R5
   \   000040   A3           INC     DPTR
   \   000041   A3           INC     DPTR
   \   000042   A3           INC     DPTR
   \   000043   A3           INC     DPTR
   \   000044   A3           INC     DPTR
   \   000045   A3           INC     DPTR
   \   000046   A3           INC     DPTR
   \   000047   A3           INC     DPTR
   \   000048   E0           MOVX    A,@DPTR
   \   000049   F9           MOV     R1,A
   \   00004A   12....       LCALL   ??ZDP_DeviceAnnce?relay
   \   00004D   7401         MOV     A,#0x1
   \   00004F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000052   E9           MOV     A,R1
   \   000053   85..82       MOV     DPL,?XSP + 0
   \   000056   85..83       MOV     DPH,?XSP + 1
   \   000059   F0           MOVX    @DPTR,A
    723          
    724            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   00005A                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   00005A   AC82         MOV     R4,DPL
   \   00005C   AD83         MOV     R5,DPH
   \   00005E   7B01         MOV     R3,#0x1
   \   000060   EE           MOV     A,R6
   \   000061   FA           MOV     R2,A
   \   000062   7965         MOV     R1,#0x65
   \   000064   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    725          }
   \   000067   7401         MOV     A,#0x1
   \   000069   12....       LCALL   ?DEALLOC_XSTACK8
   \   00006C   7F01         MOV     R7,#0x1
   \   00006E   02....       LJMP    ?BANKED_LEAVE_XDATA
    726          
    727          /***************************************************************************************************
    728           * @fn      MT_ZdoUserDescSet
    729           *
    730           * @brief   Handle a User Descriptor Set.
    731           *
    732           * @param   pBuf  - MT message data
    733           *
    734           * @return  void
    735           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    736          void MT_ZdoUserDescSet(uint8 *pBuf)
   \                     MT_ZdoUserDescSet:
    737          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 27
   \   000005   74E5         MOV     A,#-0x1b
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    738            uint8 cmdId;
    739            uint8 retValue;
    740            zAddrType_t destAddr;
    741            uint16 shortAddr;
    742            UserDescriptorFormat_t userDesc;
    743          
    744            /* parse header */
    745            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000A   8A82         MOV     DPL,R2
   \   00000C   8B83         MOV     DPH,R3
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   E0           MOVX    A,@DPTR
   \   000011   F5..         MOV     ?V0 + 3,A
    746            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000013   EA           MOV     A,R2
   \   000014   2403         ADD     A,#0x3
   \   000016   0A           INC     R2
   \   000017   0A           INC     R2
   \   000018   0A           INC     R2
   \   000019   EB           MOV     A,R3
   \   00001A   3400         ADDC    A,#0x0
   \   00001C   FB           MOV     R3,A
    747          
    748            /* Dev address */
    749            destAddr.addrMode = Addr16Bit;
   \   00001D   7402         MOV     A,#0x2
   \   00001F   C0E0         PUSH    A
   \   000021   7409         MOV     A,#0x9
   \   000023   12....       LCALL   ?XSTACK_DISP0_8
   \   000026   D0E0         POP     A
   \   000028   F0           MOVX    @DPTR,A
    750            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000029   8A82         MOV     DPL,R2
   \   00002B   8B83         MOV     DPH,R3
   \   00002D   E0           MOVX    A,@DPTR
   \   00002E   FC           MOV     R4,A
   \   00002F   A3           INC     DPTR
   \   000030   E0           MOVX    A,@DPTR
   \   000031   F9           MOV     R1,A
   \   000032   EC           MOV     A,R4
   \   000033   F8           MOV     R0,A
   \   000034   7401         MOV     A,#0x1
   \   000036   12....       LCALL   ?XSTACK_DISP0_8
   \   000039   E8           MOV     A,R0
   \   00003A   F0           MOVX    @DPTR,A
   \   00003B   A3           INC     DPTR
   \   00003C   E9           MOV     A,R1
   \   00003D   F0           MOVX    @DPTR,A
    751            pBuf += 2;
   \   00003E   EA           MOV     A,R2
   \   00003F   2402         ADD     A,#0x2
   \   000041   0A           INC     R2
   \   000042   0A           INC     R2
   \   000043   EB           MOV     A,R3
   \   000044   3400         ADDC    A,#0x0
   \   000046   FB           MOV     R3,A
    752          
    753            /* Network address of interest */
    754            shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000047   8A82         MOV     DPL,R2
   \   000049   8B83         MOV     DPH,R3
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   FC           MOV     R4,A
   \   00004D   A3           INC     DPTR
   \   00004E   E0           MOVX    A,@DPTR
   \   00004F   F8           MOV     R0,A
   \   000050   E4           CLR     A
   \   000051   C8           XCH     A,R0
   \   000052   F9           MOV     R1,A
   \   000053   EC           MOV     A,R4
   \   000054   FE           MOV     R6,A
   \   000055   E9           MOV     A,R1
   \   000056   FF           MOV     R7,A
    755            pBuf += 2;
   \   000057   EA           MOV     A,R2
   \   000058   2402         ADD     A,#0x2
   \   00005A   0A           INC     R2
   \   00005B   0A           INC     R2
   \   00005C   EB           MOV     A,R3
   \   00005D   3400         ADDC    A,#0x0
   \   00005F   FB           MOV     R3,A
    756          
    757            /* User descriptor */
    758            userDesc.len = *pBuf++;
   \   000060   8A82         MOV     DPL,R2
   \   000062   8B83         MOV     DPH,R3
   \   000064   E0           MOVX    A,@DPTR
   \   000065   C0E0         PUSH    A
   \   000067   740A         MOV     A,#0xa
   \   000069   12....       LCALL   ?XSTACK_DISP0_8
   \   00006C   D0E0         POP     A
   \   00006E   F0           MOVX    @DPTR,A
   \   00006F   8A82         MOV     DPL,R2
   \   000071   8B83         MOV     DPH,R3
   \   000073   A3           INC     DPTR
   \   000074   AA82         MOV     R2,DPL
   \   000076   AB83         MOV     R3,DPH
    759            osal_memcpy( userDesc.desc, pBuf, userDesc.len );
   \   000078                ; Setup parameters for call to function osal_memcpy
   \   000078   8A..         MOV     ?V0 + 0,R2
   \   00007A   8B..         MOV     ?V0 + 1,R3
   \   00007C   88..         MOV     ?V0 + 2,R0
   \   00007E   78..         MOV     R0,#?V0 + 0
   \   000080   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000083   740D         MOV     A,#0xd
   \   000085   12....       LCALL   ?XSTACK_DISP0_8
   \   000088   E0           MOVX    A,@DPTR
   \   000089   FC           MOV     R4,A
   \   00008A   7D00         MOV     R5,#0x0
   \   00008C   740E         MOV     A,#0xe
   \   00008E   12....       LCALL   ?XSTACK_DISP0_8
   \   000091   AA82         MOV     R2,DPL
   \   000093   AB83         MOV     R3,DPH
   \   000095   12....       LCALL   ??osal_memcpy?relay
   \   000098   7403         MOV     A,#0x3
   \   00009A   12....       LCALL   ?DEALLOC_XSTACK8
    760            pBuf += 16;
    761          
    762            retValue = (uint8)ZDP_UserDescSet( &destAddr, shortAddr, &userDesc, 0);
   \   00009D                ; Setup parameters for call to function ZDP_UserDescSet
   \   00009D   740A         MOV     A,#0xa
   \   00009F   12....       LCALL   ?XSTACK_DISP0_8
   \   0000A2   8582..       MOV     ?V0 + 0,DPL
   \   0000A5   8583..       MOV     ?V0 + 1,DPH
   \   0000A8   78..         MOV     R0,#?V0 + 0
   \   0000AA   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000AD   7900         MOV     R1,#0x0
   \   0000AF   EE           MOV     A,R6
   \   0000B0   FC           MOV     R4,A
   \   0000B1   EF           MOV     A,R7
   \   0000B2   FD           MOV     R5,A
   \   0000B3   7403         MOV     A,#0x3
   \   0000B5   12....       LCALL   ?XSTACK_DISP0_8
   \   0000B8   AA82         MOV     R2,DPL
   \   0000BA   AB83         MOV     R3,DPH
   \   0000BC   12....       LCALL   ??ZDP_UserDescSet?relay
   \   0000BF   7402         MOV     A,#0x2
   \   0000C1   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000C4   E9           MOV     A,R1
   \   0000C5   85..82       MOV     DPL,?XSP + 0
   \   0000C8   85..83       MOV     DPH,?XSP + 1
   \   0000CB   F0           MOVX    @DPTR,A
    763          
    764            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   0000CC                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   0000CC   AC82         MOV     R4,DPL
   \   0000CE   AD83         MOV     R5,DPH
   \   0000D0   7B01         MOV     R3,#0x1
   \   0000D2   AA..         MOV     R2,?V0 + 3
   \   0000D4   7965         MOV     R1,#0x65
   \   0000D6   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    765          }
   \   0000D9   741B         MOV     A,#0x1b
   \   0000DB   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000DE   7F04         MOV     R7,#0x4
   \   0000E0   02....       LJMP    ?BANKED_LEAVE_XDATA
    766          
    767          /***************************************************************************************************
    768           * @fn      MT_ZdoServiceDiscRequest
    769           *
    770           * @brief   Handle a Server Discovery request.
    771           *
    772           * @param   pBuf  - MT message data
    773           *
    774           * @return  void
    775           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    776          void MT_ZdoServiceDiscRequest(uint8 *pBuf)
   \                     MT_ZdoServiceDiscRequest:
    777          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    778            uint8 cmdId;
    779            uint8 retValue;
    780            uint16 serviceMask;
    781          
    782            /* parse header */
    783            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000A   8A82         MOV     DPL,R2
   \   00000C   8B83         MOV     DPH,R3
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   E0           MOVX    A,@DPTR
   \   000011   FE           MOV     R6,A
    784            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000012   EA           MOV     A,R2
   \   000013   2403         ADD     A,#0x3
   \   000015   0A           INC     R2
   \   000016   0A           INC     R2
   \   000017   0A           INC     R2
   \   000018   EB           MOV     A,R3
   \   000019   3400         ADDC    A,#0x0
   \   00001B   FB           MOV     R3,A
    785          
    786            /* Service Mask */
    787            serviceMask = BUILD_UINT16( pBuf[0], pBuf[1]);
    788            pBuf += 2;
    789          
    790            retValue = (uint8)ZDP_ServerDiscReq( serviceMask, 0);
   \   00001C                ; Setup parameters for call to function ZDP_ServerDiscReq
   \   00001C   7900         MOV     R1,#0x0
   \   00001E   8A82         MOV     DPL,R2
   \   000020   8B83         MOV     DPH,R3
   \   000022   E0           MOVX    A,@DPTR
   \   000023   FC           MOV     R4,A
   \   000024   A3           INC     DPTR
   \   000025   E0           MOVX    A,@DPTR
   \   000026   FB           MOV     R3,A
   \   000027   EC           MOV     A,R4
   \   000028   FA           MOV     R2,A
   \   000029   12....       LCALL   ??ZDP_ServerDiscReq?relay
   \   00002C   E9           MOV     A,R1
   \   00002D   85..82       MOV     DPL,?XSP + 0
   \   000030   85..83       MOV     DPH,?XSP + 1
   \   000033   F0           MOVX    @DPTR,A
    791          
    792            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   000034                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000034   AC82         MOV     R4,DPL
   \   000036   AD83         MOV     R5,DPH
   \   000038   7B01         MOV     R3,#0x1
   \   00003A   EE           MOV     A,R6
   \   00003B   FA           MOV     R2,A
   \   00003C   7965         MOV     R1,#0x65
   \   00003E   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    793          }
   \   000041   7401         MOV     A,#0x1
   \   000043   12....       LCALL   ?DEALLOC_XSTACK8
   \   000046   7F01         MOV     R7,#0x1
   \   000048   02....       LJMP    ?BANKED_LEAVE_XDATA
    794          
    795          /***************************************************************************************************
    796           * @fn      MT_ZdoEndDevBindRequest
    797           *
    798           * @brief   Handle a End Device Bind request.
    799           *
    800           * @param   pBuf  - MT message data
    801           *
    802           * @return  void
    803           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    804          void MT_ZdoEndDevBindRequest(uint8 *pBuf)
   \                     MT_ZdoEndDevBindRequest:
    805          {
   \   000000   74F1         MOV     A,#-0xf
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 15
   \   000005                ; Auto size: 70
   \   000005   74BA         MOV     A,#-0x46
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    806            uint8 cmdId;
    807            uint8 retValue = 0;
   \   00000A   E4           CLR     A
   \   00000B   85..82       MOV     DPL,?XSP + 0
   \   00000E   85..83       MOV     DPH,?XSP + 1
   \   000011   F0           MOVX    @DPTR,A
    808            uint8 i, epInt, numInClusters, numOutClusters;
    809            zAddrType_t destAddr;
    810            uint16 shortAddr;
    811            uint16 profileID, inClusters[MTZDO_MAX_ED_BIND_CLUSTERS], outClusters[MTZDO_MAX_ED_BIND_CLUSTERS];
    812          
    813            /* parse header */
    814            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   000012   8A82         MOV     DPL,R2
   \   000014   8B83         MOV     DPH,R3
   \   000016   A3           INC     DPTR
   \   000017   A3           INC     DPTR
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F5..         MOV     ?V0 + 6,A
    815            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   00001B   EA           MOV     A,R2
   \   00001C   2403         ADD     A,#0x3
   \   00001E   0A           INC     R2
   \   00001F   0A           INC     R2
   \   000020   0A           INC     R2
   \   000021   EB           MOV     A,R3
   \   000022   3400         ADDC    A,#0x0
   \   000024   FB           MOV     R3,A
    816          
    817            /* Dev address */
    818            destAddr.addrMode = Addr16Bit;
   \   000025   7402         MOV     A,#0x2
   \   000027   C0E0         PUSH    A
   \   000029   7409         MOV     A,#0x9
   \   00002B   12....       LCALL   ?XSTACK_DISP0_8
   \   00002E   D0E0         POP     A
   \   000030   F0           MOVX    @DPTR,A
    819            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000031   8A82         MOV     DPL,R2
   \   000033   8B83         MOV     DPH,R3
   \   000035   E0           MOVX    A,@DPTR
   \   000036   FC           MOV     R4,A
   \   000037   A3           INC     DPTR
   \   000038   E0           MOVX    A,@DPTR
   \   000039   F9           MOV     R1,A
   \   00003A   EC           MOV     A,R4
   \   00003B   F8           MOV     R0,A
   \   00003C   7401         MOV     A,#0x1
   \   00003E   12....       LCALL   ?XSTACK_DISP0_8
   \   000041   E8           MOV     A,R0
   \   000042   F0           MOVX    @DPTR,A
   \   000043   A3           INC     DPTR
   \   000044   E9           MOV     A,R1
   \   000045   F0           MOVX    @DPTR,A
    820            pBuf += 2;
   \   000046   EA           MOV     A,R2
   \   000047   2402         ADD     A,#0x2
   \   000049   0A           INC     R2
   \   00004A   0A           INC     R2
   \   00004B   EB           MOV     A,R3
   \   00004C   3400         ADDC    A,#0x0
   \   00004E   FB           MOV     R3,A
    821          
    822            /* Local coordinator of the binding */
    823            shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   00004F   8A82         MOV     DPL,R2
   \   000051   8B83         MOV     DPH,R3
   \   000053   E0           MOVX    A,@DPTR
   \   000054   FC           MOV     R4,A
   \   000055   A3           INC     DPTR
   \   000056   E0           MOVX    A,@DPTR
   \   000057   F9           MOV     R1,A
   \   000058   EC           MOV     A,R4
   \   000059   FE           MOV     R6,A
   \   00005A   E9           MOV     A,R1
   \   00005B   FF           MOV     R7,A
    824            pBuf += 2;
    825            
    826            /* For now, skip past the extended address */
    827            pBuf += Z_EXTADDR_LEN;
   \   00005C   EA           MOV     A,R2
   \   00005D   240A         ADD     A,#0xa
   \   00005F   FA           MOV     R2,A
   \   000060   EB           MOV     A,R3
   \   000061   3400         ADDC    A,#0x0
   \   000063   FB           MOV     R3,A
    828          
    829            /* Endpoint */
    830            epInt = *pBuf++;
   \   000064   8A82         MOV     DPL,R2
   \   000066   8B83         MOV     DPH,R3
   \   000068   E0           MOVX    A,@DPTR
   \   000069   F5..         MOV     ?V0 + 0,A
   \   00006B   A3           INC     DPTR
   \   00006C   AA82         MOV     R2,DPL
   \   00006E   AB83         MOV     R3,DPH
    831          
    832            /* Profile ID */
    833            profileID = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000070   E0           MOVX    A,@DPTR
   \   000071   FC           MOV     R4,A
   \   000072   A3           INC     DPTR
   \   000073   E0           MOVX    A,@DPTR
   \   000074   F8           MOV     R0,A
   \   000075   E4           CLR     A
   \   000076   C8           XCH     A,R0
   \   000077   FD           MOV     R5,A
    834            pBuf += 2;
   \   000078   EA           MOV     A,R2
   \   000079   2402         ADD     A,#0x2
   \   00007B   0A           INC     R2
   \   00007C   0A           INC     R2
   \   00007D   EB           MOV     A,R3
   \   00007E   3400         ADDC    A,#0x0
   \   000080   FB           MOV     R3,A
    835          
    836            /* NumInClusters */
    837            numInClusters = *pBuf++;
   \   000081   8A82         MOV     DPL,R2
   \   000083   8B83         MOV     DPH,R3
   \   000085   E0           MOVX    A,@DPTR
   \   000086   F5..         MOV     ?V0 + 1,A
   \   000088   A3           INC     DPTR
   \   000089   0A           INC     R2
   \   00008A   AB83         MOV     R3,DPH
    838            if ( numInClusters <= MTZDO_MAX_ED_BIND_CLUSTERS )
   \   00008C   C3           CLR     C
   \   00008D   9410         SUBB    A,#0x10
   \   00008F   5041         JNC     ??MT_ZdoEndDevBindRequest_0
    839            {
    840              for ( i = 0; i < numInClusters; i++ )
   \   000091   88..         MOV     ?V0 + 5,R0
   \                     ??MT_ZdoEndDevBindRequest_1:
   \   000093   E5..         MOV     A,?V0 + 5
   \   000095   C3           CLR     C
   \   000096   95..         SUBB    A,?V0 + 1
   \   000098   5041         JNC     ??MT_ZdoEndDevBindRequest_2
    841              {
    842                inClusters[i] = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   00009A   8A82         MOV     DPL,R2
   \   00009C   8B83         MOV     DPH,R3
   \   00009E   E0           MOVX    A,@DPTR
   \   00009F   F8           MOV     R0,A
   \   0000A0   A3           INC     DPTR
   \   0000A1   E0           MOVX    A,@DPTR
   \   0000A2   F5..         MOV     ?V0 + 3,A
   \   0000A4   E4           CLR     A
   \   0000A5   28           ADD     A,R0
   \   0000A6   F5..         MOV     ?V0 + 2,A
   \   0000A8   E5..         MOV     A,?V0 + 5
   \   0000AA   33           RLC     A
   \   0000AB   F8           MOV     R0,A
   \   0000AC   E4           CLR     A
   \   0000AD   33           RLC     A
   \   0000AE   F9           MOV     R1,A
   \   0000AF   7428         MOV     A,#0x28
   \   0000B1   12....       LCALL   ?XSTACK_DISP0_8
   \   0000B4   E582         MOV     A,DPL
   \   0000B6   28           ADD     A,R0
   \   0000B7   F582         MOV     DPL,A
   \   0000B9   E583         MOV     A,DPH
   \   0000BB   39           ADDC    A,R1
   \   0000BC   F583         MOV     DPH,A
   \   0000BE   E5..         MOV     A,?V0 + 2
   \   0000C0   F0           MOVX    @DPTR,A
   \   0000C1   A3           INC     DPTR
   \   0000C2   E5..         MOV     A,?V0 + 3
   \   0000C4   F0           MOVX    @DPTR,A
    843                pBuf += 2;
   \   0000C5   EA           MOV     A,R2
   \   0000C6   2402         ADD     A,#0x2
   \   0000C8   0A           INC     R2
   \   0000C9   0A           INC     R2
   \   0000CA   EB           MOV     A,R3
   \   0000CB   3400         ADDC    A,#0x0
   \   0000CD   FB           MOV     R3,A
    844              }
   \   0000CE   05..         INC     ?V0 + 5
   \   0000D0   80C1         SJMP    ??MT_ZdoEndDevBindRequest_1
    845            }
    846            else
    847              retValue = ZDP_INVALID_REQTYPE;
   \                     ??MT_ZdoEndDevBindRequest_0:
   \   0000D2   7480         MOV     A,#-0x80
   \   0000D4   85..82       MOV     DPL,?XSP + 0
   \   0000D7   85..83       MOV     DPH,?XSP + 1
   \   0000DA   F0           MOVX    @DPTR,A
    848          
    849            /* NumOutClusters */
    850            numOutClusters = *pBuf++;
   \                     ??MT_ZdoEndDevBindRequest_2:
   \   0000DB   8A82         MOV     DPL,R2
   \   0000DD   8B83         MOV     DPH,R3
   \   0000DF   E0           MOVX    A,@DPTR
   \   0000E0   F5..         MOV     ?V0 + 4,A
   \   0000E2   A3           INC     DPTR
   \   0000E3   AA82         MOV     R2,DPL
   \   0000E5   AB83         MOV     R3,DPH
    851            if ( numOutClusters <= MTZDO_MAX_ED_BIND_CLUSTERS )
   \   0000E7   C3           CLR     C
   \   0000E8   9410         SUBB    A,#0x10
   \   0000EA   5042         JNC     ??MT_ZdoEndDevBindRequest_3
    852            {
    853              for ( i = 0; i < numOutClusters; i++ )
   \   0000EC   75..00       MOV     ?V0 + 5,#0x0
   \                     ??MT_ZdoEndDevBindRequest_4:
   \   0000EF   E5..         MOV     A,?V0 + 5
   \   0000F1   C3           CLR     C
   \   0000F2   95..         SUBB    A,?V0 + 4
   \   0000F4   5041         JNC     ??MT_ZdoEndDevBindRequest_5
    854              {
    855                outClusters[i] = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   0000F6   8A82         MOV     DPL,R2
   \   0000F8   8B83         MOV     DPH,R3
   \   0000FA   E0           MOVX    A,@DPTR
   \   0000FB   F8           MOV     R0,A
   \   0000FC   A3           INC     DPTR
   \   0000FD   E0           MOVX    A,@DPTR
   \   0000FE   F5..         MOV     ?V0 + 3,A
   \   000100   E4           CLR     A
   \   000101   28           ADD     A,R0
   \   000102   F5..         MOV     ?V0 + 2,A
   \   000104   E5..         MOV     A,?V0 + 5
   \   000106   33           RLC     A
   \   000107   F8           MOV     R0,A
   \   000108   E4           CLR     A
   \   000109   33           RLC     A
   \   00010A   F9           MOV     R1,A
   \   00010B   740A         MOV     A,#0xa
   \   00010D   12....       LCALL   ?XSTACK_DISP0_8
   \   000110   E582         MOV     A,DPL
   \   000112   28           ADD     A,R0
   \   000113   F582         MOV     DPL,A
   \   000115   E583         MOV     A,DPH
   \   000117   39           ADDC    A,R1
   \   000118   F583         MOV     DPH,A
   \   00011A   E5..         MOV     A,?V0 + 2
   \   00011C   F0           MOVX    @DPTR,A
   \   00011D   A3           INC     DPTR
   \   00011E   E5..         MOV     A,?V0 + 3
   \   000120   F0           MOVX    @DPTR,A
    856                pBuf += 2;
   \   000121   EA           MOV     A,R2
   \   000122   2402         ADD     A,#0x2
   \   000124   0A           INC     R2
   \   000125   0A           INC     R2
   \   000126   EB           MOV     A,R3
   \   000127   3400         ADDC    A,#0x0
   \   000129   FB           MOV     R3,A
    857              }
   \   00012A   05..         INC     ?V0 + 5
   \   00012C   80C1         SJMP    ??MT_ZdoEndDevBindRequest_4
    858            }
    859            else
    860              retValue = ZDP_INVALID_REQTYPE;
   \                     ??MT_ZdoEndDevBindRequest_3:
   \   00012E   7480         MOV     A,#-0x80
   \   000130   85..82       MOV     DPL,?XSP + 0
   \   000133   85..83       MOV     DPH,?XSP + 1
   \   000136   F0           MOVX    @DPTR,A
    861            
    862            if ( retValue == 0 )
   \                     ??MT_ZdoEndDevBindRequest_5:
   \   000137   85..82       MOV     DPL,?XSP + 0
   \   00013A   85..83       MOV     DPH,?XSP + 1
   \   00013D   E0           MOVX    A,@DPTR
   \   00013E   705E         JNZ     ??MT_ZdoEndDevBindRequest_6
    863            {
    864              retValue = (uint8)ZDP_EndDeviceBindReq( &destAddr, shortAddr, epInt, profileID,
    865                                                    numInClusters, inClusters, numOutClusters, outClusters, 0);
   \   000140                ; Setup parameters for call to function ZDP_EndDeviceBindReq
   \   000140   75..00       MOV     ?V0 + 2,#0x0
   \   000143   78..         MOV     R0,#?V0 + 2
   \   000145   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000148   740B         MOV     A,#0xb
   \   00014A   12....       LCALL   ?XSTACK_DISP0_8
   \   00014D   8582..       MOV     ?V0 + 2,DPL
   \   000150   8583..       MOV     ?V0 + 3,DPH
   \   000153   78..         MOV     R0,#?V0 + 2
   \   000155   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000158   E5..         MOV     A,?V0 + 4
   \   00015A   F5..         MOV     ?V0 + 2,A
   \   00015C   78..         MOV     R0,#?V0 + 2
   \   00015E   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000161   742C         MOV     A,#0x2c
   \   000163   12....       LCALL   ?XSTACK_DISP0_8
   \   000166   8582..       MOV     ?V0 + 2,DPL
   \   000169   8583..       MOV     ?V0 + 3,DPH
   \   00016C   78..         MOV     R0,#?V0 + 2
   \   00016E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000171   78..         MOV     R0,#?V0 + 1
   \   000173   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000176   8C..         MOV     ?V0 + 2,R4
   \   000178   8D..         MOV     ?V0 + 3,R5
   \   00017A   78..         MOV     R0,#?V0 + 2
   \   00017C   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00017F   A9..         MOV     R1,?V0 + 0
   \   000181   EE           MOV     A,R6
   \   000182   FC           MOV     R4,A
   \   000183   EF           MOV     A,R7
   \   000184   FD           MOV     R5,A
   \   000185   740A         MOV     A,#0xa
   \   000187   12....       LCALL   ?XSTACK_DISP0_8
   \   00018A   AA82         MOV     R2,DPL
   \   00018C   AB83         MOV     R3,DPH
   \   00018E   12....       LCALL   ??ZDP_EndDeviceBindReq?relay
   \   000191   7409         MOV     A,#0x9
   \   000193   12....       LCALL   ?DEALLOC_XSTACK8
   \   000196   E9           MOV     A,R1
   \   000197   85..82       MOV     DPL,?XSP + 0
   \   00019A   85..83       MOV     DPH,?XSP + 1
   \   00019D   F0           MOVX    @DPTR,A
    866            }
    867          
    868            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \                     ??MT_ZdoEndDevBindRequest_6:
   \   00019E                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   00019E   AC82         MOV     R4,DPL
   \   0001A0   AD83         MOV     R5,DPH
   \   0001A2   7B01         MOV     R3,#0x1
   \   0001A4   AA..         MOV     R2,?V0 + 6
   \   0001A6   7965         MOV     R1,#0x65
   \   0001A8   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    869          }
   \   0001AB   7446         MOV     A,#0x46
   \   0001AD   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001B0   7F07         MOV     R7,#0x7
   \   0001B2   02....       LJMP    ?BANKED_LEAVE_XDATA
    870          
    871          /***************************************************************************************************
    872           * @fn      MT_ZdoBindRequest
    873           *
    874           * @brief   Handle a Bind request.
    875           *
    876           * @param   pBuf  - MT message data
    877           *
    878           * @return  void
    879           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    880          void MT_ZdoBindRequest(uint8 *pBuf)
   \                     MT_ZdoBindRequest:
    881          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 19
   \   000005   74ED         MOV     A,#-0x13
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    882            uint8 cmdId;
    883            uint8 retValue;
    884            zAddrType_t destAddr, devAddr;
    885            uint8 *pSrcAddr, *ptr;
    886            uint8 srcEPInt, dstEPInt;
    887            uint16 clusterID;
    888          
    889            /* parse header */
    890            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000A   8A82         MOV     DPL,R2
   \   00000C   8B83         MOV     DPH,R3
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   E0           MOVX    A,@DPTR
   \   000011   F5..         MOV     ?V0 + 3,A
    891            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000013   EA           MOV     A,R2
   \   000014   2403         ADD     A,#0x3
   \   000016   F5..         MOV     ?V0 + 0,A
   \   000018   EB           MOV     A,R3
   \   000019   3400         ADDC    A,#0x0
   \   00001B   F5..         MOV     ?V0 + 1,A
    892          
    893            /* Dev address */
    894            destAddr.addrMode = Addr16Bit;
   \   00001D   7402         MOV     A,#0x2
   \   00001F   C0E0         PUSH    A
   \   000021   7412         MOV     A,#0x12
   \   000023   12....       LCALL   ?XSTACK_DISP0_8
   \   000026   D0E0         POP     A
   \   000028   F0           MOVX    @DPTR,A
    895            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000029   85..82       MOV     DPL,?V0 + 0
   \   00002C   85..83       MOV     DPH,?V0 + 1
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   FA           MOV     R2,A
   \   000031   A3           INC     DPTR
   \   000032   E0           MOVX    A,@DPTR
   \   000033   F9           MOV     R1,A
   \   000034   EA           MOV     A,R2
   \   000035   F8           MOV     R0,A
   \   000036   740A         MOV     A,#0xa
   \   000038   12....       LCALL   ?XSTACK_DISP0_8
   \   00003B   E8           MOV     A,R0
   \   00003C   F0           MOVX    @DPTR,A
   \   00003D   A3           INC     DPTR
   \   00003E   E9           MOV     A,R1
   \   00003F   F0           MOVX    @DPTR,A
    896            pBuf += 2;
    897          
    898            /* SrcAddress */
    899            pSrcAddr = pBuf;
   \   000040   E5..         MOV     A,?V0 + 0
   \   000042   2402         ADD     A,#0x2
   \   000044   F5..         MOV     ?V0 + 6,A
   \   000046   E5..         MOV     A,?V0 + 1
   \   000048   3400         ADDC    A,#0x0
   \   00004A   F5..         MOV     ?V0 + 7,A
    900            pBuf += Z_EXTADDR_LEN;
   \   00004C   E5..         MOV     A,?V0 + 6
   \   00004E   2408         ADD     A,#0x8
   \   000050   F5..         MOV     ?V0 + 0,A
   \   000052   E5..         MOV     A,?V0 + 7
   \   000054   3400         ADDC    A,#0x0
    901          
    902            /* SrcEPInt */
    903            srcEPInt = *pBuf++;
   \   000056   85..82       MOV     DPL,?V0 + 0
   \   000059   F583         MOV     DPH,A
   \   00005B   E0           MOVX    A,@DPTR
   \   00005C   F5..         MOV     ?V0 + 2,A
   \   00005E   A3           INC     DPTR
   \   00005F   8582..       MOV     ?V0 + 0,DPL
   \   000062   8583..       MOV     ?V0 + 1,DPH
    904          
    905            /* ClusterID */
    906            clusterID = BUILD_UINT16( pBuf[0], pBuf[1]);
   \   000065   E0           MOVX    A,@DPTR
   \   000066   FA           MOV     R2,A
   \   000067   A3           INC     DPTR
   \   000068   E0           MOVX    A,@DPTR
   \   000069   F9           MOV     R1,A
   \   00006A   EA           MOV     A,R2
   \   00006B   FE           MOV     R6,A
   \   00006C   E9           MOV     A,R1
   \   00006D   FF           MOV     R7,A
    907            pBuf += 2;
   \   00006E   E5..         MOV     A,?V0 + 0
   \   000070   2402         ADD     A,#0x2
   \   000072   F5..         MOV     ?V0 + 0,A
   \   000074   E5..         MOV     A,?V0 + 1
   \   000076   3400         ADDC    A,#0x0
   \   000078   F5..         MOV     ?V0 + 1,A
    908          
    909            /* Destination Address mode */
    910            devAddr.addrMode = *pBuf++;
   \   00007A   85..82       MOV     DPL,?V0 + 0
   \   00007D   F583         MOV     DPH,A
   \   00007F   E0           MOVX    A,@DPTR
   \   000080   FA           MOV     R2,A
   \   000081   C0E0         PUSH    A
   \   000083   7409         MOV     A,#0x9
   \   000085   12....       LCALL   ?XSTACK_DISP0_8
   \   000088   D0E0         POP     A
   \   00008A   F0           MOVX    @DPTR,A
   \   00008B   85..82       MOV     DPL,?V0 + 0
   \   00008E   85..83       MOV     DPH,?V0 + 1
   \   000091   A3           INC     DPTR
   \   000092   8582..       MOV     ?V0 + 0,DPL
   \   000095   8583..       MOV     ?V0 + 1,DPH
    911          
    912            /* Destination Address */
    913            if ( devAddr.addrMode == Addr64Bit )
   \   000098   7403         MOV     A,#0x3
   \   00009A   6A           XRL     A,R2
   \   00009B   7012         JNZ     ??MT_ZdoBindRequest_0
    914            {
    915              ptr = pBuf;
    916              osal_cpyExtAddr( devAddr.addr.extAddr, ptr );
   \   00009D                ; Setup parameters for call to function sAddrExtCpy
   \   00009D   AC..         MOV     R4,?V0 + 0
   \   00009F   AD..         MOV     R5,?V0 + 1
   \   0000A1   7401         MOV     A,#0x1
   \   0000A3   12....       LCALL   ?XSTACK_DISP0_8
   \   0000A6   AA82         MOV     R2,DPL
   \   0000A8   AB83         MOV     R3,DPH
   \   0000AA   12....       LCALL   ??sAddrExtCpy?relay
   \   0000AD   8011         SJMP    ??MT_ZdoBindRequest_1
    917            }
    918            else
    919            {
    920              devAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \                     ??MT_ZdoBindRequest_0:
   \   0000AF   E0           MOVX    A,@DPTR
   \   0000B0   FA           MOV     R2,A
   \   0000B1   A3           INC     DPTR
   \   0000B2   E0           MOVX    A,@DPTR
   \   0000B3   F9           MOV     R1,A
   \   0000B4   EA           MOV     A,R2
   \   0000B5   F8           MOV     R0,A
   \   0000B6   7401         MOV     A,#0x1
   \   0000B8   12....       LCALL   ?XSTACK_DISP0_8
   \   0000BB   E8           MOV     A,R0
   \   0000BC   F0           MOVX    @DPTR,A
   \   0000BD   A3           INC     DPTR
   \   0000BE   E9           MOV     A,R1
   \   0000BF   F0           MOVX    @DPTR,A
    921            }
    922            /* The short address occupies LSB two bytes */
    923            pBuf += Z_EXTADDR_LEN;
    924          
    925            /* DstEPInt */
    926            dstEPInt = *pBuf;
    927          
    928            retValue = (uint8)ZDP_BindReq( &destAddr, pSrcAddr, srcEPInt, clusterID, &devAddr, dstEPInt, 0);
   \                     ??MT_ZdoBindRequest_1:
   \   0000C0                ; Setup parameters for call to function ZDP_BindUnbindReq
   \   0000C0   75..00       MOV     ?V0 + 4,#0x0
   \   0000C3   78..         MOV     R0,#?V0 + 4
   \   0000C5   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000C8   85..82       MOV     DPL,?V0 + 0
   \   0000CB   85..83       MOV     DPH,?V0 + 1
   \   0000CE   A3           INC     DPTR
   \   0000CF   A3           INC     DPTR
   \   0000D0   A3           INC     DPTR
   \   0000D1   A3           INC     DPTR
   \   0000D2   A3           INC     DPTR
   \   0000D3   A3           INC     DPTR
   \   0000D4   A3           INC     DPTR
   \   0000D5   A3           INC     DPTR
   \   0000D6   E0           MOVX    A,@DPTR
   \   0000D7   F5..         MOV     ?V0 + 0,A
   \   0000D9   78..         MOV     R0,#?V0 + 0
   \   0000DB   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000DE   7403         MOV     A,#0x3
   \   0000E0   12....       LCALL   ?XSTACK_DISP0_8
   \   0000E3   8582..       MOV     ?V0 + 0,DPL
   \   0000E6   8583..       MOV     ?V0 + 1,DPH
   \   0000E9   78..         MOV     R0,#?V0 + 0
   \   0000EB   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000EE   8E..         MOV     ?V0 + 0,R6
   \   0000F0   8F..         MOV     ?V0 + 1,R7
   \   0000F2   78..         MOV     R0,#?V0 + 0
   \   0000F4   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000F7   78..         MOV     R0,#?V0 + 6
   \   0000F9   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000FC   A9..         MOV     R1,?V0 + 2
   \   0000FE   7412         MOV     A,#0x12
   \   000100   12....       LCALL   ?XSTACK_DISP0_8
   \   000103   AC82         MOV     R4,DPL
   \   000105   AD83         MOV     R5,DPH
   \   000107   7A21         MOV     R2,#0x21
   \   000109   7B00         MOV     R3,#0x0
   \   00010B   12....       LCALL   ??ZDP_BindUnbindReq?relay
   \   00010E   7408         MOV     A,#0x8
   \   000110   12....       LCALL   ?DEALLOC_XSTACK8
   \   000113   E9           MOV     A,R1
   \   000114   85..82       MOV     DPL,?XSP + 0
   \   000117   85..83       MOV     DPH,?XSP + 1
   \   00011A   F0           MOVX    @DPTR,A
    929          
    930            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   00011B                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   00011B   AC82         MOV     R4,DPL
   \   00011D   AD83         MOV     R5,DPH
   \   00011F   7B01         MOV     R3,#0x1
   \   000121   AA..         MOV     R2,?V0 + 3
   \   000123   7965         MOV     R1,#0x65
   \   000125   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    931          }
   \   000128   7413         MOV     A,#0x13
   \   00012A   12....       LCALL   ?DEALLOC_XSTACK8
   \   00012D   7F08         MOV     R7,#0x8
   \   00012F   02....       LJMP    ?BANKED_LEAVE_XDATA
    932          
    933          /***************************************************************************************************
    934           * @fn      MT_ZdoUnbindRequest
    935           *
    936           * @brief   Handle a Unbind request.
    937           *
    938           * @param   pBuf  - MT message data
    939           *
    940           * @return  void
    941           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    942          void MT_ZdoUnbindRequest(uint8 *pBuf)
   \                     MT_ZdoUnbindRequest:
    943          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 19
   \   000005   74ED         MOV     A,#-0x13
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    944            uint8 cmdId;
    945            uint8 retValue;
    946            zAddrType_t destAddr, devAddr;
    947            uint8 *pSrcAddr, *ptr;
    948            uint8 srcEPInt, dstEPInt;
    949            uint16 clusterID;
    950          
    951            /* parse header */
    952            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000A   8A82         MOV     DPL,R2
   \   00000C   8B83         MOV     DPH,R3
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   E0           MOVX    A,@DPTR
   \   000011   F5..         MOV     ?V0 + 3,A
    953            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000013   EA           MOV     A,R2
   \   000014   2403         ADD     A,#0x3
   \   000016   F5..         MOV     ?V0 + 0,A
   \   000018   EB           MOV     A,R3
   \   000019   3400         ADDC    A,#0x0
   \   00001B   F5..         MOV     ?V0 + 1,A
    954          
    955            /* dev address */
    956            destAddr.addrMode = Addr16Bit;
   \   00001D   7402         MOV     A,#0x2
   \   00001F   C0E0         PUSH    A
   \   000021   7412         MOV     A,#0x12
   \   000023   12....       LCALL   ?XSTACK_DISP0_8
   \   000026   D0E0         POP     A
   \   000028   F0           MOVX    @DPTR,A
    957            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000029   85..82       MOV     DPL,?V0 + 0
   \   00002C   85..83       MOV     DPH,?V0 + 1
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   FA           MOV     R2,A
   \   000031   A3           INC     DPTR
   \   000032   E0           MOVX    A,@DPTR
   \   000033   F9           MOV     R1,A
   \   000034   EA           MOV     A,R2
   \   000035   F8           MOV     R0,A
   \   000036   740A         MOV     A,#0xa
   \   000038   12....       LCALL   ?XSTACK_DISP0_8
   \   00003B   E8           MOV     A,R0
   \   00003C   F0           MOVX    @DPTR,A
   \   00003D   A3           INC     DPTR
   \   00003E   E9           MOV     A,R1
   \   00003F   F0           MOVX    @DPTR,A
    958            pBuf += 2;
    959          
    960            /* SrcAddress */
    961            pSrcAddr = pBuf;
   \   000040   E5..         MOV     A,?V0 + 0
   \   000042   2402         ADD     A,#0x2
   \   000044   F5..         MOV     ?V0 + 6,A
   \   000046   E5..         MOV     A,?V0 + 1
   \   000048   3400         ADDC    A,#0x0
   \   00004A   F5..         MOV     ?V0 + 7,A
    962            pBuf += Z_EXTADDR_LEN;
   \   00004C   E5..         MOV     A,?V0 + 6
   \   00004E   2408         ADD     A,#0x8
   \   000050   F5..         MOV     ?V0 + 0,A
   \   000052   E5..         MOV     A,?V0 + 7
   \   000054   3400         ADDC    A,#0x0
    963          
    964            /* SrcEPInt */
    965            srcEPInt = *pBuf++;
   \   000056   85..82       MOV     DPL,?V0 + 0
   \   000059   F583         MOV     DPH,A
   \   00005B   E0           MOVX    A,@DPTR
   \   00005C   F5..         MOV     ?V0 + 2,A
   \   00005E   A3           INC     DPTR
   \   00005F   8582..       MOV     ?V0 + 0,DPL
   \   000062   8583..       MOV     ?V0 + 1,DPH
    966          
    967            /* ClusterID */
    968            clusterID = BUILD_UINT16( pBuf[0], pBuf[1]);
   \   000065   E0           MOVX    A,@DPTR
   \   000066   FA           MOV     R2,A
   \   000067   A3           INC     DPTR
   \   000068   E0           MOVX    A,@DPTR
   \   000069   F9           MOV     R1,A
   \   00006A   EA           MOV     A,R2
   \   00006B   FE           MOV     R6,A
   \   00006C   E9           MOV     A,R1
   \   00006D   FF           MOV     R7,A
    969            pBuf += 2;
   \   00006E   E5..         MOV     A,?V0 + 0
   \   000070   2402         ADD     A,#0x2
   \   000072   F5..         MOV     ?V0 + 0,A
   \   000074   E5..         MOV     A,?V0 + 1
   \   000076   3400         ADDC    A,#0x0
   \   000078   F5..         MOV     ?V0 + 1,A
    970          
    971            /* Destination Address mode */
    972            devAddr.addrMode = *pBuf++;
   \   00007A   85..82       MOV     DPL,?V0 + 0
   \   00007D   F583         MOV     DPH,A
   \   00007F   E0           MOVX    A,@DPTR
   \   000080   FA           MOV     R2,A
   \   000081   C0E0         PUSH    A
   \   000083   7409         MOV     A,#0x9
   \   000085   12....       LCALL   ?XSTACK_DISP0_8
   \   000088   D0E0         POP     A
   \   00008A   F0           MOVX    @DPTR,A
   \   00008B   85..82       MOV     DPL,?V0 + 0
   \   00008E   85..83       MOV     DPH,?V0 + 1
   \   000091   A3           INC     DPTR
   \   000092   8582..       MOV     ?V0 + 0,DPL
   \   000095   8583..       MOV     ?V0 + 1,DPH
    973          
    974            /* Destination Address */
    975            if ( devAddr.addrMode == Addr64Bit )
   \   000098   7403         MOV     A,#0x3
   \   00009A   6A           XRL     A,R2
   \   00009B   7012         JNZ     ??MT_ZdoUnbindRequest_0
    976            {
    977              ptr = pBuf;
    978              osal_cpyExtAddr( devAddr.addr.extAddr, ptr );
   \   00009D                ; Setup parameters for call to function sAddrExtCpy
   \   00009D   AC..         MOV     R4,?V0 + 0
   \   00009F   AD..         MOV     R5,?V0 + 1
   \   0000A1   7401         MOV     A,#0x1
   \   0000A3   12....       LCALL   ?XSTACK_DISP0_8
   \   0000A6   AA82         MOV     R2,DPL
   \   0000A8   AB83         MOV     R3,DPH
   \   0000AA   12....       LCALL   ??sAddrExtCpy?relay
   \   0000AD   8011         SJMP    ??MT_ZdoUnbindRequest_1
    979            }
    980            else
    981            {
    982              devAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   \                     ??MT_ZdoUnbindRequest_0:
   \   0000AF   E0           MOVX    A,@DPTR
   \   0000B0   FA           MOV     R2,A
   \   0000B1   A3           INC     DPTR
   \   0000B2   E0           MOVX    A,@DPTR
   \   0000B3   F9           MOV     R1,A
   \   0000B4   EA           MOV     A,R2
   \   0000B5   F8           MOV     R0,A
   \   0000B6   7401         MOV     A,#0x1
   \   0000B8   12....       LCALL   ?XSTACK_DISP0_8
   \   0000BB   E8           MOV     A,R0
   \   0000BC   F0           MOVX    @DPTR,A
   \   0000BD   A3           INC     DPTR
   \   0000BE   E9           MOV     A,R1
   \   0000BF   F0           MOVX    @DPTR,A
    983            }
    984            /* The short address occupies LSB two bytes */
    985            pBuf += Z_EXTADDR_LEN;
    986          
    987            /* dstEPInt */
    988            dstEPInt = *pBuf;
    989          
    990            retValue = (uint8)ZDP_UnbindReq( &destAddr, pSrcAddr, srcEPInt, clusterID, &devAddr, dstEPInt, 0);
   \                     ??MT_ZdoUnbindRequest_1:
   \   0000C0                ; Setup parameters for call to function ZDP_BindUnbindReq
   \   0000C0   75..00       MOV     ?V0 + 4,#0x0
   \   0000C3   78..         MOV     R0,#?V0 + 4
   \   0000C5   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000C8   85..82       MOV     DPL,?V0 + 0
   \   0000CB   85..83       MOV     DPH,?V0 + 1
   \   0000CE   A3           INC     DPTR
   \   0000CF   A3           INC     DPTR
   \   0000D0   A3           INC     DPTR
   \   0000D1   A3           INC     DPTR
   \   0000D2   A3           INC     DPTR
   \   0000D3   A3           INC     DPTR
   \   0000D4   A3           INC     DPTR
   \   0000D5   A3           INC     DPTR
   \   0000D6   E0           MOVX    A,@DPTR
   \   0000D7   F5..         MOV     ?V0 + 0,A
   \   0000D9   78..         MOV     R0,#?V0 + 0
   \   0000DB   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000DE   7403         MOV     A,#0x3
   \   0000E0   12....       LCALL   ?XSTACK_DISP0_8
   \   0000E3   8582..       MOV     ?V0 + 0,DPL
   \   0000E6   8583..       MOV     ?V0 + 1,DPH
   \   0000E9   78..         MOV     R0,#?V0 + 0
   \   0000EB   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000EE   8E..         MOV     ?V0 + 0,R6
   \   0000F0   8F..         MOV     ?V0 + 1,R7
   \   0000F2   78..         MOV     R0,#?V0 + 0
   \   0000F4   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000F7   78..         MOV     R0,#?V0 + 6
   \   0000F9   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000FC   A9..         MOV     R1,?V0 + 2
   \   0000FE   7412         MOV     A,#0x12
   \   000100   12....       LCALL   ?XSTACK_DISP0_8
   \   000103   AC82         MOV     R4,DPL
   \   000105   AD83         MOV     R5,DPH
   \   000107   7A22         MOV     R2,#0x22
   \   000109   7B00         MOV     R3,#0x0
   \   00010B   12....       LCALL   ??ZDP_BindUnbindReq?relay
   \   00010E   7408         MOV     A,#0x8
   \   000110   12....       LCALL   ?DEALLOC_XSTACK8
   \   000113   E9           MOV     A,R1
   \   000114   85..82       MOV     DPL,?XSP + 0
   \   000117   85..83       MOV     DPH,?XSP + 1
   \   00011A   F0           MOVX    @DPTR,A
    991          
    992            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   00011B                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   00011B   AC82         MOV     R4,DPL
   \   00011D   AD83         MOV     R5,DPH
   \   00011F   7B01         MOV     R3,#0x1
   \   000121   AA..         MOV     R2,?V0 + 3
   \   000123   7965         MOV     R1,#0x65
   \   000125   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    993          }
   \   000128   7413         MOV     A,#0x13
   \   00012A   12....       LCALL   ?DEALLOC_XSTACK8
   \   00012D   7F08         MOV     R7,#0x8
   \   00012F   02....       LJMP    ?BANKED_LEAVE_XDATA
    994          
    995          /***************************************************************************************************
    996           * @fn      MT_ZdoStartupFromApp
    997           *
    998           * @brief   Handle a Startup from App request.
    999           *
   1000           * @param   pBuf  - MT message data
   1001           *
   1002           * @return  void
   1003           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1004          void MT_ZdoStartupFromApp(uint8 *pBuf)
   \                     MT_ZdoStartupFromApp:
   1005          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   1006            uint8 cmdId;
   1007            uint8 retValue;
   1008          
   1009            /* parse header */
   1010            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00000A   8A82         MOV     DPL,R2
   \   00000C   8B83         MOV     DPH,R3
   \   00000E   A3           INC     DPTR
   \   00000F   A3           INC     DPTR
   \   000010   E0           MOVX    A,@DPTR
   \   000011   FE           MOV     R6,A
   1011            pBuf += MT_RPC_FRAME_HDR_SZ;
   1012          
   1013            retValue = ZDOInitDevice(100);
   \   000012                ; Setup parameters for call to function ZDOInitDevice
   \   000012   7A64         MOV     R2,#0x64
   \   000014   7B00         MOV     R3,#0x0
   \   000016   12....       LCALL   ??ZDOInitDevice?relay
   \   000019   E9           MOV     A,R1
   \   00001A   85..82       MOV     DPL,?XSP + 0
   \   00001D   85..83       MOV     DPH,?XSP + 1
   \   000020   F0           MOVX    @DPTR,A
   1014          
   1015            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   \   000021                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000021   AC82         MOV     R4,DPL
   \   000023   AD83         MOV     R5,DPH
   \   000025   7B01         MOV     R3,#0x1
   \   000027   EE           MOV     A,R6
   \   000028   FA           MOV     R2,A
   \   000029   7965         MOV     R1,#0x65
   \   00002B   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
   1016          }
   \   00002E   7401         MOV     A,#0x1
   \   000030   12....       LCALL   ?DEALLOC_XSTACK8
   \   000033   7F01         MOV     R7,#0x1
   \   000035   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoCommandProcessing?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoCommandProcessing

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoNWKAddressRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoNWKAddressRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoIEEEAddrRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoIEEEAddrRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoNodeDescRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoNodeDescRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoPowerDescRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoPowerDescRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoSimpleDescRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoSimpleDescRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoActiveEpRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoActiveEpRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoMatchDescRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoMatchDescRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoComplexDescRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoComplexDescRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoUserDescRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoUserDescRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoEndDevAnnce?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoEndDevAnnce

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoUserDescSet?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoUserDescSet

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoServiceDiscRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoServiceDiscRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoEndDevBindRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoEndDevBindRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoBindRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoBindRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoUnbindRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoUnbindRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZdoStartupFromApp?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZdoStartupFromApp
   1017          
   1018          #if defined (MT_ZDO_MGMT)
   1019          /***************************************************************************************************
   1020           * @fn      MT_ZdoMgmtNwkDiscRequest
   1021           *
   1022           * @brief   Handle a Mgmt Nwk Discovery request.
   1023           *
   1024           * @param   pBuf  - MT message data
   1025           *
   1026           * @return  void
   1027           ***************************************************************************************************/
   1028          void MT_ZdoMgmtNwkDiscRequest(uint8 *pBuf)
   1029          {
   1030            uint8 cmdId;
   1031            uint8 retValue;
   1032            zAddrType_t destAddr;
   1033            uint32 scanChannels;
   1034            uint8 scanDuration, startIndex;
   1035          
   1036            /* parse header */
   1037            cmdId = pBuf[MT_RPC_POS_CMD1];
   1038            pBuf += MT_RPC_FRAME_HDR_SZ;
   1039          
   1040            /* Dev address */
   1041            destAddr.addrMode = Addr16Bit;
   1042            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   1043            pBuf += 2;
   1044          
   1045            /* Scan Channels */
   1046            scanChannels = BUILD_UINT32( pBuf[0], pBuf[1], pBuf[2], pBuf[3] );
   1047            pBuf += 4;
   1048          
   1049            /* Scan Duration */
   1050            scanDuration = *pBuf++;
   1051          
   1052            /* Start Index */
   1053            startIndex = *pBuf;
   1054          
   1055            retValue = (uint8)ZDP_MgmtNwkDiscReq( &destAddr, scanChannels, scanDuration, startIndex, 0);
   1056          
   1057            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   1058          }
   1059          
   1060          /***************************************************************************************************
   1061           * @fn      MT_ZdoMgmtLqiRequest
   1062           *
   1063           * @brief   Handle a Mgmt Lqi request.
   1064           *
   1065           * @param   pBuf  - MT message data
   1066           *
   1067           * @return  void
   1068           ***************************************************************************************************/
   1069          void MT_ZdoMgmtLqiRequest(uint8 *pBuf)
   1070          {
   1071            uint8 cmdId;
   1072            uint8 retValue;
   1073            zAddrType_t destAddr;
   1074            uint8 startIndex;
   1075          
   1076            /* parse header */
   1077            cmdId = pBuf[MT_RPC_POS_CMD1];
   1078            pBuf += MT_RPC_FRAME_HDR_SZ;
   1079          
   1080            /* Dev address */
   1081            destAddr.addrMode = Addr16Bit;
   1082            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   1083            pBuf += 2;
   1084          
   1085            /* Start Index */
   1086            startIndex = *pBuf;
   1087          
   1088            retValue = (uint8)ZDP_MgmtLqiReq( &destAddr, startIndex, 0);
   1089          
   1090            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   1091          }
   1092          
   1093          /***************************************************************************************************
   1094           * @fn      MT_ZdoMgmtRtgRequest
   1095           *
   1096           * @brief   Handle a Mgmt Rtg request.
   1097           *
   1098           * @param   pBuf  - MT message data
   1099           *
   1100           * @return  void
   1101           ***************************************************************************************************/
   1102          void MT_ZdoMgmtRtgRequest(uint8 *pBuf)
   1103          {
   1104            uint8 cmdId;
   1105            uint8 retValue;
   1106            zAddrType_t destAddr;
   1107            uint8 startIndex;
   1108          
   1109            /* parse header */
   1110            cmdId = pBuf[MT_RPC_POS_CMD1];
   1111            pBuf += MT_RPC_FRAME_HDR_SZ;
   1112          
   1113            /* Dev Address */
   1114            destAddr.addrMode = Addr16Bit;
   1115            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1]);
   1116            pBuf += 2;
   1117          
   1118            /* Start Index */
   1119            startIndex = *pBuf;
   1120          
   1121            retValue = (byte)ZDP_MgmtRtgReq( &destAddr, startIndex, 0);
   1122          
   1123            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   1124          }
   1125          
   1126          /***************************************************************************************************
   1127           * @fn      MT_ZdoMgmtBindRequest
   1128           *
   1129           * @brief   Handle a Mgmt Bind request.
   1130           *
   1131           * @param   pBuf  - MT message data
   1132           *
   1133           * @return  void
   1134           ***************************************************************************************************/
   1135          void MT_ZdoMgmtBindRequest(uint8 *pBuf)
   1136          {
   1137            uint8 cmdId;
   1138            uint8 retValue;
   1139            zAddrType_t destAddr;
   1140            uint8 startIndex;
   1141          
   1142            /* parse header */
   1143            cmdId = pBuf[MT_RPC_POS_CMD1];
   1144            pBuf += MT_RPC_FRAME_HDR_SZ;
   1145          
   1146            /* Dev Address */
   1147            destAddr.addrMode = Addr16Bit;
   1148            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   1149            pBuf += 2;
   1150          
   1151            /* Start Index */
   1152            startIndex = *pBuf;
   1153          
   1154            retValue = (uint8)ZDP_MgmtBindReq( &destAddr, startIndex, 0);
   1155          
   1156            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   1157          }
   1158          
   1159          /***************************************************************************************************
   1160           * @fn      MT_ZdoMgmtLeaveRequest
   1161           *
   1162           * @brief   Handle a Mgmt Leave request.
   1163           *
   1164           * @param   pBuf  - MT message data
   1165           *
   1166           * @return  void
   1167           ***************************************************************************************************/
   1168          void MT_ZdoMgmtLeaveRequest(uint8 *pBuf)
   1169          {
   1170            uint8 cmdId;
   1171            uint8 retValue;
   1172            zAddrType_t destAddr;
   1173            uint8 *pIEEEAddr;
   1174            uint8 removeChildren, rejoin;
   1175          
   1176            /* parse header */
   1177            cmdId = pBuf[MT_RPC_POS_CMD1];
   1178            pBuf += MT_RPC_FRAME_HDR_SZ;
   1179          
   1180            /* Destination Address */
   1181            destAddr.addrMode = Addr16Bit;
   1182            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   1183            pBuf += 2;
   1184          
   1185            /* IEEE address */
   1186            pIEEEAddr = pBuf;
   1187            pBuf += Z_EXTADDR_LEN;
   1188          
   1189            /* Remove Children */
   1190            removeChildren = *pBuf++;
   1191          
   1192            /* Rejoin */
   1193            rejoin = *pBuf;
   1194          
   1195            retValue = (byte)ZDP_MgmtLeaveReq( &destAddr, pIEEEAddr, removeChildren, rejoin, 0);
   1196          
   1197            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   1198          }
   1199          
   1200          
   1201          /***************************************************************************************************
   1202           * @fn      MT_ZdoMgmtDirectJoinRequest
   1203           *
   1204           * @brief   Handle a Mgmt Direct Join request.
   1205           *
   1206           * @param   pBuf  - MT message data
   1207           *
   1208           * @return  void
   1209           ***************************************************************************************************/
   1210          void MT_ZdoMgmtDirectJoinRequest(uint8 *pBuf)
   1211          {
   1212            uint8 cmdId;
   1213            uint8 retValue;
   1214            zAddrType_t destAddr;
   1215            uint8 *deviceAddr;
   1216            uint8 capInfo;
   1217          
   1218            /* parse header */
   1219            cmdId = pBuf[MT_RPC_POS_CMD1];
   1220            pBuf += MT_RPC_FRAME_HDR_SZ;
   1221          
   1222            /* Destination Address */
   1223            destAddr.addrMode = Addr16Bit;
   1224            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   1225            pBuf += 2;
   1226          
   1227            /* Device Address */
   1228            deviceAddr = pBuf;
   1229            pBuf += Z_EXTADDR_LEN;
   1230          
   1231            /* Capability information */
   1232            capInfo = *pBuf;
   1233          
   1234            retValue = (uint8)ZDP_MgmtDirectJoinReq( &destAddr, deviceAddr, capInfo, 0);
   1235          
   1236            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   1237          }
   1238          
   1239          /***************************************************************************************************
   1240           * @fn      MT_ZdoMgmtPermitJoinRequest
   1241           *
   1242           * @brief   Handle a Mgmt Permit Join request.
   1243           *
   1244           * @param   pBuf  - MT message data
   1245           *
   1246           * @return  void
   1247           ***************************************************************************************************/
   1248          void MT_ZdoMgmtPermitJoinRequest(uint8 *pBuf)
   1249          {
   1250            uint8 cmdId;
   1251            uint8 retValue;
   1252            zAddrType_t destAddr;
   1253            uint8 duration, tcSignificance;
   1254          
   1255            /* parse header */
   1256            cmdId = pBuf[MT_RPC_POS_CMD1];
   1257            pBuf += MT_RPC_FRAME_HDR_SZ;
   1258          
   1259            /* Destination Address */
   1260            destAddr.addrMode = Addr16Bit;
   1261            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   1262            pBuf += 2;
   1263          
   1264            /* Duration */
   1265            duration = *pBuf++;
   1266          
   1267            /* Trust center significance */
   1268            tcSignificance = *pBuf;
   1269          
   1270            retValue = (byte)ZDP_MgmtPermitJoinReq( &destAddr, duration, tcSignificance, 0);
   1271          
   1272            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   1273          }
   1274          
   1275          /***************************************************************************************************
   1276           * @fn      MT_ZdoMgmtNwkUpdateRequest
   1277           *
   1278           * @brief   Handle a Mgmt Nwk Update request.
   1279           *
   1280           * @param   pBuf  - MT message data
   1281           *
   1282           * @return  void
   1283           ***************************************************************************************************/
   1284          void MT_ZdoMgmtNwkUpdateRequest(uint8 *pBuf)
   1285          {
   1286            uint8 cmdId;
   1287            uint8 retValue;
   1288            zAddrType_t destAddr;
   1289            uint32 channelMask;
   1290            uint8 scanDuration, scanCount;
   1291            uint16 nwkManagerAddr;
   1292          
   1293              /* parse header */
   1294            cmdId = pBuf[MT_RPC_POS_CMD1];
   1295            pBuf += MT_RPC_FRAME_HDR_SZ;
   1296          
   1297            /* Destination address */
   1298            destAddr.addr.shortAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   1299            pBuf += 2;
   1300          
   1301            /* Destination address mode */
   1302            destAddr.addrMode = *pBuf++;
   1303          
   1304            channelMask = BUILD_UINT32( pBuf[0], pBuf[1], pBuf[2], pBuf[3]);
   1305            pBuf += 4;
   1306          
   1307            /* Scan duration */
   1308            scanDuration = *pBuf++;
   1309          
   1310            /* Scan count */
   1311            scanCount = *pBuf++;
   1312          
   1313            /* NWK manager address */
   1314            nwkManagerAddr = BUILD_UINT16( pBuf[0], pBuf[1] );
   1315          
   1316            /* Send the Management Network Update request */
   1317            retValue = (uint8)ZDP_MgmtNwkUpdateReq( &destAddr, channelMask, scanDuration,
   1318                                                    scanCount, _NIB.nwkUpdateId+1, nwkManagerAddr );
   1319          
   1320            /*
   1321              Since we don't recevied our own broadcast messages, we should
   1322              send a unicast copy of the message to ourself.
   1323            */
   1324            if ( destAddr.addrMode == AddrBroadcast )
   1325            {
   1326              destAddr.addrMode = Addr16Bit;
   1327              destAddr.addr.shortAddr = _NIB.nwkDevAddress;
   1328              retValue = (uint8) ZDP_MgmtNwkUpdateReq( &destAddr, channelMask, scanDuration,
   1329                                                       scanCount, _NIB.nwkUpdateId+1, nwkManagerAddr );
   1330            }
   1331          
   1332            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_ZDO), cmdId, 1, &retValue);
   1333          }
   1334          #endif /* MT_ZDO_MGMT */
   1335          
   1336          #endif /* MT_ZDO_FUNC */
   1337          
   1338          
   1339          /***************************************************************************************************
   1340           * Callback handling function
   1341           ***************************************************************************************************/
   1342          
   1343          #if defined (MT_ZDO_CB_FUNC)
   1344          /***************************************************************************************************
   1345           * @fn     MT_ZdoDirectCB()
   1346           *
   1347           * @brief  ZDO direct callback.  Build an MT message directly from the
   1348           *         over-the-air ZDO message.
   1349           *
   1350           * @param  pData - Incoming AF frame.
   1351           *
   1352           * @return  none
   1353           ***************************************************************************************************/
   1354          void MT_ZdoDirectCB( afIncomingMSGPacket_t *pData,  zdoIncomingMsg_t *inMsg )
   1355          {
   1356            uint8 dataLen;
   1357            uint8 msgLen;
   1358            uint8 *pBuf;
   1359            uint8 *p;
   1360            uint8 id;
   1361            
   1362            // Is the message an exception or not a response?
   1363            if ( MT_ZdoHandleExceptions( pData, inMsg ) || ( (pData->clusterId & ZDO_RESPONSE_BIT) == 0 ) )
   1364            {
   1365              // Handled somewhere else or not needed
   1366              return;
   1367            }
   1368          
   1369            /* map cluster ID to MT message */
   1370            id = (uint8) pData->clusterId;
   1371            id = mtZdoCluster2Rsp[id >> 4][id & 0x0F];
   1372          
   1373            /* ZDO data starts after one-byte sequence number */
   1374            dataLen = pData->cmd.DataLength - 1;
   1375          
   1376            /* msg buffer length includes two bytes for srcAddr */
   1377            msgLen = dataLen + sizeof(uint16);
   1378          
   1379            /* get buffer */
   1380            if ((p = pBuf = MT_TransportAlloc(((uint8)MT_RPC_CMD_AREQ |(uint8)MT_RPC_SYS_ZDO), msgLen)) != NULL)
   1381            {
   1382              /* build header */
   1383              *p++ = msgLen;
   1384              *p++ = (uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_ZDO;
   1385              *p++ = id;
   1386          
   1387              /* build srcAddr */
   1388              *p++ = LO_UINT16(pData->srcAddr.addr.shortAddr);
   1389              *p++ = HI_UINT16(pData->srcAddr.addr.shortAddr);
   1390          
   1391              /* copy ZDO data, skipping one-byte sequence number */
   1392              osal_memcpy(p, (pData->cmd.Data + 1), dataLen);
   1393          
   1394              /* send it */
   1395              MT_TransportSend(pBuf);
   1396            }
   1397          }
   1398          
   1399          /***************************************************************************************************
   1400           * @fn     MT_ZdoHandleExceptions()
   1401           *
   1402           * @brief  Handles all messages that are an expection to the generic MT ZDO Response.
   1403           *
   1404           * @param  pData - Incoming AF frame.
   1405           *
   1406           * @return  TRUE if handled by this function, FALSE if not
   1407           ***************************************************************************************************/
   1408          uint8 MT_ZdoHandleExceptions( afIncomingMSGPacket_t *pData, zdoIncomingMsg_t *inMsg )
   1409          {
   1410            uint8 ret = TRUE;
   1411            ZDO_NwkIEEEAddrResp_t *nwkRsp = NULL;
   1412            ZDO_DeviceAnnce_t devAnnce;
   1413            uint8 doDefault = FALSE;
   1414            
   1415            switch ( inMsg->clusterID )
   1416            {
   1417              case NWK_addr_rsp:
   1418              case IEEE_addr_rsp:
   1419                nwkRsp = ZDO_ParseAddrRsp( inMsg );
   1420                MT_ZdoAddrRspCB( nwkRsp, inMsg->clusterID );
   1421                if ( nwkRsp )
   1422                  osal_mem_free( nwkRsp );
   1423                break;
   1424                
   1425              case Device_annce:
   1426                ZDO_ParseDeviceAnnce( inMsg, &devAnnce );
   1427                MT_ZdoEndDevAnnceCB( &devAnnce, inMsg->srcAddr.addr.shortAddr );
   1428                break;
   1429                
   1430              case Simple_Desc_rsp:
   1431                if ( pData->cmd.DataLength > 5 )
   1432                  ret = FALSE;
   1433                else
   1434                  doDefault = TRUE;        
   1435                break;  
   1436                
   1437              default:
   1438                ret = FALSE;
   1439                break;
   1440            }
   1441            
   1442            if ( doDefault )
   1443            {
   1444              ret = FALSE;
   1445              pData->clusterId = 0x26;
   1446              pData->cmd.DataLength = 2;
   1447            }
   1448            
   1449            return ( ret );
   1450          }
   1451          
   1452          /***************************************************************************************************
   1453           * @fn      MT_ZdoAddrRspCB
   1454           *
   1455           * @brief   Handle IEEE or nwk address response OSAL message from ZDO.
   1456           *
   1457           * @param   pMsg  - Message data
   1458           *
   1459           * @return  void
   1460           */
   1461          void MT_ZdoAddrRspCB( ZDO_NwkIEEEAddrResp_t *pMsg, uint16 clusterID )
   1462          {
   1463            uint8   listLen;
   1464            uint8   msgLen;
   1465            uint8   *pBuf;
   1466            uint8   *p;
   1467          
   1468            /* both ZDO_NwkAddrResp_t and ZDO_IEEEAddrResp_t must be the same */
   1469          
   1470            /* get length, sanity check length */
   1471            listLen = pMsg->numAssocDevs;
   1472            
   1473            /* calculate msg length */
   1474            msgLen = MT_ZDO_ADDR_RSP_LEN + (listLen * sizeof(uint16));
   1475          
   1476            /* get buffer */
   1477            if ((p = pBuf = MT_TransportAlloc(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_ZDO), msgLen)) != NULL)
   1478            {
   1479              /* build header */
   1480              *p++ = msgLen;
   1481              *p++ = (uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_ZDO;
   1482              *p++ = (clusterID == IEEE_addr_rsp) ?
   1483                     MT_ZDO_IEEE_ADDR_RSP : MT_ZDO_NWK_ADDR_RSP;
   1484          
   1485              /* build msg parameters */
   1486          
   1487              *p++ = pMsg->status;
   1488          
   1489              osal_cpyExtAddr(p, pMsg->extAddr);
   1490              p += Z_EXTADDR_LEN;
   1491          
   1492              *p++ = LO_UINT16(pMsg->nwkAddr);
   1493              *p++ = HI_UINT16(pMsg->nwkAddr);
   1494          
   1495              *p++ = pMsg->startIndex;
   1496          
   1497              *p++ = listLen;
   1498          
   1499              MT_Word2Buf(p, pMsg->devList, listLen);
   1500          
   1501              /* send it */
   1502              MT_TransportSend(pBuf);
   1503            }
   1504          }
   1505          
   1506          /***************************************************************************************************
   1507           * @fn      MT_ZdoEndDevAnnceCB
   1508           *
   1509           * @brief   Handle end device announce OSAL message from ZDO.
   1510           *
   1511           * @param   pMsg  - Message data
   1512           *
   1513           * @return  void
   1514           */
   1515          void MT_ZdoEndDevAnnceCB( ZDO_DeviceAnnce_t *pMsg, uint16 srcAddr )
   1516          {
   1517            uint8 *pBuf;
   1518            uint8 *p;
   1519          
   1520            if ((p = pBuf = MT_TransportAlloc(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_ZDO),
   1521                              MT_ZDO_END_DEVICE_ANNCE_IND_LEN)) != NULL)
   1522            {
   1523              *p++ = MT_ZDO_END_DEVICE_ANNCE_IND_LEN;
   1524              *p++ = (uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_ZDO;
   1525              *p++ = MT_ZDO_END_DEVICE_ANNCE_IND;
   1526          
   1527              *p++ = LO_UINT16(srcAddr);
   1528              *p++ = HI_UINT16(srcAddr);
   1529          
   1530              *p++ = LO_UINT16(pMsg->nwkAddr);
   1531              *p++ = HI_UINT16(pMsg->nwkAddr);
   1532          
   1533              osal_cpyExtAddr(p, pMsg->extAddr);
   1534              p += Z_EXTADDR_LEN;
   1535          
   1536              *p = pMsg->capabilities;
   1537          
   1538              MT_TransportSend(pBuf);
   1539            }
   1540          }
   1541          #endif // MT_ZDO_CB_FUNC
   1542          /***************************************************************************************************
   1543          ***************************************************************************************************/
   1544          
   1545          #endif   /*ZDO Command Processing in MT*/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     MT_ZdoActiveEpRequest              1      0     29
       -> ZDP_NWKAddrOfInterestReq      0      0     40
       -> MT_BuildAndSendZToolResponse
                                        0      0     38
     MT_ZdoBindRequest                  1      0     52
       -> sAddrExtCpy                   0      0     70
       -> ZDP_BindUnbindReq             0      0     86
       -> MT_BuildAndSendZToolResponse
                                        0      0     70
     MT_ZdoCommandProcessing            0      0      9
       -> MT_ZdoNWKAddressRequest       0      0     18
       -> MT_ZdoIEEEAddrRequest         0      0     18
       -> MT_ZdoNodeDescRequest         0      0     18
       -> MT_ZdoPowerDescRequest        0      0     18
       -> MT_ZdoSimpleDescRequest       0      0     18
       -> MT_ZdoActiveEpRequest         0      0     18
       -> MT_ZdoMatchDescRequest        0      0     18
       -> MT_ZdoComplexDescRequest      0      0     18
       -> MT_ZdoUserDescRequest         0      0     18
       -> MT_ZdoEndDevAnnce             0      0     18
       -> MT_ZdoUserDescSet             0      0     18
       -> MT_ZdoServiceDiscRequest      0      0     18
       -> MT_ZdoEndDevBindRequest       0      0     18
       -> MT_ZdoBindRequest             0      0     18
       -> MT_ZdoUnbindRequest           0      0     18
       -> MT_ZdoStartupFromApp          0      0     18
     MT_ZdoComplexDescRequest           1      0     29
       -> ZDP_NWKAddrOfInterestReq      0      0     40
       -> MT_BuildAndSendZToolResponse
                                        0      0     38
     MT_ZdoEndDevAnnce                  1      0     20
       -> ZDP_DeviceAnnce               0      0     22
       -> MT_BuildAndSendZToolResponse
                                        0      0     20
     MT_ZdoEndDevBindRequest            1      0    103
       -> ZDP_EndDeviceBindReq          0      0    188
       -> MT_BuildAndSendZToolResponse
                                        0      0    170
     MT_ZdoIEEEAddrRequest              1      0     19
       -> ZDP_IEEEAddrReq               0      0     20
       -> MT_BuildAndSendZToolResponse
                                        0      0     20
     MT_ZdoMatchDescRequest             1      0    105
       -> ZDP_MatchDescReq              0      0    192
       -> MT_BuildAndSendZToolResponse
                                        0      0    176
     MT_ZdoNWKAddressRequest            1      0     20
       -> ZDP_NwkAddrReq                0      0     22
       -> MT_BuildAndSendZToolResponse
                                        0      0     22
     MT_ZdoNodeDescRequest              1      0     29
       -> ZDP_NWKAddrOfInterestReq      0      0     40
       -> MT_BuildAndSendZToolResponse
                                        0      0     38
     MT_ZdoPowerDescRequest             1      0     29
       -> ZDP_NWKAddrOfInterestReq      0      0     40
       -> MT_BuildAndSendZToolResponse
                                        0      0     38
     MT_ZdoServiceDiscRequest           1      0     19
       -> ZDP_ServerDiscReq             0      0     20
       -> MT_BuildAndSendZToolResponse
                                        0      0     20
     MT_ZdoSimpleDescRequest            1      0     29
       -> ZDP_SimpleDescReq             0      0     40
       -> MT_BuildAndSendZToolResponse
                                        0      0     38
     MT_ZdoStartupFromApp               1      0     19
       -> ZDOInitDevice                 0      0     20
       -> MT_BuildAndSendZToolResponse
                                        0      0     20
     MT_ZdoUnbindRequest                1      0     52
       -> sAddrExtCpy                   0      0     70
       -> ZDP_BindUnbindReq             0      0     86
       -> MT_BuildAndSendZToolResponse
                                        0      0     70
     MT_ZdoUserDescRequest              1      0     29
       -> ZDP_NWKAddrOfInterestReq      0      0     40
       -> MT_BuildAndSendZToolResponse
                                        0      0     38
     MT_ZdoUserDescSet                  1      0     51
       -> osal_memcpy                   0      0     84
       -> ZDP_UserDescSet               0      0     82
       -> MT_BuildAndSendZToolResponse
                                        0      0     78


   Segment part sizes:

     Function/Label                   Bytes
     --------------                   -----
     _zdoCallbackSub                     4
     mtzdoResponseBuffer               100
     MT_ZdoCommandProcessing           158
     MT_ZdoNWKAddressRequest            87
     MT_ZdoIEEEAddrRequest             100
     MT_ZdoNodeDescRequest             136
     MT_ZdoPowerDescRequest            137
     MT_ZdoSimpleDescRequest           143
     MT_ZdoActiveEpRequest             137
     MT_ZdoMatchDescRequest            413
     MT_ZdoComplexDescRequest          137
     MT_ZdoUserDescRequest             137
     MT_ZdoEndDevAnnce                 113
     MT_ZdoUserDescSet                 227
     MT_ZdoServiceDiscRequest           75
     MT_ZdoEndDevBindRequest           437
     MT_ZdoBindRequest                 306
     MT_ZdoUnbindRequest               306
     MT_ZdoStartupFromApp               56
     ??MT_ZdoCommandProcessing?relay     6
     ??MT_ZdoNWKAddressRequest?relay     6
     ??MT_ZdoIEEEAddrRequest?relay       6
     ??MT_ZdoNodeDescRequest?relay       6
     ??MT_ZdoPowerDescRequest?relay      6
     ??MT_ZdoSimpleDescRequest?relay     6
     ??MT_ZdoActiveEpRequest?relay       6
     ??MT_ZdoMatchDescRequest?relay      6
     ??MT_ZdoComplexDescRequest?relay    6
     ??MT_ZdoUserDescRequest?relay       6
     ??MT_ZdoEndDevAnnce?relay           6
     ??MT_ZdoUserDescSet?relay           6
     ??MT_ZdoServiceDiscRequest?relay    6
     ??MT_ZdoEndDevBindRequest?relay     6
     ??MT_ZdoBindRequest?relay           6
     ??MT_ZdoUnbindRequest?relay         6
     ??MT_ZdoStartupFromApp?relay        6

 
 3 105 bytes in segment BANKED_CODE
   102 bytes in segment BANK_RELAYS
   104 bytes in segment XDATA_Z
 
 3 207 bytes of CODE  memory
   104 bytes of XDATA memory

Errors: none
Warnings: none
